&lt;?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Regressão on Fellipe Gomes - Data Science Blog</title>
    <link>https://gomesfellipe.github.io/categories/regress%C3%A3o/</link>
    <description>Últimos posts sobre Data Science, Machine Learning e R</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>pt-br</language>
    <managingEditor>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</managingEditor>
    <webMaster>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</webMaster>
    <lastBuildDate>Sat, 29 Sep 2018 00:00:00 +0000</lastBuildDate>
    <atom:link href="https://gomesfellipe.github.io/categories/regress%C3%A3o/" rel="self" type="application/rss+xml" />
    <item>
      <title>Com que frequência ocorrem acidentes na ponte Rio-Niterói?</title>
      <link>https://gomesfellipe.github.io/post/2018-09-29-freq-acidente-ponte-rio-niteroi/freq-acidente-ponte-rio-niteroi/</link>
      <pubDate>Sat, 29 Sep 2018 00:00:00 +0000</pubDate>
      <author>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</author>
      <guid>https://gomesfellipe.github.io/post/2018-09-29-freq-acidente-ponte-rio-niteroi/freq-acidente-ponte-rio-niteroi/</guid>
      <description>Com os dados públicos da PRF e um pouco de Estatística buscaremos respostas para esta e outras perguntas relacionadas ao número de acidentes na Ponte Rio-Niterói.</description>
      <content:encoded>&lt;![CDATA[
        
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>
<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>
<link href="/rmarkdown-libs/lightable/lightable.css" rel="stylesheet" />
<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/leaflet/leaflet.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet/leaflet.js"></script>
<link href="/rmarkdown-libs/leafletfix/leafletfix.css" rel="stylesheet" />
<script src="/rmarkdown-libs/proj4/proj4.min.js"></script>
<script src="/rmarkdown-libs/Proj4Leaflet/proj4leaflet.js"></script>
<link href="/rmarkdown-libs/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-binding/leaflet.js"></script>
<link href="/rmarkdown-libs/leaflet-markercluster/MarkerCluster.css" rel="stylesheet" />
<link href="/rmarkdown-libs/leaflet-markercluster/MarkerCluster.Default.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-markercluster/leaflet.markercluster.js"></script>
<script src="/rmarkdown-libs/leaflet-markercluster/leaflet.markercluster.freezable.js"></script>
<script src="/rmarkdown-libs/leaflet-markercluster/leaflet.markercluster.layersupport.js"></script>
<link href="/rmarkdown-libs/leaflet-easybutton/easy-button.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-easybutton/easy-button.js"></script>
<script src="/rmarkdown-libs/leaflet-easybutton/EasyButton-binding.js"></script>
<link href="/rmarkdown-libs/ionicons/ionicons.min.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-providers/leaflet-providers_1.9.0.js"></script>
<script src="/rmarkdown-libs/leaflet-providers-plugin/leaflet-providers-plugin.js"></script>


<div id="perguntas" class="section level1">
<h1>Perguntas</h1>
<p>Estudar em outra cidade têm suas vantagens e desvantagens, durante toda a graduação atravessei Baía de Guanabara pela Ponte Presidente Costa e Silva, (popularmente conhecida como Ponte Rio–Niterói) assim como todas as pessoas que fazem esse trajeto diariamente e diante de tanta beleza natural com a vista panorâmica da Baía como os espetáculos proporcionados pelo pôr do sol, os pássaros ou a beleza inegável do Pão de Açúcar também é notável a beleza fruto da maior habilidade humana: a <strong>criatividade</strong>. Temos o cristo, todos aqueles grandes barcos, o Porto do Rio de Janeiro com todas aquelas obras de Engenharia, ou até mesmo a própria Ponte, que por si só já é intrigante.</p>
<p>Em contrapartida, dentre as desvantagens está a enorme frequência de engarrafamentos, o custo, o <strong>tempo</strong> gasto no trajeto e ao refletir sobre a velocidade dos carros na travessia da Ponte e a quantidade de acidentes que ocorrem na me deparei com os seguinte questionamentos:</p>
<blockquote>
<p>O número de acidentes na ponte é diário?</p>
<p>O número de acidentes na ponte têm diminuído?</p>
<p>A instalação das câmeras de segurança diminuiu o número de acidentes?</p>
</blockquote>
<p>Em janeiro de 2018 anunciava-se no jornal: <a href="https://oglobo.globo.com/rio/bairros/radares-da-ponte-rio-niteroi-comecam-multar-nesta-segunda-22284313">“radares da Ponte Rio-Niterói começam a multar”</a> e como já faz algum tempo que a ponte é monitorada com câmeras de segurança surge a suspeita se o número de acidentes têm diminuído e na vontade de tirar minhas próprias conclusões recorri ao que há de mais abundante por ai: <strong>os dados</strong> e com o uso de técnicas simples de Estatística iniciei minha “investigação” para obter possíveis respostas para essas perguntas.</p>
<p>Pacotes utilizados nesta análise:</p>
<pre class="text"><code>library(grid)           # textGrob()
library(dplyr)          # Manipulacao dos dados
library(purrr)          # Programacao Funcional
library(stringr)        # Manipulacao de strings
library(magrittr)       # Pipes
library(leaflet)        # Mapa interativo
library(leaflet.extras) # + leaflet
library(ggplot2)        # graficos elegantes
library(lubridate)      # manipulacao de data
library(data.table)     # fred()
library(forecast)       # tslm()
library(ggfortify)      # autoplot()
library(gridExtra)      # + ggplot2
library(zoo)            # rollmean
library(broom)          # tidy() augment() glance()
library(knitr)          # kable()
library(kableExtra)     # scroll_box
library(formattable)    # color_bar()</code></pre>
</div>
<div id="fonte-dos-dados" class="section level1">
<h1>Fonte dos dados</h1>
<p>Os dados para realizar esta pesquisa foram obtidos no site da Polícia Rodoviária Federal, que disponibiliza uma sessão de <a href="https://www.prf.gov.br/portal/dados-abertos/">Dados Abertos</a> que segundo o site: “não possui restrição de licenças, patentes ou mecanismos de controle, de modo a estarem livremente disponíveis para serem utilizados e redistribuídos à vontade”. Na sessão de <a href="https://www.prf.gov.br/portal/dados-abertos/acidentes/acidentes">Acidentes</a> é possível encontrar os registros de acidentes no formato csv ao longo dos anos.</p>
<p><strong>Discussão:</strong> Para saber se de fato o número de acidentes na ponte Rio-Niterói ocorre diariamente seria necessário que todos os casos fossem registrados ou elaborar alguma forma de fazer inferência para obter significância estatística para esta resposta baseado na amostra de ocorrências registradas. Ainda é possível que ocorram <a href="https://dicionario.priberam.org/subnotifica%C3%A7%C3%A3o">subnotificações</a> pois pode ser que alguns casos como uma leve batida entre dois carros não tenham sido registrados pela PRF.</p>
<p><strong>Reflexão</strong>: Uma sugestão para contornar esse problema de <strong>subnotifação</strong> (caso de fato exista) poderia ser o desenvolvimento de um algorítimo de <strong>Inteligência Artificial</strong> baseado em <strong>Deep Learning</strong> para captar através das <strong>imagens</strong> das câmeras de segurança a ocorrência dos acidentes, classifica-los e armazenar em uma base de dados de forma automatizada além de notificar às autoridades..</p>
<p>Dada as circunstâncias, vejamos o que os dados disponibilizados pela PRF têm à revelar. Após baixar todos os dados, bastou fazer a leitura com os comandos:</p>
<pre class="text"><code># Importar / Arrumar / Limpar
base &lt;- 
  paste0(&quot;datatran&quot;,2008:2018,&quot;/&quot;,&quot;datatran&quot;,2008:2018,&quot;.csv&quot;) %&gt;% 
  map(~.x %&gt;%
        fread(sep = &quot;;&quot;,dec=&quot;,&quot;)%&gt;% 
        mutate(km = as.character(km),
               br = as.character(br)) %&gt;% 
        mutate_if(is.character,
                  ~.x %&gt;%
                    enc2native() %&gt;%
                    abjutils::rm_accent() %&gt;% 
                    tolower() %&gt;% 
                    str_replace_all(&quot;/&quot;,&quot;-&quot;) %&gt;% 
                    str_replace_all(&quot;,&quot;,&quot;\\.&quot;)
        ) %&gt;%
        mutate(data_inversa = if_else(is.na(dmy(data_inversa)),
                                      ymd(data_inversa),
                                      dmy(data_inversa)) ,
               km = as.numeric(km),
               br = as.numeric(br),
               id = as.character(id),
               dia_semana = str_remove_all(dia_semana,&quot;-feira&quot;)
        ) %&gt;%
        filter(br==101 &amp; km&gt;=321 &amp; km&lt;334)  %&gt;% 
        .[str_detect(.$municipio,&quot;(niteroi|rio de janeiro)&quot;),] 
  )

# Salvar base arrumada:
saveRDS(base, &#39;base.RDS&#39;)</code></pre>
<p><em>Nota: A única pasta que tinha a base com nome diferente das demais foi no ano de 2016, do qual foi preciso renomear o arquivo <code>datatran2016_atual.csv</code> para <code>datatran2016.csv</code>.</em></p>
<p>Diante de tantos dados, foi necessário fazer um filtro para obter apenas os dados da ponte Rio- Niterói.</p>
<p>Segundo o Google, o “endereço” da ponte é <a href="https://www.google.com.br/search?q=ponte+rio+niteroi+br101&amp;oq=ponte+rio+niteroi+br101&amp;aqs=chrome..69i57j0l2.5680j0j7&amp;sourceid=chrome&amp;ie=UTF-8">BR-101, Km 321-334</a>, portanto foi aplicado um filtro que levasse em conta essa informação.</p>
</div>
<div id="análises-preliminares" class="section level1">
<h1>Análises preliminares</h1>
<p>Com a base de dados arrumada e salva em no objeto <code>base.RDS</code> fica mais fácil fazer análises rápidas depois de reiniciar o R e a leitura dos dados também será mais veloz.</p>
<pre class="text"><code>base &lt;- readRDS(&quot;base.RDS&quot;)</code></pre>
<p>Primeiramente, um breve resumo dos dados com algumas informações gerais dos últimos 10 anos:</p>
<pre class="text"><code>base %&gt;% 
  map_df( ~.x %&gt;% 
            select(dia_semana,classificacao_acidente, mortos, feridos, veiculos)) %&gt;%
  map_if(is.character,as.factor) %&gt;% 
  bind_cols() %&gt;% 
  SmartEDA::ExpCatViz(target=NULL, fname=NULL, margin=2, Page = c(2,2)) </code></pre>
<pre><code>## $`0`</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-4-1.png" width="1152" /></p>
<p>Nota-se que o maior número de acidentes ocorre na sexta-feira, praticamente todos os acidentes não tiveram mortos e em 78% dos acidentes não houveram vítimas. A maioria dos acidentes foi colisão entre dois carros.</p>
<p>Os tipos de acidentes que ocorreram foram:</p>
<pre class="text"><code>base %&gt;% 
  map_df( ~.x %&gt;% 
            select(causa_acidente,
                   tipo_acidente)) %&gt;%
  map_if(is.character,as.factor) %&gt;% 
  as_tibble %&gt;% 
  group_by(causa_acidente) %&gt;% 
  dplyr::summarise(n=n()) %&gt;% 
  mutate(n = color_bar(&quot;lightgrey&quot;)(n)) %&gt;% 
  kable(escape = F) %&gt;%
  kable_styling(&quot;hover&quot;,full_width = F) %&gt;%
  scroll_box( height = &quot;200px&quot;)</code></pre>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; ">
<table class="table table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
causa_acidente
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
agressao externa
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.02%">1</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
animais na pista
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.08%">4</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
avarias e-ou desgaste excessivo no pneu
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.10%">5</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
condutor dormindo
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.08%">4</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
defeito mecanico em veiculo
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 4.10%">210</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
defeito mecanico no veiculo
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.51%">26</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
defeito na via
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.18%">9</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
desobediencia a sinalizacao
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.94%">48</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
desobediencia as normas de transito pelo condutor
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.18%">9</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
dormindo
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 1.13%">58</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
falta de atencao
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 33.16%">1697</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
falta de atencao a conducao
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 2.85%">146</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
falta de atencao do pedestre
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.08%">4</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
ingestao de alcool
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 1.15%">59</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
ingestao de alcool
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.10%">5</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
mal subito
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.08%">4</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
nao guardar distancia de seguranca
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 13.23%">677</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
nao guardar distancia de seguranca
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.76%">39</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
objeto estatico sobre o leito carrocavel
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.06%">3</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
outras
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 100.00%">5118</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
pista escorregadia
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.10%">5</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
restricao de visibilidade
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.04%">2</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
ultrapassagem indevida
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.41%">21</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
velocidade incompativel
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 1.21%">62</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
velocidade incompativel
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.10%">5</span>
</td>
</tr>
</tbody>
</table>
</div>
<div id="mapa" class="section level2">
<h2>Mapa</h2>
<p>Ao investigar a base nota-se que apenas os últimos dois anos (2018 e 2017) informam as coordenadas geográficas, portando para criar o mapa com o pacote <a href="https://rstudio.github.io/leaflet/">leaflet</a> foram selecionados apenas os dados referentes ao ano de <strong>2018</strong> e <strong>2017</strong>:</p>
<pre class="text"><code>base[10:11] %&gt;% 
  map_df(~.x %&gt;% 
           select(id, data_inversa, horario, br,km,
                  causa_acidente, tipo_acidente,
                  latitude, longitude) %&gt;% 
           mutate(latitude = as.numeric(latitude), 
                  longitude = as.numeric(longitude) )
  ) %&gt;%
  leaflet() %&gt;%
  addTiles() %&gt;%
  addMarkers(~longitude, ~latitude,
             clusterOptions = markerClusterOptions(),
             label = ~paste0(data_inversa,&quot;-&quot;,horario,&quot;\n Causa: &quot;,causa_acidente,&quot;\nTipo: &quot;,tipo_acidente))%&gt;%
  addResetMapButton()%&gt;% 
  addProviderTiles(providers$OpenStreetMap.Mapnik)</code></pre>
<div id="htmlwidget-1" style="width:850px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addMarkers","args":[[-22.87199872,-22.8785807,-22.8779,-22.8800204,-22.8759557,-22.87167745,-22.8858975,-22.86763924,-22.8735,-22.8759557,-22.8708372,-22.8703627,-22.8809199,-22.87174665,-22.8758,-22.87965466,-22.8692,-22.8841859,-22.8759557,-22.87323339,-22.8808,-22.8675,-22.87578968,-22.8808,-22.8758,-22.87364461,-22.87452327,-22.8685577,-22.86826698,-22.8759557,-22.87016993,-22.8759557,-22.8759557,-22.8808,-22.87462594,-22.8808,-22.8808,-22.903263,-22.87522623,-22.8466271,-22.8730169,-22.87318405,-22.87162803,-22.86902012,-22.8673,-22.87638772,-22.8783982,-22.8679457,-22.87126227,-22.8683,-22.87322944,-22.87796436,-22.878397,-22.87795448,-22.8850444,-22.8673,-22.8683,-22.8701,-22.8708372,-22.8712,-22.8692,-22.8758,-22.9236903,-22.8784012,-22.86660619,-22.87757885,-22.8759557,-22.8735,-22.8673,-22.87024407,-22.87095582,-22.87095582,-22.8808,-22.87771724,-22.8673,-22.8808,-22.878588,-22.8673,-22.8703627,-22.8783213,-22.8683,-22.87206298,-22.8759557,-22.8683,-22.86860934,-22.903263,-22.87915054,-22.86879091,-22.87762828,-22.8858975,-22.87301118,-22.87841412,-22.87045832,-22.87377806,-22.8782913,-22.87549807,-22.86778596,-22.878781,-22.88286716,-22.878315,-22.8759557,-22.86381346,-22.8735,-22.8808,-22.8683,-22.87172795,-22.87113376,-22.878,-22.8808,-22.8808,-22.87170711,-22.8779,-22.87807128,-22.8759557,-22.87115353,-22.8784518,-22.87711426,-22.878562,-22.86772821,-22.8735,-22.8759557,-22.87848845,-22.87322944,-22.8673,-22.86873081,-22.8673,-22.903263,-22.8701,-22.87769141,-22.8779,-22.8783782,-22.8784061,-22.87028362,-22.87779138,-22.8688555,-22.869379,-22.878923,-22.868481,-22.8721816,-22.871508,-22.86779247,-22.869852,-22.87627009,-22.869852,-22.86969049,-22.8785813,-22.8710349,-22.86984866,-22.878471,-22.87301196,-22.87257701,-22.86924564,-22.8784568,-22.878923,-22.8848256,-22.873808,-22.868481,-22.87000682,-22.8786976,-22.871164,-22.8858975,-22.87770736,-22.872055,-22.876848,-22.87979305,-22.869379,-22.86731796,-22.87182573,-22.9068467,-22.876848,-22.87302679,-22.86905782,-22.86981966,-22.87237931,-22.8783273,-22.871164,-22.87490991,-22.87946778,-22.869852,-22.869852,-22.869852,-22.869852,-22.87870572,-22.878471,-22.869852,-22.86858331,-22.867664,-22.868481,-22.867664,-22.872055,-22.87870572,-22.878471,-22.868481,-22.87744046,-22.878923,-22.867664,-22.868481,-22.86858331,-22.878923,-22.87997097,-22.87593795,-22.87902204,-22.869852,-22.86921599,-22.86905782,-22.871164,-22.869852,-22.87902204,-22.869379,-22.878382,-22.869852,-22.878471,-22.87158848,-22.878923,-22.87521545,-22.871164,-22.87841907,-22.867664,-22.871164,-22.870275,-22.8759557,-22.87775678,-22.86707081,-22.870275,-22.867664,-22.8676343,-22.873808,-22.867664,-22.87815218,-22.868481,-22.8759557,-22.8824619,-22.869852,-22.872925,-22.878471,-22.867664,-22.8849062,-22.8849062,-22.86731796,-22.878923,-22.86830652,-22.8759557,-22.87813241,-22.878923,-22.8759557,-22.872925,-22.868481,-22.878923,-22.869852,-22.878471,-22.88218513,-22.87009415,-22.87322944,-22.869852,-22.87775678,-22.868481,-22.87111399,-22.8680459],[-43.14552069,-43.1144885,-43.2104,-43.11206281,-43.1117034,-43.14893246,-43.1152211,-43.11079949,-43.1278,-43.1117034,-43.15983295,-43.16421032,-43.21369171,-43.15292358,-43.1186,-43.11338246,-43.1761,-43.1117034,-43.1117034,-43.11009943,-43.1043,-43.1956,-43.11863422,-43.1043,-43.1186,-43.20613861,-43.11022141,-43.19978433,-43.19343567,-43.1117034,-43.16662967,-43.1117034,-43.1117034,-43.1043,-43.12749526,-43.1043,-43.1043,-43.207874,-43.20888519,-43.0950118,-43.13368142,-43.13310832,-43.15253735,-43.17805873,-43.1103,-43.1105384,-43.1145595,-43.11070025,-43.15514445,-43.1859,-43.13393262,-43.11607003,-43.1146201,-43.1157589,-43.1117034,-43.1103,-43.1859,-43.1664,-43.16202164,-43.2042,-43.1761,-43.1186,-43.2246728,-43.1145651,-43.10935915,-43.11035693,-43.1117034,-43.1278,-43.1103,-43.11045516,-43.20382118,-43.16305161,-43.1043,-43.11573744,-43.1103,-43.1043,-43.1145867,-43.1103,-43.16703536,-43.1145249,-43.1859,-43.20081711,-43.1117034,-43.1859,-43.19817847,-43.207874,-43.11414865,-43.20050597,-43.11521173,-43.1152211,-43.13353152,-43.11427832,-43.20247609,-43.20640951,-43.1144462,-43.11937896,-43.19416416,-43.1594364,-43.2148495,-43.1144214,-43.1117034,-43.10749233,-43.1278,-43.1043,-43.1859,-43.14682335,-43.15668136,-43.116,-43.1043,-43.1043,-43.15202236,-43.2104,-43.11563909,-43.1117034,-43.15627098,-43.1144862,-43.1168845,-43.1147141,-43.11053663,-43.1278,-43.1117034,-43.11497284,-43.13419104,-43.1103,-43.11065764,-43.1103,-43.207874,-43.1664,-43.11602736,-43.2104,-43.1143391,-43.1143417,-43.16205718,-43.11578035,-43.11068845,-43.175808,-43.110676,-43.18568,-43.14394355,-43.204243,-43.19669724,-43.110458,-43.20833587,-43.110458,-43.17111969,-43.1146243,-43.15579891,-43.18622589,-43.21072,-43.14219475,-43.13837528,-43.17558289,-43.1142699,-43.110676,-43.1127452,-43.126438,-43.18568,-43.1693387,-43.1146008,-43.156063,-43.1152211,-43.1157589,-43.146187,-43.117287,-43.11108649,-43.175808,-43.19841385,-43.1461966,-43.1728965,-43.117287,-43.13391209,-43.18842798,-43.17498207,-43.14846039,-43.1145218,-43.156063,-43.11035156,-43.11583299,-43.110458,-43.110458,-43.110458,-43.110458,-43.21334839,-43.21072,-43.110458,-43.19892883,-43.19556,-43.18568,-43.19556,-43.146187,-43.10348511,-43.21072,-43.18568,-43.12820435,-43.110676,-43.19556,-43.18568,-43.1803894,-43.110676,-43.18107605,-43.11831772,-43.11138153,-43.110458,-43.16665649,-43.18047523,-43.156063,-43.110458,-43.11275482,-43.175808,-43.114474,-43.110458,-43.21072,-43.15172195,-43.110676,-43.12650723,-43.156063,-43.11451435,-43.19556,-43.156063,-43.165936,-43.1117034,-43.1157589,-43.19599987,-43.165936,-43.19556,-43.19274902,-43.126438,-43.19556,-43.11046958,-43.18568,-43.1117034,-43.2147646,-43.110458,-43.136311,-43.21072,-43.19556,-43.1136734,-43.1136734,-43.17592621,-43.110676,-43.18755627,-43.1117034,-43.11522245,-43.110676,-43.1117034,-43.136311,-43.18568,-43.110676,-43.110458,-43.21072,-43.11378479,-43.1106037,-43.20585966,-43.110458,-43.20987225,-43.18568,-43.16047668,-43.19756529],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,{"showCoverageOnHover":true,"zoomToBoundsOnClick":true,"spiderfyOnMaxZoom":true,"removeOutsideVisibleBounds":true,"spiderLegPolylineOptions":{"weight":1.5,"color":"#222","opacity":0.5},"freezeAtZoom":false},null,["2017-01-06-13:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-06-16:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-07-12:20:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-09-17:18:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-01-11-04:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-11-10:10:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: engavetamento                                                                                                                                                                                           ","2017-01-11-15:53:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-01-14-01:05:00\n Causa: velocidade incompativel                                                                             \nTipo: capotamento                                                                                                                                                                                             ","2017-01-14-06:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto em movimento                                                                                                                                                                         ","2017-01-14-11:28:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-01-16-04:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-01-23-05:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-24-11:20:00\n Causa: avarias e-ou desgaste excessivo no pneu                                                             \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-01-24-13:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-25-17:14:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-28-23:15:00\n Causa: velocidade incompativel                                                                             \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-01-30-13:43:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-31-12:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-31-20:07:00\n Causa: avarias e-ou desgaste excessivo no pneu                                                             \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-02-03-05:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-02-03-16:45:00\n Causa: objeto estatico sobre o leito carrocavel                                                            \nTipo: colisao traseira                                                                                                                                                                                        ","2017-02-03-15:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-02-08-19:50:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-02-20-01:50:00\n Causa: condutor dormindo                                                                                   \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-02-22-15:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-03-01-05:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-03-02-16:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-03-02-19:15:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-03-03-17:20:00\n Causa: mal subito                                                                                          \nTipo: colisao lateral                                                                                                                                                                                         ","2017-03-08-18:23:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-03-09-10:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-03-11-17:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-03-12-19:21:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-22-23:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-03-13-21:20:00\n Causa: ingestao de alcool                                                                                  \nTipo: colisao transversal                                                                                                                                                                                     ","2017-03-30-08:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-03-30-13:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-04-03-17:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-04-04-12:29:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-04-05-12:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-04-10-12:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-04-10-19:15:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: colisao lateral                                                                                                                                                                                         ","2017-04-13-06:17:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-04-15-15:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-04-19-09:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-04-20-08:35:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-04-29-15:50:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-08-05:36:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-11-17:44:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-02-17-18:10:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-12-18:30:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: atropelamento de pedestre                                                                                                                                                                               ","2017-05-18-12:40:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-05-19-08:35:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-05-19-12:12:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-05-23-17:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-26-17:46:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-27-23:31:00\n Causa: ingestao de alcool                                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-29-05:27:00\n Causa: velocidade incompativel                                                                             \nTipo: colisao lateral                                                                                                                                                                                         ","2017-05-29-06:05:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-30-02:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-05-30-06:42:00\n Causa: restricao de visibilidade                                                                           \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-05-30-15:23:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-31-13:30:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-06-04-07:38:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-06-17-07:00:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-06-19-12:04:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-06-20-18:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-06-24-19:12:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-06-27-10:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-06-29-10:45:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-06-30-08:15:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-06-30-13:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-07-01-12:15:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-07-03-10:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-07-04-09:45:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: colisao lateral                                                                                                                                                                                         ","2017-07-04-10:00:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: colisao lateral                                                                                                                                                                                         ","2017-06-02-21:55:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-07-05-19:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-07-07-06:04:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-07-08-19:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-07-10-08:26:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-07-16-07:50:00\n Causa: ingestao de alcool                                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-07-24-16:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-07-26-05:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-07-28-20:05:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-08-01-08:54:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-08-04-09:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-08-10-04:10:00\n Causa: condutor dormindo                                                                                   \nTipo: colisao traseira                                                                                                                                                                                        ","2017-08-14-05:22:00\n Causa: falta de atencao a conducao                                                                         \nTipo: engavetamento                                                                                                                                                                                           ","2017-08-14-06:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-08-16-17:14:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-08-22-06:24:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-08-22-18:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-08-24-17:31:00\n Causa: velocidade incompativel                                                                             \nTipo: colisao traseira                                                                                                                                                                                        ","2017-08-27-10:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: incendio                                                                                                                                                                                                ","2017-08-31-09:29:00\n Causa: restricao de visibilidade                                                                           \nTipo: engavetamento                                                                                                                                                                                           ","2017-09-03-18:46:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-04-12:21:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-04-16:06:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao com objeto em movimento                                                                                                                                                                         ","2017-09-08-17:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-09-12-10:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-09-13-17:40:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: colisao lateral                                                                                                                                                                                         ","2017-07-24-16:19:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-09-18-20:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-09-21-07:20:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-22-07:42:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-09-22-18:07:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-22-20:27:00\n Causa: ingestao de alcool                                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-24-05:00:00\n Causa: condutor dormindo                                                                                   \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-26-07:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-09-26-15:20:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao transversal                                                                                                                                                                                     ","2017-09-26-18:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-28-16:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-09-29-06:56:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-10-04-15:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-10-06-17:11:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-10-11-11:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-10-14-11:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-10-15-06:00:00\n Causa: pista escorregadia                                                                                  \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-10-18-08:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-08-06-07:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-10-23-17:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-10-27-21:25:00\n Causa: falta de atencao do pedestre                                                                        \nTipo: atropelamento de pedestre                                                                                                                                                                               ","2017-10-28-12:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2017-10-31-05:50:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-11-06-18:43:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-11-06-22:55:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-11-10-07:15:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-11-10-11:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-11-10-20:07:00\n Causa: condutor dormindo                                                                                   \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-11-11-16:00:00\n Causa: pista escorregadia                                                                                  \nTipo: tombamento                                                                                                                                                                                              ","2017-11-11-19:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-11-14-07:15:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-11-16-06:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-11-19-03:05:00\n Causa: pista escorregadia                                                                                  \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-11-23-14:29:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-11-29-06:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-11-30-20:48:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-02-07:05:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-03-19:32:00\n Causa: falta de atencao a conducao                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2017-12-05-17:30:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-12-07-09:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-08-18:11:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-09-07:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-12-11-15:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-12-12-13:07:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-12-14-17:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-17-12:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-12-17-16:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-12-18-11:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-12-18-11:10:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-12-22-10:05:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-12-22-18:30:00\n Causa: ingestao de alcool                                                                                  \nTipo: colisao frontal                                                                                                                                                                                         ","2017-12-25-10:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: engavetamento                                                                                                                                                                                           ","2017-12-25-16:30:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-26-15:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-27-15:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-28-17:26:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-12-29-15:45:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-31-00:45:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-07-24-17:45:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-09-21-07:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-07-28-18:47:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2018-01-02-22:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2018-01-04-00:49:00\n Causa: falta de atencao a conducao                                                                         \nTipo: capotamento                                                                                                                                                                                             ","2018-01-05-09:52:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-01-06-15:10:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2018-01-11-08:47:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-01-26-12:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-01-28-16:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-01-31-07:35:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-01-31-08:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-02-02-09:22:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-02-02-10:17:00\n Causa: avarias e-ou desgaste excessivo no pneu                                                             \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-02-05-15:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-02-09-17:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-02-12-17:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-02-12-22:29:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-02-06-00:45:00\n Causa: pista escorregadia                                                                                  \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2018-02-21-07:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-02-21-09:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: incendio                                                                                                                                                                                                ","2018-02-22-19:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-02-23-08:25:00\n Causa: pista escorregadia                                                                                  \nTipo: tombamento                                                                                                                                                                                              ","2018-02-25-06:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2018-02-25-15:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-02-26-19:07:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-02-26-23:58:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-03-01-08:50:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: incendio                                                                                                                                                                                                ","2018-03-06-05:00:00\n Causa: mal subito                                                                                          \nTipo: capotamento                                                                                                                                                                                             ","2018-03-10-05:30:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: colisao lateral                                                                                                                                                                                         ","2018-03-12-03:30:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-03-14-08:54:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-03-22-23:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-03-30-07:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-03-31-08:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao frontal                                                                                                                                                                                         ","2018-04-02-10:56:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-04-03-07:33:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao frontal                                                                                                                                                                                         ","2018-04-05-20:01:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-04-06-09:44:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-04-08-09:55:00\n Causa: mal subito                                                                                          \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2018-04-09-15:05:00\n Causa: falta de atencao do pedestre                                                                        \nTipo: colisao traseira                                                                                                                                                                                        ","2018-04-12-07:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2018-04-16-04:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-04-16-10:29:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-04-22-05:45:00\n Causa: mal subito                                                                                          \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-04-22-15:45:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2018-04-27-18:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2018-05-03-23:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-05-04-13:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-08-01:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-04-11:20:00\n Causa: falta de atencao do pedestre                                                                        \nTipo: atropelamento de pedestre                                                                                                                                                                               ","2018-05-08-08:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-09-10:43:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-11-11:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: atropelamento de pedestre                                                                                                                                                                               ","2018-05-11-12:28:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2018-05-14-12:35:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-16-13:29:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: colisao transversal                                                                                                                                                                                     ","2018-05-28-17:45:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-31-17:20:00\n Causa: avarias e-ou desgaste excessivo no pneu                                                             \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-06-01-09:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-06-07-09:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2018-06-10-19:05:00\n Causa: falta de atencao a conducao                                                                         \nTipo: engavetamento                                                                                                                                                                                           ","2018-06-12-08:15:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-06-13-23:50:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: incendio                                                                                                                                                                                                ","2018-06-17-18:56:00\n Causa: velocidade incompativel                                                                             \nTipo: tombamento                                                                                                                                                                                              ","2018-06-18-07:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-06-20-17:30:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: tombamento                                                                                                                                                                                              ","2018-06-22-15:27:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-06-24-11:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-06-25-15:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2018-06-27-08:40:00\n Causa: falta de atencao do pedestre                                                                        \nTipo: atropelamento de pedestre                                                                                                                                                                               ","2018-06-30-08:25:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2018-07-03-18:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-07-05-15:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-07-06-08:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-07-08-19:35:00\n Causa: avarias e-ou desgaste excessivo no pneu                                                             \nTipo: colisao traseira                                                                                                                                                                                        ","2018-07-13-14:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-07-13-11:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-07-13-16:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-05-11-06:55:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-07-20-23:39:00\n Causa: agressao externa                                                                                    \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-30-07:40:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2018-05-11-06:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-07-30-18:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-07-17-07:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: engavetamento                                                                                                                                                                                           ","2018-08-01-17:48:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-02-09-14:28:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-08-16-14:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-08-21-14:10:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2018-08-22-07:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-06-23-06:15:00\n Causa: objeto estatico sobre o leito carrocavel                                                            \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2018-08-23-17:45:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: incendio                                                                                                                                                                                                ","2018-08-24-01:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-08-28-20:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-08-29-12:40:00\n Causa: objeto estatico sobre o leito carrocavel                                                            \nTipo: colisao traseira                                                                                                                                                                                        ","2018-08-30-06:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-08-30-07:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-08-22-01:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         "],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addEasyButton","args":[{"icon":"ion-arrow-shrink","title":"Reset View","onClick":"function(btn, map){ map.setView(map._initialCenter, map._initialZoom); }","position":"topleft"}]},{"method":"addProviderTiles","args":["OpenStreetMap.Mapnik",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]}],"limits":{"lat":[-22.9236903,-22.8466271],"lng":[-43.2246728,-43.0950118]}},"evals":["calls.2.args.0.onClick"],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (function(el, x){ var map = this; map._initialCenter = map.getCenter(); map._initialZoom = map.getZoom();}).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p>Note que existem diversas ocorrências que apresentaram coordenadas geográficas fora dos limites da Ponte o que sugere que a amostra selecionada pode conter informações das redondezas. Estas informações serão avaliadas em conjunto com os dados referentes aos 13km da BR-101 que selecionamos.</p>
</div>
<div id="série-temporal" class="section level2">
<h2>Série temporal</h2>
<p>Segundo <span class="citation">@Morettin</span>:</p>
<blockquote>
<p><strong>Def</strong>.: <em>Uma série temporal é qualquer conjunto de observações ordenadas no tempo</em></p>
</blockquote>
<p>Os objetivos da análise de séries temporais são, em geral:</p>
<ul>
<li>Investigar o mecanismo gerador da série temporal</li>
<li>Fazer previsões de valores futuros da série (podem ser a curto prazo ou a longo prazo)</li>
<li>Descrever apenas o comportamento da série, neste caso a construção do gráfico, a verificação da existência de tendências, ciclos e variações sazonais, a construção de histogramas e diagramas de dispersão etc podem ser ferramentas úteis</li>
<li>Procurar periodicidade relevante nos dados</li>
</ul>
<p>Etimologicamente (<em>prae</em> e <em>videre</em>), a palavra previsão sugere que se quer ver uma coisa antes que ela exista. Alguns autores preferem a palavra <em>predição</em>, para indicar algo que deverá existir no futuro. Ainda outros utilizam o termo <em>projeção</em> porém nosso objetivo neste post não será ajustar um modelo <strong>preditivo</strong> e sim um modelo <strong>descritivo</strong> que possibilite estudar o comportamento da série.</p>
<p>Após tomar uma intuição de como ocorrem os acidentes de maneira espacial na amostra, para responder a pergunta “<em>O número de acidentes é diário?</em>” precisamos obter a informação temporal dos dados e a melhor forma de visualizar este comportamento inicialmente é com um gráfico.</p>
<div id="número-de-acidentes-por-dia-nos-últimos-10-anos" class="section level3">
<h3>Número de acidentes por dia nos últimos 10 anos</h3>
<p>Veja a seguir o número de acidentes, por id, diariamente e duas curvas de médias móveis com <code>k = 30</code> e com <code>k = 30*6</code> :</p>
<pre class="text"><code>g1 &lt;- 
  base %&gt;%
  map_df(~.x%&gt;% select(id, data_inversa, causa_acidente, tipo_acidente) ) %&gt;% 
  dplyr::group_by(data_inversa)%&gt;% 
  dplyr::summarise(n=n())%&gt;%
  mutate(rMM=rollmean(n,30, na.pad=TRUE, align=&quot;left&quot;)) %&gt;%
  mutate(rMY=rollmean(n,30*6, na.pad=TRUE, align=&quot;left&quot;)) %&gt;%
  tidyr::gather(medida,valor,n:rMY) %&gt;% 
  ggplot(aes(x=data_inversa, y=valor,col=medida)) +
  geom_line() +
  scale_colour_manual(name=&quot;Legenda:&quot;,values=c(&quot;black&quot;,&quot;red&quot;,&quot;blue&quot;), 
                      labels = c(&#39;Acidentes&#39;,&#39;Médias móveis k=30&#39;, &#39;Médias móveis k=30*6&#39;)) +
  theme_bw() +
  labs(y= &#39;Número de acidentes&#39;,
       x = &#39;Data&#39;,
       subtitle = &quot;Por dia&quot;, 
       title= &#39;Número de acidentes na Ponte Rio-Niterói&#39;, 
       caption = &quot;Fonte dos dados:\nhttps://www.prf.gov.br/portal/dados-abertos/acidentes\nhttps://gomesfellipe.github.io/&quot;,col=&quot;&quot;) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(breaks=seq(0,15,1))

g1 +
  scale_x_date(date_breaks = &#39;6 months&#39;,limits = as.Date(c(&quot;2008-02-01&quot;,&quot;2018-12-01&quot;)),
               expand = c(0.01,0.01)) + 
  theme(legend.position = c(0.85,0.7), 
        legend.background = element_rect(fill=alpha(&#39;lightgrey&#39;, 0.2)))</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-7-1.png" width="1152" /></p>
<p>Este gráfico esta um pouco carregado com a informação levando em conta o número de acidentes <em>por dia</em> mas mesmo assim já é possível notar algumas informações como:</p>
<ul>
<li>Existem diversos dias que não houveram acidentes registrados pela PRF (diversos pontos tocam o eixo x)</li>
<li>No ano de 2015 houve uma grotesca diminuição no registros do número de acidentes (o que será que aconteceu?)</li>
</ul>
<p>A primeira pergunta parece ter sido respondida: O número de acidentes não parece ter sido diário nos últimos 10 anos segundo esses dados (e supondo que não houve subnotificação).</p>
<p>Já a hipótese levantada com a segunda pergunta <em>parece</em> ser verdadeira pois o comportamento dos dados sugerem ter havido a diminuição no número de acidentes.</p>
<p>Veja a seguir outra rápida análise exploratória para checar como se distribuem os número de acidentes ano longo dos anos e dos meses com alguns box-plots:</p>
<pre class="text"><code>bp1 &lt;- 
  base %&gt;%
  map_df(~.x%&gt;% select(id, data_inversa, causa_acidente, tipo_acidente) ) %&gt;% 
  dplyr::group_by(data_inversa)%&gt;% 
  dplyr::summarise(n=n()) %&gt;%
  tidyr::gather(medida,valor,n) %&gt;% 
  ggplot(aes(x=factor(year(data_inversa)), y=valor,col=medida)) +
  geom_jitter(col=&quot;darkgrey&quot;,alpha=0.3)+
  geom_boxplot(col=&quot;black&quot;,alpha=0.3)+
  theme_bw() +
  labs(y= &#39;Número de acidentes&#39;,x=&quot;&quot;) + 
  theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
  scale_y_continuous(breaks=seq(0,15,1))+ 
  geom_vline(xintercept = 8.5, linetype=&quot;dotted&quot;, 
             color = &quot;red&quot;, size=1.5) +
  annotate(&quot;label&quot;,y = 7, x = 8.5,
           label = &quot;Comportamentos \n     diferentes&quot;,
           size = 4, colour = &quot;red&quot;,hjust=0.1)

bp2 &lt;- 
  base %&gt;%
  map_df(~.x%&gt;% select(id, data_inversa, causa_acidente, tipo_acidente)) %&gt;% 
  filter(year(data_inversa)&lt;2016) %&gt;% 
  dplyr::group_by(data_inversa) %&gt;% 
  dplyr::summarise(n=n()) %&gt;%
  tidyr::gather(medida,valor,n) %&gt;% 
  ggplot(aes(x=factor(months(data_inversa),
                      levels = months(base[[1]]$data_inversa) %&gt;% unique),
             y=valor,col=medida)) +
  geom_jitter(col=&quot;darkgrey&quot;,alpha=0.3)+
  geom_boxplot(color=&quot;black&quot;,alpha=0.3)+
  theme_bw() +
  labs(y= &#39;Número de acidentes&#39;,
       title = &#39;Dados de 2008 até 2015&#39;,x=&quot;&quot;, col=&quot;&quot;) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(breaks=seq(0,15,1))+ 
  theme(legend.position = c(0.85,0.7))

bp3 &lt;- 
  base %&gt;%
  map_df(~.x%&gt;% select(id, data_inversa, causa_acidente, tipo_acidente) ) %&gt;% 
  filter(year(data_inversa)&gt;=2016) %&gt;% 
  dplyr::group_by(data_inversa) %&gt;% 
  dplyr::summarise(n=n()) %&gt;%
  tidyr::gather(medida,valor,n) %&gt;% 
  ggplot(aes(x=factor(months(data_inversa),
                      levels = months(base[[1]]$data_inversa) %&gt;% unique),
             y=valor,col=medida)) +
  geom_jitter(col=&quot;darkgrey&quot;,alpha=0.3)+
  geom_boxplot(color=&quot;black&quot;,alpha=0.3)+
  theme_bw() +
  labs(y= &#39;&#39;,
       title = &#39;Dados de 2016 até 2018&#39;,x=&quot;&quot;,col=&quot;&quot;) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(breaks=seq(0,15,1))+ 
  theme(legend.position = c(0.85,0.7))

bp2 &lt;- arrangeGrob(bp2,bp3,ncol=2)</code></pre>
<pre class="text"><code>grid.arrange(bp1,bp2,
             top = &quot;Boxplots do número de acidentes na Ponte Rio-Niterói&quot;,
             bottom = textGrob(&quot;Fonte dos dados:\nhttps://www.prf.gov.br/portal/dados-abertos/acidentes\nhttps://gomesfellipe.github.io/&quot;,
                               gp = gpar(fontface = 3, fontsize = 9),
                               hjust = 1,x = 1 )) </code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-9-1.png" width="1152" /></p>
<p>É possível notar que antes de 2016 todos aos boxplots apresentaram medianas parecidas enquanto que após o ano de 2016 parece haver mais acidentes apenas nos primeiros meses do ano.</p>
<p>Para responder a última pergunta vamos analisar com mais detalhes a série para entender melhor seu comportamento.</p>
<div id="número-de-acidentes-por-dia-nos-últimos-10-anos-agrupados-por-ano" class="section level4">
<h4>Número de acidentes por dia nos últimos 10 anos agrupados por ano</h4>
<p>Veja a mesma informação do gráfico do número de acidentes na Ponte Rio-Niterói por dia, porém separado para cada ano:</p>
<pre class="text"><code>g1 +
  facet_wrap( ~ year(data_inversa), scales = &quot;free_x&quot;) +
  ggtitle(&quot;Número de acidentes na Ponte Rio-Niterói de acordo com o ano, por dia&quot;) +
  scale_x_date(date_breaks = &#39;1 month&#39;) +
  theme(legend.position = c(0.85, 0.1))</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-10-1.png" width="1152" /></p>
<p>Agora ficou evidente que a partir do ano de 2015 o número de acidentes na Ponte Rio-Niterói foi reduzido e manteve-se abaixo do número médio registrado nos anos anteriores.</p>
</div>
</div>
<div id="mas-o-que-aconteceu-em-2015" class="section level3">
<h3>Mas o que aconteceu em 2015?</h3>
<p>Já que em 2015 houve este comportamento tão brusco resolvi procurar no Google por notícias de acidentes na Ponte Rio-Niterói neste período e em uma breve pesquisa me deparei com a seguinte notícia:</p>
<center>
<img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi/freq-acidente-ponte-rio-niteroi_files/noticia.png" />
</center>
<p>Essa afirmação na manchete, que houve “redução de quase 60% após o videomonitoramento” é intrigante e seria interessante conseguir achar algum resultado concordante.</p>
<p>Na notícia " <a href="http://g1.globo.com/rio-de-janeiro/noticia/2015/11/monitoramento-com-cameras-ajuda-reduzir-acidentes-na-ponte-rio-niteroi.html">Monitoramento com câmeras ajuda a reduzir acidentes na Ponte Rio-Niterói</a> " um inspetor da PRF faz a seguinte declaração:</p>
<blockquote>
<p>“(…) Ajuda a amplificar o nosso poder de visualização das infrações que são cometidas. Concequentemente reduz o numero de acidentes por conta da presença quase que em todo trecho, ao mesmo tempo, da PRF”</p>
</blockquote>
<!-- [Prefeitura de Niterói instalará 12 câmeras na Ponte Rio-Niterói](http://g1.globo.com/rio-de-janeiro/noticia/2015/10/prefeitura-de-niteroi-instalara-12-cameras-na-ponte-rio-niteroi.html) -->
</div>
<div id="número-de-acidentes-por-mês-nos-últimos-10-anos-agrupados" class="section level3">
<h3>Número de acidentes por mês nos últimos 10 anos agrupados</h3>
<p>Como o gráfico ficou carregado ao levar em consideração o número de acidentes ao longo dos dias, a mesma informação será agrupada por mês.</p>
<p>Vejamos visualmente os dados fornecidos pela PRF e o dia em que a notícia foi atualizada:</p>
<pre class="text"><code>g2 &lt;- 
  base %&gt;%
  map_df(~.x
         %&gt;% select(id, data_inversa, causa_acidente, tipo_acidente) %&gt;%
           mutate_if(is.character,~ dmy(.x) )) %&gt;%
  group_by(month=floor_date(data_inversa, &quot;1 month&quot;)) %&gt;% 
  summarise(n = n()) %&gt;%  
  ggplot(aes(x=month, y=n)) +
  geom_line() +
  geom_point() +
  theme_bw() + 
  labs(y= &#39;Número de acidentes&#39;,
       x = &#39;Data&#39;,
       title= &#39;Número de acidentes na Ponte Rio-Niterói&#39;, 
       subtitle = &quot;Por mês&quot;, 
       caption = &quot;Fonte dos dados: \nhttp://glo.bo/210j8gF \nhttps://www.prf.gov.br/portal/dados-abertos/acidentes\nhttps://gomesfellipe.github.io/&quot;) +
  scale_y_continuous(breaks=seq(0,150,25))

g2 +
  geom_segment(x = as.Date(&quot;2015-11-13&quot;), xend = as.Date(&quot;2015-11-13&quot;),
               y=0,yend=100, linetype=&quot;dashed&quot;, col=&quot;red&quot;) +
  geom_text(aes(y = 100, x = as.Date(&quot;2015-11-13&quot;),
                label = &quot;G1 em 17/11/2015 :\n\&quot;Monitoramento com câmeras\n ajuda a reduzir acidentes\n  na Ponte Rio-Niterói\&quot;&quot;) ,hjust=-0.1) +
  scale_x_date(date_breaks = &#39;6 month&#39;) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-11-1.png" width="1152" /></p>
<p>De fato, visualmente é possível notar uma aparente diminuição no ano do qual a notícia foi divulgada mas será que é possível identificar algum tipo de tendência a partir destes dados?</p>
<div id="número-de-acidentes-por-mês-nos-últimos-10-anos-agrupados-por-ano" class="section level4">
<h4>Número de acidentes por mês nos últimos 10 anos agrupados por ano</h4>
<p>Vejamos a seguir o gráfico separado por cada ano para comparar o comportamento dos dados:</p>
<pre class="text"><code>g2 +
  # geom_smooth(method = &quot;lm&quot;, se = F, aes(col = &quot;blue&quot;)) +
  facet_wrap( ~ year(month), scales = &quot;free_x&quot;) +
  scale_colour_manual(name=&quot; &quot;, values=c(&quot;blue&quot;),labels=c(&quot;Regressão Linear&quot;)) + 
  theme(legend.position = c(0.88,0.20))</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-12-1.png" width="1152" /></p>
<p>Neste gráfico vemos que dos anos de 2008 à 2014 os dados se comportam de forma parecida em torno de 100 à 75 acidentes. Porém em 2015 o número de acidentes termina por volta de 25 e este número se mantém ao longo dos anos.</p>
</div>
</div>
<div id="ajuste-do-modelo-descritivo" class="section level3">
<h3>Ajuste do modelo descritivo</h3>
<p>Para entender melhor essa tendência apresentada em 2015 será ajustado modelo de regressão linear simples conforme metodologia apresentada em <span class="citation">@tend</span>, que utilizam o tempo como variável explicativa e entender qual foi a variação do número de acidentes médios por mês.</p>
<p>O método utilizado para avaliar a tendência consiste em um ajuste de tendência em função do tempo (<span class="math inline">\(t\)</span>) com um modelo de regressão linear de maneira que:</p>
<p><span class="math display">\[
Y_{i} = \beta_0 + \beta_1 t_i + \epsilon_{i}  
\]</span></p>
<p>em que:</p>
<ul>
<li><span class="math inline">\(Y_i\)</span>: Tendência para o número de acidentes médios por mês no instante <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(t_i\)</span>: i-ésimo instante de tempo</li>
<li><span class="math inline">\(\beta_0\)</span>: Intercepto do modelo (valor de <span class="math inline">\(Y_i\)</span> quando <span class="math inline">\(t_i=0\)</span>)</li>
<li><span class="math inline">\(\beta_1\)</span>: Inclinação da reta ajustada (efeito da variável <span class="math inline">\(t_i\)</span>)</li>
<li><span class="math inline">\(\epsilon_i \sim N(0,\sigma^2)\)</span> onde <span class="math inline">\(\sigma^2\)</span> é constante</li>
</ul>
<p>Este modelo de regressão linear mede a variação da tendência para diferentes valores de intervalo de tempo na faixa de interesse. O ajuste é interpretado de acordo com a inclinação da reta formada pelos diferentes valores de referência em relação a respectiva tendência pode não ser o melhor método para a previsão mas pode ajudar a entender o comportamento da série como análise descritiva.</p>
<pre class="text"><code>to_lm &lt;- 
  base %&gt;%
  map_df(~.x%&gt;% select(id, data_inversa, causa_acidente, tipo_acidente)%&gt;%
           mutate_if(is.character,~ dmy(.x) )) %&gt;% 
  group_by(data_inversa=floor_date(data_inversa, &quot;1 month&quot;)) %&gt;% 
  summarise(n = n()) %&gt;% 
  filter(data_inversa &gt;= &quot;2015-01-01&quot; &amp; data_inversa &lt; &quot;2016-01-01&quot;)

y   &lt;- to_lm %$% n %&gt;%  ts(start = c(2015, 01, 01))

g2 +
  geom_smooth(method=&#39;lm&#39;,se=F,aes(col=I(&quot;darkred&quot;))) +
  geom_smooth(data=to_lm, aes(x=data_inversa, y=n,col=I(&quot;blue&quot;)), method = &quot;lm&quot;,se=F) +
  scale_colour_manual(name=NULL, values=c(&quot;red&quot;,&quot;blue&quot;,&quot;darkred&quot;),labels=c(
    &quot;Regressão Linear para 2015&quot;,
    &quot;Regressão Linear para todo período&quot;,
    &quot;Notícia&quot;
  )) + 
  theme(legend.position = c(0.2,0.18)) +
  geom_segment(x = as.Date(&quot;2015-11-13&quot;), xend = as.Date(&quot;2015-11-13&quot;),
               y=0, yend=100, linetype=&quot;dashed&quot;, aes(col=I(&quot;red&quot;))) +
  geom_text(aes(y = 100, x = as.Date(&quot;2015-11-13&quot;),
                label = &quot;G1 em 17/11/2015 :\n\&quot;Monitoramento com câmeras\n ajuda a reduzir acidentes\n  na Ponte Rio-Niterói\&quot; &quot;) ,hjust=-0.1) +
  scale_x_date(date_breaks = &#39;6 month&#39;) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1), 
        legend.background = element_rect(fill=alpha(&#39;lightgrey&#39;, 0.2)))</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-13-1.png" width="1152" /></p>
<p>Antes de conferir os resultados do ajuste do modelo, veja o resultado para o teste de sequências (Wald-Wolfowitz) que tem como hipótese alternativa <span class="math inline">\(H_1:\)</span> <em>existe tendência na série</em></p>
<pre class="text"><code>randtests::runs.test(y)</code></pre>
<pre><code>## 
##  Runs Test
## 
## data:  y
## statistic = -3.0277, runs = 2, n1 = 6, n2 = 6, n = 12, p-value =
## 0.002465
## alternative hypothesis: nonrandomness</code></pre>
<p>Ao nível de significância de <span class="math inline">\(\alpha :\)</span> 0.05 rejeita-se a hipótese nula de que esta série não apresenta tendência no período selecionado (2015).</p>
<p>Outra hipótese importante para conferir é sobre a normalidade da variável resposta, a seguir será aplicado o teste de Shapiro-wilk que tem como hipótese nula de que os dados possuem distribuição normal:</p>
<pre class="text"><code>shapiro.test(y)</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  y
## W = 0.9702, p-value = 0.9129</code></pre>
<p>De acordo com este teste, não existem evidências estatísticas para se rejeitar a hipótese da normalidade dos dados, portanto, para uma análise mais detalhada o modelo ajustado no período de 2015 pode ser obtido da seguinte maneira:</p>
<pre class="text"><code>fit &lt;- tslm(y ~ trend, data = y) </code></pre>
<p>Com o modelo está salvo no objeto <code>fit</code>, sua informação será incrementada no gráfico da regressão de 2015 para facilitar o entendimento dos resultados:</p>
<pre class="text"><code>g1 &lt;- 
  base %&gt;%
  map_df(~.x%&gt;% select(id, data_inversa, causa_acidente, tipo_acidente)) %&gt;% 
  group_by(data_inversa=floor_date(data_inversa, &quot;1 month&quot;)) %&gt;% 
  dplyr::summarise(n=n()) %&gt;%
  ggplot(aes(x=data_inversa, y=n)) +
  geom_line() +
  theme_bw() +
  labs(y= &#39;Número de acidentes&#39;,
       x = &#39;Data&#39;,
       subtitle = &quot;Por dia&quot;, 
       title= &#39;Número de acidentes na Ponte Rio-Niterói&#39;, 
       caption = &quot;Fonte dos dados:\nhttp://glo.bo/210j8gF\nhttps://www.prf.gov.br/portal/dados-abertos/acidentes\nhttps://gomesfellipe.github.io/&quot;) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(breaks=seq(0,100,25)) + 
  annotate(&quot;text&quot;, x=as.Date(&quot;2015-08-13&quot;), y = 75,
           label = paste(&quot;Modelo teórico: Yi = β^0 + β1 ti + ei:\nEstimador do Nº de acidentes =&quot;,round(fit$coefficients[1],2),round(fit$coefficients[2],2),&quot;*  Mês&quot;))

t &lt;- 
  fit %&gt;%
  tidy() %&gt;% 
  bind_cols(r2=c(glance(fit)[[1]] %&gt;% round(4),&quot;-&quot;),
            confint_tidy(fit)) %&gt;% 
  mutate_if(is.numeric,~ round(.x,4)) %&gt;% 
  mutate(term = c(&quot;Intercepto&quot;, &quot;Tendência&quot;)) %&gt;% 
  set_names(c(&quot;Coef.&quot;, &quot;Estimativa&quot;, &quot;Erro Padrão&quot;, &quot;Estatística&quot;, &quot;Valor P&quot;, &quot;R²&quot;,&quot;Lim. Inf.&quot;, &quot;Lim. Sup.&quot;)) 

# Funcao auxiliar para colorir a celula
g &lt;- tableGrob(t,rows = NULL)
find_cell &lt;- function(table, row, col, name=&quot;core-fg&quot;){
  # Fonte: 
  # https://cran.r-project.org/web/packages/gridExtra/vignettes/tableGrob.html
  l &lt;- table$layout
  which(l$t==row &amp; l$l==col &amp; l$name==name)
}

ind &lt;- find_cell(g, 3, 2, &quot;core-bg&quot;)
g$grobs[ind][[1]][[&quot;gp&quot;]] &lt;- gpar(fill=&quot;darkolivegreen1&quot;, col = &quot;darkolivegreen4&quot;, lwd=5)

g1 +
  scale_x_date(date_breaks = &#39;1 months&#39;,
               limits = as.Date(c(&quot;2015-01-01&quot;,&quot;2015-12-01&quot;)),
               expand = c(0.01,0.01)) +
  geom_smooth(data=to_lm, aes(x=data_inversa, y=n), method = &quot;lm&quot;,col=&quot;red&quot;,se=F)+
  annotation_custom(grob = g  , ymax=220,xmin=as.Date(&quot;2015-04-01&quot;))</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-17-1.png" width="1152" /></p>
<p>Nota-se que o coeficiente estimado para determinar a variação do número de acidentes ao aumentar a variável explicativa <code>trend</code> em uma unidade se apresenta de maneira significante, isto quer dizer que parece existir relação linear estatisticamente significante entre o mês da observação e a variável resposta.</p>
<p>Além disso é possível notar que para cada aumento de uma unidade da <code>tred</code> (ou seja, no decorrer de 1 mês), o valor esperado no número de acidentes observados naquele mês diminui em aproximadamente 4.7972.</p>
<p>Como -4.7972 x 12 = -57.5664 então o número de acidentes esperados decresce para aproximadamente 57.57% do valor original conforme a variável <code>tred</code> aumentou em 12 unidades (em 1 ano).</p>
<p>Veja o resultado para o teste de Shapiro - wilk para avaliar a hipótese de normalidade dos resíduos do modelo, os resíduos padronizados(quociente entre o resíduo e a estimativa do seu desvio padrão) e os resíduos <a href="https://en.wikipedia.org/wiki/Studentized_residual"><em>studentizados</em></a>, que levam em conta o <span class="math inline">\(h\)</span> (medida de alavancagem ou " <a href="https://en.wikipedia.org/wiki/Leverage_(statistics)">leverage</a>") em sua medida:</p>
<pre class="text"><code>bind_cols(
  residuals = fit$residuals,
  rstandard = rstandard(fit),
  rstudent = rstudent(fit)
) %&gt;%
  map_dbl(~shapiro.test(.x)$p.value)  %&gt;%
  tidy() %&gt;% 
  set_names(c(&quot;Medida&quot;, &quot;Valor p&quot;)) %&gt;% 
  kable(escape = F) %&gt;%
  kable_styling(&quot;hover&quot;,full_width = F)</code></pre>
<table class="table table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Medida
</th>
<th style="text-align:right;">
Valor p
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
residuals
</td>
<td style="text-align:right;">
0.1166788
</td>
</tr>
<tr>
<td style="text-align:left;">
rstandard
</td>
<td style="text-align:right;">
0.1801799
</td>
</tr>
<tr>
<td style="text-align:left;">
rstudent
</td>
<td style="text-align:right;">
0.0058696
</td>
</tr>
</tbody>
</table>
<p>Não existem evidências para rejeitar a hipótese de que os resíduos do modelo e os resíduos padronizados seguem distribuição normal. Já para os resíduos <em>studentizados</em> rejeita-se a hipótese de normalidade e como o valor de R² não foi muito alto (66.51%), indicando que a reta ajustada explica parcialmente a variação dos dados então pode ser interessante estudar com mais detalhes qual foi a influência do número de acidentes em cada mês no ajuste do modelo calculando as medias de influência para cada observação do modelo.</p>
<p>Uma observação é considerada influente caso sua exclusão no ajuste do modelo de regressão cause uma mudança substancial na análise de regressão e para identificar essas observações serão utilizadas as mesmas medidas utilizadas no post que fiz sobre <a href="https://gomesfellipe.github.io/post/2017-12-24-diagnostico-de-modelo/diagnostico-de-modelos/">Pacotes do R para avaliar o ajuste de modelos</a>.</p>
<p>De maneira visual e com medidas de influência do valor observado para cada mês no ajuste do modelo:</p>
<pre class="text"><code>t1  &lt;- influence.measures(fit) %$%
  infmat %&gt;% 
  as_tibble() %&gt;% 
  map_df(~.x %&gt;% round(4)) %&gt;% 
  mutate(mes = 1:12) %&gt;% 
  select(mes,everything()) %&gt;% 
  set_names(c(&quot;Mês&quot;,&quot;DF β1&quot;,&quot;DF β2&quot;,&quot;   DFFit&quot;,&quot;    CovRatio&quot;,&quot; D.Cook&quot;,&quot;   h&quot;))

g   &lt;- tableGrob(t1,rows = NULL)

ind &lt;- map_dbl(1:7, ~find_cell(g, 6, .x, &quot;core-bg&quot;))  

walk(ind, function(i) g$grobs[i][[1]][[&quot;gp&quot;]] &lt;&lt;-
       gpar(fill = &quot;darkolivegreen1&quot;, col = &quot;darkolivegreen1&quot;, lwd = 5)
)

# g2  &lt;-
#   ggplot2::autoplot(fit, print=F,suppressMessages=T) +
#   theme_bw()
# 
# gn  &lt;- arrangeGrob(g2[[1]], g2[[2]], g2[[3]], g2[[4]], g2[[5]], g2[[6]])
# 
# grid.arrange(gn, g, ncol=2)

grid.arrange(g)</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-19-1.png" width="1152" /></p>
<p>A tabela apresenta um resumo das medidas de inflencia de cada variável, segundo <span class="citation">@gauss</span>:</p>
<ul>
<li><strong>DF Beta</strong>: Alteração no vetor estimado β ao se retirar o i-ésimo ponto da análise<br />
</li>
<li><strong>DF Fit</strong>: Alteração provocada no valor ajustado pela retirada da observação i<br />
</li>
<li><strong>CovRatio</strong>: Expressa o relação de covariância<br />
</li>
<li><strong>D.Cook</strong>: Medida de afastamento das estimativas ao retirar i e também considera o resíduo estudentizado internamente<br />
</li>
<li><strong>h</strong>: Elementos da diagonal da matriz H</li>
</ul>
<p>É possível notar que no mês 5 (Maio) foi o mês que provocaria a maior alteração provocada no valor ajustado após sua retirada. Outra medida importante é a <a href="https://pt.wikipedia.org/wiki/Distância_de_Cook">Distância de Cook</a> que indica o quão atípica a observação <span class="math inline">\(i\)</span> se apresenta no ajuste do modelo combinando os resíduos estudentizados e as medidas de alavancagem possibilitando examinar observações que influenciam bastante as estimativas dos parâmetros.</p>
<p>Em geral, se <span class="math inline">\(D_i&gt;1\)</span> o ponto é excessivamente influente mas como no geral as observações apresentaram valor muito inferior a 1 então a eliminação de qualquer uma dessas variáveis não vai alterar substancialmente as estimativas dos parâmetros porém nós podemos <strong>examinar</strong> quaisquer observações cujo <span class="math inline">\(D_i\)</span> seja muito maior em relação aos demais valores estimados para <span class="math inline">\(D_i\)</span> com mais cuidado para entender qual foi foi sua influência no ajuste do modelo:</p>
<pre class="text"><code># Como a funcao augment do broom nao parece mais suportar o modelo ajustado por tslm, vamos ajustar na mão o modelo com a tendencia para criar o gráfico:
to_lm &lt;- to_lm %&gt;% mutate(trend = 1:nrow(.))
fit_lm &lt;- lm(y ~ trend, data = to_lm) 


fit_lm %&gt;% 
  broom::augment() %&gt;% 
  mutate(col = if_else(.resid==max(.resid), T, F))%&gt;%
  mutate(trend = factor(months(base[[1]]$data_inversa) %&gt;% unique,
                        levels = months(base[[1]]$data_inversa) %&gt;% unique) ) %&gt;% 
  ggplot(aes(x=trend,y=.resid,col=col,label=trend)) +
  geom_point() +
  geom_label(vjust = -0.25) +
  theme_bw() +
  scale_y_continuous(limits=c(-20,35),breaks = seq(-20,35,5)) +
  scale_color_manual(values=c(&quot;black&quot;, &quot;red&quot;)) +
  geom_hline(yintercept = 0,linetype=&quot;dashed&quot;,col=&quot;red&quot;) +
  theme(legend.position=&quot;none&quot;) +
  labs(y=&quot;Resíduos&quot;, x=&quot;Valores ajustados&quot;, title=&quot;Resíduos vs Ajuste&quot;)</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-20-1.png" width="1152" /></p>
<p>De fato o valor ajustado para o mês de maior é muito diferente do valor real observado, o que implica que houve um comportamento atípico que pode ser confirmado ao voltar no gráfico da série temporal e constatar um comportamento diferente (o número de acidente aumentou em relação ao anterior) e fugindo da tendência geral dos dados.</p>
</div>
</div>
</div>
<div id="próximos-passos" class="section level1">
<h1>Próximos passos <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/Toicon-icon-lines-and-angles-think.svg/2000px-Toicon-icon-lines-and-angles-think.svg.png" style="width:5.0%" /></h1>
<p>Uma das outras idéias que tive para a analisar estes dados conforme avançava com o estudo foi de cruza-los com o fluxo de carros na ponte para ter uma ideia de proporção mas essa ideia fica como sugestão para quem também tiver curiosidade sobre este assunto pois a intensão deste post é fazer uma análise de caráter introdutório para mostrar como é possível obter insights através dos dados com o uso da Estatística.</p>
<p>Além disso gostaria de incentivar todo o pessoal que gosta de dados e tiverem dúvidas sobre questões da vida, o universo e tudo mais a procurarem sempre por respostas mas tomar muito cuidado ao tirar conclusões! Este, por exemplo, foi um estudo de caráter introdutório e descritivo e obviamente existe uma porção de outras maneiras de estudar estes dados e como estamos diante de tanta abundância, basta uma pergunta que a investigação pode ser iniciada e se sempre temos a resposta para tudo nosso cérebro nunca entra “no modo de busca”. É importante sempre questionar respostas!</p>
</div>
<div id="referências" class="section level1">
<h1>Referências</h1>
<p>Notícia do G1: <a href="http://g1.globo.com/rio-de-janeiro/noticia/2015/11/monitoramento-com-cameras-ajuda-reduzir-acidentes-na-ponte-rio-niteroi.html">Monitoramento com câmeras ajuda a reduzir acidentes na Ponte Rio-Niterói</a></p>
</div>

        <p><strong>Leia o post completo em:</strong> <a href="https://gomesfellipe.github.io/post/2018-09-29-freq-acidente-ponte-rio-niteroi/freq-acidente-ponte-rio-niteroi/">Com que frequência ocorrem acidentes na ponte Rio-Niterói?</a></p>
        <p><em>Este post foi originalmente publicado em <a href="https://gomesfellipe.github.io/">Fellipe Gomes - Data Science Blog</a></em></p>
      ]]></content:encoded>
      <category>Analise Exploratória</category>
      <category>Data mining</category>
      <category>Mapas</category>
      <category>Prática</category>
      <category>R</category>
      <category>Regressão</category>
      <category>Tidyverse</category>
      <category>Séries Temporais</category>
      <category domain="tag">Tidyverse</category>
      <category domain="tag">Tabelas</category>
      <category domain="tag">Séries Temporais</category>
      <category domain="tag">RStudio</category>
      <category domain="tag">R Markdown</category>
      <category domain="tag">R</category>
      <category domain="tag">Prática</category>
      <category domain="tag">Mapa</category>
      <category domain="tag">ponte rio niteroi</category>
      <category domain="tag">acidentes</category>
      <category domain="tag">transito</category>
      <category domain="tag">Estatistica</category>
      <category domain="tag">Dplyr</category>
      <category domain="tag">gomesfellipe</category>
      <category domain="tag">leaflet</category>
    </item>
    <item>
      <title>Um estudo sobre modelos de aprendizagem baseados em árvores com desafio do Kaggle</title>
      <link>https://gomesfellipe.github.io/post/2018-08-31-modelos-em-arvore/modelos-em-arvore/</link>
      <pubDate>Fri, 31 Aug 2018 00:00:00 +0000</pubDate>
      <author>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</author>
      <guid>https://gomesfellipe.github.io/post/2018-08-31-modelos-em-arvore/modelos-em-arvore/</guid>
      <description>Um estudo aplicado de modelos de aprendizagem baseados em árvores utilizando a base de dados do Kaggle para prever o preço final de casas residenciais em Ames, Iowa, utilizando uma variedade de aspectos</description>
      <content:encoded>&lt;![CDATA[
        
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<div id="kaggle" class="section level1">
<h1>Kaggle</h1>
<p>Segundo o <a href="https://en.wikipedia.org/wiki/Kaggle">Wikipédia</a>: “Kaggle é a maior comunidade mundial de cientistas de dados e machine learning.” Aprendo muito estudando as resoluções de alguns competidores pois lá é possível conferir tanto as metodologias utilizadas pelos competidores quando os códigos e é notável o cuidado dos participantes para que seja possível a reprodutibilidade dos resultados, o que pode impulsionar o aprendizado.</p>
<p>O Kaggle trabalha com a ideia de <a href="https://en.wikipedia.org/wiki/Gamification">gamificação</a>, que é um assunto do qual já escrevi em um post sobre <a href="https://gomesfellipe.github.io/post/2018-02-17-cheatsheet-gamificacao-r/cheatsheet-gamificacao-r/">gamificação e porque aprender R é tão divertido</a> e gosto deste conceito de se criar jogos para motivar e engajar as pessoas em atividades profissionais e a ideia de se estar em um jogo possibilita doses de motivação especialmente a quem gosta de competir.</p>
<p>A plataforma é focada em competições que envolvem modelagem preditiva, que julgam apenas o seu desempenho preditivo, embora a inteligibilidade não deixe de ser importante. Neste post farei também a modelagem descritiva com modelos de aprendizagem baseados em árvores, na qual o principal objetivo será obter informações sobre os dados para o ajuste dos modelos preditivos que iremos submeter à competição do Kaggle <a href="https://www.kaggle.com/c/house-prices-advanced-regression-techniques/">House Prices: Advanced Regression Techniques</a>.</p>
<p>A diferença entre modelos preditivos e descritivos não é tão rigorosa assim pois algumas das técnicas podem ser utilizadas para ambos e geralmente um modelo pode servir para ambos os propósitos (mesmo que de de forma insuficiente).</p>
<p>Além dos modelos de machine learning baseados em árvores, também será ajustado um modelo de regressão linear multivariado para compararmos os resultados dos ajustes e submeter nossas previsões no site do <a href="https://kaggle.com">kaggle</a>.</p>
<p>Os pacotes que serão utilizados serão os seguintes:</p>
<pre class="r"><code>library(purrr)       # Programacao funciona
library(broom)       # Arrumar outputs
library(dplyr)       # Manipulacao de dados
library(magrittr)    # pipes
library(funModeling) # df_status()
library(plyr)        # revalue()
library(gridExtra)   # Juntar ggplots
library(reshape)     # funcao melt()
library(rpart)       # Arvore de Decisoes
library(rpart.plot)  # Plot da Arvore de Decisoes
library(data.table)  # aux na manipulacao do heatmap
library(readr)       # Leitura da base de dados
library(stringr)     # Manipulacao de strings
library(ggplot2)     # Graficos elegantes
library(caret)       # Machine Learning 
library(GGally)      # up ggplot
library(ggfortify)   # autoplot()</code></pre>
<div id="base-de-dados" class="section level2">
<h2>Base de dados</h2>
<p>A base de dados deste post vem de uma competição ótima para estudantes de ciência de dados de dados com alguma experiência com R ou Python e noções básicas de machine learning e estatística.</p>
<p>Pode ser útil para aqueles que desejam expandir seu conjunto de habilidades em uma tarefa de regressão, quando a variável <span class="math inline">\(y\)</span> que desejamos estimar é do tipo numérico (contínuo ou discreto).</p>
<p>Trata-se do <a href="https://ww2.amstat.org/publications/jse/v19n3/decock.pdf">conjunto de dados Ames Housing</a> que foi compilado por Dean De Cock para uso em educação de ciência de dados.</p>
<pre class="r"><code>train &lt;- read_csv(&quot;train.csv&quot;)
test  &lt;- read_csv(&quot;test.csv&quot;)
full  &lt;- bind_rows(train, test)

id    &lt;- test$Id
full %&lt;&gt;% select(-Id)</code></pre>
<div id="descrição-da-competição" class="section level3">
<h3>Descrição da Competição</h3>
<p>Traduzido do site oficial do kaggle:</p>
<p>"Peça a um comprador que descreva a casa dos seus sonhos, e eles provavelmente não começarão com a altura do teto do porão ou a proximidade de uma ferrovia leste-oeste. Mas o conjunto de dados desta competição de playground prova que muito mais influencia as negociações de preço do que o número de quartos ou uma cerca branca.</p>
<p>Com 79 variáveis explicativas descrevendo (quase) todos os aspectos de casas residenciais em Ames, Iowa, esta competição desafia você a prever o preço final de cada casa."</p>
<p>Portanto, primeiramente vamos entender o comportamento da variável resposta, depois buscar quais dessas 79 variáveis explicativas são mais importantes para representar a variação do preço de venda das casas através dos métodos baseados em árvores e por fim ajustar os modelos propostos e submeter nossas estimativas no site!</p>
</div>
</div>
</div>
<div id="análise-exploratória-dos-dados" class="section level1">
<h1>Análise exploratória dos dados</h1>
<p>Antes de pensar em ajustar algum modelo é extremamente necessário entender como se comportam os dados, portanto, tanto a variável resposta quanto as variáveis explicativas serão avaliadas.</p>
<div id="variável-resposta" class="section level2">
<h2>Variável resposta:</h2>
<p><code>SalePrice</code> - o preço de venda da propriedade em dólares. Essa é a variável de destino que estamos tentando prever.</p>
<p><img src="/post/2018-08-31-modelos-em-arvore/modelos-em-arvore_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Note que a distribuição dos dados referentes ao preço de venda se distribui de maneira assimétrica e não possuem evidências de normalidade dos dados. Apesar dos métodos baseados em árvore se tratarem de técnicas não paramétricas essa transformação será feita pois ao final deste post desejo comparar os resultados com um modelo de regressão linear múltipla.</p>
</div>
</div>
<div id="árvore-de-decisão" class="section level1">
<h1>Árvore de decisão</h1>
<p>Uma técnica muito popular que é mais comumente usada para resolver tarefas de classificação de dados porém a árvore conhecida como <a href="https://tinyurl.com/ybhlsgom">CART (Classification and Regression Trees)(Breiman, 1986)</a> lida com todos os tipos de atributos (incluindo atributos numéricos que são tratados a partir da criação de intervalos). Para seu ajuste é possível realizar podas e produzir árvores binárias.</p>
<p>A construção da árvore é realizada por meio do algoritmo que iterativamente analisa os atributos descritivos de um conjunto de dados previamente rotulado. Sua popularidade como apoio para a tomada de decisão se deve principalmente ao fato da fácil visualização do conhecimento gerado e o fácil entendimento.</p>
<p>Outra característica legal da árvore de decisões é que ela permite ajustar um modelo sem um pré-processamento detalhado, pois é fácil de ajustar, aceita valores faltantes e é de fácil interpretação, veja:</p>
<pre class="r"><code>library(rpart)

control &lt;- rpart.control(minsplit =10, # o número mínimo de observações em um nó
                         cp = 0.006    # parametro de complexidade q controla o tamanho da arvore
)
rpartFit &lt;- rpart(exp(SalePrice) ~ . , train, method = &quot;anova&quot;, control = control) 

rpart.plot::rpart.plot(rpartFit,cex = 0.6)</code></pre>
<p><img src="/post/2018-08-31-modelos-em-arvore/modelos-em-arvore_files/figure-html/unnamed-chunk-5-1.png" width="1200" /></p>
<p>No topo, vemos o primeiro nó com 100% das observações, que representa o total da base (100%). Em seguida, vemos que a primeira variável que determina o preço de venda das casas <code>SalePrice</code> é a variável <code>OverallQual</code>. As casas que apresentaram <code>OverallQual</code> &lt; 7.5 ocorrem em maior proporção do que as que tiveram <code>OverallQual</code>&gt;7.5. A interpretação pode continuar dessa forma recursivamente.</p>
<p>É possível notar que as variáveis <code>OverallQual</code>,<code>Neighborhood</code>,<code>1stFlrSF</code>,<code>2ndFlrSF</code>,<code>GrLivArea</code>, <code>BsmtFinSF1</code> foram as que melhor representaram os dados de acordo com os parâmetros que determinamos para ajustar esta árvore, vejamos com mais detalhes se existe relação linear e intensidade e direção dessa relação com o <a href="https://pt.wikipedia.org/wiki/Coeficiente_de_correla%C3%A7%C3%A3o_de_Pearson">coeficiente de correlação de Pearson</a> entre estas variáveis dois a dois e em relação à variável resposta:</p>
<pre class="r"><code>devtools::source_url(&quot;https://raw.githubusercontent.com/gomesfellipe/functions/master/correlations_for_ggpairs.R&quot;)

train %&gt;% 
  select(SalePrice,OverallQual,`1stFlrSF`,`2ndFlrSF`,GrLivArea,BsmtFinSF1) %&gt;% 
  ggpairs(lower = list(continuous = my_fn))+
  theme_bw()</code></pre>
<p><img src="/post/2018-08-31-modelos-em-arvore/modelos-em-arvore_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Com esta figura temos muitas informações, destaca-se que todas essas variáveis possuem algum tipo de relação linear com a variável resposta, a menor correlação observada foi com o <code>BsmtFinSF1</code> e a variável que apresentou a maior correlação foi a <code>OverallQual</code>. Atenção para a correlação entre <code>SalePrice</code> e <code>OverallQual</code>, pois <code>Overallqual</code> parece ser uma variável ordinal e uma outra medida de correlação que melhor representaria esta relação é o <a href="https://pt.wikipedia.org/wiki/Coeficiente_de_correla%C3%A7%C3%A3o_de_postos_de_Spearman">coeficiente de correlação de Spearman</a>, veja:</p>
<pre class="r"><code>cor(full$SalePrice, full$OverallQual, method = &quot;spearman&quot;, use = &quot;complete.obs&quot;)</code></pre>
<pre><code>## [1] 0.8098286</code></pre>
<p>Um pouco diferente do resultado da correlação de Pearson pois avalia relações lineares, já a correlação de Spearman avalia relações monótonas, sejam elas lineares ou não.</p>
<div id="análise-exploratória-e-input-de-nas" class="section level2 tabset">
<h2>Análise exploratória e input de <code>NA</code>s</h2>
<p>Arrumar a base de dados é uma tarefa longa e que geralmente consome grande parte no tempo em um projeto de ciência de dados. Não adianta usar o algorítimo mais poderoso de machine learning se a base de dados não estiver arrumada de maneira que possibilite a análise dos dados.</p>
<p>Para obter informações da amostra, confira no <a href="https://www.kaggle.com/c/house-prices-advanced-regression-techniques/data">link do dataset da competição no Kaggle</a>. Na página é possível conferir <a href="https://www.kaggle.com/c/house-prices-advanced-regression-techniques/download/data_description.txt">a descrição da amostra</a> e nela nota-se que alguns dos valores faltantes possuem significado, então é necessário rotulá-los para que o R possa interpretar estes valores da maneira correta.</p>
<div id="status-da-amostra" class="section level3">
<h3>Status da amostra</h3>
<p>Conferindo o status da amostra com a função <code>df_status()</code> do pacote <a href="https://cran.r-project.org/web/packages/funModeling/index.html"><code>funModeling</code></a>:</p>
<pre class="r"><code>full %&gt;% 
  df_status(print_results = F) %&gt;% 
  as_tibble() %&gt;%
  arrange(-p_na, -p_zeros)</code></pre>
<pre><code>## # A tibble: 80 x 9
##    variable     q_zeros p_zeros  q_na  p_na q_inf p_inf type      unique
##    &lt;chr&gt;          &lt;int&gt;   &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;int&gt;
##  1 PoolQC             0       0  2909 99.7      0     0 character      3
##  2 MiscFeature        0       0  2814 96.4      0     0 character      4
##  3 Alley              0       0  2721 93.2      0     0 character      2
##  4 Fence              0       0  2348 80.4      0     0 character      4
##  5 SalePrice          0       0  1459 50.0      0     0 numeric      663
##  6 FireplaceQu        0       0  1420 48.6      0     0 character      5
##  7 LotFrontage        0       0   486 16.6      0     0 numeric      128
##  8 GarageYrBlt        0       0   159  5.45     0     0 numeric      103
##  9 GarageFinish       0       0   159  5.45     0     0 character      3
## 10 GarageQual         0       0   159  5.45     0     0 character      5
## # … with 70 more rows</code></pre>
<p>Note que as variáveis problemáticas foram ordenadas de forma decrescente (maior número de dados faltantes e zeros) vamos tratar uma de cada vez partindo da variável mais crítica</p>
</div>
<div id="pool" class="section level3">
<h3>Pool</h3>
<ul>
<li><code>PoolQC</code> é a variável que possui mais <code>NA</code> e a descrição da base informa que:</li>
</ul>
<p><code>PoolQC</code>: qualidade da piscina</p>
<ul>
<li>Ex Excelente</li>
<li>Gd Good</li>
<li>TA Média / Típica</li>
<li>Fa Pequena</li>
<li>NA sem piscina</li>
</ul>
<p>É possível observar que se trata de uma variável ordinal, portanto vamos criar uma variável auxiliar (pois esta descrição se repete em outras variáveis):</p>
<pre class="r"><code># Criando variável auxilar ordinal
Qualidade &lt;- c(&#39;None&#39; = 0, &#39;Po&#39; = 1, &#39;Fa&#39; = 2, &#39;TA&#39; = 3, &#39;Gd&#39; = 4, &#39;Ex&#39; = 5)

full %&lt;&gt;%
  mutate(PoolQC =  ifelse(PoolQC %&gt;% is.na, &quot;None&quot;, PoolQC) %&gt;% as.factor() ) %&gt;% 
  mutate(PoolQC = as.integer(revalue(PoolQC, Qualidade)))</code></pre>
<p>Além disso, existe outra variável relacionada à piscina, veja:</p>
<pre class="r"><code>full %&gt;% 
  select(names(full)[names(full) %&gt;% str_detect(&quot;Pool&quot;)]) %&gt;% 
  table </code></pre>
<pre><code>##         PoolQC
## PoolArea    1    2    3    4
##      0      0    0    0 2906
##      144    1    0    0    0
##      228    1    0    0    0
##      368    0    0    0    1
##      444    0    0    0    1
##      480    0    0    1    0
##      512    1    0    0    0
##      519    0    1    0    0
##      555    1    0    0    0
##      561    0    0    0    1
##      576    0    0    1    0
##      648    0    1    0    0
##      738    0    0    1    0
##      800    0    0    1    0</code></pre>
<pre class="r"><code>full %&gt;% 
  select(names(full)[names(full) %&gt;% str_detect(&quot;Pool&quot;)]) %&gt;%
  map(~sum(is.na(.x)))</code></pre>
<pre><code>## $PoolArea
## [1] 0
## 
## $PoolQC
## [1] 0</code></pre>
<pre class="r"><code># Arrumando inconsistëncias:
full %&lt;&gt;% 
  mutate(PoolQC = ifelse(PoolQC == 0 &amp; PoolArea !=0, 2, PoolQC))

# Arrumando inconsistëncias:
full %&lt;&gt;% 
  mutate(Pool = ifelse(PoolQC == 0 &amp; PoolArea ==0, &quot;no&quot;, &quot;yes&quot;))</code></pre>
</div>
<div id="misc" class="section level3">
<h3>Misc</h3>
<p>Se referem aos recursos diversos</p>
<pre class="r"><code>full %&gt;% 
  select(names(full)[names(full) %&gt;% str_detect(&quot;Misc&quot;)],
         SalePrice
  ) %&gt;%
  map(~sum(is.na(.x)))</code></pre>
<pre><code>## $MiscFeature
## [1] 2814
## 
## $MiscVal
## [1] 0
## 
## $SalePrice
## [1] 1459</code></pre>
<p><code>MiscFeature</code>: recurso diverso não coberto em outras categorias</p>
<ul>
<li>Elevador elev</li>
<li>Gar2 2nd Garage (se não for descrito na seção de garagem)</li>
<li>Othr Outro</li>
<li>Galpão derramado (mais de 100 SF)</li>
<li>TenC Campo de ténis</li>
<li>NA Nenhum</li>
</ul>
<p>Desta vez não se trata de uma variável ordinal, vejamos:</p>
<pre class="r"><code>full %&lt;&gt;%
  mutate(MiscFeature =  if_else(MiscFeature %&gt;% is.na, &quot;None&quot;, MiscFeature) %&gt;% as.factor) 

# Breve resumo:
g1 &lt;- 
  full %&gt;% 
  select(names(full)[names(full) %&gt;% str_detect(&quot;Misc&quot;)], SalePrice) %&gt;% 
  ggplot(aes(y=MiscVal,x= reorder(MiscFeature, -MiscVal,FUN = median) ,fill=MiscFeature))+
  geom_boxplot()+
  theme_bw() +
  scale_fill_viridis_d() +
  labs(x = &quot;Recurso Diverso&quot;)

g2 &lt;- 
  full %&gt;% 
  select(names(full)[names(full) %&gt;% str_detect(&quot;Misc&quot;)], SalePrice) %&gt;% 
  ggplot(aes(y=SalePrice,x= reorder(MiscFeature, -MiscVal,FUN = median) ,fill=MiscFeature))+
  geom_boxplot()+
  theme_bw() +
  scale_fill_viridis_d() +
  labs(x = &quot;Preço de Venda&quot;)

grid.arrange(g1, g2)</code></pre>
<p><img src="/post/2018-08-31-modelos-em-arvore/modelos-em-arvore_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<pre class="r"><code>rm(g1,g2)</code></pre>
<p>Além disso, <code>MiscVal</code>: Valor do recurso variado</p>
</div>
<div id="alley" class="section level3">
<h3>Alley</h3>
<p><code>Alley</code>: Tipo de acesso ao beco para a propriedade</p>
<ul>
<li>Grvl Cascalho</li>
<li>Pave pavimentado</li>
<li>NA Nenhum acesso de beco</li>
</ul>
<p>Basta realizar o input:</p>
<pre class="r"><code>full %&lt;&gt;% 
  mutate(Alley = Alley %&gt;% str_replace_na(&quot;None&quot;)) %&gt;% 
  mutate(Alley = as.factor(Alley))</code></pre>
<pre class="r"><code>full[!is.na(full$SalePrice),] %&gt;% 
  select(Alley, SalePrice) %&gt;% 
  ggplot(aes(y=SalePrice,x= reorder(Alley, -SalePrice,FUN = median) ,fill=Alley))+
  geom_boxplot()+
  theme_bw() +
  scale_fill_viridis_d() +
  labs(x = &quot;tipo de Acesso&quot;)</code></pre>
<p><img src="/post/2018-08-31-modelos-em-arvore/modelos-em-arvore_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
<div id="fence" class="section level3">
<h3>Fence</h3>
<p><code>Fence</code>: qualidade da cerca</p>
<ul>
<li>GdPrv Boa privacidade</li>
<li>MnPrv minima privacidade</li>
<li>GdWo boa madeira</li>
<li>MnWw Mínima Madeira / Fio</li>
<li>NA Sem cerca</li>
</ul>
<p>Input será da seguinte forma:</p>
<pre class="r"><code>full %&lt;&gt;% 
  mutate(Fence = Fence %&gt;% str_replace_na(&quot;None&quot;))</code></pre>
<pre class="r"><code>full[1:nrow(train),] %&gt;% 
  select(Fence, SalePrice) %&gt;% 
  ggplot(aes(y=SalePrice,x= reorder(Fence, -SalePrice, median) ,fill=Fence))+
  geom_boxplot()+
  theme_bw() +
  scale_fill_viridis_d() +
  labs(x = &quot;tipo de Acesso&quot;)</code></pre>
<p><img src="/post/2018-08-31-modelos-em-arvore/modelos-em-arvore_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<pre class="r"><code>full %&lt;&gt;% mutate(Fence = as.factor(Fence))</code></pre>
<p>Aparentemente não parece existir uma relação ordinal sobre o tipo de cerca quanto ao pre;o de venda da casa, portanto foi convertida para fator</p>
</div>
<div id="fireplace" class="section level3">
<h3>FirePlace</h3>
<p>Variáveis relacionadas com lareira. Segundo a descrição, temos:</p>
<pre class="r"><code>full %&gt;% 
  select(names(full)[names(full) %&gt;% str_detect(&quot;Fireplace&quot;)], SalePrice)</code></pre>
<pre><code>## # A tibble: 2,919 x 3
##    Fireplaces FireplaceQu SalePrice
##         &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
##  1          0 &lt;NA&gt;             12.2
##  2          1 TA               12.1
##  3          1 TA               12.3
##  4          1 Gd               11.8
##  5          1 TA               12.4
##  6          0 &lt;NA&gt;             11.9
##  7          1 Gd               12.6
##  8          2 TA               12.2
##  9          2 TA               11.8
## 10          2 TA               11.7
## # … with 2,909 more rows</code></pre>
<p><code>Fireplaces</code>: Numero de lareiras</p>
<p><code>FireplaceQu</code>: Qualidade da lareira</p>
<ul>
<li>Ex Excellente - Excepcional Lareira de Alvenaria</li>
<li>Gd Boa - Lareira de alvenaria no nível principal</li>
<li>TA Média - lareira pré-fabricada na sala principal ou Lareira de alvenaria no porão</li>
<li>Fa Pequena - Lareira pré-fabricada no porão</li>
<li>Po Pobre - Fogão Ben Franklin</li>
<li>NA sem lareira</li>
</ul>
<p>Nota-se que se trata de uma variável ordinal de acordo com a qualidade, portanto:</p>
<pre class="r"><code>full %&lt;&gt;% 
  mutate(FireplaceQu =  if_else(FireplaceQu %&gt;% is.na, &quot;None&quot;, FireplaceQu) ) %&gt;% 
  mutate(FireplaceQu = as.integer(revalue(FireplaceQu, Qualidade)))</code></pre>
<p>Conferindo se existem inconsistências:</p>
<pre class="r"><code>full %&gt;% 
  select(names(full)[names(full) %&gt;% str_detect(&quot;Fireplace&quot;)]) %&gt;% 
  table </code></pre>
<pre><code>##           FireplaceQu
## Fireplaces    0    1    2    3    4    5
##          0 1420    0    0    0    0    0
##          1    0   46   63  495  627   37
##          2    0    0   10   92  112    5
##          3    0    0    1    4    5    1
##          4    0    0    0    1    0    0</code></pre>
</div>
<div id="lot" class="section level3">
<h3>Lot</h3>
<pre class="r"><code>full %&gt;% 
  select(names(full)[names(full) %&gt;% str_detect(&quot;Lot&quot;)], SalePrice) %&gt;% 
  map_dbl(~sum(is.na(.x)))</code></pre>
<pre><code>## LotFrontage     LotArea    LotShape   LotConfig   SalePrice 
##         486           0           0           0        1459</code></pre>
<p>Segundo a descrição:</p>
<p><code>LotFrontage</code>: Ruas linearmente conectadas à propriedade</p>
<p><code>LotArea</code> : Tamanho do lote em pés quadrados</p>
<p><code>LotShape</code>: forma geral da propriedade</p>
<ul>
<li>Regue Regular<br />
</li>
<li>IR1 ligeiramente irregular</li>
<li>IR2 moderadamente irregular</li>
<li>IR3 Irregular</li>
</ul>
<p><code>LotConfig</code>: configuração de lote</p>
<ul>
<li>Inside Lote muito para dentro</li>
<li>Corner Canto de esquina</li>
<li>CulDSac Cul-de-sac</li>
<li>FR2 Frente em 2 lados da propriedade</li>
<li>FR3 Frente em 3 lados da propriedade</li>
</ul>
<p>Input para o <code>LotFrontage</code> será feito considerando a configuração do lote, veja:</p>
<pre class="r"><code>inputsLot &lt;- full %&gt;% 
  select(LotFrontage, LotConfig) %&gt;% 
  group_by(LotConfig) %&gt;%
  dplyr::summarise(Media = mean(LotFrontage, na.rm = T),
            Mediana = median(LotFrontage, na.rm = T))

full$LotFrontage[is.na(full$LotFrontage) &amp; full$LotConfig == inputsLot$LotConfig[1]] &lt;- inputsLot$Mediana[1] 
full$LotFrontage[is.na(full$LotFrontage) &amp; full$LotConfig == inputsLot$LotConfig[2]] &lt;- inputsLot$Mediana[2] 
full$LotFrontage[is.na(full$LotFrontage) &amp; full$LotConfig == inputsLot$LotConfig[3]] &lt;- inputsLot$Mediana[3] 
full$LotFrontage[is.na(full$LotFrontage) &amp; full$LotConfig == inputsLot$LotConfig[4]] &lt;- inputsLot$Mediana[4] 
full$LotFrontage[is.na(full$LotFrontage) &amp; full$LotConfig == inputsLot$LotConfig[5]] &lt;- inputsLot$Mediana[5] </code></pre>
<p>Arrumando variáveis nominais e ordinais:</p>
<pre class="r"><code>full %&lt;&gt;% 
  mutate(LotShape = as.integer(revalue(full$LotShape, c(&#39;IR3&#39;=0, &#39;IR2&#39;=1, &#39;IR1&#39;=2, &#39;Reg&#39;=3))))</code></pre>
</div>
<div id="garages" class="section level3">
<h3>Garages</h3>
<p>Variáveis relacionadas, segundo a descrição, temos:</p>
<pre class="r"><code>full %&gt;% 
  select(names(full)[names(full) %&gt;% str_detect(&quot;Garage&quot;)], SalePrice) %&gt;% 
  map_dbl(~sum(is.na(.x)))</code></pre>
<pre><code>##   GarageType  GarageYrBlt GarageFinish   GarageCars   GarageArea   GarageQual 
##          157          159          159            1            1          159 
##   GarageCond    SalePrice 
##          159         1459</code></pre>
<p><code>GarageType</code>: localização da garagem</p>
<ul>
<li>2Types Mais de um tipo de garagem</li>
<li>Attchd anexa a casa</li>
<li>Basement tipo porao</li>
<li>BuiltIn (garagem parte da casa - normalmente tem sala acima da garagem)</li>
<li>CarPort Porta do carro</li>
<li>Detchd nao anexa a casa</li>
<li>NA Sem Garagem</li>
</ul>
<p><code>GarageYrBlt</code>: garagem do ano foi construída</p>
<p><code>GarageFinish</code>: acabamento interior da garagem</p>
<ul>
<li>Fin Finished</li>
<li>RFn Áspero Finalizado<br />
</li>
<li>Unf inacabado</li>
<li>NA Sem Garagem</li>
</ul>
<p><code>GarageCars</code>: Tamanho da garagem na capacidade do carro</p>
<p><code>GarageArea</code>: Tamanho da garagem em pés quadrados</p>
<p><code>GarageQual</code>: GarageQuality</p>
<ul>
<li>Ex Excelente</li>
<li>Gd Good</li>
<li>TA Típico / Médio</li>
<li>FA Justo</li>
<li>Po Poor</li>
<li>NA Sem Garagem</li>
</ul>
<p><code>GarageCond</code>: condição de garagem</p>
<ul>
<li>Ex Excelente</li>
<li>Gd Good</li>
<li>TA Típico / Médio</li>
<li>Fa Justo</li>
<li>Po Poor</li>
<li>NA Sem Garagem</li>
</ul>
<pre class="r"><code>full %&lt;&gt;% 
  mutate(GarageType   =  if_else(GarageType %&gt;% is.na, &quot;None&quot;, GarageType) ) %&gt;% 
  mutate(GarageYrBlt  = if_else(GarageYrBlt %&gt;% is.na,YearBuilt, GarageYrBlt) ) %&gt;% 
  mutate(GarageFinish =  if_else(GarageFinish %&gt;% is.na, &quot;None&quot;, GarageFinish) ) %&gt;% 
  mutate(GarageFinish = as.integer(revalue(GarageFinish, c(&#39;None&#39;=0, &#39;Unf&#39;=1, &#39;RFn&#39;=2, &#39;Fin&#39;=3)))) %&gt;% 
  mutate(GarageCars   = ifelse(GarageCars %&gt;% is.na, 0, GarageCars) ) %&gt;% 
  mutate(GarageArea   = ifelse(GarageArea %&gt;% is.na, 0, GarageArea)) %&gt;% 
  mutate(GarageQual   = if_else(GarageQual %&gt;% is.na, &quot;None&quot;, GarageQual)) %&gt;% 
  mutate(GarageQual   = as.integer(revalue(GarageQual, Qualidade))) %&gt;% 
  mutate(GarageCond   = if_else(GarageCond %&gt;% is.na, &quot;None&quot;, GarageCond)) %&gt;% 
  mutate(GarageCond   = as.integer(revalue(GarageCond, Qualidade))) 
  
table(full$GarageCond)</code></pre>
<pre><code>## 
##    0    1    2    3    4    5 
##  159   14   74 2654   15    3</code></pre>
</div>
<div id="bsmt" class="section level3">
<h3>Bsmt</h3>
<pre class="r"><code>full %&gt;% 
  select(names(full)[names(full) %&gt;% str_detect(&quot;Bsmt&quot;)], SalePrice) %&gt;% 
  map_dbl(~sum(is.na(.x)))</code></pre>
<pre><code>##     BsmtQual     BsmtCond BsmtExposure BsmtFinType1   BsmtFinSF1 BsmtFinType2 
##           81           82           82           79            1           80 
##   BsmtFinSF2    BsmtUnfSF  TotalBsmtSF BsmtFullBath BsmtHalfBath    SalePrice 
##            1            1            1            2            2         1459</code></pre>
<p><code>BsmtQual</code>: Avalia a altura do porão</p>
<ul>
<li>Ex Excelente (100+ polegadas)<br />
</li>
<li>Gd Bom (90-99 polegadas)</li>
<li>TA Típica (80-89 polegadas)</li>
<li>Fa Justo (70-79 polegadas)</li>
<li>Po Pobre (&lt;70 polegadas</li>
<li>NA Sem Porão</li>
</ul>
<p><code>BsmtCond</code>: Avalia o estado geral do porão</p>
<ul>
<li>Ex Excelente</li>
<li>Gd Bom</li>
<li>TA Típica - umidade ligeira permitida</li>
<li>Fa Razoável - umidade ou alguma rachadura ou sedimentação</li>
<li>Po Insuficiente - Craqueamento severo, sedimentação ou umidade</li>
<li>NA Sem Porão</li>
</ul>
<p><code>BsmtExposure</code>: Refere-se a paralisações ou paredes no nível do jardim</p>
<ul>
<li>Gd Good Exposição</li>
<li>Av Média Exposição (níveis divididos ou foyers normalmente pontuação média ou acima)<br />
</li>
<li>Mn Exposição Mínima</li>
<li>No Não Exposição</li>
<li>NA Sem porão</li>
</ul>
<p><code>BsmtFinType1</code>: Avaliação da área acabada do porão</p>
<ul>
<li>GLQ Bons Viver</li>
<li>ALQ Média Living Quarters</li>
<li>BLQ Abaixo da média Living Quarters<br />
</li>
<li>Rec Média Rec Room</li>
<li>LwQ Baixa Qualidade</li>
<li>Unf unfinshed</li>
<li>NA nenhum porão</li>
</ul>
<p><code>BsmtFinSF1</code>: pes quadrados do tipo 1 terminado</p>
<p><code>BsmtFinType2</code>: Avaliação do porão área terminado (se vários tipos)</p>
<ul>
<li>GLQ Bons aposentos</li>
<li>ALQ Medianos</li>
<li>BLQ abaixo da media</li>
<li>Rec Aposentos média qualidade</li>
<li>LwQ Baixa Qualidade</li>
<li>Unf</li>
<li>Não Sem Porão</li>
</ul>
<p><code>BsmtFinSF2</code>: Pés quadrados acabados do Tipo 2</p>
<p><code>BsmtUnfSF</code>: Pés quadrados inacabados da área do porão</p>
<p><code>TotalBsmtSF</code>: Total pés quadrados da área do porão</p>
<p>Input das variáveis não numéricas com <code>None</code> e convertendo para ordinal as variáveis com relação de ordem. Para os faltantes das variáveis numéricas foram imputados o valor 0 (zeros).</p>
<pre class="r"><code># Categóricos:
full[,names(full)[names(full) %&gt;% str_detect(&quot;Bsmt&quot;)]] &lt;- 
  full[,names(full)[names(full) %&gt;% str_detect(&quot;Bsmt&quot;)]] %&gt;%
  select(names(full)[names(full) %&gt;% str_detect(&quot;Bsmt&quot;)]) %&gt;%
  mutate_if( ~ !is.numeric(.x) , ~ ifelse(is.na(.x), &quot;None&quot;, .x)) %&gt;% 
  mutate(BsmtQual = as.integer(revalue(BsmtQual, Qualidade))) %&gt;% 
  mutate(BsmtCond = as.integer(revalue(BsmtCond, Qualidade))) %&gt;% 
  mutate(BsmtExposure = as.integer(revalue(BsmtExposure, c(&#39;None&#39;=0, &#39;No&#39;=1, &#39;Mn&#39;=2, &#39;Av&#39;=3, &#39;Gd&#39;=4)))) %&gt;% 
  mutate(BsmtFinType1 = as.integer(revalue(BsmtFinType1,c(&#39;None&#39;=0, &#39;Unf&#39;=1, &#39;LwQ&#39;=2, &#39;Rec&#39;=3, &#39;BLQ&#39;=4, &#39;ALQ&#39;=5, &#39;GLQ&#39;=6)))) 

# Numéricos:
full[,names(full)[names(full) %&gt;% str_detect(&quot;Bsmt&quot;)]] &lt;- 
  full[,names(full)[names(full) %&gt;% str_detect(&quot;Bsmt&quot;)]] %&gt;%
  select(names(full)[names(full) %&gt;% str_detect(&quot;Bsmt&quot;)]) %&gt;%
  mutate_if( ~ is.numeric(.x) , ~ ifelse(is.na(.x), 0, .x))</code></pre>
</div>
<div id="masvnr" class="section level3">
<h3>MasVnr</h3>
<pre class="r"><code>full %&gt;% 
  select(names(full)[names(full) %&gt;% str_detect(&quot;MasVnr&quot;)], SalePrice) %&gt;% 
  map_dbl(~sum(is.na(.x)))</code></pre>
<pre><code>## MasVnrType MasVnrArea  SalePrice 
##         24         23       1459</code></pre>
<p><code>MasVnrType</code>: Alvenaria tipo de verniz</p>
<ul>
<li>BrkCmn Brick Common</li>
<li>BrkFace Face de tijolos</li>
<li>CBlock Bloco cinza</li>
<li>None Nenhum</li>
<li>Stone Pedra</li>
</ul>
<p><code>MasVnrArea</code>: Área de folheado de alvenaria em pés quadrados</p>
<pre class="r"><code>full %&lt;&gt;% 
  mutate(MasVnrType = if_else(is.na(MasVnrType), &quot;None&quot;, MasVnrType)) %&gt;% 
  mutate(MasVnrType = as.integer(revalue(MasVnrType, c(&#39;None&#39;=0, &#39;BrkCmn&#39;=0, &#39;BrkFace&#39;=1, &#39;Stone&#39;=2)))) %&gt;% 
  mutate(MasVnrArea = if_else(is.na(MasVnrArea), 0, 1))</code></pre>
</div>
<div id="variáveis-restantes-com-poucos-na" class="section level3">
<h3>Variáveis restantes com poucos <code>NA</code></h3>
<p>A estratégia adotada para imputar estes dados será tomada de maneira arbitrária. Os valores faltantes serão preenchidos com o valor comum mais frequente daquela variável. As variáveis que restam são:</p>
<pre class="r"><code>full %&gt;% 
  df_status(print_results = F) %&gt;% 
  as_tibble() %&gt;%
  arrange(-p_na, -p_zeros)</code></pre>
<pre><code>## # A tibble: 81 x 9
##    variable    q_zeros p_zeros  q_na  p_na q_inf p_inf type      unique
##    &lt;chr&gt;         &lt;int&gt;   &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;int&gt;
##  1 SalePrice         0     0    1459 50.0      0     0 numeric      663
##  2 MSZoning          0     0       4  0.14     0     0 character      5
##  3 Utilities         0     0       2  0.07     0     0 character      2
##  4 Functional        0     0       2  0.07     0     0 character      7
##  5 Exterior1st       0     0       1  0.03     0     0 character     15
##  6 Exterior2nd       0     0       1  0.03     0     0 character     16
##  7 Electrical        0     0       1  0.03     0     0 character      5
##  8 KitchenQual       0     0       1  0.03     0     0 character      4
##  9 SaleType          0     0       1  0.03     0     0 character      9
## 10 PoolArea       2906    99.6     0  0        0     0 numeric       14
## # … with 71 more rows</code></pre>
<p>Vejamos:</p>
<p><code>MSZoning</code>: Identifica a classificação geral de zoneamento da venda.</p>
<ul>
<li>Será convertida para fator, variável nominal</li>
</ul>
<p><code>KitchenQual</code>: Qualidade da cozinha</p>
<ul>
<li>Será convertida para ordinal</li>
</ul>
<p><code>Utilities</code>: Tipo de utilidade disponível</p>
<ul>
<li>Será removida</li>
</ul>
<p><code>Functional</code>: Funcionalidade doméstica</p>
<ul>
<li>Será considerada como ordinal</li>
</ul>
<p><code>Exterior1st</code>: revestimento Exterior em casa</p>
<ul>
<li>Convertida para fator, variável nominal</li>
</ul>
<p><code>Electrical</code>: Sistema elétrico</p>
<ul>
<li>Convertida para fator, variável nominal</li>
</ul>
<p><code>SaleType</code>: Tipo de venda</p>
<ul>
<li>Convertida para fator, variável nominal</li>
</ul>
<pre class="r"><code>full &lt;- full %&gt;% 
  mutate(MSZoning    = ifelse(is.na(MSZoning),
                            full$MSZoning %&gt;% table %&gt;% sort %&gt;% names %&gt;% last, MSZoning)) %&gt;% 
  mutate(MSZoning    = as.factor(MSZoning)) %&gt;% 
  mutate(KitchenQual = ifelse(is.na(KitchenQual),
                            full$KitchenQual %&gt;% 
                              table %&gt;% sort %&gt;% names %&gt;% last, KitchenQual)) %&gt;% 
  mutate(KitchenQual = as.integer(revalue(as.character(full$KitchenQual), Qualidade))) %&gt;% 
  select(-Utilities) %&gt;% 
  mutate(Exterior1st = ifelse(is.na(Exterior1st),
                            full$Exterior1st %&gt;% table %&gt;% sort %&gt;% names %&gt;% last, Exterior1st)) %&gt;% 
  mutate(Exterior1st = as.factor(Exterior1st)) %&gt;% 
  mutate(Exterior2nd = ifelse(is.na(Exterior2nd),
                            full$Exterior2nd %&gt;% table %&gt;% sort %&gt;% names %&gt;% last, Exterior2nd)) %&gt;% 
  mutate(Exterior2nd = as.factor(Exterior2nd)) %&gt;% 
  mutate(Electrical  = ifelse(is.na(Electrical),
                            full$Electrical %&gt;% table %&gt;% sort %&gt;% names %&gt;% last, Electrical)) %&gt;% 
  mutate(Electrical  = as.factor(Electrical)) %&gt;% 
  mutate(SaleType    = ifelse(is.na(SaleType ),
                            full$SaleType  %&gt;% table %&gt;% sort %&gt;% names %&gt;% last, SaleType )) %&gt;% 
  mutate(SaleType    = as.factor(SaleType )) 


full[is.na(full$Functional),&quot;Functional&quot;] &lt;- full$Functional %&gt;% table %&gt;% sort %&gt;% names %&gt;% last
full$Functional = as.integer(revalue(full$Functional, c(&#39;Sal&#39;=0, &#39;Sev&#39;=1, &#39;Maj2&#39;=2, &#39;Maj1&#39;=3, &#39;Mod&#39;=4, &#39;Min2&#39;=5, &#39;Min1&#39;=6, &#39;Typ&#39;=7)))
full[is.na(full$KitchenQual),&quot;KitchenQual&quot;] &lt;- full$KitchenQual %&gt;% table %&gt;% sort %&gt;% names %&gt;% last %&gt;% as.numeric()
full$KitchenQual = as.integer(revalue(as.character(full$KitchenQual), Qualidade))
# full[is.na(full$Electrical),&quot;Electrical&quot;] &lt;- 3

to_remove &lt;- full %&gt;% map(~table(.x) %&gt;% length()) %&gt;% .[.== 1] %&gt;% names()
full &lt;- full %&gt;% select(-one_of(to_remove))</code></pre>
<p>Status da base no momento:</p>
<pre class="r"><code>full %&gt;% 
  df_status(print_results = F) %&gt;% 
  as_tibble() %&gt;%
  arrange(-p_na,-p_zeros, type)</code></pre>
<pre><code>## # A tibble: 79 x 9
##    variable      q_zeros p_zeros  q_na  p_na q_inf p_inf type    unique
##    &lt;chr&gt;           &lt;int&gt;   &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt;
##  1 SalePrice           0     0    1459  50.0     0     0 numeric    663
##  2 PoolArea         2906    99.6     0   0       0     0 numeric     14
##  3 3SsnPorch        2882    98.7     0   0       0     0 numeric     31
##  4 LowQualFinSF     2879    98.6     0   0       0     0 numeric     36
##  5 MiscVal          2816    96.5     0   0       0     0 numeric     38
##  6 BsmtHalfBath     2744    94       0   0       0     0 numeric      3
##  7 ScreenPorch      2663    91.2     0   0       0     0 numeric    121
##  8 BsmtFinSF2       2572    88.1     0   0       0     0 numeric    272
##  9 EnclosedPorch    2460    84.3     0   0       0     0 numeric    183
## 10 HalfBath         1834    62.8     0   0       0     0 numeric      3
## # … with 69 more rows</code></pre>
<p>Transformando o <code>character</code> para <code>factor</code>:</p>
<pre class="r"><code>full %&lt;&gt;% mutate_if(is.character, as.factor)</code></pre>
<p>Transformando novamente nossa base de treino e de teste:</p>
<pre class="r"><code>train &lt;- full[1:nrow(train),] %&gt;% as.data.frame() 
test  &lt;- full[(nrow(train)+1):nrow(full),] %&gt;% select(-SalePrice) %&gt;% as.data.frame()

# # Input Missing
# train_miss_model = preProcess(train, &quot;knnImpute&quot;)
# train = predict(train_miss_model, train)
# test = predict(train_miss_model, test)
# 
# train$SalePrice &lt;- y</code></pre>
</div>
</div>
</div>
<div id="machine-learning-com-algorítmos-de-aprendizagem-baseados-em-árvores" class="section level1">
<h1>Machine Learning com algorítmos de aprendizagem baseados em árvores</h1>
<p>Os métodos baseados em árvores fornecem modelos preditivos de alta precisão, estabilidade e facilidade de interpretação. Ao contrário dos modelos lineares, eles são capazes de lidar bem com relações não-lineares além de poderem ser adaptados para resolver tanto problemas de classificação quanto problemas de regressão.</p>
<p>Algoritmos como árvores de decisão, random forest e “gradient boosting” estão sendo muito usados em todos os tipos de problemas de data science e é notável o uso desses algorítimos para resolver os desafios do <a href="https://www.kaggle.com/">Kaggle</a>. Para resolver este problema utilizaremos estes três algoritmos e ao final, pegando carona na seleção de variáveis para os algoritmos de árvore, será ajustado um modelo de regressão linear para compararmos e conferirmos a significância estatística de cada uma das variáveis.</p>
<div id="varimp-com-random-forest" class="section level2">
<h2>VarImp com Random Forest</h2>
<p>Um dos benefícios da floresta aleatória é o poder de lidar com grande conjunto de dados com maior dimensionalidade e identificar as variáveis a importância das variáveis, que pode ser uma característica muito útil porém deve ser feita com cautela.</p>
<p>Veja uma reflexão (traduzida) da <a href="https://www.stat.berkeley.edu/~breiman/RandomForests/reg_philosophy.htm">nota de Leo Breiman (Universidade da Califórnia em Berkeley)</a></p>
<blockquote>
<p>“Uma nota filosófica: RF é um exemplo de uma ferramenta que é útil para fazer análises de dados científicos; Mas os algoritmos mais inteligentes não substituem a inteligência humana e o conhecimento dos dados do problema; Pegue a saída de florestas aleatórias não como verdade absoluta, mas como suposições geradas por um computador inteligente que podem ser úteis para levar a uma compreensão mais profunda do problema.”</p>
</blockquote>
<p>O ajuste da árvore será feito com o pacote <code>caret</code> e o estudo de estimativas de erro foi definido como o <a href="https://en.wikipedia.org/wiki/Out-of-bag_error">Out of bag</a> que remove a necessidade de um conjunto de teste pois é o erro médio de previsão em cada amostra de treinamento <span class="math inline">\(x_i\)</span> , usando apenas as árvores que não tinham <span class="math inline">\(x_i\)</span> em sua amostra de <a href="https://www.ime.usp.br/~chang/home/mae5704/aula-bootstrap.pdf">bootstrap</a>.</p>
<pre class="r"><code>set.seed(1)
control &lt;- trainControl(method = &quot;oob&quot;,verboseIter = F)

rfFit1 &lt;- train(SalePrice ~. ,
      data=train,
      method=&quot;rf&quot;,
      metric = &quot;Rsquared&quot;,
      trControl = control,
      preProcess = c(&quot;knnImpute&quot;)
      )

randomForest::varImpPlot(rfFit1$finalModel)</code></pre>
<p><img src="/post/2018-08-31-modelos-em-arvore/modelos-em-arvore_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<pre class="r"><code>rfFit1$finalModel$importance %&gt;% 
  as.data.frame %&gt;%
  mutate(row = rownames(.)) %&gt;% 
  arrange(desc(IncNodePurity)) %&gt;% 
  as_tibble()</code></pre>
<pre><code>## # A tibble: 217 x 2
##    IncNodePurity row        
##            &lt;dbl&gt; &lt;chr&gt;      
##  1         77.9  OverallQual
##  2         35.0  GrLivArea  
##  3         14.8  YearBuilt  
##  4         11.5  KitchenQual
##  5          9.75 TotalBsmtSF
##  6          9.29 GarageCars 
##  7          6.74 `1stFlrSF` 
##  8          6.33 GarageArea 
##  9          5.02 ExterQualTA
## 10          4.04 BsmtFinSF1 
## # … with 207 more rows</code></pre>
<p>Após inspecionar a importância das variáveis vamos selecionar as seguintes variáveis:</p>
<pre class="r"><code>full %&lt;&gt;% 
  select(
    SalePrice  , Neighborhood, OverallQual , GrLivArea   , YearBuilt   ,  KitchenQual, 
    GarageCars ,  GarageArea , `1stFlrSF`  , ExterQual   , BsmtFinSF1  , FireplaceQu, 
    BsmtQual   , `2ndFlrSF`  , CentralAir  , GarageFinish, YearRemodAdd, FullBath, 
    GarageYrBlt, Fireplaces  , LotFrontage , BsmtUnfSF   , TotalBsmtSF , BsmtFinType1,
    OpenPorchSF, GarageType  , BsmtExposure, OverallCond , TotalBsmtSF , LotArea
  )</code></pre>
<p>Portanto, vamos definir novamente o conjunto de dados de treino e de teste:</p>
<pre class="r"><code>train &lt;- full[1:nrow(train),] %&gt;% as.data.frame()
test  &lt;- full[(nrow(train)+1):nrow(full),-1] %&gt;% as.data.frame()</code></pre>
</div>
<div id="variáveis-numéricas" class="section level2">
<h2>Variáveis numéricas</h2>
<p>Após a seleção dessas variáveis, vamos entender como elas estão correlacionadas dois a dois com o <a href="https://pt.wikipedia.org/wiki/Coeficiente_de_correla%C3%A7%C3%A3o_de_Pearson">coeficiente de correlação de pearson</a>, exibindo a matrix em um <a href="https://en.wikipedia.org/wiki/Heat_map">Heatmap</a> (ou mapa de calor ), que é uma representação gráfica de dados em que os valores individuais contidos em uma matriz representados como cores.</p>
<pre class="r"><code>cormat &lt;- 
  full %&gt;% 
  select(SalePrice, everything()) %&gt;% 
  select_if(is.numeric) %&gt;% 
  as.data.frame() %&gt;% 
  cor(use = &quot;na.or.complete&quot;) %&gt;% 
  melt

cormat %&gt;%   
  ggplot( aes(reorder(Var1,value), reorder(Var2,value), fill=value))+
  geom_tile(color=&quot;white&quot;)+
  scale_fill_gradient2(low=&quot;blue&quot;, high=&quot;red&quot;, mid=&quot;white&quot;, midpoint=0, limit=c(-1,1), space=&quot;Lab&quot;, name=&quot;Pearson\nCorrelation&quot;)+
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, vjust=1, size=10, hjust=1))+
  coord_fixed()+
  labs(x=&quot;&quot;,y=&quot;&quot;)</code></pre>
<p><img src="/post/2018-08-31-modelos-em-arvore/modelos-em-arvore_files/figure-html/unnamed-chunk-37-1.png" width="1152" /></p>
<p>É possível notar que existem variáveis explicativas correlacionadas o que indica que a presença de algumas variáveis pode possivelmente interferir no ajuste final do modelo linear multivariado.</p>
</div>
<div id="variáveis-categóricas" class="section level2">
<h2>Variáveis categóricas</h2>
<p>Já a relação das varáveis categóricas não podem ser calculada com o coeficiente de correlação calculado anteriormente, para avaliar como elas estão associadas será calculado a medida de associação <a href="https://en.wikipedia.org/wiki/Cram%C3%A9r%27s_V">V de Cramér</a>. Novamente a matrix dos resultados serão novamente apresentados em um <a href="https://en.wikipedia.org/wiki/Heat_map">Heatmap</a> (ou mapa de calor ) que foi inspirado <a href="http://analysingstuffs.xyz/2017/12/01/visualizing-the-correlations-between-categorical-variables-with-r-a-cramers-v-heatmap/">neste post</a> (neste post também é apresentada uma função para o cálculo da matrix, adaptei de forma que se tornasse mais geral e disponibilizei no meu github <a href="https://github.com/gomesfellipe/functions/blob/master/interaction_all.R">neste link</a>).</p>
<pre class="r"><code># Carrega funcao que calcula o V de Cramer:
devtools::source_url(&quot;https://raw.githubusercontent.com/gomesfellipe/functions/master/cv_test.R&quot;)
# Carrega a funcao que realiza as interações dos calculos dois a dois:
devtools::source_url(&quot;https://raw.githubusercontent.com/gomesfellipe/functions/master/interaction_all.R&quot;)</code></pre>
<p>Veja:</p>
<pre class="r"><code>cvmat &lt;- 
train %&gt;%
  select_if(~!is.numeric(.x)) %&gt;% 
  as.data.table() %&gt;%
  interaction_all(cv_test) %&gt;% 
  as_tibble() 

cvmat %&gt;% 
  ggplot( aes(variable_x, variable_y, fill=v_cramer))+
  geom_tile(color=&quot;white&quot;)+
  scale_fill_gradient2(low=&quot;blue&quot;, high=&quot;red&quot;, mid=&quot;white&quot;, midpoint=0, limit=c(-1,1), space=&quot;Lab&quot;, name=&quot;Cramer&#39;s V&quot;)+
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, vjust=1, size=10, hjust=1))+
  coord_fixed()+
  labs(x=&quot;&quot;,y=&quot;&quot;)</code></pre>
<p><img src="/post/2018-08-31-modelos-em-arvore/modelos-em-arvore_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
</div>
</div>
<div id="ajustando-modelos" class="section level1">
<h1>Ajustando modelos</h1>
<div id="arvore-de-decisao" class="section level2">
<h2>Arvore de decisao</h2>
<p>O modelo de árvore de decisão já foi comentado e deixei algumas referências ao final do post portanto vejamos a seguir o ajusto no R. Segundo a <a href="https://cran.r-project.org/web/packages/rpart/rpart.pdf">documentação</a>:</p>
<p><code>cp</code>: parâmetro de complexidade. No nosso caso isso significa que o <a href="https://pt.wikipedia.org/wiki/R%C2%B2"><span class="math inline">\(R^2\)</span></a> total deve aumentar em cp em cada etapa. O principal papel desse parâmetro é economizar tempo de computação removendo as divisões que obviamente não valem a pena. Essencialmente, informamos ao programa que qualquer divisão que não melhore o ajuste por <code>cp</code> provavelmente será eliminada por <a href="https://pt.wikipedia.org/wiki/Valida%C3%A7%C3%A3o_cruzada">validação cruzada</a>, e que, portanto, o programa não precisa buscá-la.</p>
<p>Para pesquisa de grade existem duas maneiras de ajustar um algoritmo no pacote <code>caret</code>: permitir que o sistema faça isso automaticamente ou especificar o <code>tuneGride</code> manualmente onde cada parâmetro do algoritmo pode ser especificado como um vetor de valores possíveis. Confira o ajuste manual em R:</p>
<pre class="r"><code>set.seed(1)

control &lt;- trainControl(method = &quot;cv&quot;, number = 5,verboseIter = F)

tunegrid &lt;- expand.grid(cp=seq(0.001, 0.01, 0.001))

rpartFit2 &lt;- 
  train(y=train$SalePrice, x=train[,-1],
        method=&quot;rpart&quot;,
        trControl=control,
        tuneGrid=tunegrid,
        metric = &quot;Rsquared&quot;
  )
rpartFit2</code></pre>
<pre><code>## CART 
## 
## 1460 samples
##   28 predictor
## 
## No pre-processing
## Resampling: Cross-Validated (5 fold) 
## Summary of sample sizes: 1169, 1169, 1168, 1168, 1166 
## Resampling results across tuning parameters:
## 
##   cp     RMSE       Rsquared   MAE      
##   0.001  0.1918932  0.7757730  0.1386651
##   0.002  0.1943654  0.7690391  0.1410967
##   0.003  0.2016485  0.7513005  0.1457213
##   0.004  0.2029596  0.7462748  0.1457752
##   0.005  0.2098812  0.7279462  0.1534384
##   0.006  0.2090073  0.7291130  0.1539830
##   0.007  0.2110066  0.7227211  0.1544402
##   0.008  0.2120734  0.7198280  0.1555415
##   0.009  0.2142488  0.7143975  0.1570535
##   0.010  0.2148236  0.7126454  0.1575360
## 
## Rsquared was used to select the optimal model using the largest value.
## The final value used for the model was cp = 0.001.</code></pre>
<p>Podemos conferir os resultados novamente de maneira visual:</p>
<pre class="r"><code>rpart.plot(rpartFit2$finalModel, cex = 0.5)</code></pre>
<p><img src="/post/2018-08-31-modelos-em-arvore/modelos-em-arvore_files/figure-html/unnamed-chunk-41-1.png" width="1200" /></p>
<p>Gerando arquivo para submissão no kaggle:</p>
<pre class="r"><code>id %&gt;% cbind(predict(rpartFit2, test) %&gt;% exp) %&gt;% 
  `colnames&lt;-`(c(&quot;Id&quot;, &quot;SalePrice&quot;)) %&gt;%
  write.csv(&quot;rpartFit2.csv&quot;,row.names = F)</code></pre>
</div>
<div id="bagging" class="section level2">
<h2>Bagging</h2>
<p><a href="https://en.wikipedia.org/wiki/Bootstrap_aggregating">“Bagging”</a> é usado quando desejamos reduzir a variação de uma árvore de decisão. Ela combina o resultado de vários modelos onde todas as variáveis são considerados para divisão um nó. Em R:</p>
<pre class="r"><code>set.seed(1)

control &lt;- trainControl(method = &quot;cv&quot;, number = 5,verboseIter = F)

treebagFit &lt;- train(y=train$SalePrice, 
                    x=train[,-1], 
                    method = &quot;treebag&quot;,
                    metric = &quot;Rsquared&quot;,
                    trControl=control
)
treebagFit</code></pre>
<pre><code>## Bagged CART 
## 
## 1460 samples
##   28 predictor
## 
## No pre-processing
## Resampling: Cross-Validated (5 fold) 
## Summary of sample sizes: 1169, 1169, 1168, 1168, 1166 
## Resampling results:
## 
##   RMSE       Rsquared   MAE      
##   0.1831872  0.7946059  0.1288626</code></pre>
<p>Note que o <span class="math inline">\(R^2\)</span> aumentou e o <a href="https://en.wikipedia.org/wiki/Root-mean-square_deviation"><span class="math inline">\(RMSE\)</span></a> diminuiu após o uso desta técnica.</p>
<p>Resultados para enviar para o Kaggle:</p>
<pre class="r"><code>id %&gt;% cbind(predict(treebagFit, test)%&gt;% exp) %&gt;% 
  `colnames&lt;-`(c(&quot;Id&quot;, &quot;SalePrice&quot;)) %&gt;%
  write.csv(&quot;treebagFit.csv&quot;,row.names = F)</code></pre>
</div>
<div id="random-forest" class="section level2">
<h2>Random Forest</h2>
<p>A principal diferença entre “bagging” e o algoritmo Random Forest é que em <code>randomForest</code>, apenas um subconjunto de características é selecionado aleatoriamente em cada divisão em uma árvore de decisão enquanto que no bagging todos os recursos são usados.</p>
<p>Para pesquisa de grade especificaremos um vetor com os possíveis valores, <a href="https://cran.r-project.org/web/packages/randomForest/randomForest.pdf">pois o default adotado para o parâmetro</a> <code>mtry</code> é <code>mtry</code> = p/3 (Número de variáveis amostradas aleatoriamente como candidatos em cada divisão), onde p é o número de variáveis e pode ser que o modelo se ajuste melhor aos dados ao utilizar outro valor.</p>
<p>Veja:</p>
<pre class="r"><code>set.seed(1)

tunegrid &lt;- expand.grid(mtry = seq(4, ncol(train) * 0.8, 2))

control &lt;- trainControl(method = &quot;cv&quot;, number = 5,verboseIter = F)

rfFit &lt;- train(SalePrice ~. ,
               data=train,
               method=&quot;rf&quot;,
               metric = &quot;Rsquared&quot;,
               tuneGrid=tunegrid,
               trControl=control
)
rfFit</code></pre>
<pre><code>## Random Forest 
## 
## 1460 samples
##   28 predictor
## 
## No pre-processing
## Resampling: Cross-Validated (5 fold) 
## Summary of sample sizes: 1169, 1169, 1168, 1168, 1166 
## Resampling results across tuning parameters:
## 
##   mtry  RMSE       Rsquared   MAE       
##    4    0.1455656  0.8781772  0.09755474
##    6    0.1417368  0.8817193  0.09435674
##    8    0.1405084  0.8826370  0.09350712
##   10    0.1395367  0.8834153  0.09290816
##   12    0.1385338  0.8845102  0.09181049
##   14    0.1386865  0.8840165  0.09223527
##   16    0.1381776  0.8846283  0.09155563
##   18    0.1384532  0.8837305  0.09222536
##   20    0.1380863  0.8840803  0.09173754
##   22    0.1383788  0.8835938  0.09189772
## 
## Rsquared was used to select the optimal model using the largest value.
## The final value used for the model was mtry = 16.</code></pre>
<p>Note que o <span class="math inline">\(R^2\)</span> aumentou e o <span class="math inline">\(RMSE\)</span> apresentou resultados ainda mais satisfatórios.</p>
<p>Veja visualmente a importância de ada variável:</p>
<pre class="r"><code>randomForest::varImpPlot(rfFit$finalModel)</code></pre>
<p><img src="/post/2018-08-31-modelos-em-arvore/modelos-em-arvore_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p>Resultados para enviar para o Kaggle:</p>
<pre class="r"><code>id %&gt;% cbind(predict(rfFit, test) %&gt;% exp) %&gt;% 
  `colnames&lt;-`(c(&quot;Id&quot;, &quot;SalePrice&quot;)) %&gt;%
  write.csv(&quot;rfFit.csv&quot;,row.names = F) </code></pre>
</div>
<div id="gbm" class="section level2">
<h2>GBM</h2>
<p>Diferentemente do “bagging”, o “boosting” é uma técnica de ensemble (conjunto) na qual os preditores não são feitos independentemente, mas sequencialmente. Na imagem a seguir é possível ver uma representação visual dessa diferença:</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*PaXJ8HCYE9r2MgiZ32TQ2A.png" /></p>
<p>A imagem foi obtida <a href="https://medium.com/mlreview/gradient-boosting-from-scratch-1e317ae4587d">neste artigo: Gradient Boosting from scratch</a>, recomendo a leitura pois da uma boa intuição de como o algoritmo funciona.</p>
<p>Para a pesquisa de grade vamos permitir que o sistema faça isso automaticamente configurando apenas o <code>tuneLength</code> para indicar o número de valores diferentes para cada parâmetro do algoritmo.</p>
<pre class="r"><code>set.seed(1)

control &lt;- trainControl(method = &quot;cv&quot;, number = 5,verboseIter = F)

gbmFit &lt;- train(SalePrice~.,data=train,
                method = &quot;gbm&quot;,
                trControl=control,
                tuneLength=5,
                metric = &quot;Rsquared&quot;,
                verbose = FALSE
)
gbmFit</code></pre>
<pre><code>## Stochastic Gradient Boosting 
## 
## 1460 samples
##   28 predictor
## 
## No pre-processing
## Resampling: Cross-Validated (5 fold) 
## Summary of sample sizes: 1169, 1169, 1168, 1168, 1166 
## Resampling results across tuning parameters:
## 
##   interaction.depth  n.trees  RMSE       Rsquared   MAE       
##   1                   50      0.1736970  0.8346902  0.12145158
##   1                  100      0.1474386  0.8663694  0.10371271
##   1                  150      0.1400060  0.8775141  0.09804851
##   1                  200      0.1381902  0.8803999  0.09607709
##   1                  250      0.1375854  0.8817130  0.09502881
##   2                   50      0.1511051  0.8640075  0.10557294
##   2                  100      0.1379357  0.8815852  0.09546142
##   2                  150      0.1360260  0.8846503  0.09326628
##   2                  200      0.1355702  0.8852090  0.09248558
##   2                  250      0.1362827  0.8841734  0.09254710
##   3                   50      0.1434808  0.8743589  0.09910961
##   3                  100      0.1363881  0.8838715  0.09355652
##   3                  150      0.1346606  0.8868808  0.09163759
##   3                  200      0.1339427  0.8880370  0.09062153
##   3                  250      0.1336666  0.8886732  0.08979366
##   4                   50      0.1376575  0.8824442  0.09516571
##   4                  100      0.1334392  0.8884173  0.09192150
##   4                  150      0.1330866  0.8890336  0.09156893
##   4                  200      0.1334706  0.8886198  0.09096598
##   4                  250      0.1335809  0.8884950  0.09101981
##   5                   50      0.1384852  0.8813449  0.09535954
##   5                  100      0.1350803  0.8863344  0.09231165
##   5                  150      0.1340246  0.8878172  0.09112111
##   5                  200      0.1342892  0.8874590  0.09088714
##   5                  250      0.1349331  0.8867525  0.09104875
## 
## Tuning parameter &#39;shrinkage&#39; was held constant at a value of 0.1
## 
## Tuning parameter &#39;n.minobsinnode&#39; was held constant at a value of 10
## Rsquared was used to select the optimal model using the largest value.
## The final values used for the model were n.trees = 150, interaction.depth =
##  4, shrinkage = 0.1 and n.minobsinnode = 10.</code></pre>
<p>Note que este foi o modelo que apresentou os melhores resultados quanto só <span class="math inline">\(R^2\)</span> e ao <span class="math inline">\(RMSE\)</span> em comparação com os outros modelos.</p>
<p>Submissão para Kaggle:</p>
<pre class="r"><code>id %&gt;% cbind(predict(gbmFit, test) %&gt;% exp) %&gt;%
  `colnames&lt;-`(c(&quot;Id&quot;, &quot;SalePrice&quot;)) %&gt;%
  write.csv(&quot;gbmFit.csv&quot;, row.names = F)</code></pre>
</div>
<div id="regressão-linear" class="section level2">
<h2>Regressão Linear</h2>
<p>Por fim faremos o ajuste de um modelo de regressão linear multivariado utilizando o pacote caret.</p>
<p>Utilizaremos validação cruzada separando nossa amostra em 5 e utilizaremos o método <code>lmStepAIC</code> que realiza a seleção do modelo escalonado pelo critério de informação de Akaike - <a href="https://en.wikipedia.org/wiki/Akaike_information_criterion">AIC</a>.</p>
<pre class="r"><code>set.seed(1)

control &lt;- trainControl(method = &quot;cv&quot;, number = 5,verboseIter = F)

lmFit &lt;- train(SalePrice~.,data=train,
               method = &quot;lmStepAIC&quot;,
               trControl=control,
               metric = &quot;Rsquared&quot;,trace=F
)
lmFit</code></pre>
<pre><code>## Linear Regression with Stepwise Selection 
## 
## 1460 samples
##   28 predictor
## 
## No pre-processing
## Resampling: Cross-Validated (5 fold) 
## Summary of sample sizes: 1169, 1169, 1168, 1168, 1166 
## Resampling results:
## 
##   RMSE      Rsquared   MAE       
##   0.147716  0.8632513  0.09574552</code></pre>
<p>Note que o ajuste do modelo se apresenta de maneira satisfatória com <span class="math inline">\(R^2\)</span> e <span class="math inline">\(RMSE\)</span> semelhantes aos modelos de <code>bagging</code> e <code>boosting</code> e além disso, diferente dos modelos baseados em árvore, com este ajuste é possível notar a significância estatística de cada parâmetro ajustado, o que possibilita tanto o uso tanto como modelo preditivo quanto como modelo descritivo. Veja:</p>
<pre class="r"><code>ggcoef(
  lmFit$finalModel,                      #O modelo a ser conferido
  vline_color = &quot;red&quot;,          #Reta em zero  
  errorbar_color = &quot;blue&quot;,      #Cor da barra de erros
  errorbar_height = .25,
  shape = 18,                   #Altera o formato dos pontos centrais
  size=2,                      #Altera o tamanho do ponto
  color=&quot;black&quot;,
  exclude_intercept = TRUE,                #Altera a cor do ponto
  mapping = aes(x = estimate, y = term, size = p.value))+
  scale_size_continuous(trans = &quot;reverse&quot;)+ #Essa linha faz com que inverta o tamanho
  theme_bw()</code></pre>
<p><img src="/post/2018-08-31-modelos-em-arvore/modelos-em-arvore_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
<p>Note que o intercepto <span class="math inline">\(\beta_0\)</span> foi retirado da imagem pois é muito superior aos demais coeficientes. Note também que <span class="math inline">\(\beta_i\)</span> informa quão sensível é <span class="math inline">\(y\)</span>, no caso <code>log(SalePrice)</code> às variações de cara umas das <span class="math inline">\(x_{i,j}\)</span> variáveis explicativas. Mais concretamente, se <span class="math inline">\(x_{i,j}\)</span> aumenta em uma unidade, o valor de <span class="math inline">\(y\)</span> varia em <span class="math inline">\(\beta_1\)</span> unidades.</p>
<p>Uma rápida <a href="http://www.portalaction.com.br/analise-de-regressao/analise-dos-residuos">Análise dos Resíduos</a>:</p>
<pre class="r"><code>lmFit$finalModel %&gt;% 
  autoplot(which = 1:2) + 
  theme_bw()</code></pre>
<p><img src="/post/2018-08-31-modelos-em-arvore/modelos-em-arvore_files/figure-html/unnamed-chunk-52-1.png" width="1500" /></p>
<p>É possível notar que parece haver alguns outliers em ambas as figuras. Na primeira é possível notar uma nuvem de pontos aleatórios em torno de zero porém na segunda figura nota-se que alguns valores não estão de acordo com os quantils teóricos de uma distribuição normal, o que pode prejudicar nossa interpretação dos coeficientes do modelo. Vamos encerrar o modelo por aqui mesmo e ver como ele se sai na competição do Kaggle, preparando a submissão:</p>
<pre class="r"><code>id %&gt;% cbind(predict(lmFit, test) %&gt;% exp ) %&gt;% 
  `colnames&lt;-`(c(&quot;Id&quot;, &quot;SalePrice&quot;)) %&gt;%
  write.csv(&quot;lmFit.csv&quot;,row.names = F)</code></pre>
<p>O score obtido com esta submissão no Kaggle foi muito próximo dos modelos baseados e árvore e o tempo computacional para este ajuste foi bem menor.</p>
</div>
<div id="comparando-ajustes" class="section level2">
<h2>Comparando ajustes</h2>
<p>Vejamos a seguir uma comparação entre estes modelos com as funções fornecidas pelo pacote `caret:.</p>
<pre class="r"><code>resamps &lt;- resamples(list(rpart = rpartFit2,
                          treebag = treebagFit,
                          rf = rfFit,
                          gbm = gbmFit,
                          lm = lmFit 
                          )) 
bwplot(resamps)</code></pre>
<p><img src="/post/2018-08-31-modelos-em-arvore/modelos-em-arvore_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<p>Com este gráfico é possível notar que o modelo de regressão linear múltipla apresentou resultados semelhantes aos de bagging e boosting.</p>
<p>É importante frisar que a maneira como as variáveis foram selecionadas para o modelo de regressão linear múltipla através da importância das variáveis obtida com o modelo randomForest não é um padrão e existem diversos outros modos estatísticos de se de determinar a significância e a relação das variáveis para o modelo.</p>
<p>Um possível problema neste método é que não detecta a multicolinearidade, que ocorre quando as variáveis explicativas estão fortemente correlacionadas entre si e a análise de regressão linear pode ficar confusa e desprovida de significado, pois há dificuldade em distinguir o efeito de uma ou outra variável explicativa sobre a variável resposta <span class="math inline">\(Y\)</span> devido à variâncias muito elevadas ou sinais inconsistentes.</p>
<p>Essa proposta de aprender se divertindo e de maneira produtiva me deixa muito empolgado, espero que tenham se divertido como eu me diverti fazendo este post!</p>
</div>
</div>
<div id="referências" class="section level1">
<h1>Referências:</h1>
<ul>
<li><a href="https://www.datacamp.com/courses/machine-learning-with-tree-based-models-in-r">DataCamp Course:Machine Learning with Tree-Based Models in R</a></li>
<li><a href="https://tinyurl.com/y796aa4t">Data Science <em>for</em> Business</a></li>
<li><a href="https://lethalbrains.com/learn-ml-algorithms-by-coding-decision-trees-439ac503c9a4">Learn ML Algorithms by coding: Decision Trees</a></li>
<li><a href="https://www.datacamp.com/community/tutorials/decision-trees-R">DataCamp Tutorials: Decision Trees in R</a></li>
<li><a href="https://topepo.github.io/caret/">The caret Package - Max Kuhn</a></li>
<li><a href="https://www.vooo.pro/insights/um-tutorial-completo-sobre-a-modelagem-baseada-em-tree-arvore-do-zero-em-r-python/">Um tutorial completo sobre modelagem baseada em árvores de decisão (códigos R e Python)</a></li>
<li><a href="https://machinelearningmastery.com/tuning-machine-learning-models-using-the-caret-r-package/">Tuning Machine Learning Models Using the Caret R Package</a></li>
<li><a href="https://medium.com/mlreview/gradient-boosting-from-scratch-1e317ae4587d">Gradient Boosting from scratch</a></li>
<li><a href="https://machinelearningmastery.com/tune-machine-learning-algorithms-in-r/">Tune Machine Learning Algorithms in R (random forest case study)</a></li>
<li><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/cc_manual.htm">Random Forests - Leo Breiman and Adele Cutler</a></li>
<li><a href="https://cran.r-project.org/web/packages/rpart/vignettes/longintro.pdf">An Introduction to Recursive Partitioning Using the RPART Routines - CRAN</a></li>
</ul>
</div>

        <p><strong>Leia o post completo em:</strong> <a href="https://gomesfellipe.github.io/post/2018-08-31-modelos-em-arvore/modelos-em-arvore/">Um estudo sobre modelos de aprendizagem baseados em árvores com desafio do Kaggle</a></p>
        <p><em>Este post foi originalmente publicado em <a href="https://gomesfellipe.github.io/">Fellipe Gomes - Data Science Blog</a></em></p>
      ]]></content:encoded>
      <category>Analise Exploratória</category>
      <category>Aprendizado Supervisionado</category>
      <category>Data mining</category>
      <category>Estatistica</category>
      <category>Machine Learning</category>
      <category>Prática</category>
      <category>Probabilidade</category>
      <category>R</category>
      <category>modelo baseado em arvores</category>
      <category>kaggle</category>
      <category>Regressão</category>
      <category domain="tag">Data Mining</category>
      <category domain="tag">Estatistica</category>
      <category domain="tag">gomesfellipe</category>
      <category domain="tag">kaggle</category>
      <category domain="tag">Correlacoes</category>
      <category domain="tag">modelagem</category>
      <category domain="tag">modelagem estatistica</category>
      <category domain="tag">Prática</category>
      <category domain="tag">R</category>
      <category domain="tag">regression</category>
      <category domain="tag">caret</category>
      <category domain="tag">xgboost</category>
      <category domain="tag">random forest</category>
      <category domain="tag">decisiontree</category>
    </item>
  </channel>
</rss>