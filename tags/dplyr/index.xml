&lt;?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Dplyr on Fellipe Gomes - Data Science Blog</title>
    <link>https://gomesfellipe.github.io/tags/dplyr/</link>
    <description>√öltimos posts sobre Data Science, Machine Learning e R</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>pt-br</language>
    <managingEditor>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</managingEditor>
    <webMaster>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</webMaster>
    <lastBuildDate>Wed, 25 Mar 2020 00:00:00 +0000</lastBuildDate>
    <atom:link href="https://gomesfellipe.github.io/tags/dplyr/" rel="self" type="application/rss+xml" />
    <item>
      <title>Desenvolva um bot e receba resultados de Machine Learning no seu Smartphone para ajudar nos investimentos</title>
      <link>https://gomesfellipe.github.io/post/2020-03-25-investment-alert/investment-alert/</link>
      <pubDate>Wed, 25 Mar 2020 00:00:00 +0000</pubDate>
      <author>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</author>
      <guid>https://gomesfellipe.github.io/post/2020-03-25-investment-alert/investment-alert/</guid>
      <description>Entenda a l√≥gica de como montar uma carteira, coletar dados de finan√ßa em tempo real, treinar um modelo de Machine Learning com Prophet (Facebook Open Source) e receber an√°lises automatizadas no Smartphone</description>
      <content:encoded>&lt;![CDATA[
        


<style>
.column {
  float: left;
  width: 50%;
  padding: 10px;
}

.column4 {
  float: left;
  width: 33%;
  padding: 10px;
}

.column8 {
  float: left;
  width: 66%;
  padding: 10px;
}

.row:after {
  content: "";
  display: table; 
  clear: both;
}
</style>
<div id="por-que-investir" class="section level1">
<h1>Por que investir?</h1>
<p>Como esta sua situa√ß√£o financeira? Caso tenha alguma reserva pode ser interessante pensar em investimentos pois a poupan√ßa j√° n√£o √© mais garantia de lucro no longo prazo, n√£o acredita?</p>
<p>Estamos no final do primeiro trimestre de 2020 e desde 2019 j√° liam-se not√≠cias como esta abaixo que levam √† reflex√£o sobre reeduca√ß√£o financeira pois alertam sobre a necessidade da busca por novas oportunidades de investimento.</p>
<center>
<img src="/post/2020-03-25-investment-alert/noticia_poupanca.png" style="width:50.0%" /> <br><small>Fonte: <a href="https://noticias.r7.com/economia/economize/poupanca-em-baixa-exige-busca-por-novos-investimentos-em-2020-25122019" class="uri">https://noticias.r7.com/economia/economize/poupanca-em-baixa-exige-busca-por-novos-investimentos-em-2020-25122019</a></small>
</center>
<p></br></p>
<p>Com a finalidade de fomentar um pouco a discuss√£o sobre investimentos, trouxe nesse post algumas sugest√µes e id√©ias de como elaborar uma carteira e otimizar as escolhas para equilibrar risco em novos investimentos combinando elementos de estat√≠stica, machine learning e programa√ß√£o em R.</p>
<p>Ao final do post criaremos um <a href="https://core.telegram.org/bots">rob√¥ no telegram</a> que coletar√° os dados das cota√ß√µes adquiridas, aplicar√° o modelo <a href="https://facebook.github.io/prophet/docs/quick_start.html">Prophet do Facebook</a> para forecast e analisar√° a desmontagem da carteira segundo os crit√©rios estabelecidos e enviar√° mensagens para n√≥s com uma tabela financeira automatizada via Telegram como mostra na anima√ß√£o:</p>
<p></br></p>
<div class="row">
<div class="column4">
<center>
<img src="/post/2020-03-25-investment-alert/watch.png" />
</center>
</div>
<div class="column8">
<p><img src="/post/2020-03-25-investment-alert/report_stocks.gif" style="width:90.0%" /></p>
</div>
</div>
<p></br></p>
<div class="w3-panel w3-pale-red w3-border">
<p><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> <strong>AVISO</strong>: Este post <strong>n√£o</strong> tem como finalidade ser um guia de investimentos (J√° existem muitas consultorias especializadas nisso por ai). Todos as decis√µes tomadas como diversifica√ß√£o da carteira, sele√ß√£o de a√ß√µes e crit√©rios para desmontagem da carteira s√£o <strong>exemplos</strong> e servem para ilustrar algumas <strong>possibilidades</strong> que um cientista de dados t√™m na hora de desenvolver ferramentas para auxiliar √† tomada de decis√£o.</p>
</div>
<p></br></p>
<div id="diferen√ßa-de-poupar-e-investir" class="section level2">
<h2>Diferen√ßa de poupar e investir</h2>
<p>De acordo com um <a href="https://www.infomoney.com.br/minhas-financas/brasileiros-nao-sabem-a-diferenca-entre-poupar-e-investir-afirma-especialista-2/">especialista entrevistado pela InfoMoney</a>:</p>
<blockquote>
‚ÄúPoupar √© guardar dinheiro para usar no futuro, comprar alguma coisa com ele. Investimento √© juntar dinheiro, n√£o mexer nele, para que este gere rendimentos e a√≠ sim, usar os lucros mais para frente. √â o recomendado para quem quer viver de renda no futuro, por exemplo‚Äù (‚Ä¶)
<div align="right">
<font size="1">InfoMoney - Ago 2015</font>
</div>
</blockquote>
<p>Ou seja, poupar √© acumular agora para utilizar depois, e normalmente envolve mudan√ßa de h√°bitos, pois requer uma redu√ß√£o nos gastos pessoais e familiares, j√° investir √© usar esse dinheiro poupado em aplica√ß√µes que rendam.</p>
<p>Como todo mundo sabe, n√£o existe investimento sem risco e este risco deve ser controlado e utilizado a nosso favor de forma que gere alguma seguran√ßa financeira.</p>
</div>
</div>
<div id="montagem-da-carteira" class="section level1">
<h1>Montagem da carteira</h1>
<div class="row">
<div class="column8">
<p>N√£o colocar todos os ovos na mesma cesta significa que voc√™ deve diversificar o seu investimento. Provavelmente voc√™ j√° ouviu essa frase alguma vez na vida e ela certamente faz sentido!</p>
<p>Diversificar a carteira ir√° proteger seus investimentos diminuindo o risco pois, imagine s√≥, voc√™ investe todo o seu dinheiro em uma empresa e ela passa por alguma crise assim seu dinheiro estar√° todo comprometido!</p>
<p>Existem diversos motivos para se diversificar a carteira mas acho que essa met√°fora dos ovos j√° resume bem pois acredito que ningu√©m queira perder tudo em uma queda.</p>
</div>
<div class="column4">
<p><img src="/post/2020-03-25-investment-alert/ovos_mesm_cesta.png" style="width:90.0%" /></p>
</div>
</div>
<div id="como-dividir-a-carteira" class="section level2">
<h2>Como dividir a carteira?</h2>
<p>Dependendo do risco que voc√™ deseja se expor existem muitas formas de preparar a carteira mas a id√©ias principal consiste em atingir um equil√≠brio entre dois tipos de investimento:</p>
<ul>
<li>Renda fixa: Menor exposi√ß√£o, menor risco (ex.: CDI, Selic e TR)</li>
<li>Renda vari√°vel: Maior exposi√ß√£o, maior risco (ex: A√ß√µes, Commodities, Im√≥veis)</li>
</ul>
<p>Para ajudar a dividir a carteira de investimentos neste post utilizaremos a chamada <a href="https://www.btgpactualdigital.com/blog/coluna-gustavo-cerbasi/defina-sua-estrategia-entre-renda-fixa-ou-variavel">Regra (ou Lei) dos 80</a>. A estrat√©gia √© a seguinte: subtraia da sua idade o n√∫mero 80. O resultado dessa conta vai indicar o percentual a ser investido em <a href="https://pt.wikipedia.org/wiki/Renda_vari%C3%A1vel">renda vari√°vel</a>. Por exemplo, no meu caso: tenho 26 anos, portanto <span class="math inline">\(80-26 = 54\%\)</span> dever√° ser investido em renda vari√°vel. Aos 53 anos esse percentual vai cair√° para a metade, <span class="math inline">\(27\%\)</span>.</p>
<p>A id√©ias principal por tr√°s desta regra que √© que a cada ano que passa, 1% do montante da renda vari√°vel deva ser direcionado para a <a href="https://pt.wikipedia.org/wiki/Renda_fixa">renda fixa</a>.</p>
<p>Para testar diferentes valores seguindo esta regra desenvolvi uma fun√ß√£o que se chama <a href="https://gist.github.com/gomesfellipe/a74710a63b3c8637166b538ad2f460f5"><code>montagem80()</code> (que j√° est√° dispon√≠vel no github)</a>. Vejamos alguns resultados para diferentes cen√°rios e vamos selecionar um para seguir com a montagem da carteira:</p>
<pre class="r"><code># https://gist.github.com/gomesfellipe/a74710a63b3c8637166b538ad2f460f5
devtools::source_gist(&quot;a74710a63b3c8637166b538ad2f460f5&quot;, quiet = T)</code></pre>
<div class="row">
<div class="column">
<ol style="list-style-type: decimal">
<li>Entrada de R$20.000,00 <big>üëà</big></li>
</ol>
<pre class="r"><code>montagem80(entrada = 20000, idade = 26)</code></pre>
<pre><code>## ‚Ä¢ Entrada: R$R$20.000,00
##   ‚îî‚îÄ Renda fixa:     R$9.200,00
##   ‚îî‚îÄ Renda variavel: R$10.800,00
##        (Acao + Cryptomoeda): 
##        R$9.720,00 + R$1.080,00</code></pre>
</div>
<div class="column">
<ol start="2" style="list-style-type: decimal">
<li>R$ 5.000,00 em acoes</li>
</ol>
<pre class="r"><code>montagem80(variavel = 10800, idade = 53)</code></pre>
<pre><code>## ‚Ä¢ Entrada: R$R$40.000,00
##   ‚îî‚îÄ Renda fixa:     R$29.200,00
##   ‚îî‚îÄ Renda variavel: R$10.800,00
##        (Acao + Cryptomoeda): 
##        R$9.720,00 + R$1.080,00</code></pre>
</div>
</div>
<p>Utilizaremos a primeira (1.) configura√ß√£o que esta assinalada em vermelho como exemplo, onde:</p>
<ul>
<li>Entrada: R$20.000,00</li>
<li>Renda fixa: R$9.200,00</li>
<li>Renda Vari√°vel (Acoes): R$9.720,00</li>
<li>Renda Vari√°vel (Crypt): R$1.080,00</li>
</ul>
<p>Note que a entrada deve ser o dobro na segunda (2.) configura√ß√£o caso deseje investir R$10.800,00 (que √© o valor sugerido aos 26 anos para uma entrada de R$20.000,00)</p>
<p>Ap√≥s definir a quantidade a ser investida √© hora de planejar a pr√≥xima etapa: a diversifica√ß√£o.</p>
</div>
<div id="diversifica√ß√£o-da-carteira" class="section level2">
<h2>Diversifica√ß√£o da carteira</h2>
<div class="row">
<div class="column8">
<p>A diversifica√ß√£o √© uma t√©cnica para gest√£o do risco que visa distribuir o capital investido em uma variedade de investimentos dentro de da nossa carteira.</p>
<p>Assim, o risco do portf√≥lio √© consideravelmente reduzido pois reduzimos a volatividade e criamos um equil√≠brio onde um desempenho positivo de um ativo neutraliza as baixas ocorridas em outras aplica√ß√µes. Al√©m disso a diversifica√ß√£o pode ser tanto coma renda vari√°vel quanto com a renda fixa.</p>
<p>Mas lembre-se, n√£o existe uma receita mais eficiente!</p>
</div>
<div class="column4">
</br>
<iframe src="https://giphy.com/embed/qJkRbWM1MfVjq" width="100%" height="150" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>
<p>
<a href="https://giphy.com/gifs/eggs-qJkRbWM1MfVjq">via GIPHY</a>
</p>
</div>
</div>
<div id="renda-fixa" class="section level3">
<h3>Renda fixa</h3>
<p>Normalmente, tamb√©m diversificamos nossa renda fixa por√©m como gostaria de focar nas an√°lises de renda vari√°vel utilizaremos o simulador dispon√≠vel no site <a href="https://verios.com.br/" class="uri">https://verios.com.br/</a> neste <a href="https://simulador-tesouro-direto.verios.com.br/">link</a> para selecionar apenas um t√≠tulo:</p>
<center>
<img src="/post/2020-03-25-investment-alert/tesouro_direto.png" style="width:80.0%" />
<small></br>Fonte: <a href="https://simulador-tesouro-direto.verios.com.br/" class="uri">https://simulador-tesouro-direto.verios.com.br/</a></small>
</center>
<p></br></p>
<p>Como exemplo, escolhi o Tesouro Prefixado 2015 (LTN), note que com essa escolha o lucro planejado seria de quase 3 mil reais nos pr√≥ximos 5 anos.</p>
<div class="w3-panel w3-pale-red w3-border">
<p><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> <strong>AVISO</strong>: Lembrando que esta sele√ß√£o √© apenas um exemplo e existem diversas informa√ß√µes a serem levadas em conta ao se fazer esta escolha al√©m de se poder diversificar tamb√©m. Convido o leitor a procurar saber mais sobre os tipos, pr√≥s e contras do Tesouro Direto.</p>
</div>
</div>
<div id="renda-vari√°vel" class="section level3">
<h3>Renda vari√°vel</h3>
<p>Para elabora√ß√£o da parte da renda vari√°vel da carteira selecionei duas a√ß√µes que s√£o inversamente correlacionadas (de forma totalmente arbitr√°ria) baseado no excelente post "<a href="https://www.tradingcomdados.com/post/2017/07/09/estudo-de-correla%C3%A7%C3%A3o-entre-a%C3%A7%C3%B5es-da-bolsa-de-valores-de-s%C3%A3o-paulo">Estudo de correla√ß√£o entre a√ß√µes da Bolsa de Valores de S√£o Paulo</a>" escrito por Victor Gomes onde o autor faz um estudo de correla√ß√µes das s√©ries hist√≥ricas de a√ß√µes de diferentes setores.</p>
<p>Al√©m disso, o Bitcoin ser√° selecionado para completar a carteira de renda vari√°vel como um ativo de alto risco com bastante volatividade. Mas voc√™ deve estar se perguntando, por que assumir este risco?</p>
<p>Existem muitas hist√≥rias de pessoas que ficaram milion√°rias com o Bitcoin pela sua valoriza√ß√£o inesperada ao longo do tempo, como por exemplo o <a href="https://www.infomoney.com.br/mercados/adolescente-fica-milionario-aos-18-anos-usando-bitcoins-apos-fazer-aposta-com-os-pais/">adolescente que ficou milion√°rio aos 18 anos usando bitcoins ap√≥s fazer aposta com os pais</a>.</p>
<p>Ent√£o <strong>eu</strong> acho que 10% dessa nossa carteira (n√£o esque√ßa que podemos ter mais de uma carteira) √© um risco que pode valer a pena correr e por isso vou inclu√≠-lo.</p>
<p>Portanto, para este exemplo consideramos:</p>
<ul>
<li>TUPY3.SA: <a href="https://www.google.com/search?q=tupy3&amp;oq=tupy3&amp;aqs=chrome..69i57.7273j0j4&amp;sourceid=chrome&amp;ie=UTF-8">Tupy</a></li>
<li>ELET3.SA: <a href="https://www.google.com/search?ei=-dxuXtuyNIbR5OUPxY2m8AE&amp;q=ELET3.SA&amp;oq=ELET3.SA&amp;gs_l=psy-ab.3..0.40045.41040..41701...0.2..0.123.237.0j2......0....2j1..gws-wiz.......0i71.a2fjObIM6cM&amp;ved=0ahUKEwibk86a8p3oAhWGKLkGHcWGCR4Q4dUDCAs&amp;uact=5">Centrais Eletricas Brasileiras SA</a></li>
<li>BTC-USD: <a href="https://www.google.com/search?ei=JN1uXsDJLJm55OUPj8-c8As&amp;q=bitcoin&amp;oq=bitcoin&amp;gs_l=psy-ab.3.0.0i131i70i258j0i131i67j0i131j0i67j0j0i67j0i131j0i67j0j0i131.25383.26281..27215...0.0..0.175.1147.1j8......0....1..gws-wiz.xu0EQx1CnXI">Bitcoin</a></li>
</ul>
<pre class="r"><code>portifolio = c(&quot;TUPY3.SA&quot;,&quot;ELET3.SA&quot;, &quot;BTC-USD&quot;)</code></pre>
<div class="w3-panel w3-pale-red w3-border">
<p><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> <strong>AVISO</strong>: Volto a frisar que as escolhas das a√ß√µes foram feitas de forma arbitr√°ria. Estamos em tempos de incerteza atualmente por conta do corona v√≠rus (espero que todos fiquem bem) o que leva algumas escolhas √† serem ainda mais complexas e imprevis√≠veis.</p>
</div>
<div id="obter-dados" class="section level4">
<h4>Obter dados</h4>
<p>A aquisi√ß√£o das s√©rie hist√≥ricas das cota√ß√µes destes ativos desde 01/01/2016 foram obtidas utilizando o pacote <a href="https://github.com/business-science/tidyquant"><code>tidyquant</code></a> que nos retorna os dados das cota√ß√µes das a√ß√µes informadas em formato ‚Äúarrumado‚Äù (ou seja, familiar com fun√ß√µes do <a href="https://www.tidyverse.org/">tidyverse</a>), veja:</p>
<pre class="r"><code>library(tidyquant) # aquisicao de dados financeiros
stocks &lt;-map_df(portifolio, ~tq_get(.x, get = &quot;stock.prices&quot;, from = &quot; 2016-01-01&quot;))
saveRDS(stocks, &quot;stocks.rds&quot;)</code></pre>
<p>Veja as linhas iniciais do dataset obtido:</p>
<pre class="r"><code>stocks %&gt;% head() %&gt;% kable2()</code></pre>
<center>
<img src="/post/2020-03-25-investment-alert/img1.png" style="width:80.0%" />
</center>
<p>Existem uma s√©rie de vantagens de se trabalhar com os dados neste formato em R, veremos o porque nas pr√≥ximas se√ß√µes.</p>
</div>
<div id="arrumar-dataset" class="section level4">
<h4>Arrumar dataset</h4>
<p>O formato <a href="https://github.com/tidyverts/tsibble"><code>tsibble</code></a> √© um formato moderno para se trabalhar com s√©ries temporais trazendo a filosofia do <code>tidyverse</code> para os dados de s√©ries temporais facilitando o <a href="https://blog.earo.me/2018/12/20/reintro-tsibble/">fluxo de trabalho</a>.</p>
<p>Diversos outros pacotes podem ser combinados utilizando os dados no formato do pacote <code>tsibble</code> como os pacotes <a href="https://robjhyndman.com/hyndsight/fable/"><code>fable</code></a> e o <a href="https://github.com/mitchelloharawild/fable.prophet"><code>prophet</code></a> (sugiro a leitura para quem nao conhece) para aplica√ß√£o de modelagem de s√©ries temporais.</p>
<p>Veja como √© o fluxo ao trabalhar com objetos do tipo <code>tsibble</code></p>
<center>
<img src="/post/2020-03-25-investment-alert/ds-pipeline.png" style="width:60.0%" />
</br>
<small>Fonte: <a href="https://blog.earo.me/2018/12/20/reintro-tsibble/" class="uri">https://blog.earo.me/2018/12/20/reintro-tsibble/</a></small>
</center>
<p></br></p>
<pre class="r"><code>library(tsibble) # series temporais arrumadas
tbl_stocks &lt;- stocks %&gt;% as_tsibble(key = symbol, index = date) </code></pre>
<p>Ap√≥s importar e arrumar o dataset, seguimos para os pr√≥ximos passos.</p>
</div>
<div id="transformar" class="section level4">
<h4>Transformar</h4>
<p>Ap√≥s converter para <code>tsibble</code>, vamos preencher alguns gaps da bolsa como por exemplo os finais de semana (quando a bolsa de valores fica fechada) com o mesmo valor do dia anterior (Para este exemplo vamos fazer esse preenchimento dos gaps do final de semana mas n√£o √© sempre √© necess√°rio):</p>
<pre class="r"><code>tbl_stocks &lt;- 
  tbl_stocks %&gt;% 
  fill_gaps() %&gt;% 
  tidyr::fill(c(open, high, low, close, volume, adjusted),.direction = &quot;down&quot;)</code></pre>
<p>Com os dados arrumados vamos a algumas visualiza√ß√µes.</p>
</div>
<div id="visualizar" class="section level4">
<h4>Visualizar</h4>
<p>Vejamos qual foi o comportamento das s√©ries hist√≥ricas que coletamos desde o in√≠cio de 2016:</p>
<pre class="r"><code>library(forecast) # series temporais
library(fpp3)     # series temporais
d2 &lt;- 
  tbl_stocks %&gt;% 
  group_by(symbol) %&gt;% 
  summarise(y = mean(close))

autoplot(tbl_stocks)+
  geom_line(aes(group = symbol), color = &quot;black&quot;, show.legend = F) + 
  facet_wrap(~symbol, scales = &quot;free_y&quot;, ncol = 1)+
  geom_ma(n=6*30, color = &quot;red&quot;) + 
  theme(legend.position = &quot;none&quot;)+
  labs(subtitle = &quot;m√©dia m√≥vel n = 6 meses&quot;,
       caption = &quot;gomesfellipe.github.io&quot;)</code></pre>
<center>
<img src="/post/2020-03-25-investment-alert/unnamed-chunk-10-1.png" style="width:80.0%" />
</center>
<p>Note que a s√©rie do Bitcoin √© a mais imprevis√≠vel, houve um pico em 2018 mas ap√≥s isso n√£o houve nenhum grande pico como aquele. Em breve ocorrer√° o <a href="https://www.infomoney.com.br/onde-investir/halving-conheca-o-processo-que-pode-levar-o-bitcoin-a-uma-nova-explosao-de-preco/">Halving</a> (a contagem regressiva pode acompanhada <a href="https://www.bitcoinblockhalf.com/">neste link</a>) que √© um processo de choque de oferta e ocorre aproximadamente a cada 4 anos e pode ser uma boa oportunidade de retorno.</p>
<p>As duas s√©ries da bolsa de valores n√£o parecem ter uma correla√ß√£o muito forte, os picos ocorrem de forma alternada e isto pode ser uma caracter√≠stica boa para a carteira pois caso uma delas entre em crise a outra poder√° estar em uma fase boa.</p>
<div class="w3-panel w3-pale-blue w3-border">
<p><i class="fa fa-ambulance" aria-hidden="true"></i> Nota: Esta queda abrupta que ocorreu na bolsa no in√≠cio de 2020 √© o reflexo da <a href="https://pt.wikipedia.org/wiki/Pandemia_de_COVID-19_no_Brasil">Pandemia CODVID-19</a> que j√° come√ßou a apresentar alguns casos no Brasil e isso certamente tem gerando muita incerteza na bolsa de valores. Nem eu nem ningu√©m sabe o que pode acontecer, estou na torcida para que todos fiquem bem e pelo sucesso na conten√ß√£o desse v√≠rus! <i class="fas fa-praying-hands"></i></p>
</div>
</div>
<div id="correla√ß√µes" class="section level4">
<h4>Correla√ß√µes</h4>
<p>Para estudar melhor as conjecturas formadas ao observar o comportamento das s√©ries hist√≥rias (de que os picos e vales se alternam) vamos conferir olhada nos gr√°ficos de dispers√£o e coeficientes de <a href="https://pt.wikipedia.org/wiki/Coeficiente_de_correla%C3%A7%C3%A3o_de_postos_de_Spearman">correla√ß√£o de Spearman</a>:</p>
<pre class="r"><code>points_loess &lt;- function(data, mapping){
  ggplot(data = data, mapping = mapping) + 
    geom_point(alpha = 0.3,size=0.5) + 
    geom_smooth(method = &quot;loess&quot;)
}

tbl_stocks %&gt;%
  as_tibble() %&gt;% 
  select(symbol, date, close) %&gt;% 
  spread(key = symbol, value = close) %&gt;%
  GGally::ggpairs(columns = 2:4,
                  upper = list(continuous = GGally::wrap(&quot;cor&quot;, method = &quot;spearman&quot;)),
                  lower = list(continuous =  points_loess))</code></pre>
<center>
<img src="/post/2020-03-25-investment-alert/unnamed-chunk-11-1.png" style="width:80.0%" />
</center>
<p>Note que a rela√ß√£o entre TUPY3 e ELET3 n√£o √© linear e al√©m disso essa correla√ß√£o √© fraca, o que pode ser ben√©fico para o portf√≥lio pois uma poss√≠vel queda em uma n√£o parece n√£o ter tanto impacto na outra.</p>
<p>Al√©m disso note que a correla√ß√£o do BTC-USD com TUPY3 e ELET3 √© moderada e mesmo apresentando este valores num√©ricos, o Bitcoin √© um ativo negociado em escala global e √© de um setor totalmente diferente das outras a√ß√µes.</p>
<div class="w3-panel w3-pale-red w3-border">
<p><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> <strong>AVISO</strong>: Essa an√°lise meramente num√©rica n√£o √© o suficiente para detectar uma rela√ß√£o de causa, pois correla√ß√£o n√£o implica causalidade. Isto que dizer que poda haver uma causa em comum para ambas ou que seja uma <a href="https://pt.wikipedia.org/wiki/Regress%C3%A3o_esp%C3%BAria">correla√ß√£o esp√∫ria</a>. Quando se trata da bolsa de valores √© necess√°rio tamb√©m conhecer um pouco sobre a situa√ß√£o e hist√≥ria da empresa na qual se investe.</p>
</div>
</div>
<div id="forecast-com-prophet-do-facebook" class="section level4">
<h4>Forecast com Prophet do Facebook</h4>
<p>Poder√≠amos utilizar uma s√©rie de modelos estat√≠sticos, econom√©tricos e de machine learning utilizando tanto as fun√ß√µes nativas do R base ou pacote forecast quanto as fun√ß√µes desenvolvidas para trabalhar de maneira ‚Äúarrumada‚Äù com tsibble mas resolvi fazer uma abordagem diferente neste post escolhendo o modelo disponibilizado pelo Facebook.</p>
<div class="row">
<div class="column">
<p></br>
O <a href="https://facebook.github.io/prophet/">Prophet</a> √© um software de c√≥digo aberto disponibilizado pela equipe de <a href="https://research.fb.com/category/data-science/">Data Science do Facebook</a> que fornece um procedimento para realiza√ß√£o de previs√µes de dados de s√©ries temporais.</p>
</div>
<div class="column">
<p><img src="/post/2020-03-25-investment-alert/prophet_logo.png" style="width:80.0%" />
</br><small>Fonte: <a href="https://facebook.github.io/prophet/" class="uri">https://facebook.github.io/prophet/</a></small></p>
</div>
</div>
<p>Segundo a <a href="https://facebook.github.io/prophet/">documenta√ß√£o oficial</a>, (em tradu√ß√£o livre):</p>
<blockquote>
<p>O Prophet tem como ‚Äúbase em um modelo aditivo no qual tend√™ncias n√£o lineares se ajustam √† sazonalidade anual, semanal e di√°ria, al√©m de efeitos de f√©rias. Funciona melhor com s√©ries temporais que t√™m fortes efeitos sazonais e v√°rias temporadas de dados hist√≥ricos. O Profeta √© robusto para a falta de dados e mudan√ßas na tend√™ncia, e geralmente lida bem com outliers‚Äù.</p>
</blockquote>
<p>Este modelo me pareceu uma boa op√ß√£o para exemplificar a etapa da modelagem de s√©ries temporais deste post. Vamos ver o que o modelo do Facebook tem a nos dizer sobre o futuro das nossas a√ß√µes.</p>
<div id="divis√£o-entre-treino-e-teste-em-s√©ries-temporais" class="section level5">
<h5>Divis√£o entre treino e teste em s√©ries temporais</h5>
<p>Assim como em uma tarefa de machine learning que n√£o envolvem dados temporais, no caso de s√©ries temporais, quando desejamos avaliar o ajuste do nosso modelo tamb√©m dividimos o dataset em treino e teste por√©m utilizamos a data como √≠ndice.</p>
<p>Veja como ser√£o divididas nossas s√©ries hist√≥ricas:</p>
<ul>
<li>treino: inicio da s√©rie at√© 18/11/20;</li>
<li>teste: de 18/11/2020 at√© o final da s√©rie hist√≥rica (2 meses atr√°s)</li>
</ul>
<pre class="r"><code>h = 30 * 2
data_split &lt;- Sys.Date() - h

tbl_stocks_train &lt;-  
  tbl_stocks %&gt;% 
  filter(date &lt;= data_split) %&gt;% 
  select(symbol, date, close)

tbl_stocks_test &lt;- 
  tbl_stocks %&gt;%
  filter(date &gt; data_split) %&gt;% 
  select(symbol, date, close)</code></pre>
<p>Ap√≥s dividir os dados em treino e teste j√° estamos habilitados √† utilizar o modelo. Note que, por default, o modelo espera duas colunas nomeadas como <code>ds</code>: data da s√©rie e <code>y</code>: vari√°vel target da s√©rie.</p>
<p>Al√©m disso faremos uma previs√£o 6 meses a frente dos dados de teste para entender qual a tend√™ncia o modelo estaria adotando.</p>
<pre class="r"><code>library(prophet)

prophet_results &lt;- 
  tbl_stocks_train %&gt;% 
  rename(ds = date, y = close) %&gt;% 
  nest(data = c(ds, y)) %&gt;% 
  mutate(pmodel = map(data, ~ prophet(.x, daily.seasonality=TRUE))
  )%&gt;% 
  mutate(pprediction = map(pmodel, ~.x %&gt;%  
                             make_future_dataframe(periods = h + 30*6) %&gt;%
                             predict(.x,.))) </code></pre>
<p>Veja os resultados do ajuste do modelo:</p>
<pre class="r"><code>library(patchwork)

pmap(list(
  x = prophet_results$pprediction,
  y = split(tbl_stocks_train, tbl_stocks_train$symbol),
  z = split(tbl_stocks_test, tbl_stocks_test$symbol),
  w = prophet_results$symbol
),function(x, y, z, w){
  x %&gt;% 
    as_tibble() %&gt;%
    mutate(ds=as_date(ds)) %&gt;%
    select(ds, trend, yhat, yhat_lower, yhat_upper) %&gt;% 
    ggplot() + 
    geom_line(aes(x=ds, y=yhat, color=&quot;blue&quot;), show.legend = F) +
    geom_line(data=y, aes(x=date, y=close, color=&quot;black&quot;), show.legend = F) +
    geom_line(data=z, aes(x=date, y=close, color=&quot;red&quot;), show.legend = T) +
    geom_ribbon(aes(x=ds, ymin=yhat_lower, ymax=yhat_upper), alpha=0.2)  +
    scale_x_date(#limits = c(as.Date(&quot;2018-06-01&quot;), Sys.Date() + 30*12), 
      date_breaks = &quot;6 month&quot;, date_labels = &quot;%m/%Y&quot;) +
    theme_bw()+
    labs(y = w, x = &quot;&quot;, caption = &quot;gomesfellipe.github.io&quot;)+
    scale_colour_manual(values=c(&quot;black&quot;,&quot;blue&quot;,&quot;red&quot;), name=&quot;&quot;, labels=c(&quot;treino&quot;,&quot;modelo&quot;,&quot;teste&quot;))+
    theme(legend.position = c(1-0.8,1-0.2), 
          legend.background = element_rect(fill=alpha(&#39;lightgrey&#39;, 0.2)),
          legend.direction = &quot;horizontal&quot;)
}
) %&gt;% {.[[1]] / .[[2]] / .[[3]]}

ggsave(&quot;prophet.png&quot;) # salvar para o bot retornar este resultado!</code></pre>
<center>
<img src="/post/2020-03-25-investment-alert/unnamed-chunk-15-1.png" style="width:80.0%" />
</center>
<p>Parece interessante..</p>
<p>Veja que a linha azul (modelo ajustado) se ajusta bem √† linha preta (dados de treino) acompanhando a s√©rie hist√≥rica e captando algumas tend√™ncias n√£o lineares.</p>
<p>Por√©m note que a linha azul se perde completamente da linha vermelha (dados de teste) no in√≠cio de 2020 e acho isso muito razo√°vel pois dificilmente algum modelo iria prever os efeitos de uma Pandemia utilizando apenas a s√©rie hist√≥rica do ativo.</p>
<p>Note ainda que a linha azul se estende at√© o final de 2020 (previs√µes para os pr√≥ximos 6 meses) o que sugere que a s√©rie possu√≠a esta tendencia positiva ao longo dos anos, segundo o modelo Prophet .</p>
<div class="w3-panel w3-pale-yellow w3-border">
<p><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> <strong>Aviso</strong>: Existem v√°rias maneiras de estudar e melhorar a qualidade do ajuste deste modelo mas como o objetivo deste post n√£o √© este deixo como aviso para o leitor.</p>
</div>
<p>Com a interpreta√ß√£o dos resultados conclu√≠da.. vamos √†s compras!</p>
</div>
</div>
</div>
</div>
</div>
<div id="comprando-a√ß√µes" class="section level1">
<h1>Comprando a√ß√µes</h1>
<p>Ap√≥s toda essa exemplifica√ß√£o de como podem ser feitas as an√°lises para a elabora√ß√£o da carteira chegou a hora das compras.</p>
<p>Suponha que tiv√©ssemos realizado nossas compra no fechamento do dia <strong>2018-12-01</strong>, quando os valores de <font color="blue"><strong>fechamento</strong></font> das cota√ß√µes eram as seguintes:</p>
<pre class="r"><code>tbl_stocks %&gt;% 
  filter(date == &quot;2018-12-01&quot;) %&gt;% 
  mutate(close = cell_spec(moeda_real(close), &quot;html&quot;, color = &quot;blue&quot;, bold = T)) %&gt;% 
  mutate_at(c(3:5, 8), ~moeda_real(.x)) %&gt;% 
  kable2()</code></pre>
<center>
<img src="/post/2020-03-25-investment-alert/img2.png" style="width:80.0%" />
</center>
<p>Neste dia a cota√ß√£o para ELET3 era R$24,42 e TUPY3 era R$19,73 e suponha que tenhamos comprado 200 lotes de ELET3 e 150 fracion√°rios de TUPY, totalizando R$7.843,64 (pr√≥ximo ao que tinhaamos planejado no inicio do estudo)</p>
<p>Vamos guardar estes valores:</p>
<pre class="r"><code>cot_inicio = filter(tbl_stocks, date == &quot;2018-12-01&quot;, symbol != &quot;BTC-USD&quot;) %&gt;% pull(close)
qtd_inicio = c(elet = 200, tupy = 150)</code></pre>
<p>Note que o valor do Bitcoin est√° em d√≥lares, para obter o valor em reais (R$) daquele dia vamos utilizar a <a href="https://www.mercadobitcoin.net/api/BTC/day-summary/2020/01/09/">API do Mercado Bitcoin</a>. Como n√£o existe nenhum pacote que forne√ßa estes dados diretamente no R, a requisi√ß√£o ser√° feita normalmente via API com o pacote <code>jsonlite</code>:</p>
<pre class="r"><code>library(jsonlite) # requisicao de api
url &lt;- glue::glue(&quot;https://www.mercadobitcoin.net/api/BTC/day-summary/2019/12/01/&quot;)
safe_fromJSON &lt;- purrr:::safely(fromJSON, as.numeric(NA)) 
consulta &lt;- safe_fromJSON(url)$result %&gt;% map_dfc(~.x)

consulta %&gt;%
  select(-date) %&gt;% 
  mutate_all(~moeda_real(.x)) %&gt;%
  mutate(closing = cell_spec(closing, &quot;html&quot;, color = &quot;blue&quot;)) %&gt;% 
  kable2()</code></pre>
<center>
<img src="/post/2020-03-25-investment-alert/img3.png" style="width:80.0%" />
</center>
<p>O pre√ßo de fechamento foi de R$31.747,38 e suponhamos que tenha sido este o valor pago no dia. (Parece que neste dia o d√≥lar estava em torno de R$4,03)</p>
<p>Para completar esta carteira fict√≠cia vamos adquirir 0,0032 do valor de um Bitcoin</p>
<pre class="r"><code>cot_inicio[3] &lt;- consulta$closing
qtd_inicio[3] &lt;- 0.032</code></pre>
<p>Portanto, ao valor de R$31.747,38 compramos 0.032 Bitcoin totalizando R$1.015,92 completando nossa carteira.</p>
<div id="tabela-financeira" class="section level2">
<h2>Tabela financeira</h2>
<p>Semelhante a uma planilha financeira, criaremos uma tabela financeira automatizada que receber√° como input os valores da montagem e calcular√° automaticamente os valores do desmontagem no tempo atual utilizando dados de APIs abertas.</p>
<blockquote>
‚ÄúAquilo que n√£o se pode medir, n√£o se pode melhorar‚Äù.
<div align="right">
<font size="1">F√≠sico irland√™s William Thomson</font>
</div>
</blockquote>
<p>Primeiro √© necess√°rio obter os valores mais recentes das cota√ß√µes das acoes que compramos na bolsa e para isto ser√° necess√°rio utilizar outro pacote pois o <code>tidyquant</code> s√≥ fornece os dados em frequ√™ncia di√°ria.</p>
<p>Utilizaremos portanto, o pacote <a href="https://www.business-science.io/code-tools/2017/09/03/alphavantager-0-1-0.html">alphavantager</a> que fornece dados de finan√ßas da API gratuita <a href="https://www.alphavantage.co/">Alpha Vantage</a> no formato arrumados e tamb√©m foi desenvolvida pela <a href="https://github.com/business-science">Business Science</a> (mesmo criados do pacote <code>tidyquant</code>).</p>
<div class="w3-panel w3-pale-yellow w3-border">
<p><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> <strong>Aviso</strong>: Na <a href="https://www.alphavantage.co/support/#api-key">documenta√ß√£o da api do Alphavantage</a> recomenda-se a solicita√ß√µes de API com modera√ß√£o, suportando at√© 5 solicita√ß√µes de API por minuto e 500 solicita√ß√µes por dia para obter o melhor desempenho no servidor. Caso deseje segmentar um volume maior de chamadas da API, confira a <a href="https://www.alphavantage.co/premium/">associa√ß√£o premium.</a>.</p>
</div>
<p>J√° para a coleta da cota√ß√£o em tempo real do Bitcoin em reais (R$), utilizaremos novamente a <a href="https://www.mercadobitcoin.com.br/api-doc/?">api do mercado bitcoin</a>.</p>
<pre class="r"><code># Importar dados da bolsa de valores ==================================

library(alphavantager) # api streaming bovespa

AV_API_KEY = Sys.getenv(&quot;AV_API_KEY&quot;)
av_api_key(AV_API_KEY)

consulta_acoes &lt;- map_df(portifolio[1:2], ~{
  alphavantager::av_get(symbol = .x,
         av_fun = &quot;TIME_SERIES_INTRADAY&quot;,
         interval = &quot;1min&quot;,  # &quot;1min&quot;, &quot;5min&quot;, &quot;15min&quot;, &quot;30min&quot; ou &quot;60min&quot;
         outputsize = &quot;compact&quot;) %&gt;%  # &quot;full&quot;
    bind_cols(stock = rep(.x, nrow(.)))
})

# Impotar dados do bitcoin ============================================

coin &lt;- &quot;BTC&quot;
method &lt;- &quot;ticker&quot;
url &lt;- glue::glue(&quot;https://www.mercadobitcoin.net/api/{coin}/{method}/&quot;)

safe_fromJSON &lt;- safely(fromJSON, as.numeric(NA)) 
consulta_bitcoin &lt;- 
  safe_fromJSON(url)$result$ticker %&gt;% 
  as_tibble() %&gt;% 
  transmute(timestamp = lubridate::ymd_hms(as.POSIXct(date, origin=&quot;1970-01-01&quot;)),
            open, high, low, close = sell, volume = NA, stock = &quot;BTC.BR&quot;) %&gt;% 
  mutate_at(c(&#39;open&#39;, &#39;high&#39;, &#39;low&#39;, &#39;close&#39;), ~as.numeric(.x))

# Combinar resultados das consultas ==================================

consulta_atual &lt;- 
  bind_rows(
    consulta_acoes %&gt;% 
      group_by(stock) %&gt;% 
      filter(timestamp == last(timestamp)),
    consulta_bitcoin
  ) 

# Salvar consulta ====================================================
saveRDS(consulta_atual, &quot;consulta_atual.rds&quot;)</code></pre>
<p>Resultados da consulta atual (ap√≥s combinar a requisi√ß√£o da bolsa de valores e do Mercado Bitcoin):</p>
<pre class="r"><code>consulta_atual  %&gt;%
  mutate_at(2:4, ~moeda_real(.x)) %&gt;% 
  mutate_if(is.numeric, ~ifelse(is.na(.x), &quot;-&quot;, format(.x, digits = 2))) %&gt;% 
  mutate(close = cell_spec(moeda_real(close), &quot;html&quot;, color = &quot;blue&quot;)) %&gt;% 
  kable2()</code></pre>
<center>
<img src="/post/2020-03-25-investment-alert/img4.png" style="width:80.0%" />
</center>
<p>Com os valores da Montagem organizados e os valores da Desmontagem coletados em tempo real j√° podemos construir nossa tabela financeira automatizada.</p>
<p>A tabela cont√©m:</p>
<ul>
<li>Valores de cota√ß√£o e quantidade adquiridas de cada uma no momento da montagem da carteira;</li>
<li>Valores de cada cota√ß√£o no momento atual com suas respectivas quantidades dispon√≠veis;</li>
<li>Resultados de o ganho (ou perda) seguido do resultado bruto caso realize a venda agora;</li>
<li>√öltima coluna indica se vale a pena vender ou n√£o aquela cota√ß√£o considerando que o valor de venda √© superior ao valor de compra.</li>
</ul>
<div class="w3-panel w3-pale-yellow w3-border">
<p><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> <strong>Aviso</strong>: Essa opera√ß√£o de vender o ativo caso o pre√ßo da venda seja maior que o da compra √© apenas um exemplo. Poder√≠amos utilizar diversas estat√≠sticas para determinar o momento da opera√ß√£o por√©m adotei esta apenas para ilustrar o funcionamento da tabela financeira, o limite de op√ß√µes √© a sua criatividade!</p>
</div>
<p>Veja a tabela final com os resultados atualizados em tempo real:</p>
<pre class="r"><code>porcentagem &lt;- function(x){paste0(round(x,2), &quot;%&quot;)} # Funcao auxiliar

# Tabela resultado
financas &lt;- 
  tibble(
    ativo = portifolio,
    cot_inicio = cot_inicio,
    qtd_inicio = qtd_inicio,
    vol_inicio = cot_inicio * qtd_inicio,
    cot_atual = consulta_atual$close,
    qtd_atual = qtd_inicio,
    vol_atual = cot_atual * qtd_atual,
    ganho_perda = vol_atual - vol_inicio,
    resultado_bruto = ganho_perda / vol_inicio * 100
  ) 


tabela &lt;- 
  financas %&gt;% 
  mutate(
    cot_inicio = moeda_real(cot_inicio),
    cot_atual = moeda_real(cot_atual),
    vol_inicio = moeda_real(vol_inicio),
    vol_atual = moeda_real(vol_atual),
    qtd_inicio = round(qtd_inicio,4),
    qtd_atual = round(qtd_atual,4),
    ` ` = ifelse(ganho_perda &gt; 0,&quot;\u2713&quot;, &quot;\u2718&quot;) ,
    cot_atual = cell_spec(cot_atual, &quot;html&quot;, color = &quot;blue&quot;),
    ganho_perda = cell_spec(moeda_real(ganho_perda), &quot;html&quot;,
                            color = ifelse(ganho_perda &gt; 0, 
                                           &quot;green&quot;, &quot;red&quot;)),
    resultado_bruto = cell_spec(porcentagem(resultado_bruto), &quot;html&quot;,
                                color = ifelse(resultado_bruto &gt; 0, 
                                               &quot;green&quot;, &quot;red&quot;))) %&gt;% 
  `colnames&lt;-`(stringr::str_replace_all(colnames(.), &quot;(_|[[:space:]])&quot;, &quot;\n&quot;)) %&gt;% 
  # Exibicao
  kable(format = &quot;html&quot;, escape = F) %&gt;%
  kable_styling(c(&quot;striped&quot;, &quot;bordered&quot;, &quot;hover&quot;, &quot;responsive&quot;), full_width = T, font_size = 12) %&gt;%
  add_header_above(c(&quot; &quot;, &quot;Montagem&quot; = 3,
                     &quot;Desmontagem / Atual&quot; = 3, &quot;Resultado&quot; = 3))

tabela</code></pre>
<center>
<img src="/post/2020-03-25-investment-alert/img5.png" style="width:80.0%" />
</center>
<p>Agora que j√° possu√≠mos nossa requisi√ß√£o completa e arrumada em tempo real precisamos ter acesso a esta informa√ß√£o de forma din√¢mica tamb√©m e para isso utilizaremos o bot do Telegram.</p>
</div>
</div>
<div id="bot-telegram" class="section level1">
<h1>Bot Telegram</h1>
<p>Depois de muitas decis√µes tomadas enfim chegamos ao bot! Espero que tenha notado que montar uma carteira n√£o √© uma tarefa f√°cil pois envolve exposi√ß√£o ao risco e tamb√©m exige certo acompanhamento do mercado.</p>
<div class="row">
<div class="column8">
<p></br>
Para criar um bot no Telegram basta seguir os passos do <a href="https://github.com/lbraglia/telegram">readme</a> do pacote <a href="https://github.com/lbraglia/telegram"><code>telegram</code></a> disponibilizado no Github ou seguir os passos desse excelente <a href="https://www.curso-r.com/blog/2017-08-19-r-telegram-bitcoin/">post do curso-r</a> que me inspirou a uns anos atras e hoje me auxiliou novamente para criar este bot. Ao concluir a etapa de configura√ß√£o teremos um novo contado no Telegram, o nosso bot!</p>
<p>Com a configura√ß√£o no aplicativo do Telegram conclu√≠da, o primeiro passo para configurar as a√ß√µes do bot no R √© iniciar um objeto TGBot declarando o id do seu bot. No meu caso o bot se chama <em>Stocks</em> e o id √© <em>fgstockbot</em>.</p>
</div>
<div class="column4">
</br>
<center>
<img src="/post/2020-03-25-investment-alert/bot_telegram.png" style="width:99.0%" />
</center>
</div>
</div>
<p>Com o R conectado ao bot do Telegram j√° somos capazes de criar um conjunto de regras de forma que o bot nos retorne as informa√ß√µes que desejamos.</p>
<p>Desenvolveremos a fun√ß√£o <code>report_stocks()</code> que programa o bot para realizar o seguinte algoritmo:</p>
<ol start="0" style="list-style-type: decimal">
<li>Carregar depend√™ncias e conectar chaves de acesso</li>
<li>Conferir se a bolsa de valores esta aberta</li>
<li>Requisi√ß√£o das cota√ß√µes da bolsa de valores em <em>real-time</em></li>
<li>Requisi√ß√£o da cota√ß√£o do Bitcoin em <em>real-time</em></li>
<li>Combinar resultados</li>
<li>Inserir resultados da coleta na tabela financeira</li>
<li>Se o valor de algum volume atual seja maior que o volume inicial:
<ul>
<li>Calcular valores de desmontagem</li>
<li>Preparar layout da tabela financeira</li>
<li>Salvar resultados</li>
<li>Enviar via Telegram</li>
</ul></li>
<li>Aguardar 20 minutos para a pr√≥xima requisi√ß√£o</li>
<li>Repetir todo o processo</li>
</ol>
<p>Parece complicado mas √© tranquilo pois todos os c√≥digos de cada uma destas tarefas j√° foram desenvolvidos nas se√ß√µes anteriores e ser√£o apenas combinados. A fun√ß√£o <a href="https://gist.github.com/gomesfellipe/357af0735d2aedca60146a7655e33929"><code>report_stocks()</code> j√° esta dispon√≠vel no github</a>, veja a baixo:</p>
<p>(A frequ√™ncia adotata como default pela fun√ß√£o tenta fazer a requisi√ß√£o com a maior frequ√™ncia poss√≠vel na api do Alphavantage)</p>
<script src="https://gist.github.com/gomesfellipe/357af0735d2aedca60146a7655e33929.js"></script>
<p>Ap√≥s todas as devidas configura√ß√µes, basta carregar a fun√ß√£o e executar para obter o seguinte resultado:</p>
<pre class="r"><code># https://gist.github.com/gomesfellipe/357af0735d2aedca60146a7655e33929
devtools::source_gist(&quot;357af0735d2aedca60146a7655e33929&quot;,quiet = T)

# Executar
bot_report_stocks(portifolio = portifolio, 
                  cot_inicio = cot_inicio,
                  qtd_inicio = qtd_inicio)</code></pre>
<center>
<img src="/post/2020-03-25-investment-alert/report_stocks.gif" style="width:70.0%" />
</center>
<p></br>
E assim obtemos um feedback atrav√©s do nosso Smartphone ou Smartwatch em tempo real sobre o desempenho da nossa carteira!</p>
</div>
<div id="conclus√£o-e-pr√≥ximos-passos" class="section level1">
<h1>Conclus√£o e pr√≥ximos passos</h1>
<p>Neste post criamos um bot que coleta os dados e faz an√°lises disponibilizando-as em tempo real no Telegram. Por√©m vimos tamb√©m o qu√£o dif√≠cil pode ser a montagem de uma carteira e as an√°lises envolvendo s√©ries hist√≥ricas de ativos.</p>
<p>Diante dos resultados obtidos aqui existe uma grande gama de op√ß√µes de inova√ß√µes para trabalhos futuros como:</p>
<ul>
<li>Programar o bot para responder a uma <a href="https://support.apple.com/pt-br/guide/watch/apd92a90f882/watchos">menssagem r√°pida no smartwatch</a> com o valor de uma previs√£o;</li>
<li>Desenvolver um Shiny parametrizando o bot para consultar an√°lises em tempo real;</li>
<li>Hospedar a rotina em um servidor para operacionalizar o bot (caso tenha d√∫vidas de como se iniciar um RStudio Server u um Shiny Server <a href="https://gomesfellipe.github.io/post/2018-10-27-server-cloud/server-cloud/">consulte este post do blog</a>);</li>
<li>Criar uma API com <a href="https://www.rplumber.io">plumber</a> para fornecer os resultados;</li>
<li>Treinar modelo utilizando mais dados, mais vari√°veis explicativas e tuning dos par√¢metros;</li>
<li>Criar pacote com um rob√¥ mais geral para responder diferentes consultas.</li>
</ul>
<p>Espero que tenha gostado qualquer d√∫vida deixe nos coment√°rios!</p>
</div>
<div id="refer√™ncias" class="section level1">
<h1>Refer√™ncias</h1>
<ul>
<li><a href="https://www.infomoney.com.br/minhas-financas/brasileiros-nao-sabem-a-diferenca-entre-poupar-e-investir-afirma-especialista-2/" class="uri">https://www.infomoney.com.br/minhas-financas/brasileiros-nao-sabem-a-diferenca-entre-poupar-e-investir-afirma-especialista-2/</a></li>
<li><a href="https://www.btgpactualdigital.com/blog/investimentos/diversificacao-de-investimentos" class="uri">https://www.btgpactualdigital.com/blog/investimentos/diversificacao-de-investimentos</a></li>
<li><a href="https://www.btgpactualdigital.com/blog/coluna-gustavo-cerbasi/defina-sua-estrategia-entre-renda-fixa-ou-variavel" class="uri">https://www.btgpactualdigital.com/blog/coluna-gustavo-cerbasi/defina-sua-estrategia-entre-renda-fixa-ou-variavel</a></li>
<li><a href="https://blog.earo.me/2018/12/20/reintro-tsibble/" class="uri">https://blog.earo.me/2018/12/20/reintro-tsibble/</a></li>
<li><a href="https://www.tradingcomdados.com/post/2017/07/09/estudo-de-correla%C3%A7%C3%A3o-entre-a%C3%A7%C3%B5es-da-bolsa-de-valores-de-s%C3%A3o-paulo" class="uri">https://www.tradingcomdados.com/post/2017/07/09/estudo-de-correla%C3%A7%C3%A3o-entre-a%C3%A7%C3%B5es-da-bolsa-de-valores-de-s%C3%A3o-paulo</a></li>
<li><a href="https://www.business-science.io/code-tools/2017/10/28/demo_week_h2o.html" class="uri">https://www.business-science.io/code-tools/2017/10/28/demo_week_h2o.html</a></li>
<li><a href="https://www.infomoney.com.br/mercados/adolescente-fica-milionario-aos-18-anos-usando-bitcoins-apos-fazer-aposta-com-os-pais/" class="uri">https://www.infomoney.com.br/mercados/adolescente-fica-milionario-aos-18-anos-usando-bitcoins-apos-fazer-aposta-com-os-pais/</a></li>
<li><a href="https://www.infomoney.com.br/onde-investir/halving-conheca-o-processo-que-pode-levar-o-bitcoin-a-uma-nova-explosao-de-preco/" class="uri">https://www.infomoney.com.br/onde-investir/halving-conheca-o-processo-que-pode-levar-o-bitcoin-a-uma-nova-explosao-de-preco/</a></li>
<li><a href="https://cran.r-project.org/web/packages/telegram/README.html" class="uri">https://cran.r-project.org/web/packages/telegram/README.html</a></li>
<li><a href="https://otexts.com/fpp2/" class="uri">https://otexts.com/fpp2/</a>
<a href="https://www.curso-r.com/blog/2017-08-19-r-telegram-bitcoin/" class="uri">https://www.curso-r.com/blog/2017-08-19-r-telegram-bitcoin/</a></li>
<li><a href="https://www.curso-r.com/blog/2017-08-19-r-telegram-bitcoin/" class="uri">https://www.curso-r.com/blog/2017-08-19-r-telegram-bitcoin/</a></li>
</ul>
</div>

        <p><strong>Leia o post completo em:</strong> <a href="https://gomesfellipe.github.io/post/2020-03-25-investment-alert/investment-alert/">Desenvolva um bot e receba resultados de Machine Learning no seu Smartphone para ajudar nos investimentos</a></p>
        <p><em>Este post foi originalmente publicado em <a href="https://gomesfellipe.github.io/">Fellipe Gomes - Data Science Blog</a></em></p>
      ]]></content:encoded>
      <category>Fundamentos de Data Science</category>
      <category>Intelig√™ncia Artificial</category>
      <category>Machine Learning</category>
      <category>Programa√ß√£o e Ferramentas</category>
      <category domain="tag">bitcoin</category>
      <category domain="tag">bolsa-de-valores</category>
      <category domain="tag">correlacao</category>
      <category domain="tag">dplyr</category>
      <category domain="tag">estatistica</category>
      <category domain="tag">machine-learning</category>
      <category domain="tag">modelagem</category>
      <category domain="tag">prophet</category>
      <category domain="tag">r</category>
      <category domain="tag">reports</category>
    </item>
    <item>
      <title>Com que frequ√™ncia ocorrem acidentes na ponte Rio-Niter√≥i?</title>
      <link>https://gomesfellipe.github.io/post/2018-09-29-freq-acidente-ponte-rio-niteroi/freq-acidente-ponte-rio-niteroi/</link>
      <pubDate>Sat, 29 Sep 2018 00:00:00 +0000</pubDate>
      <author>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</author>
      <guid>https://gomesfellipe.github.io/post/2018-09-29-freq-acidente-ponte-rio-niteroi/freq-acidente-ponte-rio-niteroi/</guid>
      <description>Com os dados p√∫blicos da PRF e um pouco de Estat√≠stica buscaremos respostas para esta e outras perguntas relacionadas ao n√∫mero de acidentes na Ponte Rio-Niter√≥i.</description>
      <content:encoded>&lt;![CDATA[
        
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>
<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>
<link href="/rmarkdown-libs/lightable/lightable.css" rel="stylesheet" />
<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/leaflet/leaflet.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet/leaflet.js"></script>
<link href="/rmarkdown-libs/leafletfix/leafletfix.css" rel="stylesheet" />
<script src="/rmarkdown-libs/proj4/proj4.min.js"></script>
<script src="/rmarkdown-libs/Proj4Leaflet/proj4leaflet.js"></script>
<link href="/rmarkdown-libs/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-binding/leaflet.js"></script>
<link href="/rmarkdown-libs/leaflet-markercluster/MarkerCluster.css" rel="stylesheet" />
<link href="/rmarkdown-libs/leaflet-markercluster/MarkerCluster.Default.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-markercluster/leaflet.markercluster.js"></script>
<script src="/rmarkdown-libs/leaflet-markercluster/leaflet.markercluster.freezable.js"></script>
<script src="/rmarkdown-libs/leaflet-markercluster/leaflet.markercluster.layersupport.js"></script>
<link href="/rmarkdown-libs/leaflet-easybutton/easy-button.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-easybutton/easy-button.js"></script>
<script src="/rmarkdown-libs/leaflet-easybutton/EasyButton-binding.js"></script>
<link href="/rmarkdown-libs/ionicons/ionicons.min.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-providers/leaflet-providers_1.9.0.js"></script>
<script src="/rmarkdown-libs/leaflet-providers-plugin/leaflet-providers-plugin.js"></script>


<div id="perguntas" class="section level1">
<h1>Perguntas</h1>
<p>Estudar em outra cidade t√™m suas vantagens e desvantagens, durante toda a gradua√ß√£o atravessei Ba√≠a de Guanabara pela Ponte Presidente Costa e Silva, (popularmente conhecida como Ponte Rio‚ÄìNiter√≥i) assim como todas as pessoas que fazem esse trajeto diariamente e diante de tanta beleza natural com a vista panor√¢mica da Ba√≠a como os espet√°culos proporcionados pelo p√¥r do sol, os p√°ssaros ou a beleza ineg√°vel do P√£o de A√ß√∫car tamb√©m √© not√°vel a beleza fruto da maior habilidade humana: a <strong>criatividade</strong>. Temos o cristo, todos aqueles grandes barcos, o Porto do Rio de Janeiro com todas aquelas obras de Engenharia, ou at√© mesmo a pr√≥pria Ponte, que por si s√≥ j√° √© intrigante.</p>
<p>Em contrapartida, dentre as desvantagens est√° a enorme frequ√™ncia de engarrafamentos, o custo, o <strong>tempo</strong> gasto no trajeto e ao refletir sobre a velocidade dos carros na travessia da Ponte e a quantidade de acidentes que ocorrem na me deparei com os seguinte questionamentos:</p>
<blockquote>
<p>O n√∫mero de acidentes na ponte √© di√°rio?</p>
<p>O n√∫mero de acidentes na ponte t√™m diminu√≠do?</p>
<p>A instala√ß√£o das c√¢meras de seguran√ßa diminuiu o n√∫mero de acidentes?</p>
</blockquote>
<p>Em janeiro de 2018 anunciava-se no jornal: <a href="https://oglobo.globo.com/rio/bairros/radares-da-ponte-rio-niteroi-comecam-multar-nesta-segunda-22284313">‚Äúradares da Ponte Rio-Niter√≥i come√ßam a multar‚Äù</a> e como j√° faz algum tempo que a ponte √© monitorada com c√¢meras de seguran√ßa surge a suspeita se o n√∫mero de acidentes t√™m diminu√≠do e na vontade de tirar minhas pr√≥prias conclus√µes recorri ao que h√° de mais abundante por ai: <strong>os dados</strong> e com o uso de t√©cnicas simples de Estat√≠stica iniciei minha ‚Äúinvestiga√ß√£o‚Äù para obter poss√≠veis respostas para essas perguntas.</p>
<p>Pacotes utilizados nesta an√°lise:</p>
<pre class="text"><code>library(grid)           # textGrob()
library(dplyr)          # Manipulacao dos dados
library(purrr)          # Programacao Funcional
library(stringr)        # Manipulacao de strings
library(magrittr)       # Pipes
library(leaflet)        # Mapa interativo
library(leaflet.extras) # + leaflet
library(ggplot2)        # graficos elegantes
library(lubridate)      # manipulacao de data
library(data.table)     # fred()
library(forecast)       # tslm()
library(ggfortify)      # autoplot()
library(gridExtra)      # + ggplot2
library(zoo)            # rollmean
library(broom)          # tidy() augment() glance()
library(knitr)          # kable()
library(kableExtra)     # scroll_box
library(formattable)    # color_bar()</code></pre>
</div>
<div id="fonte-dos-dados" class="section level1">
<h1>Fonte dos dados</h1>
<p>Os dados para realizar esta pesquisa foram obtidos no site da Pol√≠cia Rodovi√°ria Federal, que disponibiliza uma sess√£o de <a href="https://www.prf.gov.br/portal/dados-abertos/">Dados Abertos</a> que segundo o site: ‚Äún√£o possui restri√ß√£o de licen√ßas, patentes ou mecanismos de controle, de modo a estarem livremente dispon√≠veis para serem utilizados e redistribu√≠dos √† vontade‚Äù. Na sess√£o de <a href="https://www.prf.gov.br/portal/dados-abertos/acidentes/acidentes">Acidentes</a> √© poss√≠vel encontrar os registros de acidentes no formato csv ao longo dos anos.</p>
<p><strong>Discuss√£o:</strong> Para saber se de fato o n√∫mero de acidentes na ponte Rio-Niter√≥i ocorre diariamente seria necess√°rio que todos os casos fossem registrados ou elaborar alguma forma de fazer infer√™ncia para obter signific√¢ncia estat√≠stica para esta resposta baseado na amostra de ocorr√™ncias registradas. Ainda √© poss√≠vel que ocorram <a href="https://dicionario.priberam.org/subnotifica%C3%A7%C3%A3o">subnotifica√ß√µes</a> pois pode ser que alguns casos como uma leve batida entre dois carros n√£o tenham sido registrados pela PRF.</p>
<p><strong>Reflex√£o</strong>: Uma sugest√£o para contornar esse problema de <strong>subnotifa√ß√£o</strong> (caso de fato exista) poderia ser o desenvolvimento de um algor√≠timo de <strong>Intelig√™ncia Artificial</strong> baseado em <strong>Deep Learning</strong> para captar atrav√©s das <strong>imagens</strong> das c√¢meras de seguran√ßa a ocorr√™ncia dos acidentes, classifica-los e armazenar em uma base de dados de forma automatizada al√©m de notificar √†s autoridades..</p>
<p>Dada as circunst√¢ncias, vejamos o que os dados disponibilizados pela PRF t√™m √† revelar. Ap√≥s baixar todos os dados, bastou fazer a leitura com os comandos:</p>
<pre class="text"><code># Importar / Arrumar / Limpar
base &lt;- 
  paste0(&quot;datatran&quot;,2008:2018,&quot;/&quot;,&quot;datatran&quot;,2008:2018,&quot;.csv&quot;) %&gt;% 
  map(~.x %&gt;%
        fread(sep = &quot;;&quot;,dec=&quot;,&quot;)%&gt;% 
        mutate(km = as.character(km),
               br = as.character(br)) %&gt;% 
        mutate_if(is.character,
                  ~.x %&gt;%
                    enc2native() %&gt;%
                    abjutils::rm_accent() %&gt;% 
                    tolower() %&gt;% 
                    str_replace_all(&quot;/&quot;,&quot;-&quot;) %&gt;% 
                    str_replace_all(&quot;,&quot;,&quot;\\.&quot;)
        ) %&gt;%
        mutate(data_inversa = if_else(is.na(dmy(data_inversa)),
                                      ymd(data_inversa),
                                      dmy(data_inversa)) ,
               km = as.numeric(km),
               br = as.numeric(br),
               id = as.character(id),
               dia_semana = str_remove_all(dia_semana,&quot;-feira&quot;)
        ) %&gt;%
        filter(br==101 &amp; km&gt;=321 &amp; km&lt;334)  %&gt;% 
        .[str_detect(.$municipio,&quot;(niteroi|rio de janeiro)&quot;),] 
  )

# Salvar base arrumada:
saveRDS(base, &#39;base.RDS&#39;)</code></pre>
<p><em>Nota: A √∫nica pasta que tinha a base com nome diferente das demais foi no ano de 2016, do qual foi preciso renomear o arquivo <code>datatran2016_atual.csv</code> para <code>datatran2016.csv</code>.</em></p>
<p>Diante de tantos dados, foi necess√°rio fazer um filtro para obter apenas os dados da ponte Rio- Niter√≥i.</p>
<p>Segundo o Google, o ‚Äúendere√ßo‚Äù da ponte √© <a href="https://www.google.com.br/search?q=ponte+rio+niteroi+br101&amp;oq=ponte+rio+niteroi+br101&amp;aqs=chrome..69i57j0l2.5680j0j7&amp;sourceid=chrome&amp;ie=UTF-8">BR-101, Km 321-334</a>, portanto foi aplicado um filtro que levasse em conta essa informa√ß√£o.</p>
</div>
<div id="an√°lises-preliminares" class="section level1">
<h1>An√°lises preliminares</h1>
<p>Com a base de dados arrumada e salva em no objeto <code>base.RDS</code> fica mais f√°cil fazer an√°lises r√°pidas depois de reiniciar o R e a leitura dos dados tamb√©m ser√° mais veloz.</p>
<pre class="text"><code>base &lt;- readRDS(&quot;base.RDS&quot;)</code></pre>
<p>Primeiramente, um breve resumo dos dados com algumas informa√ß√µes gerais dos √∫ltimos 10 anos:</p>
<pre class="text"><code>base %&gt;% 
  map_df( ~.x %&gt;% 
            select(dia_semana,classificacao_acidente, mortos, feridos, veiculos)) %&gt;%
  map_if(is.character,as.factor) %&gt;% 
  bind_cols() %&gt;% 
  SmartEDA::ExpCatViz(target=NULL, fname=NULL, margin=2, Page = c(2,2)) </code></pre>
<pre><code>## $`0`</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-4-1.png" width="1152" /></p>
<p>Nota-se que o maior n√∫mero de acidentes ocorre na sexta-feira, praticamente todos os acidentes n√£o tiveram mortos e em 78% dos acidentes n√£o houveram v√≠timas. A maioria dos acidentes foi colis√£o entre dois carros.</p>
<p>Os tipos de acidentes que ocorreram foram:</p>
<pre class="text"><code>base %&gt;% 
  map_df( ~.x %&gt;% 
            select(causa_acidente,
                   tipo_acidente)) %&gt;%
  map_if(is.character,as.factor) %&gt;% 
  as_tibble %&gt;% 
  group_by(causa_acidente) %&gt;% 
  dplyr::summarise(n=n()) %&gt;% 
  mutate(n = color_bar(&quot;lightgrey&quot;)(n)) %&gt;% 
  kable(escape = F) %&gt;%
  kable_styling(&quot;hover&quot;,full_width = F) %&gt;%
  scroll_box( height = &quot;200px&quot;)</code></pre>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; ">
<table class="table table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
causa_acidente
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
agressao externa
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.02%">1</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
animais na pista
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.08%">4</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
avarias e-ou desgaste excessivo no pneu
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.10%">5</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
condutor dormindo
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.08%">4</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
defeito mecanico em veiculo
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 4.10%">210</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
defeito mecanico no veiculo
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.51%">26</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
defeito na via
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.18%">9</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
desobediencia a sinalizacao
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.94%">48</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
desobediencia as normas de transito pelo condutor
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.18%">9</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
dormindo
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 1.13%">58</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
falta de atencao
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 33.16%">1697</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
falta de atencao a conducao
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 2.85%">146</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
falta de atencao do pedestre
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.08%">4</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
ingestao de alcool
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 1.15%">59</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
ingestao de alcool
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.10%">5</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
mal subito
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.08%">4</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
nao guardar distancia de seguranca
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 13.23%">677</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
nao guardar distancia de seguranca
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.76%">39</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
objeto estatico sobre o leito carrocavel
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.06%">3</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
outras
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 100.00%">5118</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
pista escorregadia
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.10%">5</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
restricao de visibilidade
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.04%">2</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
ultrapassagem indevida
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.41%">21</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
velocidade incompativel
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 1.21%">62</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
velocidade incompativel
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.10%">5</span>
</td>
</tr>
</tbody>
</table>
</div>
<div id="mapa" class="section level2">
<h2>Mapa</h2>
<p>Ao investigar a base nota-se que apenas os √∫ltimos dois anos (2018 e 2017) informam as coordenadas geogr√°ficas, portando para criar o mapa com o pacote <a href="https://rstudio.github.io/leaflet/">leaflet</a> foram selecionados apenas os dados referentes ao ano de <strong>2018</strong> e <strong>2017</strong>:</p>
<pre class="text"><code>base[10:11] %&gt;% 
  map_df(~.x %&gt;% 
           select(id, data_inversa, horario, br,km,
                  causa_acidente, tipo_acidente,
                  latitude, longitude) %&gt;% 
           mutate(latitude = as.numeric(latitude), 
                  longitude = as.numeric(longitude) )
  ) %&gt;%
  leaflet() %&gt;%
  addTiles() %&gt;%
  addMarkers(~longitude, ~latitude,
             clusterOptions = markerClusterOptions(),
             label = ~paste0(data_inversa,&quot;-&quot;,horario,&quot;\n Causa: &quot;,causa_acidente,&quot;\nTipo: &quot;,tipo_acidente))%&gt;%
  addResetMapButton()%&gt;% 
  addProviderTiles(providers$OpenStreetMap.Mapnik)</code></pre>
<div id="htmlwidget-1" style="width:850px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addMarkers","args":[[-22.87199872,-22.8785807,-22.8779,-22.8800204,-22.8759557,-22.87167745,-22.8858975,-22.86763924,-22.8735,-22.8759557,-22.8708372,-22.8703627,-22.8809199,-22.87174665,-22.8758,-22.87965466,-22.8692,-22.8841859,-22.8759557,-22.87323339,-22.8808,-22.8675,-22.87578968,-22.8808,-22.8758,-22.87364461,-22.87452327,-22.8685577,-22.86826698,-22.8759557,-22.87016993,-22.8759557,-22.8759557,-22.8808,-22.87462594,-22.8808,-22.8808,-22.903263,-22.87522623,-22.8466271,-22.8730169,-22.87318405,-22.87162803,-22.86902012,-22.8673,-22.87638772,-22.8783982,-22.8679457,-22.87126227,-22.8683,-22.87322944,-22.87796436,-22.878397,-22.87795448,-22.8850444,-22.8673,-22.8683,-22.8701,-22.8708372,-22.8712,-22.8692,-22.8758,-22.9236903,-22.8784012,-22.86660619,-22.87757885,-22.8759557,-22.8735,-22.8673,-22.87024407,-22.87095582,-22.87095582,-22.8808,-22.87771724,-22.8673,-22.8808,-22.878588,-22.8673,-22.8703627,-22.8783213,-22.8683,-22.87206298,-22.8759557,-22.8683,-22.86860934,-22.903263,-22.87915054,-22.86879091,-22.87762828,-22.8858975,-22.87301118,-22.87841412,-22.87045832,-22.87377806,-22.8782913,-22.87549807,-22.86778596,-22.878781,-22.88286716,-22.878315,-22.8759557,-22.86381346,-22.8735,-22.8808,-22.8683,-22.87172795,-22.87113376,-22.878,-22.8808,-22.8808,-22.87170711,-22.8779,-22.87807128,-22.8759557,-22.87115353,-22.8784518,-22.87711426,-22.878562,-22.86772821,-22.8735,-22.8759557,-22.87848845,-22.87322944,-22.8673,-22.86873081,-22.8673,-22.903263,-22.8701,-22.87769141,-22.8779,-22.8783782,-22.8784061,-22.87028362,-22.87779138,-22.8688555,-22.869379,-22.878923,-22.868481,-22.8721816,-22.871508,-22.86779247,-22.869852,-22.87627009,-22.869852,-22.86969049,-22.8785813,-22.8710349,-22.86984866,-22.878471,-22.87301196,-22.87257701,-22.86924564,-22.8784568,-22.878923,-22.8848256,-22.873808,-22.868481,-22.87000682,-22.8786976,-22.871164,-22.8858975,-22.87770736,-22.872055,-22.876848,-22.87979305,-22.869379,-22.86731796,-22.87182573,-22.9068467,-22.876848,-22.87302679,-22.86905782,-22.86981966,-22.87237931,-22.8783273,-22.871164,-22.87490991,-22.87946778,-22.869852,-22.869852,-22.869852,-22.869852,-22.87870572,-22.878471,-22.869852,-22.86858331,-22.867664,-22.868481,-22.867664,-22.872055,-22.87870572,-22.878471,-22.868481,-22.87744046,-22.878923,-22.867664,-22.868481,-22.86858331,-22.878923,-22.87997097,-22.87593795,-22.87902204,-22.869852,-22.86921599,-22.86905782,-22.871164,-22.869852,-22.87902204,-22.869379,-22.878382,-22.869852,-22.878471,-22.87158848,-22.878923,-22.87521545,-22.871164,-22.87841907,-22.867664,-22.871164,-22.870275,-22.8759557,-22.87775678,-22.86707081,-22.870275,-22.867664,-22.8676343,-22.873808,-22.867664,-22.87815218,-22.868481,-22.8759557,-22.8824619,-22.869852,-22.872925,-22.878471,-22.867664,-22.8849062,-22.8849062,-22.86731796,-22.878923,-22.86830652,-22.8759557,-22.87813241,-22.878923,-22.8759557,-22.872925,-22.868481,-22.878923,-22.869852,-22.878471,-22.88218513,-22.87009415,-22.87322944,-22.869852,-22.87775678,-22.868481,-22.87111399,-22.8680459],[-43.14552069,-43.1144885,-43.2104,-43.11206281,-43.1117034,-43.14893246,-43.1152211,-43.11079949,-43.1278,-43.1117034,-43.15983295,-43.16421032,-43.21369171,-43.15292358,-43.1186,-43.11338246,-43.1761,-43.1117034,-43.1117034,-43.11009943,-43.1043,-43.1956,-43.11863422,-43.1043,-43.1186,-43.20613861,-43.11022141,-43.19978433,-43.19343567,-43.1117034,-43.16662967,-43.1117034,-43.1117034,-43.1043,-43.12749526,-43.1043,-43.1043,-43.207874,-43.20888519,-43.0950118,-43.13368142,-43.13310832,-43.15253735,-43.17805873,-43.1103,-43.1105384,-43.1145595,-43.11070025,-43.15514445,-43.1859,-43.13393262,-43.11607003,-43.1146201,-43.1157589,-43.1117034,-43.1103,-43.1859,-43.1664,-43.16202164,-43.2042,-43.1761,-43.1186,-43.2246728,-43.1145651,-43.10935915,-43.11035693,-43.1117034,-43.1278,-43.1103,-43.11045516,-43.20382118,-43.16305161,-43.1043,-43.11573744,-43.1103,-43.1043,-43.1145867,-43.1103,-43.16703536,-43.1145249,-43.1859,-43.20081711,-43.1117034,-43.1859,-43.19817847,-43.207874,-43.11414865,-43.20050597,-43.11521173,-43.1152211,-43.13353152,-43.11427832,-43.20247609,-43.20640951,-43.1144462,-43.11937896,-43.19416416,-43.1594364,-43.2148495,-43.1144214,-43.1117034,-43.10749233,-43.1278,-43.1043,-43.1859,-43.14682335,-43.15668136,-43.116,-43.1043,-43.1043,-43.15202236,-43.2104,-43.11563909,-43.1117034,-43.15627098,-43.1144862,-43.1168845,-43.1147141,-43.11053663,-43.1278,-43.1117034,-43.11497284,-43.13419104,-43.1103,-43.11065764,-43.1103,-43.207874,-43.1664,-43.11602736,-43.2104,-43.1143391,-43.1143417,-43.16205718,-43.11578035,-43.11068845,-43.175808,-43.110676,-43.18568,-43.14394355,-43.204243,-43.19669724,-43.110458,-43.20833587,-43.110458,-43.17111969,-43.1146243,-43.15579891,-43.18622589,-43.21072,-43.14219475,-43.13837528,-43.17558289,-43.1142699,-43.110676,-43.1127452,-43.126438,-43.18568,-43.1693387,-43.1146008,-43.156063,-43.1152211,-43.1157589,-43.146187,-43.117287,-43.11108649,-43.175808,-43.19841385,-43.1461966,-43.1728965,-43.117287,-43.13391209,-43.18842798,-43.17498207,-43.14846039,-43.1145218,-43.156063,-43.11035156,-43.11583299,-43.110458,-43.110458,-43.110458,-43.110458,-43.21334839,-43.21072,-43.110458,-43.19892883,-43.19556,-43.18568,-43.19556,-43.146187,-43.10348511,-43.21072,-43.18568,-43.12820435,-43.110676,-43.19556,-43.18568,-43.1803894,-43.110676,-43.18107605,-43.11831772,-43.11138153,-43.110458,-43.16665649,-43.18047523,-43.156063,-43.110458,-43.11275482,-43.175808,-43.114474,-43.110458,-43.21072,-43.15172195,-43.110676,-43.12650723,-43.156063,-43.11451435,-43.19556,-43.156063,-43.165936,-43.1117034,-43.1157589,-43.19599987,-43.165936,-43.19556,-43.19274902,-43.126438,-43.19556,-43.11046958,-43.18568,-43.1117034,-43.2147646,-43.110458,-43.136311,-43.21072,-43.19556,-43.1136734,-43.1136734,-43.17592621,-43.110676,-43.18755627,-43.1117034,-43.11522245,-43.110676,-43.1117034,-43.136311,-43.18568,-43.110676,-43.110458,-43.21072,-43.11378479,-43.1106037,-43.20585966,-43.110458,-43.20987225,-43.18568,-43.16047668,-43.19756529],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,{"showCoverageOnHover":true,"zoomToBoundsOnClick":true,"spiderfyOnMaxZoom":true,"removeOutsideVisibleBounds":true,"spiderLegPolylineOptions":{"weight":1.5,"color":"#222","opacity":0.5},"freezeAtZoom":false},null,["2017-01-06-13:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-06-16:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-07-12:20:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-09-17:18:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-01-11-04:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-11-10:10:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: engavetamento                                                                                                                                                                                           ","2017-01-11-15:53:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-01-14-01:05:00\n Causa: velocidade incompativel                                                                             \nTipo: capotamento                                                                                                                                                                                             ","2017-01-14-06:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto em movimento                                                                                                                                                                         ","2017-01-14-11:28:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-01-16-04:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-01-23-05:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-24-11:20:00\n Causa: avarias e-ou desgaste excessivo no pneu                                                             \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-01-24-13:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-25-17:14:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-28-23:15:00\n Causa: velocidade incompativel                                                                             \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-01-30-13:43:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-31-12:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-31-20:07:00\n Causa: avarias e-ou desgaste excessivo no pneu                                                             \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-02-03-05:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-02-03-16:45:00\n Causa: objeto estatico sobre o leito carrocavel                                                            \nTipo: colisao traseira                                                                                                                                                                                        ","2017-02-03-15:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-02-08-19:50:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-02-20-01:50:00\n Causa: condutor dormindo                                                                                   \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-02-22-15:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-03-01-05:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-03-02-16:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-03-02-19:15:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-03-03-17:20:00\n Causa: mal subito                                                                                          \nTipo: colisao lateral                                                                                                                                                                                         ","2017-03-08-18:23:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-03-09-10:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-03-11-17:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-03-12-19:21:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-22-23:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-03-13-21:20:00\n Causa: ingestao de alcool                                                                                  \nTipo: colisao transversal                                                                                                                                                                                     ","2017-03-30-08:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-03-30-13:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-04-03-17:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-04-04-12:29:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-04-05-12:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-04-10-12:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-04-10-19:15:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: colisao lateral                                                                                                                                                                                         ","2017-04-13-06:17:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-04-15-15:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-04-19-09:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-04-20-08:35:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-04-29-15:50:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-08-05:36:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-11-17:44:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-02-17-18:10:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-12-18:30:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: atropelamento de pedestre                                                                                                                                                                               ","2017-05-18-12:40:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-05-19-08:35:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-05-19-12:12:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-05-23-17:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-26-17:46:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-27-23:31:00\n Causa: ingestao de alcool                                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-29-05:27:00\n Causa: velocidade incompativel                                                                             \nTipo: colisao lateral                                                                                                                                                                                         ","2017-05-29-06:05:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-30-02:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-05-30-06:42:00\n Causa: restricao de visibilidade                                                                           \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-05-30-15:23:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-31-13:30:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-06-04-07:38:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-06-17-07:00:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-06-19-12:04:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-06-20-18:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-06-24-19:12:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-06-27-10:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-06-29-10:45:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-06-30-08:15:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-06-30-13:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-07-01-12:15:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-07-03-10:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-07-04-09:45:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: colisao lateral                                                                                                                                                                                         ","2017-07-04-10:00:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: colisao lateral                                                                                                                                                                                         ","2017-06-02-21:55:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-07-05-19:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-07-07-06:04:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-07-08-19:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-07-10-08:26:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-07-16-07:50:00\n Causa: ingestao de alcool                                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-07-24-16:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-07-26-05:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-07-28-20:05:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-08-01-08:54:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-08-04-09:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-08-10-04:10:00\n Causa: condutor dormindo                                                                                   \nTipo: colisao traseira                                                                                                                                                                                        ","2017-08-14-05:22:00\n Causa: falta de atencao a conducao                                                                         \nTipo: engavetamento                                                                                                                                                                                           ","2017-08-14-06:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-08-16-17:14:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-08-22-06:24:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-08-22-18:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-08-24-17:31:00\n Causa: velocidade incompativel                                                                             \nTipo: colisao traseira                                                                                                                                                                                        ","2017-08-27-10:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: incendio                                                                                                                                                                                                ","2017-08-31-09:29:00\n Causa: restricao de visibilidade                                                                           \nTipo: engavetamento                                                                                                                                                                                           ","2017-09-03-18:46:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-04-12:21:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-04-16:06:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao com objeto em movimento                                                                                                                                                                         ","2017-09-08-17:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-09-12-10:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-09-13-17:40:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: colisao lateral                                                                                                                                                                                         ","2017-07-24-16:19:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-09-18-20:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-09-21-07:20:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-22-07:42:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-09-22-18:07:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-22-20:27:00\n Causa: ingestao de alcool                                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-24-05:00:00\n Causa: condutor dormindo                                                                                   \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-26-07:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-09-26-15:20:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao transversal                                                                                                                                                                                     ","2017-09-26-18:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-28-16:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-09-29-06:56:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-10-04-15:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-10-06-17:11:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-10-11-11:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-10-14-11:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-10-15-06:00:00\n Causa: pista escorregadia                                                                                  \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-10-18-08:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-08-06-07:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-10-23-17:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-10-27-21:25:00\n Causa: falta de atencao do pedestre                                                                        \nTipo: atropelamento de pedestre                                                                                                                                                                               ","2017-10-28-12:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2017-10-31-05:50:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-11-06-18:43:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-11-06-22:55:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-11-10-07:15:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-11-10-11:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-11-10-20:07:00\n Causa: condutor dormindo                                                                                   \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-11-11-16:00:00\n Causa: pista escorregadia                                                                                  \nTipo: tombamento                                                                                                                                                                                              ","2017-11-11-19:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-11-14-07:15:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-11-16-06:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-11-19-03:05:00\n Causa: pista escorregadia                                                                                  \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-11-23-14:29:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-11-29-06:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-11-30-20:48:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-02-07:05:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-03-19:32:00\n Causa: falta de atencao a conducao                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2017-12-05-17:30:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-12-07-09:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-08-18:11:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-09-07:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-12-11-15:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-12-12-13:07:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-12-14-17:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-17-12:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-12-17-16:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-12-18-11:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-12-18-11:10:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-12-22-10:05:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-12-22-18:30:00\n Causa: ingestao de alcool                                                                                  \nTipo: colisao frontal                                                                                                                                                                                         ","2017-12-25-10:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: engavetamento                                                                                                                                                                                           ","2017-12-25-16:30:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-26-15:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-27-15:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-28-17:26:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-12-29-15:45:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-31-00:45:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-07-24-17:45:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-09-21-07:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-07-28-18:47:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2018-01-02-22:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2018-01-04-00:49:00\n Causa: falta de atencao a conducao                                                                         \nTipo: capotamento                                                                                                                                                                                             ","2018-01-05-09:52:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-01-06-15:10:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2018-01-11-08:47:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-01-26-12:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-01-28-16:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-01-31-07:35:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-01-31-08:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-02-02-09:22:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-02-02-10:17:00\n Causa: avarias e-ou desgaste excessivo no pneu                                                             \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-02-05-15:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-02-09-17:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-02-12-17:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-02-12-22:29:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-02-06-00:45:00\n Causa: pista escorregadia                                                                                  \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2018-02-21-07:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-02-21-09:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: incendio                                                                                                                                                                                                ","2018-02-22-19:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-02-23-08:25:00\n Causa: pista escorregadia                                                                                  \nTipo: tombamento                                                                                                                                                                                              ","2018-02-25-06:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2018-02-25-15:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-02-26-19:07:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-02-26-23:58:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-03-01-08:50:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: incendio                                                                                                                                                                                                ","2018-03-06-05:00:00\n Causa: mal subito                                                                                          \nTipo: capotamento                                                                                                                                                                                             ","2018-03-10-05:30:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: colisao lateral                                                                                                                                                                                         ","2018-03-12-03:30:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-03-14-08:54:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-03-22-23:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-03-30-07:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-03-31-08:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao frontal                                                                                                                                                                                         ","2018-04-02-10:56:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-04-03-07:33:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao frontal                                                                                                                                                                                         ","2018-04-05-20:01:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-04-06-09:44:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-04-08-09:55:00\n Causa: mal subito                                                                                          \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2018-04-09-15:05:00\n Causa: falta de atencao do pedestre                                                                        \nTipo: colisao traseira                                                                                                                                                                                        ","2018-04-12-07:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2018-04-16-04:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-04-16-10:29:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-04-22-05:45:00\n Causa: mal subito                                                                                          \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-04-22-15:45:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2018-04-27-18:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2018-05-03-23:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-05-04-13:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-08-01:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-04-11:20:00\n Causa: falta de atencao do pedestre                                                                        \nTipo: atropelamento de pedestre                                                                                                                                                                               ","2018-05-08-08:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-09-10:43:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-11-11:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: atropelamento de pedestre                                                                                                                                                                               ","2018-05-11-12:28:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2018-05-14-12:35:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-16-13:29:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: colisao transversal                                                                                                                                                                                     ","2018-05-28-17:45:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-31-17:20:00\n Causa: avarias e-ou desgaste excessivo no pneu                                                             \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-06-01-09:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-06-07-09:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2018-06-10-19:05:00\n Causa: falta de atencao a conducao                                                                         \nTipo: engavetamento                                                                                                                                                                                           ","2018-06-12-08:15:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-06-13-23:50:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: incendio                                                                                                                                                                                                ","2018-06-17-18:56:00\n Causa: velocidade incompativel                                                                             \nTipo: tombamento                                                                                                                                                                                              ","2018-06-18-07:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-06-20-17:30:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: tombamento                                                                                                                                                                                              ","2018-06-22-15:27:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-06-24-11:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-06-25-15:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2018-06-27-08:40:00\n Causa: falta de atencao do pedestre                                                                        \nTipo: atropelamento de pedestre                                                                                                                                                                               ","2018-06-30-08:25:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2018-07-03-18:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-07-05-15:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-07-06-08:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-07-08-19:35:00\n Causa: avarias e-ou desgaste excessivo no pneu                                                             \nTipo: colisao traseira                                                                                                                                                                                        ","2018-07-13-14:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-07-13-11:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-07-13-16:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-05-11-06:55:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-07-20-23:39:00\n Causa: agressao externa                                                                                    \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-30-07:40:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2018-05-11-06:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-07-30-18:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-07-17-07:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: engavetamento                                                                                                                                                                                           ","2018-08-01-17:48:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-02-09-14:28:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-08-16-14:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-08-21-14:10:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2018-08-22-07:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-06-23-06:15:00\n Causa: objeto estatico sobre o leito carrocavel                                                            \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2018-08-23-17:45:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: incendio                                                                                                                                                                                                ","2018-08-24-01:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-08-28-20:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-08-29-12:40:00\n Causa: objeto estatico sobre o leito carrocavel                                                            \nTipo: colisao traseira                                                                                                                                                                                        ","2018-08-30-06:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-08-30-07:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-08-22-01:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         "],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addEasyButton","args":[{"icon":"ion-arrow-shrink","title":"Reset View","onClick":"function(btn, map){ map.setView(map._initialCenter, map._initialZoom); }","position":"topleft"}]},{"method":"addProviderTiles","args":["OpenStreetMap.Mapnik",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]}],"limits":{"lat":[-22.9236903,-22.8466271],"lng":[-43.2246728,-43.0950118]}},"evals":["calls.2.args.0.onClick"],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (function(el, x){ var map = this; map._initialCenter = map.getCenter(); map._initialZoom = map.getZoom();}).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p>Note que existem diversas ocorr√™ncias que apresentaram coordenadas geogr√°ficas fora dos limites da Ponte o que sugere que a amostra selecionada pode conter informa√ß√µes das redondezas. Estas informa√ß√µes ser√£o avaliadas em conjunto com os dados referentes aos 13km da BR-101 que selecionamos.</p>
</div>
<div id="s√©rie-temporal" class="section level2">
<h2>S√©rie temporal</h2>
<p>Segundo <span class="citation">@Morettin</span>:</p>
<blockquote>
<p><strong>Def</strong>.: <em>Uma s√©rie temporal √© qualquer conjunto de observa√ß√µes ordenadas no tempo</em></p>
</blockquote>
<p>Os objetivos da an√°lise de s√©ries temporais s√£o, em geral:</p>
<ul>
<li>Investigar o mecanismo gerador da s√©rie temporal</li>
<li>Fazer previs√µes de valores futuros da s√©rie (podem ser a curto prazo ou a longo prazo)</li>
<li>Descrever apenas o comportamento da s√©rie, neste caso a constru√ß√£o do gr√°fico, a verifica√ß√£o da exist√™ncia de tend√™ncias, ciclos e varia√ß√µes sazonais, a constru√ß√£o de histogramas e diagramas de dispers√£o etc podem ser ferramentas √∫teis</li>
<li>Procurar periodicidade relevante nos dados</li>
</ul>
<p>Etimologicamente (<em>prae</em> e <em>videre</em>), a palavra previs√£o sugere que se quer ver uma coisa antes que ela exista. Alguns autores preferem a palavra <em>predi√ß√£o</em>, para indicar algo que dever√° existir no futuro. Ainda outros utilizam o termo <em>proje√ß√£o</em> por√©m nosso objetivo neste post n√£o ser√° ajustar um modelo <strong>preditivo</strong> e sim um modelo <strong>descritivo</strong> que possibilite estudar o comportamento da s√©rie.</p>
<p>Ap√≥s tomar uma intui√ß√£o de como ocorrem os acidentes de maneira espacial na amostra, para responder a pergunta ‚Äú<em>O n√∫mero de acidentes √© di√°rio?</em>‚Äù precisamos obter a informa√ß√£o temporal dos dados e a melhor forma de visualizar este comportamento inicialmente √© com um gr√°fico.</p>
<div id="n√∫mero-de-acidentes-por-dia-nos-√∫ltimos-10-anos" class="section level3">
<h3>N√∫mero de acidentes por dia nos √∫ltimos 10 anos</h3>
<p>Veja a seguir o n√∫mero de acidentes, por id, diariamente e duas curvas de m√©dias m√≥veis com <code>k = 30</code> e com <code>k = 30*6</code> :</p>
<pre class="text"><code>g1 &lt;- 
  base %&gt;%
  map_df(~.x%&gt;% select(id, data_inversa, causa_acidente, tipo_acidente) ) %&gt;% 
  dplyr::group_by(data_inversa)%&gt;% 
  dplyr::summarise(n=n())%&gt;%
  mutate(rMM=rollmean(n,30, na.pad=TRUE, align=&quot;left&quot;)) %&gt;%
  mutate(rMY=rollmean(n,30*6, na.pad=TRUE, align=&quot;left&quot;)) %&gt;%
  tidyr::gather(medida,valor,n:rMY) %&gt;% 
  ggplot(aes(x=data_inversa, y=valor,col=medida)) +
  geom_line() +
  scale_colour_manual(name=&quot;Legenda:&quot;,values=c(&quot;black&quot;,&quot;red&quot;,&quot;blue&quot;), 
                      labels = c(&#39;Acidentes&#39;,&#39;M√©dias m√≥veis k=30&#39;, &#39;M√©dias m√≥veis k=30*6&#39;)) +
  theme_bw() +
  labs(y= &#39;N√∫mero de acidentes&#39;,
       x = &#39;Data&#39;,
       subtitle = &quot;Por dia&quot;, 
       title= &#39;N√∫mero de acidentes na Ponte Rio-Niter√≥i&#39;, 
       caption = &quot;Fonte dos dados:\nhttps://www.prf.gov.br/portal/dados-abertos/acidentes\nhttps://gomesfellipe.github.io/&quot;,col=&quot;&quot;) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(breaks=seq(0,15,1))

g1 +
  scale_x_date(date_breaks = &#39;6 months&#39;,limits = as.Date(c(&quot;2008-02-01&quot;,&quot;2018-12-01&quot;)),
               expand = c(0.01,0.01)) + 
  theme(legend.position = c(0.85,0.7), 
        legend.background = element_rect(fill=alpha(&#39;lightgrey&#39;, 0.2)))</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-7-1.png" width="1152" /></p>
<p>Este gr√°fico esta um pouco carregado com a informa√ß√£o levando em conta o n√∫mero de acidentes <em>por dia</em> mas mesmo assim j√° √© poss√≠vel notar algumas informa√ß√µes como:</p>
<ul>
<li>Existem diversos dias que n√£o houveram acidentes registrados pela PRF (diversos pontos tocam o eixo x)</li>
<li>No ano de 2015 houve uma grotesca diminui√ß√£o no registros do n√∫mero de acidentes (o que ser√° que aconteceu?)</li>
</ul>
<p>A primeira pergunta parece ter sido respondida: O n√∫mero de acidentes n√£o parece ter sido di√°rio nos √∫ltimos 10 anos segundo esses dados (e supondo que n√£o houve subnotifica√ß√£o).</p>
<p>J√° a hip√≥tese levantada com a segunda pergunta <em>parece</em> ser verdadeira pois o comportamento dos dados sugerem ter havido a diminui√ß√£o no n√∫mero de acidentes.</p>
<p>Veja a seguir outra r√°pida an√°lise explorat√≥ria para checar como se distribuem os n√∫mero de acidentes ano longo dos anos e dos meses com alguns box-plots:</p>
<pre class="text"><code>bp1 &lt;- 
  base %&gt;%
  map_df(~.x%&gt;% select(id, data_inversa, causa_acidente, tipo_acidente) ) %&gt;% 
  dplyr::group_by(data_inversa)%&gt;% 
  dplyr::summarise(n=n()) %&gt;%
  tidyr::gather(medida,valor,n) %&gt;% 
  ggplot(aes(x=factor(year(data_inversa)), y=valor,col=medida)) +
  geom_jitter(col=&quot;darkgrey&quot;,alpha=0.3)+
  geom_boxplot(col=&quot;black&quot;,alpha=0.3)+
  theme_bw() +
  labs(y= &#39;N√∫mero de acidentes&#39;,x=&quot;&quot;) + 
  theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
  scale_y_continuous(breaks=seq(0,15,1))+ 
  geom_vline(xintercept = 8.5, linetype=&quot;dotted&quot;, 
             color = &quot;red&quot;, size=1.5) +
  annotate(&quot;label&quot;,y = 7, x = 8.5,
           label = &quot;Comportamentos \n     diferentes&quot;,
           size = 4, colour = &quot;red&quot;,hjust=0.1)

bp2 &lt;- 
  base %&gt;%
  map_df(~.x%&gt;% select(id, data_inversa, causa_acidente, tipo_acidente)) %&gt;% 
  filter(year(data_inversa)&lt;2016) %&gt;% 
  dplyr::group_by(data_inversa) %&gt;% 
  dplyr::summarise(n=n()) %&gt;%
  tidyr::gather(medida,valor,n) %&gt;% 
  ggplot(aes(x=factor(months(data_inversa),
                      levels = months(base[[1]]$data_inversa) %&gt;% unique),
             y=valor,col=medida)) +
  geom_jitter(col=&quot;darkgrey&quot;,alpha=0.3)+
  geom_boxplot(color=&quot;black&quot;,alpha=0.3)+
  theme_bw() +
  labs(y= &#39;N√∫mero de acidentes&#39;,
       title = &#39;Dados de 2008 at√© 2015&#39;,x=&quot;&quot;, col=&quot;&quot;) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(breaks=seq(0,15,1))+ 
  theme(legend.position = c(0.85,0.7))

bp3 &lt;- 
  base %&gt;%
  map_df(~.x%&gt;% select(id, data_inversa, causa_acidente, tipo_acidente) ) %&gt;% 
  filter(year(data_inversa)&gt;=2016) %&gt;% 
  dplyr::group_by(data_inversa) %&gt;% 
  dplyr::summarise(n=n()) %&gt;%
  tidyr::gather(medida,valor,n) %&gt;% 
  ggplot(aes(x=factor(months(data_inversa),
                      levels = months(base[[1]]$data_inversa) %&gt;% unique),
             y=valor,col=medida)) +
  geom_jitter(col=&quot;darkgrey&quot;,alpha=0.3)+
  geom_boxplot(color=&quot;black&quot;,alpha=0.3)+
  theme_bw() +
  labs(y= &#39;&#39;,
       title = &#39;Dados de 2016 at√© 2018&#39;,x=&quot;&quot;,col=&quot;&quot;) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(breaks=seq(0,15,1))+ 
  theme(legend.position = c(0.85,0.7))

bp2 &lt;- arrangeGrob(bp2,bp3,ncol=2)</code></pre>
<pre class="text"><code>grid.arrange(bp1,bp2,
             top = &quot;Boxplots do n√∫mero de acidentes na Ponte Rio-Niter√≥i&quot;,
             bottom = textGrob(&quot;Fonte dos dados:\nhttps://www.prf.gov.br/portal/dados-abertos/acidentes\nhttps://gomesfellipe.github.io/&quot;,
                               gp = gpar(fontface = 3, fontsize = 9),
                               hjust = 1,x = 1 )) </code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-9-1.png" width="1152" /></p>
<p>√â poss√≠vel notar que antes de 2016 todos aos boxplots apresentaram medianas parecidas enquanto que ap√≥s o ano de 2016 parece haver mais acidentes apenas nos primeiros meses do ano.</p>
<p>Para responder a √∫ltima pergunta vamos analisar com mais detalhes a s√©rie para entender melhor seu comportamento.</p>
<div id="n√∫mero-de-acidentes-por-dia-nos-√∫ltimos-10-anos-agrupados-por-ano" class="section level4">
<h4>N√∫mero de acidentes por dia nos √∫ltimos 10 anos agrupados por ano</h4>
<p>Veja a mesma informa√ß√£o do gr√°fico do n√∫mero de acidentes na Ponte Rio-Niter√≥i por dia, por√©m separado para cada ano:</p>
<pre class="text"><code>g1 +
  facet_wrap( ~ year(data_inversa), scales = &quot;free_x&quot;) +
  ggtitle(&quot;N√∫mero de acidentes na Ponte Rio-Niter√≥i de acordo com o ano, por dia&quot;) +
  scale_x_date(date_breaks = &#39;1 month&#39;) +
  theme(legend.position = c(0.85, 0.1))</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-10-1.png" width="1152" /></p>
<p>Agora ficou evidente que a partir do ano de 2015 o n√∫mero de acidentes na Ponte Rio-Niter√≥i foi reduzido e manteve-se abaixo do n√∫mero m√©dio registrado nos anos anteriores.</p>
</div>
</div>
<div id="mas-o-que-aconteceu-em-2015" class="section level3">
<h3>Mas o que aconteceu em 2015?</h3>
<p>J√° que em 2015 houve este comportamento t√£o brusco resolvi procurar no Google por not√≠cias de acidentes na Ponte Rio-Niter√≥i neste per√≠odo e em uma breve pesquisa me deparei com a seguinte not√≠cia:</p>
<center>
<img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi/freq-acidente-ponte-rio-niteroi_files/noticia.png" />
</center>
<p>Essa afirma√ß√£o na manchete, que houve ‚Äúredu√ß√£o de quase 60% ap√≥s o videomonitoramento‚Äù √© intrigante e seria interessante conseguir achar algum resultado concordante.</p>
<p>Na not√≠cia " <a href="http://g1.globo.com/rio-de-janeiro/noticia/2015/11/monitoramento-com-cameras-ajuda-reduzir-acidentes-na-ponte-rio-niteroi.html">Monitoramento com c√¢meras ajuda a reduzir acidentes na Ponte Rio-Niter√≥i</a> " um inspetor da PRF faz a seguinte declara√ß√£o:</p>
<blockquote>
<p>‚Äú(‚Ä¶) Ajuda a amplificar o nosso poder de visualiza√ß√£o das infra√ß√µes que s√£o cometidas. Concequentemente reduz o numero de acidentes por conta da presen√ßa quase que em todo trecho, ao mesmo tempo, da PRF‚Äù</p>
</blockquote>
<!-- [Prefeitura de Niter√≥i instalar√° 12 c√¢meras na Ponte Rio-Niter√≥i](http://g1.globo.com/rio-de-janeiro/noticia/2015/10/prefeitura-de-niteroi-instalara-12-cameras-na-ponte-rio-niteroi.html) -->
</div>
<div id="n√∫mero-de-acidentes-por-m√™s-nos-√∫ltimos-10-anos-agrupados" class="section level3">
<h3>N√∫mero de acidentes por m√™s nos √∫ltimos 10 anos agrupados</h3>
<p>Como o gr√°fico ficou carregado ao levar em considera√ß√£o o n√∫mero de acidentes ao longo dos dias, a mesma informa√ß√£o ser√° agrupada por m√™s.</p>
<p>Vejamos visualmente os dados fornecidos pela PRF e o dia em que a not√≠cia foi atualizada:</p>
<pre class="text"><code>g2 &lt;- 
  base %&gt;%
  map_df(~.x
         %&gt;% select(id, data_inversa, causa_acidente, tipo_acidente) %&gt;%
           mutate_if(is.character,~ dmy(.x) )) %&gt;%
  group_by(month=floor_date(data_inversa, &quot;1 month&quot;)) %&gt;% 
  summarise(n = n()) %&gt;%  
  ggplot(aes(x=month, y=n)) +
  geom_line() +
  geom_point() +
  theme_bw() + 
  labs(y= &#39;N√∫mero de acidentes&#39;,
       x = &#39;Data&#39;,
       title= &#39;N√∫mero de acidentes na Ponte Rio-Niter√≥i&#39;, 
       subtitle = &quot;Por m√™s&quot;, 
       caption = &quot;Fonte dos dados: \nhttp://glo.bo/210j8gF \nhttps://www.prf.gov.br/portal/dados-abertos/acidentes\nhttps://gomesfellipe.github.io/&quot;) +
  scale_y_continuous(breaks=seq(0,150,25))

g2 +
  geom_segment(x = as.Date(&quot;2015-11-13&quot;), xend = as.Date(&quot;2015-11-13&quot;),
               y=0,yend=100, linetype=&quot;dashed&quot;, col=&quot;red&quot;) +
  geom_text(aes(y = 100, x = as.Date(&quot;2015-11-13&quot;),
                label = &quot;G1 em 17/11/2015 :\n\&quot;Monitoramento com c√¢meras\n ajuda a reduzir acidentes\n  na Ponte Rio-Niter√≥i\&quot;&quot;) ,hjust=-0.1) +
  scale_x_date(date_breaks = &#39;6 month&#39;) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-11-1.png" width="1152" /></p>
<p>De fato, visualmente √© poss√≠vel notar uma aparente diminui√ß√£o no ano do qual a not√≠cia foi divulgada mas ser√° que √© poss√≠vel identificar algum tipo de tend√™ncia a partir destes dados?</p>
<div id="n√∫mero-de-acidentes-por-m√™s-nos-√∫ltimos-10-anos-agrupados-por-ano" class="section level4">
<h4>N√∫mero de acidentes por m√™s nos √∫ltimos 10 anos agrupados por ano</h4>
<p>Vejamos a seguir o gr√°fico separado por cada ano para comparar o comportamento dos dados:</p>
<pre class="text"><code>g2 +
  # geom_smooth(method = &quot;lm&quot;, se = F, aes(col = &quot;blue&quot;)) +
  facet_wrap( ~ year(month), scales = &quot;free_x&quot;) +
  scale_colour_manual(name=&quot; &quot;, values=c(&quot;blue&quot;),labels=c(&quot;Regress√£o Linear&quot;)) + 
  theme(legend.position = c(0.88,0.20))</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-12-1.png" width="1152" /></p>
<p>Neste gr√°fico vemos que dos anos de 2008 √† 2014 os dados se comportam de forma parecida em torno de 100 √† 75 acidentes. Por√©m em 2015 o n√∫mero de acidentes termina por volta de 25 e este n√∫mero se mant√©m ao longo dos anos.</p>
</div>
</div>
<div id="ajuste-do-modelo-descritivo" class="section level3">
<h3>Ajuste do modelo descritivo</h3>
<p>Para entender melhor essa tend√™ncia apresentada em 2015 ser√° ajustado modelo de regress√£o linear simples conforme metodologia apresentada em <span class="citation">@tend</span>, que utilizam o tempo como vari√°vel explicativa e entender qual foi a varia√ß√£o do n√∫mero de acidentes m√©dios por m√™s.</p>
<p>O m√©todo utilizado para avaliar a tend√™ncia consiste em um ajuste de tend√™ncia em fun√ß√£o do tempo (<span class="math inline">\(t\)</span>) com um modelo de regress√£o linear de maneira que:</p>
<p><span class="math display">\[
Y_{i} = \beta_0 + \beta_1 t_i + \epsilon_{i}  
\]</span></p>
<p>em que:</p>
<ul>
<li><span class="math inline">\(Y_i\)</span>: Tend√™ncia para o n√∫mero de acidentes m√©dios por m√™s no instante <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(t_i\)</span>: i-√©simo instante de tempo</li>
<li><span class="math inline">\(\beta_0\)</span>: Intercepto do modelo (valor de <span class="math inline">\(Y_i\)</span> quando <span class="math inline">\(t_i=0\)</span>)</li>
<li><span class="math inline">\(\beta_1\)</span>: Inclina√ß√£o da reta ajustada (efeito da vari√°vel <span class="math inline">\(t_i\)</span>)</li>
<li><span class="math inline">\(\epsilon_i \sim N(0,\sigma^2)\)</span> onde <span class="math inline">\(\sigma^2\)</span> √© constante</li>
</ul>
<p>Este modelo de regress√£o linear mede a varia√ß√£o da tend√™ncia para diferentes valores de intervalo de tempo na faixa de interesse. O ajuste √© interpretado de acordo com a inclina√ß√£o da reta formada pelos diferentes valores de refer√™ncia em rela√ß√£o a respectiva tend√™ncia pode n√£o ser o melhor m√©todo para a previs√£o mas pode ajudar a entender o comportamento da s√©rie como an√°lise descritiva.</p>
<pre class="text"><code>to_lm &lt;- 
  base %&gt;%
  map_df(~.x%&gt;% select(id, data_inversa, causa_acidente, tipo_acidente)%&gt;%
           mutate_if(is.character,~ dmy(.x) )) %&gt;% 
  group_by(data_inversa=floor_date(data_inversa, &quot;1 month&quot;)) %&gt;% 
  summarise(n = n()) %&gt;% 
  filter(data_inversa &gt;= &quot;2015-01-01&quot; &amp; data_inversa &lt; &quot;2016-01-01&quot;)

y   &lt;- to_lm %$% n %&gt;%  ts(start = c(2015, 01, 01))

g2 +
  geom_smooth(method=&#39;lm&#39;,se=F,aes(col=I(&quot;darkred&quot;))) +
  geom_smooth(data=to_lm, aes(x=data_inversa, y=n,col=I(&quot;blue&quot;)), method = &quot;lm&quot;,se=F) +
  scale_colour_manual(name=NULL, values=c(&quot;red&quot;,&quot;blue&quot;,&quot;darkred&quot;),labels=c(
    &quot;Regress√£o Linear para 2015&quot;,
    &quot;Regress√£o Linear para todo per√≠odo&quot;,
    &quot;Not√≠cia&quot;
  )) + 
  theme(legend.position = c(0.2,0.18)) +
  geom_segment(x = as.Date(&quot;2015-11-13&quot;), xend = as.Date(&quot;2015-11-13&quot;),
               y=0, yend=100, linetype=&quot;dashed&quot;, aes(col=I(&quot;red&quot;))) +
  geom_text(aes(y = 100, x = as.Date(&quot;2015-11-13&quot;),
                label = &quot;G1 em 17/11/2015 :\n\&quot;Monitoramento com c√¢meras\n ajuda a reduzir acidentes\n  na Ponte Rio-Niter√≥i\&quot; &quot;) ,hjust=-0.1) +
  scale_x_date(date_breaks = &#39;6 month&#39;) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1), 
        legend.background = element_rect(fill=alpha(&#39;lightgrey&#39;, 0.2)))</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-13-1.png" width="1152" /></p>
<p>Antes de conferir os resultados do ajuste do modelo, veja o resultado para o teste de sequ√™ncias (Wald-Wolfowitz) que tem como hip√≥tese alternativa <span class="math inline">\(H_1:\)</span> <em>existe tend√™ncia na s√©rie</em></p>
<pre class="text"><code>randtests::runs.test(y)</code></pre>
<pre><code>## 
##  Runs Test
## 
## data:  y
## statistic = -3.0277, runs = 2, n1 = 6, n2 = 6, n = 12, p-value =
## 0.002465
## alternative hypothesis: nonrandomness</code></pre>
<p>Ao n√≠vel de signific√¢ncia de <span class="math inline">\(\alpha :\)</span> 0.05 rejeita-se a hip√≥tese nula de que esta s√©rie n√£o apresenta tend√™ncia no per√≠odo selecionado (2015).</p>
<p>Outra hip√≥tese importante para conferir √© sobre a normalidade da vari√°vel resposta, a seguir ser√° aplicado o teste de Shapiro-wilk que tem como hip√≥tese nula de que os dados possuem distribui√ß√£o normal:</p>
<pre class="text"><code>shapiro.test(y)</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  y
## W = 0.9702, p-value = 0.9129</code></pre>
<p>De acordo com este teste, n√£o existem evid√™ncias estat√≠sticas para se rejeitar a hip√≥tese da normalidade dos dados, portanto, para uma an√°lise mais detalhada o modelo ajustado no per√≠odo de 2015 pode ser obtido da seguinte maneira:</p>
<pre class="text"><code>fit &lt;- tslm(y ~ trend, data = y) </code></pre>
<p>Com o modelo est√° salvo no objeto <code>fit</code>, sua informa√ß√£o ser√° incrementada no gr√°fico da regress√£o de 2015 para facilitar o entendimento dos resultados:</p>
<pre class="text"><code>g1 &lt;- 
  base %&gt;%
  map_df(~.x%&gt;% select(id, data_inversa, causa_acidente, tipo_acidente)) %&gt;% 
  group_by(data_inversa=floor_date(data_inversa, &quot;1 month&quot;)) %&gt;% 
  dplyr::summarise(n=n()) %&gt;%
  ggplot(aes(x=data_inversa, y=n)) +
  geom_line() +
  theme_bw() +
  labs(y= &#39;N√∫mero de acidentes&#39;,
       x = &#39;Data&#39;,
       subtitle = &quot;Por dia&quot;, 
       title= &#39;N√∫mero de acidentes na Ponte Rio-Niter√≥i&#39;, 
       caption = &quot;Fonte dos dados:\nhttp://glo.bo/210j8gF\nhttps://www.prf.gov.br/portal/dados-abertos/acidentes\nhttps://gomesfellipe.github.io/&quot;) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(breaks=seq(0,100,25)) + 
  annotate(&quot;text&quot;, x=as.Date(&quot;2015-08-13&quot;), y = 75,
           label = paste(&quot;Modelo te√≥rico: Yi = Œ≤^0 + Œ≤1 ti + ei:\nEstimador do N¬∫ de acidentes =&quot;,round(fit$coefficients[1],2),round(fit$coefficients[2],2),&quot;*  M√™s&quot;))

t &lt;- 
  fit %&gt;%
  tidy() %&gt;% 
  bind_cols(r2=c(glance(fit)[[1]] %&gt;% round(4),&quot;-&quot;),
            confint_tidy(fit)) %&gt;% 
  mutate_if(is.numeric,~ round(.x,4)) %&gt;% 
  mutate(term = c(&quot;Intercepto&quot;, &quot;Tend√™ncia&quot;)) %&gt;% 
  set_names(c(&quot;Coef.&quot;, &quot;Estimativa&quot;, &quot;Erro Padr√£o&quot;, &quot;Estat√≠stica&quot;, &quot;Valor P&quot;, &quot;R¬≤&quot;,&quot;Lim. Inf.&quot;, &quot;Lim. Sup.&quot;)) 

# Funcao auxiliar para colorir a celula
g &lt;- tableGrob(t,rows = NULL)
find_cell &lt;- function(table, row, col, name=&quot;core-fg&quot;){
  # Fonte: 
  # https://cran.r-project.org/web/packages/gridExtra/vignettes/tableGrob.html
  l &lt;- table$layout
  which(l$t==row &amp; l$l==col &amp; l$name==name)
}

ind &lt;- find_cell(g, 3, 2, &quot;core-bg&quot;)
g$grobs[ind][[1]][[&quot;gp&quot;]] &lt;- gpar(fill=&quot;darkolivegreen1&quot;, col = &quot;darkolivegreen4&quot;, lwd=5)

g1 +
  scale_x_date(date_breaks = &#39;1 months&#39;,
               limits = as.Date(c(&quot;2015-01-01&quot;,&quot;2015-12-01&quot;)),
               expand = c(0.01,0.01)) +
  geom_smooth(data=to_lm, aes(x=data_inversa, y=n), method = &quot;lm&quot;,col=&quot;red&quot;,se=F)+
  annotation_custom(grob = g  , ymax=220,xmin=as.Date(&quot;2015-04-01&quot;))</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-17-1.png" width="1152" /></p>
<p>Nota-se que o coeficiente estimado para determinar a varia√ß√£o do n√∫mero de acidentes ao aumentar a vari√°vel explicativa <code>trend</code> em uma unidade se apresenta de maneira significante, isto quer dizer que parece existir rela√ß√£o linear estatisticamente significante entre o m√™s da observa√ß√£o e a vari√°vel resposta.</p>
<p>Al√©m disso √© poss√≠vel notar que para cada aumento de uma unidade da <code>tred</code> (ou seja, no decorrer de 1 m√™s), o valor esperado no n√∫mero de acidentes observados naquele m√™s diminui em aproximadamente 4.7972.</p>
<p>Como -4.7972 x 12 = -57.5664 ent√£o o n√∫mero de acidentes esperados decresce para aproximadamente 57.57% do valor original conforme a vari√°vel <code>tred</code> aumentou em 12 unidades (em 1 ano).</p>
<p>Veja o resultado para o teste de Shapiro - wilk para avaliar a hip√≥tese de normalidade dos res√≠duos do modelo, os res√≠duos padronizados(quociente entre o res√≠duo e a estimativa do seu desvio padr√£o) e os res√≠duos <a href="https://en.wikipedia.org/wiki/Studentized_residual"><em>studentizados</em></a>, que levam em conta o <span class="math inline">\(h\)</span> (medida de alavancagem ou " <a href="https://en.wikipedia.org/wiki/Leverage_(statistics)">leverage</a>") em sua medida:</p>
<pre class="text"><code>bind_cols(
  residuals = fit$residuals,
  rstandard = rstandard(fit),
  rstudent = rstudent(fit)
) %&gt;%
  map_dbl(~shapiro.test(.x)$p.value)  %&gt;%
  tidy() %&gt;% 
  set_names(c(&quot;Medida&quot;, &quot;Valor p&quot;)) %&gt;% 
  kable(escape = F) %&gt;%
  kable_styling(&quot;hover&quot;,full_width = F)</code></pre>
<table class="table table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Medida
</th>
<th style="text-align:right;">
Valor p
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
residuals
</td>
<td style="text-align:right;">
0.1166788
</td>
</tr>
<tr>
<td style="text-align:left;">
rstandard
</td>
<td style="text-align:right;">
0.1801799
</td>
</tr>
<tr>
<td style="text-align:left;">
rstudent
</td>
<td style="text-align:right;">
0.0058696
</td>
</tr>
</tbody>
</table>
<p>N√£o existem evid√™ncias para rejeitar a hip√≥tese de que os res√≠duos do modelo e os res√≠duos padronizados seguem distribui√ß√£o normal. J√° para os res√≠duos <em>studentizados</em> rejeita-se a hip√≥tese de normalidade e como o valor de R¬≤ n√£o foi muito alto (66.51%), indicando que a reta ajustada explica parcialmente a varia√ß√£o dos dados ent√£o pode ser interessante estudar com mais detalhes qual foi a influ√™ncia do n√∫mero de acidentes em cada m√™s no ajuste do modelo calculando as medias de influ√™ncia para cada observa√ß√£o do modelo.</p>
<p>Uma observa√ß√£o √© considerada influente caso sua exclus√£o no ajuste do modelo de regress√£o cause uma mudan√ßa substancial na an√°lise de regress√£o e para identificar essas observa√ß√µes ser√£o utilizadas as mesmas medidas utilizadas no post que fiz sobre <a href="https://gomesfellipe.github.io/post/2017-12-24-diagnostico-de-modelo/diagnostico-de-modelos/">Pacotes do R para avaliar o ajuste de modelos</a>.</p>
<p>De maneira visual e com medidas de influ√™ncia do valor observado para cada m√™s no ajuste do modelo:</p>
<pre class="text"><code>t1  &lt;- influence.measures(fit) %$%
  infmat %&gt;% 
  as_tibble() %&gt;% 
  map_df(~.x %&gt;% round(4)) %&gt;% 
  mutate(mes = 1:12) %&gt;% 
  select(mes,everything()) %&gt;% 
  set_names(c(&quot;M√™s&quot;,&quot;DF Œ≤1&quot;,&quot;DF Œ≤2&quot;,&quot;   DFFit&quot;,&quot;    CovRatio&quot;,&quot; D.Cook&quot;,&quot;   h&quot;))

g   &lt;- tableGrob(t1,rows = NULL)

ind &lt;- map_dbl(1:7, ~find_cell(g, 6, .x, &quot;core-bg&quot;))  

walk(ind, function(i) g$grobs[i][[1]][[&quot;gp&quot;]] &lt;&lt;-
       gpar(fill = &quot;darkolivegreen1&quot;, col = &quot;darkolivegreen1&quot;, lwd = 5)
)

# g2  &lt;-
#   ggplot2::autoplot(fit, print=F,suppressMessages=T) +
#   theme_bw()
# 
# gn  &lt;- arrangeGrob(g2[[1]], g2[[2]], g2[[3]], g2[[4]], g2[[5]], g2[[6]])
# 
# grid.arrange(gn, g, ncol=2)

grid.arrange(g)</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-19-1.png" width="1152" /></p>
<p>A tabela apresenta um resumo das medidas de inflencia de cada vari√°vel, segundo <span class="citation">@gauss</span>:</p>
<ul>
<li><strong>DF Beta</strong>: Altera√ß√£o no vetor estimado Œ≤ ao se retirar o i-√©simo ponto da an√°lise<br />
</li>
<li><strong>DF Fit</strong>: Altera√ß√£o provocada no valor ajustado pela retirada da observa√ß√£o i<br />
</li>
<li><strong>CovRatio</strong>: Expressa o rela√ß√£o de covari√¢ncia<br />
</li>
<li><strong>D.Cook</strong>: Medida de afastamento das estimativas ao retirar i e tamb√©m considera o res√≠duo estudentizado internamente<br />
</li>
<li><strong>h</strong>: Elementos da diagonal da matriz H</li>
</ul>
<p>√â poss√≠vel notar que no m√™s 5 (Maio) foi o m√™s que provocaria a maior altera√ß√£o provocada no valor ajustado ap√≥s sua retirada. Outra medida importante √© a <a href="https://pt.wikipedia.org/wiki/Dist√¢ncia_de_Cook">Dist√¢ncia de Cook</a> que indica o qu√£o at√≠pica a observa√ß√£o <span class="math inline">\(i\)</span> se apresenta no ajuste do modelo combinando os res√≠duos estudentizados e as medidas de alavancagem possibilitando examinar observa√ß√µes que influenciam bastante as estimativas dos par√¢metros.</p>
<p>Em geral, se <span class="math inline">\(D_i&gt;1\)</span> o ponto √© excessivamente influente mas como no geral as observa√ß√µes apresentaram valor muito inferior a 1 ent√£o a elimina√ß√£o de qualquer uma dessas vari√°veis n√£o vai alterar substancialmente as estimativas dos par√¢metros por√©m n√≥s podemos <strong>examinar</strong> quaisquer observa√ß√µes cujo <span class="math inline">\(D_i\)</span> seja muito maior em rela√ß√£o aos demais valores estimados para <span class="math inline">\(D_i\)</span> com mais cuidado para entender qual foi foi sua influ√™ncia no ajuste do modelo:</p>
<pre class="text"><code># Como a funcao augment do broom nao parece mais suportar o modelo ajustado por tslm, vamos ajustar na m√£o o modelo com a tendencia para criar o gr√°fico:
to_lm &lt;- to_lm %&gt;% mutate(trend = 1:nrow(.))
fit_lm &lt;- lm(y ~ trend, data = to_lm) 


fit_lm %&gt;% 
  broom::augment() %&gt;% 
  mutate(col = if_else(.resid==max(.resid), T, F))%&gt;%
  mutate(trend = factor(months(base[[1]]$data_inversa) %&gt;% unique,
                        levels = months(base[[1]]$data_inversa) %&gt;% unique) ) %&gt;% 
  ggplot(aes(x=trend,y=.resid,col=col,label=trend)) +
  geom_point() +
  geom_label(vjust = -0.25) +
  theme_bw() +
  scale_y_continuous(limits=c(-20,35),breaks = seq(-20,35,5)) +
  scale_color_manual(values=c(&quot;black&quot;, &quot;red&quot;)) +
  geom_hline(yintercept = 0,linetype=&quot;dashed&quot;,col=&quot;red&quot;) +
  theme(legend.position=&quot;none&quot;) +
  labs(y=&quot;Res√≠duos&quot;, x=&quot;Valores ajustados&quot;, title=&quot;Res√≠duos vs Ajuste&quot;)</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-20-1.png" width="1152" /></p>
<p>De fato o valor ajustado para o m√™s de maior √© muito diferente do valor real observado, o que implica que houve um comportamento at√≠pico que pode ser confirmado ao voltar no gr√°fico da s√©rie temporal e constatar um comportamento diferente (o n√∫mero de acidente aumentou em rela√ß√£o ao anterior) e fugindo da tend√™ncia geral dos dados.</p>
</div>
</div>
</div>
<div id="pr√≥ximos-passos" class="section level1">
<h1>Pr√≥ximos passos <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/Toicon-icon-lines-and-angles-think.svg/2000px-Toicon-icon-lines-and-angles-think.svg.png" style="width:5.0%" /></h1>
<p>Uma das outras id√©ias que tive para a analisar estes dados conforme avan√ßava com o estudo foi de cruza-los com o fluxo de carros na ponte para ter uma ideia de propor√ß√£o mas essa ideia fica como sugest√£o para quem tamb√©m tiver curiosidade sobre este assunto pois a intens√£o deste post √© fazer uma an√°lise de car√°ter introdut√≥rio para mostrar como √© poss√≠vel obter insights atrav√©s dos dados com o uso da Estat√≠stica.</p>
<p>Al√©m disso gostaria de incentivar todo o pessoal que gosta de dados e tiverem d√∫vidas sobre quest√µes da vida, o universo e tudo mais a procurarem sempre por respostas mas tomar muito cuidado ao tirar conclus√µes! Este, por exemplo, foi um estudo de car√°ter introdut√≥rio e descritivo e obviamente existe uma por√ß√£o de outras maneiras de estudar estes dados e como estamos diante de tanta abund√¢ncia, basta uma pergunta que a investiga√ß√£o pode ser iniciada e se sempre temos a resposta para tudo nosso c√©rebro nunca entra ‚Äúno modo de busca‚Äù. √â importante sempre questionar respostas!</p>
</div>
<div id="refer√™ncias" class="section level1">
<h1>Refer√™ncias</h1>
<p>Not√≠cia do G1: <a href="http://g1.globo.com/rio-de-janeiro/noticia/2015/11/monitoramento-com-cameras-ajuda-reduzir-acidentes-na-ponte-rio-niteroi.html">Monitoramento com c√¢meras ajuda a reduzir acidentes na Ponte Rio-Niter√≥i</a></p>
</div>

        <p><strong>Leia o post completo em:</strong> <a href="https://gomesfellipe.github.io/post/2018-09-29-freq-acidente-ponte-rio-niteroi/freq-acidente-ponte-rio-niteroi/">Com que frequ√™ncia ocorrem acidentes na ponte Rio-Niter√≥i?</a></p>
        <p><em>Este post foi originalmente publicado em <a href="https://gomesfellipe.github.io/">Fellipe Gomes - Data Science Blog</a></em></p>
      ]]></content:encoded>
      <category>Analise Explorat√≥ria</category>
      <category>Data mining</category>
      <category>Mapas</category>
      <category>Pr√°tica</category>
      <category>R</category>
      <category>Regress√£o</category>
      <category>Tidyverse</category>
      <category>S√©ries Temporais</category>
      <category domain="tag">Tidyverse</category>
      <category domain="tag">Tabelas</category>
      <category domain="tag">S√©ries Temporais</category>
      <category domain="tag">RStudio</category>
      <category domain="tag">R Markdown</category>
      <category domain="tag">R</category>
      <category domain="tag">Pr√°tica</category>
      <category domain="tag">Mapa</category>
      <category domain="tag">ponte rio niteroi</category>
      <category domain="tag">acidentes</category>
      <category domain="tag">transito</category>
      <category domain="tag">Estatistica</category>
      <category domain="tag">Dplyr</category>
      <category domain="tag">gomesfellipe</category>
      <category domain="tag">leaflet</category>
    </item>
    <item>
      <title>Manipulando dados com dplyr</title>
      <link>https://gomesfellipe.github.io/post/2017-12-07-manipulando-dados-com-dplyr/manipulando-dados-com-dplyr/</link>
      <pubDate>Thu, 07 Dec 2017 00:00:00 +0000</pubDate>
      <author>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</author>
      <guid>https://gomesfellipe.github.io/post/2017-12-07-manipulando-dados-com-dplyr/manipulando-dados-com-dplyr/</guid>
      <description>Manipular bases de dados nunca foi t√£o simples</description>
      <content:encoded>&lt;![CDATA[
        
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<div id="o-pacote-dplyr" class="section level1">
<h1>o pacote <code>dplyr</code>:</h1>
<p>A an√°lise explorat√≥ria dos dados √© uma tarefa de bastante relev√¢ncia para entendermos a natureza dos dados e o tempo de an√°lise gastro √© muito precioso. √â necess√°ria bastante curiosidade e criatividade para fazer uma boa an√°lise explorat√≥ria dos dados pois √© dif√≠cil receber aqueles dados bonitinhos igual aos nativos do banco de dados do <strong>R</strong>.</p>
<p>Existem diversos pacotes para as mais variadas necessidades dos cientistas de dados (ou qualquer pessoa que precise fazer alguma an√°lise ou programa√ß√£o estat√≠stica) dispon√≠veis no <a href="https://cran.r-project.org/">CRAN</a> e hoje quero registrar aqui algumas das funcionalidades do pacote <a href="https://cran.r-project.org/package=dplyr">dplyr</a> que s√£o muito √∫teis.</p>
<p>√â um dos pacotes mais poderosos e populares do R, desenvolvido por Hadley Wickham, faz a explora√ß√£o de dados e permite a manipula√ß√£o de dados de forma f√°cil e r√°pida no R.</p>
<p>Segundo sua descri√ß√£o no <a href="https://cran.r-project.org/">CRAN</a>, o <a href="https://cran.r-project.org/package=dplyr">dplyr</a> √© definido como uma ferramenta r√°pida e consistente para trabalhar com data.frames como objetos, tanto na mem√≥ria quanto fora da mem√≥ria. Vamos conferir ent√£o o que de t√£o especial tem nesse pacote.</p>
<div id="operador-pipe" class="section level2">
<h2>Operador pipe: %&gt;%</h2>
<p>O operador <code>%&gt;%</code> √© uma op√ß√£o incrivelmente √∫til para a manipula√ß√£o dos dados, funcionando com uma l√≥gica diferente da nativa do <strong>R</strong>, que executa fun√ß√µes no formato <code>f(x)</code>, o pipe permite que fa√ßamos opera√ß√µes no formato <code>x %&gt;% f()</code> que basicamente funciona da maneira como raciocinamos: ‚ÄúPega esse objeto e executa isso, depois isso, depois isso‚Ä¶‚Äù
Realiza m√∫ltiplas a√ß√µes sem guardar os passos intermedi√°rios.</p>
<!-- Vejamos um resumo dos dados: -->
<p>Vamos come√ßar carregando o pacote:</p>
<pre class="r"><code># Carregando o pacote dplyr
suppressMessages(library(dplyr))</code></pre>
</div>
<div id="selecionando-n-linhas-aleatorias-fun√ß√£o-sample_n" class="section level2">
<h2>Selecionando n linhas aleatorias: fun√ß√£o <code>sample_n()</code></h2>
<pre class="r"><code># Selecionando 5 linhas aleatoriamente
df%&gt;%
  sample_n(5)</code></pre>
</div>
<div id="removendo-linhas-duplicadas-fun√ß√£o-distinct" class="section level2">
<h2>Removendo linhas duplicadas: fun√ß√£o <code>distinct()</code></h2>
<div id="baseado-em-todas-as-vari√°veis" class="section level3">
<h3>Baseado em todas as vari√°veis</h3>
<pre class="r"><code># excluindo linhas iguais
df%&gt;%
  distinct()</code></pre>
</div>
<div id="baseado-em-uma-vari√°vel" class="section level3">
<h3>Baseado em uma vari√°vel</h3>
<pre class="r"><code># excluindo linhas que possuem Datas iguais
df%&gt;%
  distinct(Datas)</code></pre>
</div>
<div id="baseado-em-mais-de-uma-vari√°vel" class="section level3">
<h3>Baseado em mais de uma vari√°vel</h3>
<pre class="r"><code># excluindo linhas que possuem ano e consumo iguais
df%&gt;%
  distinct(ano, consumo)</code></pre>
</div>
</div>
<div id="selecionando-colunas-vari√°veis-fun√ß√£o-select" class="section level2">
<h2>Selecionando colunas (vari√°veis): fun√ß√£o <code>select()</code></h2>
<pre class="r"><code># Selecionando a variavel ano e  todas as vari√°veis de sucesso at√© tonalidade na df
df%&gt;%
  select(ano, sucesso:tonalidade)

# Selecionando todas as variaveis com exce√ß√£o de ano e id
df%&gt;%
  select(-c(ano,id))


# Selecionando todas as variaveis cujo nome inicia com e
df%&gt;%
  select(starts_with(&quot;a&quot;))</code></pre>
<div id="podem-ser-√∫teis-tamb√©m-ends_with-e-contains." class="section level4">
<h4>Podem ser √∫teis tamb√©m <code>ends_with()</code> e <code>contains()</code>.</h4>
</div>
</div>
<div id="reordenando-as-as-colunas-das-vari√°veis-fun√ß√£o-select" class="section level2">
<h2>Reordenando as as colunas das vari√°veis: fun√ß√£o <code>select()</code></h2>
<pre class="r"><code># reorganiza o data frame, iniciando com a vari√°vel Datas e depois as demais
df%&gt;%
  select(Datas,everything())</code></pre>
</div>
<div id="renomeando-vari√°veis-fun√ß√£o-rename" class="section level2">
<h2>Renomeando vari√°veis: fun√ß√£o <code>rename()</code></h2>
<pre class="r"><code># Renomeando a vari√°vel Datas para micro
df%&gt;%
  rename(Dia = Datas)</code></pre>
</div>
<div id="selecionando-um-subconjunto-de-linhas-que-satisfazem-uma-ou-mais-condi√ß√µes-fun√ß√£o-filter" class="section level2">
<h2>Selecionando um subconjunto de linhas que satisfazem uma ou mais condi√ß√µes: fun√ß√£o <code>filter()</code></h2>
<pre class="r"><code># Selecionando somente os indiv√≠duos do sexo masculino
df%&gt;%
  filter( sexo == &quot;Masculino&quot;)


# Selecionando somente os indiv√≠duos do sexo masculino e branco
df%&gt;%
  filter( sexo == &quot;Masculino&quot; &amp; tonalidade == &quot;Branco&quot;)


# Selecionando somente os indiv√≠duos com consumo de 1 a 3 anos e 4 a 7 anos
df%&gt;%
  filter( consumo %in% c(&quot;1 a 3&quot;,&quot;4 a 7&quot;))


# Selecionando indiv√≠duos que ou s√£o homens solteiros ou s√£o mulheres casadas
df%&gt;%
  filter( (estado_civil==&quot;Solteiro&quot; &amp; sexo ==&quot;Masculino&quot;) | (estado_civil==&quot;Casado&quot; &amp; sexo ==&quot;Feminino&quot;) )</code></pre>
</div>
<div id="ordenando-seus-data-frames-fun√ß√£o-arrange" class="section level2">
<h2>Ordenando seus data frames: fun√ß√£o <code>arrange()</code></h2>
<pre class="r"><code># Ordenando os dados pela vari√°vel ano de forma crescente
df%&gt;%
  arrange( ano )

# Ordenando os dados pela vari√°vel ano e consumo
df%&gt;%
  arrange( ano ,consumo)

# Ordenando os dados pela vari√°vel ano de forma decrescente
df%&gt;%
  arrange( desc(ano) )</code></pre>
</div>
<div id="criando-uma-nova-vari√°vel-fun√ß√£o-mutate-e-transmute" class="section level2">
<h2>Criando uma nova vari√°vel: fun√ß√£o <code>mutate()</code> e <code>transmute()</code></h2>
<pre class="r"><code># Criando a vari√°vel ano ao quadrado
df%&gt;%
  mutate( ano2 = ano**2 )

# Criando a vari√°vel Dia e a vari√°vel Mes
df%&gt;%
  mutate( Dia = substring(Datas,1,2), Mes = substring(mensalidade,1,1) )

# Se voc√™ quiser somente manter as vari√°veis criadas
df18 = transmute(mensalidade = substring(Datas,1,2), Mes = substring(mensalidade,1,1) )</code></pre>
</div>
<div id="resumindo-vari√°veis-fun√ß√£o-summarize" class="section level2">
<h2>Resumindo vari√°veis: fun√ß√£o <code>summarize()</code></h2>
<pre class="r"><code># Calculando a media e a mediana da vari√°vel ano
df%&gt;%
  summarise(  media.ano = mean(ano), mediana.ano = median(ano))</code></pre>
</div>
<div id="resumindo-vari√°veis-por-grupo-fun√ß√£o-group_by-e-summarize" class="section level2">
<h2>Resumindo vari√°veis por grupo: fun√ß√£o <code>group_by()</code> e <code>summarize()</code></h2>
<pre class="r"><code># Calculando a media da vari√°vel ano para as combina√ß√µes entre sexo, consumo e estado civil e a frequencia de indiv√≠duos em cada combina√ß√£o
df%&gt;%
  group_by(sexo, consumo, estado_civil)%&gt;%
  summarise(media.ano = mean(ano),frequencia=n())


# Calculando a media da vari√°vel ano para as combina√ß√µes entre ano legal, consumo e estado civil e a frequencia de indiv√≠duos em cada combina√ß√£o
df%&gt;%
  group_by(id, consumo, estado_civil)%&gt;%
  summarise(media.ano = mean(ano),frequencia=n())</code></pre>
</div>
<div id="operador-pipe-1" class="section level2">
<h2>Operador pipe: %&gt;%</h2>
<p>Portanto, o operador <code>%&gt;%</code> realiza m√∫ltiplas a√ß√µes sem guardar os passos intermedi√°rios. Mais alguns exemplos:</p>
<pre class="r"><code># Selecionando as vari√°veis ano e id
df %&gt;%
  select(ano,id)


df %&gt;% select(-estado_civil) %&gt;%
  filter(sexo==&quot;Masculino&quot;) %&gt;%
  group_by(tonalidade,consumo) %&gt;%
  summarise(maximo=max(ano),media=mean(ano))</code></pre>
</div>
<div id="aplicando-fun√ß√µes-em-linhas" class="section level2">
<h2>Aplicando fun√ß√µes em linhas</h2>
<pre class="r"><code>df%&gt;%
  mutate(ano2 = ano**2 )%&gt;%
  rowwise() %&gt;% mutate(Max= max(ano:ano2)) %&gt;%
  select(ano,ano2,Max)</code></pre>
</div>
</div>
<div id="fazendo-a-uni√£o-de-banco-de-dados-distintos" class="section level1">
<h1>Fazendo a uni√£o de banco de dados distintos</h1>
<div id="combinando-duas-bases-de-dados" class="section level2">
<h2>Combinando duas bases de dados</h2>
<p>O pacote dplyr possui um conjunto de fun√ß√µes que nos auxiliam a combinar dos data frames do nosso interesse.</p>
<div id="inner_join" class="section level3">
<h3>inner_join</h3>
<pre class="r"><code># Fun√ß√£o inner_join: Combina as duas bases incluindo todas as vari√°veis de ambas as bases e todas as linhas comuns as duas bases
inner_join(df1,df2,by=&quot;ID&quot;)

inner_join(df1,df3,by=c(&quot;ID&quot;=&quot;Identificacao&quot;))</code></pre>
</div>
<div id="left_join" class="section level3">
<h3>left_join</h3>
<pre class="r"><code># Fun√ß√£o left_join: Combina as duas bases incluindo todas as vari√°veis de ambas as bases e todas as linhas da base a esquerda
left_join(df1,df2,by=&quot;ID&quot;)</code></pre>
</div>
<div id="right_join" class="section level3">
<h3>right_join</h3>
<pre class="r"><code># Fun√ß√£o right_join: Combina as duas bases incluindo todas as vari√°veis de ambas as bases e todas as linhas da base a direita
right_join(df1,df2,by=&quot;ID&quot;)</code></pre>
</div>
<div id="full_join" class="section level3">
<h3>full_join</h3>
<pre class="r"><code># Fun√ß√£o full_join: Combina as duas bases incluindo todas as vari√°veis de ambas as bases e todas as linhas de ambas as bases
full_join(df1,df2,by=&quot;ID&quot;)</code></pre>
</div>
<div id="semi_join" class="section level3">
<h3>semi_join</h3>
<pre class="r"><code># Fun√ß√£o semi_join: Combina as duas bases incluindo as vari√°veis da basea a esquerda e todas as linhas comuns as duas bases
semi_join(df1,df2,by=&quot;ID&quot;)</code></pre>
</div>
<div id="anti_join" class="section level3">
<h3>anti_join</h3>
<pre class="r"><code># Fun√ß√£o anti_join: Combina as duas bases incluindo as vari√°veis da base a esquerda e todas as linhas que n√£o s√£o comuns as duas bases
anti_join(df1,df2,by=&quot;ID&quot;)</code></pre>
</div>
</div>
<div id="combinando-dados-verticalmente" class="section level2">
<h2>Combinando dados verticalmente</h2>
<div id="juntando-por-linhas-comuns-com-intersect" class="section level3">
<h3>Juntando por linhas comuns com intersect</h3>
<pre class="r"><code>#Criando uma base com as linhas comus as duas bases
intersect(d1,d2)</code></pre>
</div>
<div id="juntando-todas-as-linhas-com-union" class="section level3">
<h3>Juntando todas as linhas com union</h3>
<pre class="r"><code>#Criando uma base unindo todas as linhas das duas bases
union(d1,d3)</code></pre>
</div>
<div id="base-com-linhas-distintas-nas-duas-bases-com-setdiff" class="section level3">
<h3>Base com linhas distintas nas duas bases com setdiff</h3>
<pre class="r"><code>#Criando uma base com as linhas distintas nas duas bases
setdiff(d1,d3)</code></pre>
</div>
<div id="empilhando-duas-bases-uma-sobre-a-outra-com-rbind" class="section level3">
<h3>Empilhando duas bases uma sobre a outra com rbind</h3>
<pre class="r"><code>#Empilhando duas bases, uma em cima da outra
rbind(d1,d3)</code></pre>
</div>
<div id="empilhando-duas-bases-lado-a-lado-com-cbind" class="section level3">
<h3>Empilhando duas bases lado a lado com cbind</h3>
<pre class="r"><code>#Empilhando duas bases, uma ao lado da outra
cbind(d3,d4)</code></pre>
<p>√â realmente impressionante como este pacote pode impulsionar nossas habilidades na manipula√ß√£o de dados! Espero que a partir de hoje o <code>%&gt;%</code> n√£o seja mais visto coisa ‚Äúesquisita‚Äù</p>
</div>
</div>
</div>

        <p><strong>Leia o post completo em:</strong> <a href="https://gomesfellipe.github.io/post/2017-12-07-manipulando-dados-com-dplyr/manipulando-dados-com-dplyr/">Manipulando dados com dplyr</a></p>
        <p><em>Este post foi originalmente publicado em <a href="https://gomesfellipe.github.io/">Fellipe Gomes - Data Science Blog</a></em></p>
      ]]></content:encoded>
      <category>Estatistica</category>
      <category>R</category>
      <category>Teoria</category>
      <category>Tidyverse</category>
      <category>Data mining</category>
      <category domain="tag">Estatistica</category>
      <category domain="tag">gomesfellipe</category>
      <category domain="tag">R</category>
      <category domain="tag">Pr√°tica</category>
      <category domain="tag">Dplyr</category>
      <category domain="tag">Tidyverse</category>
      <category domain="tag">Data Mining</category>
    </item>
  </channel>
</rss>