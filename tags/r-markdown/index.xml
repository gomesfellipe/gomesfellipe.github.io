&lt;?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>R Markdown on Fellipe Gomes - Data Science Blog</title>
    <link>https://gomesfellipe.github.io/tags/r-markdown/</link>
    <description>Últimos posts sobre Data Science, Machine Learning e R</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>pt-br</language>
    <managingEditor>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</managingEditor>
    <webMaster>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</webMaster>
    <lastBuildDate>Sat, 29 Sep 2018 00:00:00 +0000</lastBuildDate>
    <atom:link href="https://gomesfellipe.github.io/tags/r-markdown/" rel="self" type="application/rss+xml" />
    <item>
      <title>Com que frequência ocorrem acidentes na ponte Rio-Niterói?</title>
      <link>https://gomesfellipe.github.io/post/2018-09-29-freq-acidente-ponte-rio-niteroi/freq-acidente-ponte-rio-niteroi/</link>
      <pubDate>Sat, 29 Sep 2018 00:00:00 +0000</pubDate>
      <author>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</author>
      <guid>https://gomesfellipe.github.io/post/2018-09-29-freq-acidente-ponte-rio-niteroi/freq-acidente-ponte-rio-niteroi/</guid>
      <description>Com os dados públicos da PRF e um pouco de Estatística buscaremos respostas para esta e outras perguntas relacionadas ao número de acidentes na Ponte Rio-Niterói.</description>
      <content:encoded>&lt;![CDATA[
        
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>
<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>
<link href="/rmarkdown-libs/lightable/lightable.css" rel="stylesheet" />
<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/leaflet/leaflet.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet/leaflet.js"></script>
<link href="/rmarkdown-libs/leafletfix/leafletfix.css" rel="stylesheet" />
<script src="/rmarkdown-libs/proj4/proj4.min.js"></script>
<script src="/rmarkdown-libs/Proj4Leaflet/proj4leaflet.js"></script>
<link href="/rmarkdown-libs/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-binding/leaflet.js"></script>
<link href="/rmarkdown-libs/leaflet-markercluster/MarkerCluster.css" rel="stylesheet" />
<link href="/rmarkdown-libs/leaflet-markercluster/MarkerCluster.Default.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-markercluster/leaflet.markercluster.js"></script>
<script src="/rmarkdown-libs/leaflet-markercluster/leaflet.markercluster.freezable.js"></script>
<script src="/rmarkdown-libs/leaflet-markercluster/leaflet.markercluster.layersupport.js"></script>
<link href="/rmarkdown-libs/leaflet-easybutton/easy-button.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-easybutton/easy-button.js"></script>
<script src="/rmarkdown-libs/leaflet-easybutton/EasyButton-binding.js"></script>
<link href="/rmarkdown-libs/ionicons/ionicons.min.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-providers/leaflet-providers_1.9.0.js"></script>
<script src="/rmarkdown-libs/leaflet-providers-plugin/leaflet-providers-plugin.js"></script>


<div id="perguntas" class="section level1">
<h1>Perguntas</h1>
<p>Estudar em outra cidade têm suas vantagens e desvantagens, durante toda a graduação atravessei Baía de Guanabara pela Ponte Presidente Costa e Silva, (popularmente conhecida como Ponte Rio–Niterói) assim como todas as pessoas que fazem esse trajeto diariamente e diante de tanta beleza natural com a vista panorâmica da Baía como os espetáculos proporcionados pelo pôr do sol, os pássaros ou a beleza inegável do Pão de Açúcar também é notável a beleza fruto da maior habilidade humana: a <strong>criatividade</strong>. Temos o cristo, todos aqueles grandes barcos, o Porto do Rio de Janeiro com todas aquelas obras de Engenharia, ou até mesmo a própria Ponte, que por si só já é intrigante.</p>
<p>Em contrapartida, dentre as desvantagens está a enorme frequência de engarrafamentos, o custo, o <strong>tempo</strong> gasto no trajeto e ao refletir sobre a velocidade dos carros na travessia da Ponte e a quantidade de acidentes que ocorrem na me deparei com os seguinte questionamentos:</p>
<blockquote>
<p>O número de acidentes na ponte é diário?</p>
<p>O número de acidentes na ponte têm diminuído?</p>
<p>A instalação das câmeras de segurança diminuiu o número de acidentes?</p>
</blockquote>
<p>Em janeiro de 2018 anunciava-se no jornal: <a href="https://oglobo.globo.com/rio/bairros/radares-da-ponte-rio-niteroi-comecam-multar-nesta-segunda-22284313">“radares da Ponte Rio-Niterói começam a multar”</a> e como já faz algum tempo que a ponte é monitorada com câmeras de segurança surge a suspeita se o número de acidentes têm diminuído e na vontade de tirar minhas próprias conclusões recorri ao que há de mais abundante por ai: <strong>os dados</strong> e com o uso de técnicas simples de Estatística iniciei minha “investigação” para obter possíveis respostas para essas perguntas.</p>
<p>Pacotes utilizados nesta análise:</p>
<pre class="text"><code>library(grid)           # textGrob()
library(dplyr)          # Manipulacao dos dados
library(purrr)          # Programacao Funcional
library(stringr)        # Manipulacao de strings
library(magrittr)       # Pipes
library(leaflet)        # Mapa interativo
library(leaflet.extras) # + leaflet
library(ggplot2)        # graficos elegantes
library(lubridate)      # manipulacao de data
library(data.table)     # fred()
library(forecast)       # tslm()
library(ggfortify)      # autoplot()
library(gridExtra)      # + ggplot2
library(zoo)            # rollmean
library(broom)          # tidy() augment() glance()
library(knitr)          # kable()
library(kableExtra)     # scroll_box
library(formattable)    # color_bar()</code></pre>
</div>
<div id="fonte-dos-dados" class="section level1">
<h1>Fonte dos dados</h1>
<p>Os dados para realizar esta pesquisa foram obtidos no site da Polícia Rodoviária Federal, que disponibiliza uma sessão de <a href="https://www.prf.gov.br/portal/dados-abertos/">Dados Abertos</a> que segundo o site: “não possui restrição de licenças, patentes ou mecanismos de controle, de modo a estarem livremente disponíveis para serem utilizados e redistribuídos à vontade”. Na sessão de <a href="https://www.prf.gov.br/portal/dados-abertos/acidentes/acidentes">Acidentes</a> é possível encontrar os registros de acidentes no formato csv ao longo dos anos.</p>
<p><strong>Discussão:</strong> Para saber se de fato o número de acidentes na ponte Rio-Niterói ocorre diariamente seria necessário que todos os casos fossem registrados ou elaborar alguma forma de fazer inferência para obter significância estatística para esta resposta baseado na amostra de ocorrências registradas. Ainda é possível que ocorram <a href="https://dicionario.priberam.org/subnotifica%C3%A7%C3%A3o">subnotificações</a> pois pode ser que alguns casos como uma leve batida entre dois carros não tenham sido registrados pela PRF.</p>
<p><strong>Reflexão</strong>: Uma sugestão para contornar esse problema de <strong>subnotifação</strong> (caso de fato exista) poderia ser o desenvolvimento de um algorítimo de <strong>Inteligência Artificial</strong> baseado em <strong>Deep Learning</strong> para captar através das <strong>imagens</strong> das câmeras de segurança a ocorrência dos acidentes, classifica-los e armazenar em uma base de dados de forma automatizada além de notificar às autoridades..</p>
<p>Dada as circunstâncias, vejamos o que os dados disponibilizados pela PRF têm à revelar. Após baixar todos os dados, bastou fazer a leitura com os comandos:</p>
<pre class="text"><code># Importar / Arrumar / Limpar
base &lt;- 
  paste0(&quot;datatran&quot;,2008:2018,&quot;/&quot;,&quot;datatran&quot;,2008:2018,&quot;.csv&quot;) %&gt;% 
  map(~.x %&gt;%
        fread(sep = &quot;;&quot;,dec=&quot;,&quot;)%&gt;% 
        mutate(km = as.character(km),
               br = as.character(br)) %&gt;% 
        mutate_if(is.character,
                  ~.x %&gt;%
                    enc2native() %&gt;%
                    abjutils::rm_accent() %&gt;% 
                    tolower() %&gt;% 
                    str_replace_all(&quot;/&quot;,&quot;-&quot;) %&gt;% 
                    str_replace_all(&quot;,&quot;,&quot;\\.&quot;)
        ) %&gt;%
        mutate(data_inversa = if_else(is.na(dmy(data_inversa)),
                                      ymd(data_inversa),
                                      dmy(data_inversa)) ,
               km = as.numeric(km),
               br = as.numeric(br),
               id = as.character(id),
               dia_semana = str_remove_all(dia_semana,&quot;-feira&quot;)
        ) %&gt;%
        filter(br==101 &amp; km&gt;=321 &amp; km&lt;334)  %&gt;% 
        .[str_detect(.$municipio,&quot;(niteroi|rio de janeiro)&quot;),] 
  )

# Salvar base arrumada:
saveRDS(base, &#39;base.RDS&#39;)</code></pre>
<p><em>Nota: A única pasta que tinha a base com nome diferente das demais foi no ano de 2016, do qual foi preciso renomear o arquivo <code>datatran2016_atual.csv</code> para <code>datatran2016.csv</code>.</em></p>
<p>Diante de tantos dados, foi necessário fazer um filtro para obter apenas os dados da ponte Rio- Niterói.</p>
<p>Segundo o Google, o “endereço” da ponte é <a href="https://www.google.com.br/search?q=ponte+rio+niteroi+br101&amp;oq=ponte+rio+niteroi+br101&amp;aqs=chrome..69i57j0l2.5680j0j7&amp;sourceid=chrome&amp;ie=UTF-8">BR-101, Km 321-334</a>, portanto foi aplicado um filtro que levasse em conta essa informação.</p>
</div>
<div id="análises-preliminares" class="section level1">
<h1>Análises preliminares</h1>
<p>Com a base de dados arrumada e salva em no objeto <code>base.RDS</code> fica mais fácil fazer análises rápidas depois de reiniciar o R e a leitura dos dados também será mais veloz.</p>
<pre class="text"><code>base &lt;- readRDS(&quot;base.RDS&quot;)</code></pre>
<p>Primeiramente, um breve resumo dos dados com algumas informações gerais dos últimos 10 anos:</p>
<pre class="text"><code>base %&gt;% 
  map_df( ~.x %&gt;% 
            select(dia_semana,classificacao_acidente, mortos, feridos, veiculos)) %&gt;%
  map_if(is.character,as.factor) %&gt;% 
  bind_cols() %&gt;% 
  SmartEDA::ExpCatViz(target=NULL, fname=NULL, margin=2, Page = c(2,2)) </code></pre>
<pre><code>## $`0`</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-4-1.png" width="1152" /></p>
<p>Nota-se que o maior número de acidentes ocorre na sexta-feira, praticamente todos os acidentes não tiveram mortos e em 78% dos acidentes não houveram vítimas. A maioria dos acidentes foi colisão entre dois carros.</p>
<p>Os tipos de acidentes que ocorreram foram:</p>
<pre class="text"><code>base %&gt;% 
  map_df( ~.x %&gt;% 
            select(causa_acidente,
                   tipo_acidente)) %&gt;%
  map_if(is.character,as.factor) %&gt;% 
  as_tibble %&gt;% 
  group_by(causa_acidente) %&gt;% 
  dplyr::summarise(n=n()) %&gt;% 
  mutate(n = color_bar(&quot;lightgrey&quot;)(n)) %&gt;% 
  kable(escape = F) %&gt;%
  kable_styling(&quot;hover&quot;,full_width = F) %&gt;%
  scroll_box( height = &quot;200px&quot;)</code></pre>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; ">
<table class="table table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
causa_acidente
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
agressao externa
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.02%">1</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
animais na pista
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.08%">4</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
avarias e-ou desgaste excessivo no pneu
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.10%">5</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
condutor dormindo
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.08%">4</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
defeito mecanico em veiculo
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 4.10%">210</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
defeito mecanico no veiculo
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.51%">26</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
defeito na via
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.18%">9</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
desobediencia a sinalizacao
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.94%">48</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
desobediencia as normas de transito pelo condutor
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.18%">9</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
dormindo
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 1.13%">58</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
falta de atencao
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 33.16%">1697</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
falta de atencao a conducao
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 2.85%">146</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
falta de atencao do pedestre
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.08%">4</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
ingestao de alcool
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 1.15%">59</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
ingestao de alcool
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.10%">5</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
mal subito
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.08%">4</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
nao guardar distancia de seguranca
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 13.23%">677</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
nao guardar distancia de seguranca
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.76%">39</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
objeto estatico sobre o leito carrocavel
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.06%">3</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
outras
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 100.00%">5118</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
pista escorregadia
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.10%">5</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
restricao de visibilidade
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.04%">2</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
ultrapassagem indevida
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.41%">21</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
velocidade incompativel
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 1.21%">62</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
velocidade incompativel
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 0.10%">5</span>
</td>
</tr>
</tbody>
</table>
</div>
<div id="mapa" class="section level2">
<h2>Mapa</h2>
<p>Ao investigar a base nota-se que apenas os últimos dois anos (2018 e 2017) informam as coordenadas geográficas, portando para criar o mapa com o pacote <a href="https://rstudio.github.io/leaflet/">leaflet</a> foram selecionados apenas os dados referentes ao ano de <strong>2018</strong> e <strong>2017</strong>:</p>
<pre class="text"><code>base[10:11] %&gt;% 
  map_df(~.x %&gt;% 
           select(id, data_inversa, horario, br,km,
                  causa_acidente, tipo_acidente,
                  latitude, longitude) %&gt;% 
           mutate(latitude = as.numeric(latitude), 
                  longitude = as.numeric(longitude) )
  ) %&gt;%
  leaflet() %&gt;%
  addTiles() %&gt;%
  addMarkers(~longitude, ~latitude,
             clusterOptions = markerClusterOptions(),
             label = ~paste0(data_inversa,&quot;-&quot;,horario,&quot;\n Causa: &quot;,causa_acidente,&quot;\nTipo: &quot;,tipo_acidente))%&gt;%
  addResetMapButton()%&gt;% 
  addProviderTiles(providers$OpenStreetMap.Mapnik)</code></pre>
<div id="htmlwidget-1" style="width:850px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addMarkers","args":[[-22.87199872,-22.8785807,-22.8779,-22.8800204,-22.8759557,-22.87167745,-22.8858975,-22.86763924,-22.8735,-22.8759557,-22.8708372,-22.8703627,-22.8809199,-22.87174665,-22.8758,-22.87965466,-22.8692,-22.8841859,-22.8759557,-22.87323339,-22.8808,-22.8675,-22.87578968,-22.8808,-22.8758,-22.87364461,-22.87452327,-22.8685577,-22.86826698,-22.8759557,-22.87016993,-22.8759557,-22.8759557,-22.8808,-22.87462594,-22.8808,-22.8808,-22.903263,-22.87522623,-22.8466271,-22.8730169,-22.87318405,-22.87162803,-22.86902012,-22.8673,-22.87638772,-22.8783982,-22.8679457,-22.87126227,-22.8683,-22.87322944,-22.87796436,-22.878397,-22.87795448,-22.8850444,-22.8673,-22.8683,-22.8701,-22.8708372,-22.8712,-22.8692,-22.8758,-22.9236903,-22.8784012,-22.86660619,-22.87757885,-22.8759557,-22.8735,-22.8673,-22.87024407,-22.87095582,-22.87095582,-22.8808,-22.87771724,-22.8673,-22.8808,-22.878588,-22.8673,-22.8703627,-22.8783213,-22.8683,-22.87206298,-22.8759557,-22.8683,-22.86860934,-22.903263,-22.87915054,-22.86879091,-22.87762828,-22.8858975,-22.87301118,-22.87841412,-22.87045832,-22.87377806,-22.8782913,-22.87549807,-22.86778596,-22.878781,-22.88286716,-22.878315,-22.8759557,-22.86381346,-22.8735,-22.8808,-22.8683,-22.87172795,-22.87113376,-22.878,-22.8808,-22.8808,-22.87170711,-22.8779,-22.87807128,-22.8759557,-22.87115353,-22.8784518,-22.87711426,-22.878562,-22.86772821,-22.8735,-22.8759557,-22.87848845,-22.87322944,-22.8673,-22.86873081,-22.8673,-22.903263,-22.8701,-22.87769141,-22.8779,-22.8783782,-22.8784061,-22.87028362,-22.87779138,-22.8688555,-22.869379,-22.878923,-22.868481,-22.8721816,-22.871508,-22.86779247,-22.869852,-22.87627009,-22.869852,-22.86969049,-22.8785813,-22.8710349,-22.86984866,-22.878471,-22.87301196,-22.87257701,-22.86924564,-22.8784568,-22.878923,-22.8848256,-22.873808,-22.868481,-22.87000682,-22.8786976,-22.871164,-22.8858975,-22.87770736,-22.872055,-22.876848,-22.87979305,-22.869379,-22.86731796,-22.87182573,-22.9068467,-22.876848,-22.87302679,-22.86905782,-22.86981966,-22.87237931,-22.8783273,-22.871164,-22.87490991,-22.87946778,-22.869852,-22.869852,-22.869852,-22.869852,-22.87870572,-22.878471,-22.869852,-22.86858331,-22.867664,-22.868481,-22.867664,-22.872055,-22.87870572,-22.878471,-22.868481,-22.87744046,-22.878923,-22.867664,-22.868481,-22.86858331,-22.878923,-22.87997097,-22.87593795,-22.87902204,-22.869852,-22.86921599,-22.86905782,-22.871164,-22.869852,-22.87902204,-22.869379,-22.878382,-22.869852,-22.878471,-22.87158848,-22.878923,-22.87521545,-22.871164,-22.87841907,-22.867664,-22.871164,-22.870275,-22.8759557,-22.87775678,-22.86707081,-22.870275,-22.867664,-22.8676343,-22.873808,-22.867664,-22.87815218,-22.868481,-22.8759557,-22.8824619,-22.869852,-22.872925,-22.878471,-22.867664,-22.8849062,-22.8849062,-22.86731796,-22.878923,-22.86830652,-22.8759557,-22.87813241,-22.878923,-22.8759557,-22.872925,-22.868481,-22.878923,-22.869852,-22.878471,-22.88218513,-22.87009415,-22.87322944,-22.869852,-22.87775678,-22.868481,-22.87111399,-22.8680459],[-43.14552069,-43.1144885,-43.2104,-43.11206281,-43.1117034,-43.14893246,-43.1152211,-43.11079949,-43.1278,-43.1117034,-43.15983295,-43.16421032,-43.21369171,-43.15292358,-43.1186,-43.11338246,-43.1761,-43.1117034,-43.1117034,-43.11009943,-43.1043,-43.1956,-43.11863422,-43.1043,-43.1186,-43.20613861,-43.11022141,-43.19978433,-43.19343567,-43.1117034,-43.16662967,-43.1117034,-43.1117034,-43.1043,-43.12749526,-43.1043,-43.1043,-43.207874,-43.20888519,-43.0950118,-43.13368142,-43.13310832,-43.15253735,-43.17805873,-43.1103,-43.1105384,-43.1145595,-43.11070025,-43.15514445,-43.1859,-43.13393262,-43.11607003,-43.1146201,-43.1157589,-43.1117034,-43.1103,-43.1859,-43.1664,-43.16202164,-43.2042,-43.1761,-43.1186,-43.2246728,-43.1145651,-43.10935915,-43.11035693,-43.1117034,-43.1278,-43.1103,-43.11045516,-43.20382118,-43.16305161,-43.1043,-43.11573744,-43.1103,-43.1043,-43.1145867,-43.1103,-43.16703536,-43.1145249,-43.1859,-43.20081711,-43.1117034,-43.1859,-43.19817847,-43.207874,-43.11414865,-43.20050597,-43.11521173,-43.1152211,-43.13353152,-43.11427832,-43.20247609,-43.20640951,-43.1144462,-43.11937896,-43.19416416,-43.1594364,-43.2148495,-43.1144214,-43.1117034,-43.10749233,-43.1278,-43.1043,-43.1859,-43.14682335,-43.15668136,-43.116,-43.1043,-43.1043,-43.15202236,-43.2104,-43.11563909,-43.1117034,-43.15627098,-43.1144862,-43.1168845,-43.1147141,-43.11053663,-43.1278,-43.1117034,-43.11497284,-43.13419104,-43.1103,-43.11065764,-43.1103,-43.207874,-43.1664,-43.11602736,-43.2104,-43.1143391,-43.1143417,-43.16205718,-43.11578035,-43.11068845,-43.175808,-43.110676,-43.18568,-43.14394355,-43.204243,-43.19669724,-43.110458,-43.20833587,-43.110458,-43.17111969,-43.1146243,-43.15579891,-43.18622589,-43.21072,-43.14219475,-43.13837528,-43.17558289,-43.1142699,-43.110676,-43.1127452,-43.126438,-43.18568,-43.1693387,-43.1146008,-43.156063,-43.1152211,-43.1157589,-43.146187,-43.117287,-43.11108649,-43.175808,-43.19841385,-43.1461966,-43.1728965,-43.117287,-43.13391209,-43.18842798,-43.17498207,-43.14846039,-43.1145218,-43.156063,-43.11035156,-43.11583299,-43.110458,-43.110458,-43.110458,-43.110458,-43.21334839,-43.21072,-43.110458,-43.19892883,-43.19556,-43.18568,-43.19556,-43.146187,-43.10348511,-43.21072,-43.18568,-43.12820435,-43.110676,-43.19556,-43.18568,-43.1803894,-43.110676,-43.18107605,-43.11831772,-43.11138153,-43.110458,-43.16665649,-43.18047523,-43.156063,-43.110458,-43.11275482,-43.175808,-43.114474,-43.110458,-43.21072,-43.15172195,-43.110676,-43.12650723,-43.156063,-43.11451435,-43.19556,-43.156063,-43.165936,-43.1117034,-43.1157589,-43.19599987,-43.165936,-43.19556,-43.19274902,-43.126438,-43.19556,-43.11046958,-43.18568,-43.1117034,-43.2147646,-43.110458,-43.136311,-43.21072,-43.19556,-43.1136734,-43.1136734,-43.17592621,-43.110676,-43.18755627,-43.1117034,-43.11522245,-43.110676,-43.1117034,-43.136311,-43.18568,-43.110676,-43.110458,-43.21072,-43.11378479,-43.1106037,-43.20585966,-43.110458,-43.20987225,-43.18568,-43.16047668,-43.19756529],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,{"showCoverageOnHover":true,"zoomToBoundsOnClick":true,"spiderfyOnMaxZoom":true,"removeOutsideVisibleBounds":true,"spiderLegPolylineOptions":{"weight":1.5,"color":"#222","opacity":0.5},"freezeAtZoom":false},null,["2017-01-06-13:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-06-16:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-07-12:20:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-09-17:18:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-01-11-04:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-11-10:10:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: engavetamento                                                                                                                                                                                           ","2017-01-11-15:53:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-01-14-01:05:00\n Causa: velocidade incompativel                                                                             \nTipo: capotamento                                                                                                                                                                                             ","2017-01-14-06:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto em movimento                                                                                                                                                                         ","2017-01-14-11:28:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-01-16-04:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-01-23-05:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-24-11:20:00\n Causa: avarias e-ou desgaste excessivo no pneu                                                             \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-01-24-13:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-25-17:14:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-28-23:15:00\n Causa: velocidade incompativel                                                                             \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-01-30-13:43:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-31-12:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-31-20:07:00\n Causa: avarias e-ou desgaste excessivo no pneu                                                             \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-02-03-05:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-02-03-16:45:00\n Causa: objeto estatico sobre o leito carrocavel                                                            \nTipo: colisao traseira                                                                                                                                                                                        ","2017-02-03-15:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-02-08-19:50:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-02-20-01:50:00\n Causa: condutor dormindo                                                                                   \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-02-22-15:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-03-01-05:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-03-02-16:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-03-02-19:15:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-03-03-17:20:00\n Causa: mal subito                                                                                          \nTipo: colisao lateral                                                                                                                                                                                         ","2017-03-08-18:23:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-03-09-10:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-03-11-17:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-03-12-19:21:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-01-22-23:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-03-13-21:20:00\n Causa: ingestao de alcool                                                                                  \nTipo: colisao transversal                                                                                                                                                                                     ","2017-03-30-08:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-03-30-13:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-04-03-17:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-04-04-12:29:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-04-05-12:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-04-10-12:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-04-10-19:15:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: colisao lateral                                                                                                                                                                                         ","2017-04-13-06:17:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-04-15-15:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-04-19-09:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-04-20-08:35:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-04-29-15:50:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-08-05:36:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-11-17:44:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-02-17-18:10:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-12-18:30:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: atropelamento de pedestre                                                                                                                                                                               ","2017-05-18-12:40:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-05-19-08:35:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-05-19-12:12:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-05-23-17:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-26-17:46:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-27-23:31:00\n Causa: ingestao de alcool                                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-29-05:27:00\n Causa: velocidade incompativel                                                                             \nTipo: colisao lateral                                                                                                                                                                                         ","2017-05-29-06:05:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-30-02:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-05-30-06:42:00\n Causa: restricao de visibilidade                                                                           \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-05-30-15:23:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-05-31-13:30:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-06-04-07:38:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-06-17-07:00:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-06-19-12:04:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-06-20-18:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-06-24-19:12:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-06-27-10:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-06-29-10:45:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-06-30-08:15:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-06-30-13:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-07-01-12:15:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-07-03-10:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-07-04-09:45:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: colisao lateral                                                                                                                                                                                         ","2017-07-04-10:00:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: colisao lateral                                                                                                                                                                                         ","2017-06-02-21:55:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-07-05-19:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-07-07-06:04:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-07-08-19:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-07-10-08:26:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-07-16-07:50:00\n Causa: ingestao de alcool                                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-07-24-16:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-07-26-05:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-07-28-20:05:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-08-01-08:54:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-08-04-09:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-08-10-04:10:00\n Causa: condutor dormindo                                                                                   \nTipo: colisao traseira                                                                                                                                                                                        ","2017-08-14-05:22:00\n Causa: falta de atencao a conducao                                                                         \nTipo: engavetamento                                                                                                                                                                                           ","2017-08-14-06:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-08-16-17:14:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-08-22-06:24:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-08-22-18:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-08-24-17:31:00\n Causa: velocidade incompativel                                                                             \nTipo: colisao traseira                                                                                                                                                                                        ","2017-08-27-10:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: incendio                                                                                                                                                                                                ","2017-08-31-09:29:00\n Causa: restricao de visibilidade                                                                           \nTipo: engavetamento                                                                                                                                                                                           ","2017-09-03-18:46:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-04-12:21:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-04-16:06:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao com objeto em movimento                                                                                                                                                                         ","2017-09-08-17:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-09-12-10:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-09-13-17:40:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: colisao lateral                                                                                                                                                                                         ","2017-07-24-16:19:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-09-18-20:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-09-21-07:20:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-22-07:42:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-09-22-18:07:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-22-20:27:00\n Causa: ingestao de alcool                                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-24-05:00:00\n Causa: condutor dormindo                                                                                   \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-26-07:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-09-26-15:20:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao transversal                                                                                                                                                                                     ","2017-09-26-18:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-09-28-16:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-09-29-06:56:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-10-04-15:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-10-06-17:11:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-10-11-11:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-10-14-11:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-10-15-06:00:00\n Causa: pista escorregadia                                                                                  \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-10-18-08:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-08-06-07:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-10-23-17:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-10-27-21:25:00\n Causa: falta de atencao do pedestre                                                                        \nTipo: atropelamento de pedestre                                                                                                                                                                               ","2017-10-28-12:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2017-10-31-05:50:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-11-06-18:43:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-11-06-22:55:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-11-10-07:15:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-11-10-11:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-11-10-20:07:00\n Causa: condutor dormindo                                                                                   \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-11-11-16:00:00\n Causa: pista escorregadia                                                                                  \nTipo: tombamento                                                                                                                                                                                              ","2017-11-11-19:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-11-14-07:15:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-11-16-06:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-11-19-03:05:00\n Causa: pista escorregadia                                                                                  \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-11-23-14:29:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-11-29-06:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-11-30-20:48:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-02-07:05:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-03-19:32:00\n Causa: falta de atencao a conducao                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2017-12-05-17:30:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-12-07-09:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-08-18:11:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-09-07:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-12-11-15:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-12-12-13:07:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-12-14-17:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-17-12:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-12-17-16:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2017-12-18-11:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-12-18-11:10:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2017-12-22-10:05:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-12-22-18:30:00\n Causa: ingestao de alcool                                                                                  \nTipo: colisao frontal                                                                                                                                                                                         ","2017-12-25-10:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: engavetamento                                                                                                                                                                                           ","2017-12-25-16:30:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-26-15:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-27-15:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-28-17:26:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-12-29-15:45:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2017-12-31-00:45:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-07-24-17:45:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2017-09-21-07:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2017-07-28-18:47:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2018-01-02-22:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2018-01-04-00:49:00\n Causa: falta de atencao a conducao                                                                         \nTipo: capotamento                                                                                                                                                                                             ","2018-01-05-09:52:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-01-06-15:10:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao traseira                                                                                                                                                                                        ","2018-01-11-08:47:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-01-26-12:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-01-28-16:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-01-31-07:35:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-01-31-08:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-02-02-09:22:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-02-02-10:17:00\n Causa: avarias e-ou desgaste excessivo no pneu                                                             \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-02-05-15:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-02-09-17:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-02-12-17:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-02-12-22:29:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-02-06-00:45:00\n Causa: pista escorregadia                                                                                  \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2018-02-21-07:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-02-21-09:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: incendio                                                                                                                                                                                                ","2018-02-22-19:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-02-23-08:25:00\n Causa: pista escorregadia                                                                                  \nTipo: tombamento                                                                                                                                                                                              ","2018-02-25-06:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2018-02-25-15:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-02-26-19:07:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-02-26-23:58:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-03-01-08:50:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: incendio                                                                                                                                                                                                ","2018-03-06-05:00:00\n Causa: mal subito                                                                                          \nTipo: capotamento                                                                                                                                                                                             ","2018-03-10-05:30:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: colisao lateral                                                                                                                                                                                         ","2018-03-12-03:30:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-03-14-08:54:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-03-22-23:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-03-30-07:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-03-31-08:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao frontal                                                                                                                                                                                         ","2018-04-02-10:56:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-04-03-07:33:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao frontal                                                                                                                                                                                         ","2018-04-05-20:01:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-04-06-09:44:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-04-08-09:55:00\n Causa: mal subito                                                                                          \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2018-04-09-15:05:00\n Causa: falta de atencao do pedestre                                                                        \nTipo: colisao traseira                                                                                                                                                                                        ","2018-04-12-07:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2018-04-16-04:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-04-16-10:29:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-04-22-05:45:00\n Causa: mal subito                                                                                          \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-04-22-15:45:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2018-04-27-18:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2018-05-03-23:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-05-04-13:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-08-01:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-04-11:20:00\n Causa: falta de atencao do pedestre                                                                        \nTipo: atropelamento de pedestre                                                                                                                                                                               ","2018-05-08-08:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-09-10:43:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-11-11:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: atropelamento de pedestre                                                                                                                                                                               ","2018-05-11-12:28:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2018-05-14-12:35:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-16-13:29:00\n Causa: desobediencia as normas de transito pelo condutor                                                   \nTipo: colisao transversal                                                                                                                                                                                     ","2018-05-28-17:45:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-31-17:20:00\n Causa: avarias e-ou desgaste excessivo no pneu                                                             \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-06-01-09:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-06-07-09:00:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2018-06-10-19:05:00\n Causa: falta de atencao a conducao                                                                         \nTipo: engavetamento                                                                                                                                                                                           ","2018-06-12-08:15:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-06-13-23:50:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: incendio                                                                                                                                                                                                ","2018-06-17-18:56:00\n Causa: velocidade incompativel                                                                             \nTipo: tombamento                                                                                                                                                                                              ","2018-06-18-07:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-06-20-17:30:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: tombamento                                                                                                                                                                                              ","2018-06-22-15:27:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-06-24-11:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-06-25-15:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2018-06-27-08:40:00\n Causa: falta de atencao do pedestre                                                                        \nTipo: atropelamento de pedestre                                                                                                                                                                               ","2018-06-30-08:25:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: tombamento                                                                                                                                                                                              ","2018-07-03-18:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-07-05-15:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-07-06-08:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-07-08-19:35:00\n Causa: avarias e-ou desgaste excessivo no pneu                                                             \nTipo: colisao traseira                                                                                                                                                                                        ","2018-07-13-14:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-07-13-11:40:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-07-13-16:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-05-11-06:55:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-07-20-23:39:00\n Causa: agressao externa                                                                                    \nTipo: colisao traseira                                                                                                                                                                                        ","2018-05-30-07:40:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2018-05-11-06:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-07-30-18:10:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-07-17-07:00:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: engavetamento                                                                                                                                                                                           ","2018-08-01-17:48:00\n Causa: falta de atencao a conducao                                                                         \nTipo: queda de ocupante de veiculo                                                                                                                                                                            ","2018-02-09-14:28:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-08-16-14:30:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-08-21-14:10:00\n Causa: nao guardar distancia de seguranca                                                                  \nTipo: colisao lateral                                                                                                                                                                                         ","2018-08-22-07:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-06-23-06:15:00\n Causa: objeto estatico sobre o leito carrocavel                                                            \nTipo: colisao com objeto estatico                                                                                                                                                                             ","2018-08-23-17:45:00\n Causa: defeito mecanico no veiculo                                                                         \nTipo: incendio                                                                                                                                                                                                ","2018-08-24-01:20:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-08-28-20:00:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-08-29-12:40:00\n Causa: objeto estatico sobre o leito carrocavel                                                            \nTipo: colisao traseira                                                                                                                                                                                        ","2018-08-30-06:25:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         ","2018-08-30-07:45:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao traseira                                                                                                                                                                                        ","2018-08-22-01:50:00\n Causa: falta de atencao a conducao                                                                         \nTipo: colisao lateral                                                                                                                                                                                         "],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addEasyButton","args":[{"icon":"ion-arrow-shrink","title":"Reset View","onClick":"function(btn, map){ map.setView(map._initialCenter, map._initialZoom); }","position":"topleft"}]},{"method":"addProviderTiles","args":["OpenStreetMap.Mapnik",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]}],"limits":{"lat":[-22.9236903,-22.8466271],"lng":[-43.2246728,-43.0950118]}},"evals":["calls.2.args.0.onClick"],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (function(el, x){ var map = this; map._initialCenter = map.getCenter(); map._initialZoom = map.getZoom();}).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p>Note que existem diversas ocorrências que apresentaram coordenadas geográficas fora dos limites da Ponte o que sugere que a amostra selecionada pode conter informações das redondezas. Estas informações serão avaliadas em conjunto com os dados referentes aos 13km da BR-101 que selecionamos.</p>
</div>
<div id="série-temporal" class="section level2">
<h2>Série temporal</h2>
<p>Segundo <span class="citation">@Morettin</span>:</p>
<blockquote>
<p><strong>Def</strong>.: <em>Uma série temporal é qualquer conjunto de observações ordenadas no tempo</em></p>
</blockquote>
<p>Os objetivos da análise de séries temporais são, em geral:</p>
<ul>
<li>Investigar o mecanismo gerador da série temporal</li>
<li>Fazer previsões de valores futuros da série (podem ser a curto prazo ou a longo prazo)</li>
<li>Descrever apenas o comportamento da série, neste caso a construção do gráfico, a verificação da existência de tendências, ciclos e variações sazonais, a construção de histogramas e diagramas de dispersão etc podem ser ferramentas úteis</li>
<li>Procurar periodicidade relevante nos dados</li>
</ul>
<p>Etimologicamente (<em>prae</em> e <em>videre</em>), a palavra previsão sugere que se quer ver uma coisa antes que ela exista. Alguns autores preferem a palavra <em>predição</em>, para indicar algo que deverá existir no futuro. Ainda outros utilizam o termo <em>projeção</em> porém nosso objetivo neste post não será ajustar um modelo <strong>preditivo</strong> e sim um modelo <strong>descritivo</strong> que possibilite estudar o comportamento da série.</p>
<p>Após tomar uma intuição de como ocorrem os acidentes de maneira espacial na amostra, para responder a pergunta “<em>O número de acidentes é diário?</em>” precisamos obter a informação temporal dos dados e a melhor forma de visualizar este comportamento inicialmente é com um gráfico.</p>
<div id="número-de-acidentes-por-dia-nos-últimos-10-anos" class="section level3">
<h3>Número de acidentes por dia nos últimos 10 anos</h3>
<p>Veja a seguir o número de acidentes, por id, diariamente e duas curvas de médias móveis com <code>k = 30</code> e com <code>k = 30*6</code> :</p>
<pre class="text"><code>g1 &lt;- 
  base %&gt;%
  map_df(~.x%&gt;% select(id, data_inversa, causa_acidente, tipo_acidente) ) %&gt;% 
  dplyr::group_by(data_inversa)%&gt;% 
  dplyr::summarise(n=n())%&gt;%
  mutate(rMM=rollmean(n,30, na.pad=TRUE, align=&quot;left&quot;)) %&gt;%
  mutate(rMY=rollmean(n,30*6, na.pad=TRUE, align=&quot;left&quot;)) %&gt;%
  tidyr::gather(medida,valor,n:rMY) %&gt;% 
  ggplot(aes(x=data_inversa, y=valor,col=medida)) +
  geom_line() +
  scale_colour_manual(name=&quot;Legenda:&quot;,values=c(&quot;black&quot;,&quot;red&quot;,&quot;blue&quot;), 
                      labels = c(&#39;Acidentes&#39;,&#39;Médias móveis k=30&#39;, &#39;Médias móveis k=30*6&#39;)) +
  theme_bw() +
  labs(y= &#39;Número de acidentes&#39;,
       x = &#39;Data&#39;,
       subtitle = &quot;Por dia&quot;, 
       title= &#39;Número de acidentes na Ponte Rio-Niterói&#39;, 
       caption = &quot;Fonte dos dados:\nhttps://www.prf.gov.br/portal/dados-abertos/acidentes\nhttps://gomesfellipe.github.io/&quot;,col=&quot;&quot;) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(breaks=seq(0,15,1))

g1 +
  scale_x_date(date_breaks = &#39;6 months&#39;,limits = as.Date(c(&quot;2008-02-01&quot;,&quot;2018-12-01&quot;)),
               expand = c(0.01,0.01)) + 
  theme(legend.position = c(0.85,0.7), 
        legend.background = element_rect(fill=alpha(&#39;lightgrey&#39;, 0.2)))</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-7-1.png" width="1152" /></p>
<p>Este gráfico esta um pouco carregado com a informação levando em conta o número de acidentes <em>por dia</em> mas mesmo assim já é possível notar algumas informações como:</p>
<ul>
<li>Existem diversos dias que não houveram acidentes registrados pela PRF (diversos pontos tocam o eixo x)</li>
<li>No ano de 2015 houve uma grotesca diminuição no registros do número de acidentes (o que será que aconteceu?)</li>
</ul>
<p>A primeira pergunta parece ter sido respondida: O número de acidentes não parece ter sido diário nos últimos 10 anos segundo esses dados (e supondo que não houve subnotificação).</p>
<p>Já a hipótese levantada com a segunda pergunta <em>parece</em> ser verdadeira pois o comportamento dos dados sugerem ter havido a diminuição no número de acidentes.</p>
<p>Veja a seguir outra rápida análise exploratória para checar como se distribuem os número de acidentes ano longo dos anos e dos meses com alguns box-plots:</p>
<pre class="text"><code>bp1 &lt;- 
  base %&gt;%
  map_df(~.x%&gt;% select(id, data_inversa, causa_acidente, tipo_acidente) ) %&gt;% 
  dplyr::group_by(data_inversa)%&gt;% 
  dplyr::summarise(n=n()) %&gt;%
  tidyr::gather(medida,valor,n) %&gt;% 
  ggplot(aes(x=factor(year(data_inversa)), y=valor,col=medida)) +
  geom_jitter(col=&quot;darkgrey&quot;,alpha=0.3)+
  geom_boxplot(col=&quot;black&quot;,alpha=0.3)+
  theme_bw() +
  labs(y= &#39;Número de acidentes&#39;,x=&quot;&quot;) + 
  theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
  scale_y_continuous(breaks=seq(0,15,1))+ 
  geom_vline(xintercept = 8.5, linetype=&quot;dotted&quot;, 
             color = &quot;red&quot;, size=1.5) +
  annotate(&quot;label&quot;,y = 7, x = 8.5,
           label = &quot;Comportamentos \n     diferentes&quot;,
           size = 4, colour = &quot;red&quot;,hjust=0.1)

bp2 &lt;- 
  base %&gt;%
  map_df(~.x%&gt;% select(id, data_inversa, causa_acidente, tipo_acidente)) %&gt;% 
  filter(year(data_inversa)&lt;2016) %&gt;% 
  dplyr::group_by(data_inversa) %&gt;% 
  dplyr::summarise(n=n()) %&gt;%
  tidyr::gather(medida,valor,n) %&gt;% 
  ggplot(aes(x=factor(months(data_inversa),
                      levels = months(base[[1]]$data_inversa) %&gt;% unique),
             y=valor,col=medida)) +
  geom_jitter(col=&quot;darkgrey&quot;,alpha=0.3)+
  geom_boxplot(color=&quot;black&quot;,alpha=0.3)+
  theme_bw() +
  labs(y= &#39;Número de acidentes&#39;,
       title = &#39;Dados de 2008 até 2015&#39;,x=&quot;&quot;, col=&quot;&quot;) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(breaks=seq(0,15,1))+ 
  theme(legend.position = c(0.85,0.7))

bp3 &lt;- 
  base %&gt;%
  map_df(~.x%&gt;% select(id, data_inversa, causa_acidente, tipo_acidente) ) %&gt;% 
  filter(year(data_inversa)&gt;=2016) %&gt;% 
  dplyr::group_by(data_inversa) %&gt;% 
  dplyr::summarise(n=n()) %&gt;%
  tidyr::gather(medida,valor,n) %&gt;% 
  ggplot(aes(x=factor(months(data_inversa),
                      levels = months(base[[1]]$data_inversa) %&gt;% unique),
             y=valor,col=medida)) +
  geom_jitter(col=&quot;darkgrey&quot;,alpha=0.3)+
  geom_boxplot(color=&quot;black&quot;,alpha=0.3)+
  theme_bw() +
  labs(y= &#39;&#39;,
       title = &#39;Dados de 2016 até 2018&#39;,x=&quot;&quot;,col=&quot;&quot;) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(breaks=seq(0,15,1))+ 
  theme(legend.position = c(0.85,0.7))

bp2 &lt;- arrangeGrob(bp2,bp3,ncol=2)</code></pre>
<pre class="text"><code>grid.arrange(bp1,bp2,
             top = &quot;Boxplots do número de acidentes na Ponte Rio-Niterói&quot;,
             bottom = textGrob(&quot;Fonte dos dados:\nhttps://www.prf.gov.br/portal/dados-abertos/acidentes\nhttps://gomesfellipe.github.io/&quot;,
                               gp = gpar(fontface = 3, fontsize = 9),
                               hjust = 1,x = 1 )) </code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-9-1.png" width="1152" /></p>
<p>É possível notar que antes de 2016 todos aos boxplots apresentaram medianas parecidas enquanto que após o ano de 2016 parece haver mais acidentes apenas nos primeiros meses do ano.</p>
<p>Para responder a última pergunta vamos analisar com mais detalhes a série para entender melhor seu comportamento.</p>
<div id="número-de-acidentes-por-dia-nos-últimos-10-anos-agrupados-por-ano" class="section level4">
<h4>Número de acidentes por dia nos últimos 10 anos agrupados por ano</h4>
<p>Veja a mesma informação do gráfico do número de acidentes na Ponte Rio-Niterói por dia, porém separado para cada ano:</p>
<pre class="text"><code>g1 +
  facet_wrap( ~ year(data_inversa), scales = &quot;free_x&quot;) +
  ggtitle(&quot;Número de acidentes na Ponte Rio-Niterói de acordo com o ano, por dia&quot;) +
  scale_x_date(date_breaks = &#39;1 month&#39;) +
  theme(legend.position = c(0.85, 0.1))</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-10-1.png" width="1152" /></p>
<p>Agora ficou evidente que a partir do ano de 2015 o número de acidentes na Ponte Rio-Niterói foi reduzido e manteve-se abaixo do número médio registrado nos anos anteriores.</p>
</div>
</div>
<div id="mas-o-que-aconteceu-em-2015" class="section level3">
<h3>Mas o que aconteceu em 2015?</h3>
<p>Já que em 2015 houve este comportamento tão brusco resolvi procurar no Google por notícias de acidentes na Ponte Rio-Niterói neste período e em uma breve pesquisa me deparei com a seguinte notícia:</p>
<center>
<img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi/freq-acidente-ponte-rio-niteroi_files/noticia.png" />
</center>
<p>Essa afirmação na manchete, que houve “redução de quase 60% após o videomonitoramento” é intrigante e seria interessante conseguir achar algum resultado concordante.</p>
<p>Na notícia " <a href="http://g1.globo.com/rio-de-janeiro/noticia/2015/11/monitoramento-com-cameras-ajuda-reduzir-acidentes-na-ponte-rio-niteroi.html">Monitoramento com câmeras ajuda a reduzir acidentes na Ponte Rio-Niterói</a> " um inspetor da PRF faz a seguinte declaração:</p>
<blockquote>
<p>“(…) Ajuda a amplificar o nosso poder de visualização das infrações que são cometidas. Concequentemente reduz o numero de acidentes por conta da presença quase que em todo trecho, ao mesmo tempo, da PRF”</p>
</blockquote>
<!-- [Prefeitura de Niterói instalará 12 câmeras na Ponte Rio-Niterói](http://g1.globo.com/rio-de-janeiro/noticia/2015/10/prefeitura-de-niteroi-instalara-12-cameras-na-ponte-rio-niteroi.html) -->
</div>
<div id="número-de-acidentes-por-mês-nos-últimos-10-anos-agrupados" class="section level3">
<h3>Número de acidentes por mês nos últimos 10 anos agrupados</h3>
<p>Como o gráfico ficou carregado ao levar em consideração o número de acidentes ao longo dos dias, a mesma informação será agrupada por mês.</p>
<p>Vejamos visualmente os dados fornecidos pela PRF e o dia em que a notícia foi atualizada:</p>
<pre class="text"><code>g2 &lt;- 
  base %&gt;%
  map_df(~.x
         %&gt;% select(id, data_inversa, causa_acidente, tipo_acidente) %&gt;%
           mutate_if(is.character,~ dmy(.x) )) %&gt;%
  group_by(month=floor_date(data_inversa, &quot;1 month&quot;)) %&gt;% 
  summarise(n = n()) %&gt;%  
  ggplot(aes(x=month, y=n)) +
  geom_line() +
  geom_point() +
  theme_bw() + 
  labs(y= &#39;Número de acidentes&#39;,
       x = &#39;Data&#39;,
       title= &#39;Número de acidentes na Ponte Rio-Niterói&#39;, 
       subtitle = &quot;Por mês&quot;, 
       caption = &quot;Fonte dos dados: \nhttp://glo.bo/210j8gF \nhttps://www.prf.gov.br/portal/dados-abertos/acidentes\nhttps://gomesfellipe.github.io/&quot;) +
  scale_y_continuous(breaks=seq(0,150,25))

g2 +
  geom_segment(x = as.Date(&quot;2015-11-13&quot;), xend = as.Date(&quot;2015-11-13&quot;),
               y=0,yend=100, linetype=&quot;dashed&quot;, col=&quot;red&quot;) +
  geom_text(aes(y = 100, x = as.Date(&quot;2015-11-13&quot;),
                label = &quot;G1 em 17/11/2015 :\n\&quot;Monitoramento com câmeras\n ajuda a reduzir acidentes\n  na Ponte Rio-Niterói\&quot;&quot;) ,hjust=-0.1) +
  scale_x_date(date_breaks = &#39;6 month&#39;) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-11-1.png" width="1152" /></p>
<p>De fato, visualmente é possível notar uma aparente diminuição no ano do qual a notícia foi divulgada mas será que é possível identificar algum tipo de tendência a partir destes dados?</p>
<div id="número-de-acidentes-por-mês-nos-últimos-10-anos-agrupados-por-ano" class="section level4">
<h4>Número de acidentes por mês nos últimos 10 anos agrupados por ano</h4>
<p>Vejamos a seguir o gráfico separado por cada ano para comparar o comportamento dos dados:</p>
<pre class="text"><code>g2 +
  # geom_smooth(method = &quot;lm&quot;, se = F, aes(col = &quot;blue&quot;)) +
  facet_wrap( ~ year(month), scales = &quot;free_x&quot;) +
  scale_colour_manual(name=&quot; &quot;, values=c(&quot;blue&quot;),labels=c(&quot;Regressão Linear&quot;)) + 
  theme(legend.position = c(0.88,0.20))</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-12-1.png" width="1152" /></p>
<p>Neste gráfico vemos que dos anos de 2008 à 2014 os dados se comportam de forma parecida em torno de 100 à 75 acidentes. Porém em 2015 o número de acidentes termina por volta de 25 e este número se mantém ao longo dos anos.</p>
</div>
</div>
<div id="ajuste-do-modelo-descritivo" class="section level3">
<h3>Ajuste do modelo descritivo</h3>
<p>Para entender melhor essa tendência apresentada em 2015 será ajustado modelo de regressão linear simples conforme metodologia apresentada em <span class="citation">@tend</span>, que utilizam o tempo como variável explicativa e entender qual foi a variação do número de acidentes médios por mês.</p>
<p>O método utilizado para avaliar a tendência consiste em um ajuste de tendência em função do tempo (<span class="math inline">\(t\)</span>) com um modelo de regressão linear de maneira que:</p>
<p><span class="math display">\[
Y_{i} = \beta_0 + \beta_1 t_i + \epsilon_{i}  
\]</span></p>
<p>em que:</p>
<ul>
<li><span class="math inline">\(Y_i\)</span>: Tendência para o número de acidentes médios por mês no instante <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(t_i\)</span>: i-ésimo instante de tempo</li>
<li><span class="math inline">\(\beta_0\)</span>: Intercepto do modelo (valor de <span class="math inline">\(Y_i\)</span> quando <span class="math inline">\(t_i=0\)</span>)</li>
<li><span class="math inline">\(\beta_1\)</span>: Inclinação da reta ajustada (efeito da variável <span class="math inline">\(t_i\)</span>)</li>
<li><span class="math inline">\(\epsilon_i \sim N(0,\sigma^2)\)</span> onde <span class="math inline">\(\sigma^2\)</span> é constante</li>
</ul>
<p>Este modelo de regressão linear mede a variação da tendência para diferentes valores de intervalo de tempo na faixa de interesse. O ajuste é interpretado de acordo com a inclinação da reta formada pelos diferentes valores de referência em relação a respectiva tendência pode não ser o melhor método para a previsão mas pode ajudar a entender o comportamento da série como análise descritiva.</p>
<pre class="text"><code>to_lm &lt;- 
  base %&gt;%
  map_df(~.x%&gt;% select(id, data_inversa, causa_acidente, tipo_acidente)%&gt;%
           mutate_if(is.character,~ dmy(.x) )) %&gt;% 
  group_by(data_inversa=floor_date(data_inversa, &quot;1 month&quot;)) %&gt;% 
  summarise(n = n()) %&gt;% 
  filter(data_inversa &gt;= &quot;2015-01-01&quot; &amp; data_inversa &lt; &quot;2016-01-01&quot;)

y   &lt;- to_lm %$% n %&gt;%  ts(start = c(2015, 01, 01))

g2 +
  geom_smooth(method=&#39;lm&#39;,se=F,aes(col=I(&quot;darkred&quot;))) +
  geom_smooth(data=to_lm, aes(x=data_inversa, y=n,col=I(&quot;blue&quot;)), method = &quot;lm&quot;,se=F) +
  scale_colour_manual(name=NULL, values=c(&quot;red&quot;,&quot;blue&quot;,&quot;darkred&quot;),labels=c(
    &quot;Regressão Linear para 2015&quot;,
    &quot;Regressão Linear para todo período&quot;,
    &quot;Notícia&quot;
  )) + 
  theme(legend.position = c(0.2,0.18)) +
  geom_segment(x = as.Date(&quot;2015-11-13&quot;), xend = as.Date(&quot;2015-11-13&quot;),
               y=0, yend=100, linetype=&quot;dashed&quot;, aes(col=I(&quot;red&quot;))) +
  geom_text(aes(y = 100, x = as.Date(&quot;2015-11-13&quot;),
                label = &quot;G1 em 17/11/2015 :\n\&quot;Monitoramento com câmeras\n ajuda a reduzir acidentes\n  na Ponte Rio-Niterói\&quot; &quot;) ,hjust=-0.1) +
  scale_x_date(date_breaks = &#39;6 month&#39;) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1), 
        legend.background = element_rect(fill=alpha(&#39;lightgrey&#39;, 0.2)))</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-13-1.png" width="1152" /></p>
<p>Antes de conferir os resultados do ajuste do modelo, veja o resultado para o teste de sequências (Wald-Wolfowitz) que tem como hipótese alternativa <span class="math inline">\(H_1:\)</span> <em>existe tendência na série</em></p>
<pre class="text"><code>randtests::runs.test(y)</code></pre>
<pre><code>## 
##  Runs Test
## 
## data:  y
## statistic = -3.0277, runs = 2, n1 = 6, n2 = 6, n = 12, p-value =
## 0.002465
## alternative hypothesis: nonrandomness</code></pre>
<p>Ao nível de significância de <span class="math inline">\(\alpha :\)</span> 0.05 rejeita-se a hipótese nula de que esta série não apresenta tendência no período selecionado (2015).</p>
<p>Outra hipótese importante para conferir é sobre a normalidade da variável resposta, a seguir será aplicado o teste de Shapiro-wilk que tem como hipótese nula de que os dados possuem distribuição normal:</p>
<pre class="text"><code>shapiro.test(y)</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  y
## W = 0.9702, p-value = 0.9129</code></pre>
<p>De acordo com este teste, não existem evidências estatísticas para se rejeitar a hipótese da normalidade dos dados, portanto, para uma análise mais detalhada o modelo ajustado no período de 2015 pode ser obtido da seguinte maneira:</p>
<pre class="text"><code>fit &lt;- tslm(y ~ trend, data = y) </code></pre>
<p>Com o modelo está salvo no objeto <code>fit</code>, sua informação será incrementada no gráfico da regressão de 2015 para facilitar o entendimento dos resultados:</p>
<pre class="text"><code>g1 &lt;- 
  base %&gt;%
  map_df(~.x%&gt;% select(id, data_inversa, causa_acidente, tipo_acidente)) %&gt;% 
  group_by(data_inversa=floor_date(data_inversa, &quot;1 month&quot;)) %&gt;% 
  dplyr::summarise(n=n()) %&gt;%
  ggplot(aes(x=data_inversa, y=n)) +
  geom_line() +
  theme_bw() +
  labs(y= &#39;Número de acidentes&#39;,
       x = &#39;Data&#39;,
       subtitle = &quot;Por dia&quot;, 
       title= &#39;Número de acidentes na Ponte Rio-Niterói&#39;, 
       caption = &quot;Fonte dos dados:\nhttp://glo.bo/210j8gF\nhttps://www.prf.gov.br/portal/dados-abertos/acidentes\nhttps://gomesfellipe.github.io/&quot;) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(breaks=seq(0,100,25)) + 
  annotate(&quot;text&quot;, x=as.Date(&quot;2015-08-13&quot;), y = 75,
           label = paste(&quot;Modelo teórico: Yi = β^0 + β1 ti + ei:\nEstimador do Nº de acidentes =&quot;,round(fit$coefficients[1],2),round(fit$coefficients[2],2),&quot;*  Mês&quot;))

t &lt;- 
  fit %&gt;%
  tidy() %&gt;% 
  bind_cols(r2=c(glance(fit)[[1]] %&gt;% round(4),&quot;-&quot;),
            confint_tidy(fit)) %&gt;% 
  mutate_if(is.numeric,~ round(.x,4)) %&gt;% 
  mutate(term = c(&quot;Intercepto&quot;, &quot;Tendência&quot;)) %&gt;% 
  set_names(c(&quot;Coef.&quot;, &quot;Estimativa&quot;, &quot;Erro Padrão&quot;, &quot;Estatística&quot;, &quot;Valor P&quot;, &quot;R²&quot;,&quot;Lim. Inf.&quot;, &quot;Lim. Sup.&quot;)) 

# Funcao auxiliar para colorir a celula
g &lt;- tableGrob(t,rows = NULL)
find_cell &lt;- function(table, row, col, name=&quot;core-fg&quot;){
  # Fonte: 
  # https://cran.r-project.org/web/packages/gridExtra/vignettes/tableGrob.html
  l &lt;- table$layout
  which(l$t==row &amp; l$l==col &amp; l$name==name)
}

ind &lt;- find_cell(g, 3, 2, &quot;core-bg&quot;)
g$grobs[ind][[1]][[&quot;gp&quot;]] &lt;- gpar(fill=&quot;darkolivegreen1&quot;, col = &quot;darkolivegreen4&quot;, lwd=5)

g1 +
  scale_x_date(date_breaks = &#39;1 months&#39;,
               limits = as.Date(c(&quot;2015-01-01&quot;,&quot;2015-12-01&quot;)),
               expand = c(0.01,0.01)) +
  geom_smooth(data=to_lm, aes(x=data_inversa, y=n), method = &quot;lm&quot;,col=&quot;red&quot;,se=F)+
  annotation_custom(grob = g  , ymax=220,xmin=as.Date(&quot;2015-04-01&quot;))</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-17-1.png" width="1152" /></p>
<p>Nota-se que o coeficiente estimado para determinar a variação do número de acidentes ao aumentar a variável explicativa <code>trend</code> em uma unidade se apresenta de maneira significante, isto quer dizer que parece existir relação linear estatisticamente significante entre o mês da observação e a variável resposta.</p>
<p>Além disso é possível notar que para cada aumento de uma unidade da <code>tred</code> (ou seja, no decorrer de 1 mês), o valor esperado no número de acidentes observados naquele mês diminui em aproximadamente 4.7972.</p>
<p>Como -4.7972 x 12 = -57.5664 então o número de acidentes esperados decresce para aproximadamente 57.57% do valor original conforme a variável <code>tred</code> aumentou em 12 unidades (em 1 ano).</p>
<p>Veja o resultado para o teste de Shapiro - wilk para avaliar a hipótese de normalidade dos resíduos do modelo, os resíduos padronizados(quociente entre o resíduo e a estimativa do seu desvio padrão) e os resíduos <a href="https://en.wikipedia.org/wiki/Studentized_residual"><em>studentizados</em></a>, que levam em conta o <span class="math inline">\(h\)</span> (medida de alavancagem ou " <a href="https://en.wikipedia.org/wiki/Leverage_(statistics)">leverage</a>") em sua medida:</p>
<pre class="text"><code>bind_cols(
  residuals = fit$residuals,
  rstandard = rstandard(fit),
  rstudent = rstudent(fit)
) %&gt;%
  map_dbl(~shapiro.test(.x)$p.value)  %&gt;%
  tidy() %&gt;% 
  set_names(c(&quot;Medida&quot;, &quot;Valor p&quot;)) %&gt;% 
  kable(escape = F) %&gt;%
  kable_styling(&quot;hover&quot;,full_width = F)</code></pre>
<table class="table table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Medida
</th>
<th style="text-align:right;">
Valor p
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
residuals
</td>
<td style="text-align:right;">
0.1166788
</td>
</tr>
<tr>
<td style="text-align:left;">
rstandard
</td>
<td style="text-align:right;">
0.1801799
</td>
</tr>
<tr>
<td style="text-align:left;">
rstudent
</td>
<td style="text-align:right;">
0.0058696
</td>
</tr>
</tbody>
</table>
<p>Não existem evidências para rejeitar a hipótese de que os resíduos do modelo e os resíduos padronizados seguem distribuição normal. Já para os resíduos <em>studentizados</em> rejeita-se a hipótese de normalidade e como o valor de R² não foi muito alto (66.51%), indicando que a reta ajustada explica parcialmente a variação dos dados então pode ser interessante estudar com mais detalhes qual foi a influência do número de acidentes em cada mês no ajuste do modelo calculando as medias de influência para cada observação do modelo.</p>
<p>Uma observação é considerada influente caso sua exclusão no ajuste do modelo de regressão cause uma mudança substancial na análise de regressão e para identificar essas observações serão utilizadas as mesmas medidas utilizadas no post que fiz sobre <a href="https://gomesfellipe.github.io/post/2017-12-24-diagnostico-de-modelo/diagnostico-de-modelos/">Pacotes do R para avaliar o ajuste de modelos</a>.</p>
<p>De maneira visual e com medidas de influência do valor observado para cada mês no ajuste do modelo:</p>
<pre class="text"><code>t1  &lt;- influence.measures(fit) %$%
  infmat %&gt;% 
  as_tibble() %&gt;% 
  map_df(~.x %&gt;% round(4)) %&gt;% 
  mutate(mes = 1:12) %&gt;% 
  select(mes,everything()) %&gt;% 
  set_names(c(&quot;Mês&quot;,&quot;DF β1&quot;,&quot;DF β2&quot;,&quot;   DFFit&quot;,&quot;    CovRatio&quot;,&quot; D.Cook&quot;,&quot;   h&quot;))

g   &lt;- tableGrob(t1,rows = NULL)

ind &lt;- map_dbl(1:7, ~find_cell(g, 6, .x, &quot;core-bg&quot;))  

walk(ind, function(i) g$grobs[i][[1]][[&quot;gp&quot;]] &lt;&lt;-
       gpar(fill = &quot;darkolivegreen1&quot;, col = &quot;darkolivegreen1&quot;, lwd = 5)
)

# g2  &lt;-
#   ggplot2::autoplot(fit, print=F,suppressMessages=T) +
#   theme_bw()
# 
# gn  &lt;- arrangeGrob(g2[[1]], g2[[2]], g2[[3]], g2[[4]], g2[[5]], g2[[6]])
# 
# grid.arrange(gn, g, ncol=2)

grid.arrange(g)</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-19-1.png" width="1152" /></p>
<p>A tabela apresenta um resumo das medidas de inflencia de cada variável, segundo <span class="citation">@gauss</span>:</p>
<ul>
<li><strong>DF Beta</strong>: Alteração no vetor estimado β ao se retirar o i-ésimo ponto da análise<br />
</li>
<li><strong>DF Fit</strong>: Alteração provocada no valor ajustado pela retirada da observação i<br />
</li>
<li><strong>CovRatio</strong>: Expressa o relação de covariância<br />
</li>
<li><strong>D.Cook</strong>: Medida de afastamento das estimativas ao retirar i e também considera o resíduo estudentizado internamente<br />
</li>
<li><strong>h</strong>: Elementos da diagonal da matriz H</li>
</ul>
<p>É possível notar que no mês 5 (Maio) foi o mês que provocaria a maior alteração provocada no valor ajustado após sua retirada. Outra medida importante é a <a href="https://pt.wikipedia.org/wiki/Distância_de_Cook">Distância de Cook</a> que indica o quão atípica a observação <span class="math inline">\(i\)</span> se apresenta no ajuste do modelo combinando os resíduos estudentizados e as medidas de alavancagem possibilitando examinar observações que influenciam bastante as estimativas dos parâmetros.</p>
<p>Em geral, se <span class="math inline">\(D_i&gt;1\)</span> o ponto é excessivamente influente mas como no geral as observações apresentaram valor muito inferior a 1 então a eliminação de qualquer uma dessas variáveis não vai alterar substancialmente as estimativas dos parâmetros porém nós podemos <strong>examinar</strong> quaisquer observações cujo <span class="math inline">\(D_i\)</span> seja muito maior em relação aos demais valores estimados para <span class="math inline">\(D_i\)</span> com mais cuidado para entender qual foi foi sua influência no ajuste do modelo:</p>
<pre class="text"><code># Como a funcao augment do broom nao parece mais suportar o modelo ajustado por tslm, vamos ajustar na mão o modelo com a tendencia para criar o gráfico:
to_lm &lt;- to_lm %&gt;% mutate(trend = 1:nrow(.))
fit_lm &lt;- lm(y ~ trend, data = to_lm) 


fit_lm %&gt;% 
  broom::augment() %&gt;% 
  mutate(col = if_else(.resid==max(.resid), T, F))%&gt;%
  mutate(trend = factor(months(base[[1]]$data_inversa) %&gt;% unique,
                        levels = months(base[[1]]$data_inversa) %&gt;% unique) ) %&gt;% 
  ggplot(aes(x=trend,y=.resid,col=col,label=trend)) +
  geom_point() +
  geom_label(vjust = -0.25) +
  theme_bw() +
  scale_y_continuous(limits=c(-20,35),breaks = seq(-20,35,5)) +
  scale_color_manual(values=c(&quot;black&quot;, &quot;red&quot;)) +
  geom_hline(yintercept = 0,linetype=&quot;dashed&quot;,col=&quot;red&quot;) +
  theme(legend.position=&quot;none&quot;) +
  labs(y=&quot;Resíduos&quot;, x=&quot;Valores ajustados&quot;, title=&quot;Resíduos vs Ajuste&quot;)</code></pre>
<p><img src="/post/2018-09-29-freq-acidente-ponte-rio-niteroi.md/freq-acidente-ponte-rio-niteroi_files/figure-html/unnamed-chunk-20-1.png" width="1152" /></p>
<p>De fato o valor ajustado para o mês de maior é muito diferente do valor real observado, o que implica que houve um comportamento atípico que pode ser confirmado ao voltar no gráfico da série temporal e constatar um comportamento diferente (o número de acidente aumentou em relação ao anterior) e fugindo da tendência geral dos dados.</p>
</div>
</div>
</div>
<div id="próximos-passos" class="section level1">
<h1>Próximos passos <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/Toicon-icon-lines-and-angles-think.svg/2000px-Toicon-icon-lines-and-angles-think.svg.png" style="width:5.0%" /></h1>
<p>Uma das outras idéias que tive para a analisar estes dados conforme avançava com o estudo foi de cruza-los com o fluxo de carros na ponte para ter uma ideia de proporção mas essa ideia fica como sugestão para quem também tiver curiosidade sobre este assunto pois a intensão deste post é fazer uma análise de caráter introdutório para mostrar como é possível obter insights através dos dados com o uso da Estatística.</p>
<p>Além disso gostaria de incentivar todo o pessoal que gosta de dados e tiverem dúvidas sobre questões da vida, o universo e tudo mais a procurarem sempre por respostas mas tomar muito cuidado ao tirar conclusões! Este, por exemplo, foi um estudo de caráter introdutório e descritivo e obviamente existe uma porção de outras maneiras de estudar estes dados e como estamos diante de tanta abundância, basta uma pergunta que a investigação pode ser iniciada e se sempre temos a resposta para tudo nosso cérebro nunca entra “no modo de busca”. É importante sempre questionar respostas!</p>
</div>
<div id="referências" class="section level1">
<h1>Referências</h1>
<p>Notícia do G1: <a href="http://g1.globo.com/rio-de-janeiro/noticia/2015/11/monitoramento-com-cameras-ajuda-reduzir-acidentes-na-ponte-rio-niteroi.html">Monitoramento com câmeras ajuda a reduzir acidentes na Ponte Rio-Niterói</a></p>
</div>

        <p><strong>Leia o post completo em:</strong> <a href="https://gomesfellipe.github.io/post/2018-09-29-freq-acidente-ponte-rio-niteroi/freq-acidente-ponte-rio-niteroi/">Com que frequência ocorrem acidentes na ponte Rio-Niterói?</a></p>
        <p><em>Este post foi originalmente publicado em <a href="https://gomesfellipe.github.io/">Fellipe Gomes - Data Science Blog</a></em></p>
      ]]></content:encoded>
      <category>Analise Exploratória</category>
      <category>Data mining</category>
      <category>Mapas</category>
      <category>Prática</category>
      <category>R</category>
      <category>Regressão</category>
      <category>Tidyverse</category>
      <category>Séries Temporais</category>
      <category domain="tag">Tidyverse</category>
      <category domain="tag">Tabelas</category>
      <category domain="tag">Séries Temporais</category>
      <category domain="tag">RStudio</category>
      <category domain="tag">R Markdown</category>
      <category domain="tag">R</category>
      <category domain="tag">Prática</category>
      <category domain="tag">Mapa</category>
      <category domain="tag">ponte rio niteroi</category>
      <category domain="tag">acidentes</category>
      <category domain="tag">transito</category>
      <category domain="tag">Estatistica</category>
      <category domain="tag">Dplyr</category>
      <category domain="tag">gomesfellipe</category>
      <category domain="tag">leaflet</category>
    </item>
    <item>
      <title>Produzindo e formatando um documento Word direto em R</title>
      <link>https://gomesfellipe.github.io/post/2018-03-07-word-e-r-2/word-e-r-2/</link>
      <pubDate>Wed, 07 Mar 2018 00:00:00 +0000</pubDate>
      <author>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</author>
      <guid>https://gomesfellipe.github.io/post/2018-03-07-word-e-r-2/word-e-r-2/</guid>
      <description>As análises foram feitas em R e agora? Geralmente um bom PDF ou HTML são suficientes mas e se o destino da análise tiver que ser um documento Word?</description>
      <content:encoded>&lt;![CDATA[
        
<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>
<link href="/rmarkdown-libs/lightable/lightable.css" rel="stylesheet" />


<div id="relatórios-de-alta-qualidade-só-com-latex" class="section level1">
<h1>Relatórios de alta qualidade só com <span class="math inline">\(\LaTeX\)</span>?</h1>
<p>Como já mencionei no <a href="https://gomesfellipe.github.io/post/2018-01-12-tabelas-incriveis-com-r/tabelas-incriveis-com-r/">post sobre tabelas incríveis com R</a>, a tarefa de um estatístico (ou Data Scientist, em sua versão diluída e mais comercial) vai muito além do planejamento, análises, inferência, sumarização e interpretação de observações para fornecer a melhor informação possível a partir do dados disponíveis. A produção final dos relatórios é fundamental e na grande maioria das vezes utiliza-se a linguagem <span class="math inline">\(\LaTeX\)</span>, mas será que ela é realmente a única opção?</p>
<p>A escrita para a produção de documentação técnica e científica de alta qualidade é tão importante que até o <a href="https://www.prof-edigleyalexandre.com/2017/10/agora-facebook-messenger-permite-que-voce-escreva-formulas-matematicas-basicas-laTex.html">Facebook permite usar a linguagem <span class="math inline">\(\LaTeX\)</span> no messenger</a>. Normalmente para gerar arquivos em <span class="math inline">\(\LaTeX\)</span> existem muitas opções de softwares ou mesmo opções online como o <a href="https://www.overleaf.com/">overleaf</a> ou o <a href="https://pt.sharelatex.com/">sharelatex</a> que permitem escrever os documentos online com compilação em tempo real e armazenamento automático na nuvem. Para esse tipo de relatório escrito puramente em <span class="math inline">\(\LaTeX\)</span>, as funções dos pacotes <a href="https://cran.r-project.org/web/packages/stargazer/">stargazer</a>, <a href="https://cran.r-project.org/web/packages/xtable/index.html">xtable</a>, <a href="https://cran.r-project.org/web/packages/pander/index.html">pander</a> dentre outros, podem ser muito úteis na tarefa de produzir as tabelas dos resultados obtidos das análises em R para o formato <span class="math inline">\(\LaTeX\)</span>.</p>
<p>Além desses softwares a linguagem <span class="math inline">\(\LaTeX\)</span> pode ser utilizada diretamente de dentro do R em duas opções: O documento R Sweave e o documento Rmarkdown. Se for em Rmarkdown será necessária algumas configurações, como por exemplo algumas vezes a opção <code>results = "asis"</code> deve ser incluída nos chunks que deseja-se renderizar as tabelas <span class="math inline">\(\LaTeX\)</span>, caso seja R Sweave, pode ser que <a href="https://stat.epfl.ch/webdav/site/stat/shared/Regression/EPFL-Sweave-powerdot.pdf">essa documentação</a> ajude, pois as configurações dos chunks podem ser diferentes das configurações utilizadas em R markdown).</p>
<p>Porém, não basta obter informação através dos dados e com técnicas específicas transformá-los em conhecimento, geralmente tal conhecimento será destinado para alguma finalidade e não necessariamente a pessoa que irá receber nossos resultados vai desejar um documento em PDF ou html, além de não trabalhar com <a href="https://www.latex-project.org/"><span class="math inline">\(\LaTeX\)</span></a> nem conhecer as linguagens de programação muito utilizadas por nós, como <a href="https://www.r-project.org/">R</a> ou <a href="https://pt.wikipedia.org/wiki/Markdown">Markdown</a>. Na verdade isso nem é mesmo uma obrigação para quem contrata serviços de analytics.</p>
</div>
<div id="relatórios-em-word" class="section level1">
<h1>Relatórios em Word</h1>
<p>A partir do momento que é assumida a responsabilidade do entendimento da informação que passamos, acaba sendo necessário sair da nossa zona de conforto e aprender a falar na língua de quem nos ouve, para que a informação seja passada da maneira mais clara possível.</p>
<p>É muito comum criarmos nossas figuras e tabelas super elegantes e rechear nossos relatórios com as mais espertas interpretações a cerca dos resultados e compilar tudo em um arquivo .PDF (geralmente ao se utilizar <span class="math inline">\(\LaTeX\)</span>) ou mesmo em .html (muito comum ao se utilizar Rmarkdown), porém muitas vezes nossos resultados serão reaproveitados em documentos escritos em outros formatos e uma das escolhas optadas em escala mundial é escrever documentos em Word.</p>
<p>Geralmente quem trabalha com programação está sempre atento a otimizar seus processos, portanto integrar nossos resultados do R com um documento em Word é uma tarefa que pode ser muito útil dependendo da finalidade dos nossos dados.</p>
<p>Existem extensões para escrever <span class="math inline">\(\LaTeX\)</span> diretamente no word, como por exemplo o <a href="http://texpoint.necula.org/">TexPoint</a> que permite escrever invocações e definições de macro <span class="math inline">\(\LaTeX\)</span> junto com seu texto normal ou o <a href="http://aurora.pt.downloadastro.com/">Aurora</a> que é um programa de edição de texto que permite introduzir funções matemáticas complexas em texto de modo a esboçar relatórios e outras mensagens com caracteres únicos e equações. Particularmente nunca usei nenhuma das duas opções mas elas estão aí para quem quiser testar.</p>
<p>A extensão para word chamada <a href="http://www.grindeq.com/index.php?p=latex2word">GrindEQ™ Math Utilities</a> que permite fazer a conversão do documento <span class="math inline">\(\LaTeX\)</span> para word já foi muito útil para mim, porém muitas vezes ocorriam bugs na formatação e com a finalidade de focar os esforços nas análises e não na formatação, uma busca por alguma maneira de que a isso pudesse ser feito totalmente em R e o arquivo final ser um documento word já formatado pareceu interessante.</p>
<center>
<p><img src="http://www.grindeq.com/img/ribbon.jpg" /></p>
</center>
<p>Em algumas pesquisas descobri que existem diversas outras maneiras de se produzir um documento Word através do R, vou apresentar aqui duas maneiras com alguns truques, mas sintam-se a vontade para dar sugestões de outras maneiras de se fazer isso nos comentários, será de grande ajuda!</p>
<div id="º-método-rmd-to-docx" class="section level2">
<h2>1º método: Rmd to docx</h2>
<p>O primeiro método envolve o uso da opção nativa do R de produzir esse tipo de documento. Segundo este <a href="https://rmarkdown.rstudio.com/articles_docx.html">guia disponível pela RStudio</a> basta selecionar o tipo de arquivo Rmarkdown da seguinte maneira:</p>
<center>
<img src="https://d33wubrfki0l68.cloudfront.net/a419c1c8f567e88f1ed51ade70752254d630de49/fc1b2/articles/images/new-file-screenshot.png" />
</center>
<p>Então selecione o formato Word para o documento, e se desejar já pode alterar o nome do título e autor do documento (não é obrigado a fazer isso nesse momento)</p>
<center>
<img src="https://d33wubrfki0l68.cloudfront.net/66a92ebda97ab32fc7b4dc3a919fcc688a15482c/32107/articles/images/new-r-markdown-box.png" />
</center>
<p>Um novo documento será exibido com o preâmbulo default para esse tipo de arquivo. O interessante aqui é que você pode compilar seu documento, alterar o estilo e salvar na mesma pasta do arquivo que você está trabalhando, de forma que as alterações no estilo sejam salvas e utilizadas como referência ao incluir no preâmbulo o nome deste documento como no exemplo a seguir:</p>
<pre><code>---
title: &quot;Título do trabalho&quot;
author: &quot;Fellipe&quot;
date: &quot; 06 de março de 2018&quot;
output:
  word_document:
    reference_docx: word-styles-reference-01.docx
---</code></pre>
<p>Outros recursos interessantes são os de formatar tabelas e figuras. Para formatar as tabelas podemos utilizar os pacotes que já usávamos em documentos <span class="math inline">\(\LaTeX\)</span> para PDF ou Rmd para html. como por exemplo veja uma tabela simples produzida por códigos em R gerando uma tabela em Word usando a função <code>kable</code>:</p>
<center>
<img src="/post/2018-03-07-word-e-r-2/word-e-r-2_files/img4.png" />
</center>
<p>Muitas outras opções podem ser utilizadas, mais informações podem ser conferidas na <a href="https://rmarkdown.rstudio.com/articles_docx.html">documentação no site da RStudio</a> ou então conferir as opções de formatação utilizando a função <code>knitr::kable()</code> e o pacote <code>kableExtra</code> no <a href="https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html">manual do pacote kableExtra</a>.</p>
<p>Para alterar as dimensões de todas as figuras do documento ou mesmo incluir um sumário também basta alterar as especificações do preâmbulo, como por exemplo:</p>
<pre><code>---
title: &quot;Título do trabalho&quot;
author: &quot;Fellipe&quot;
date: &quot; 06 de março de 2018&quot;
output: word_document
    reference_docx: word-styles-reference-01.docx
    fig_width: 7
    fig_height: 4
    fig_caption: true
    toc: true
---</code></pre>
<p>Muito simples gerar o arquivo diretamente em Word!</p>
</div>
<div id="º-método-grmddocx_document" class="section level2">
<h2>2º método: Grmd::docx_document</h2>
<p>Mesmo com a simplicidade oferecida pelo recurso nativo do R, não parece ser possível formatar as tabelas da maneira mais elaborara utilizando essas funções, fiz um post falando sobre <a href="https://gomesfellipe.github.io/post/2018-01-12-tabelas-incriveis-com-r/tabelas-incriveis-com-r/">como criar tabelas incríveis com R</a> porém a maioria das opções dos pacotes apresentados lá servem apenas para documentos no formato html.</p>
<p>Pesquisando se havia algum jeito de criar o documento em html que pudesse ser aberto no Word encontrei um pacote disponível no github chamado <a href="https://github.com/gforge/Grmd"><code>Grmd</code></a>. Sua finalidade é trabalhar com a publicação rápida, escrevendo o documento como normalmente em RMarkdown e permitindo que o documento html gerado possa ser aberto em Word sem problemas de formatação!</p>
<p>Por exemplo, uma formatação da tabela e elaborção de imagem que é bem tranquilo de se fazer em html com o <code>knitr::kable()</code> e com <code>ggplot::ggplot()</code>:</p>
<pre class="r"><code>dt &lt;- mtcars[1:5, 1:6]
#Tabela gerada:
kable(dt,
      &quot;html&quot;,
      caption= &quot;Título&quot;,
      align = c(&quot;l&quot;,&quot;r&quot;,&quot;l&quot;,&quot;r&quot;,&quot;l&quot;,&quot;r&quot;,&quot;l&quot;))%&gt;%
  kable_styling(full_width = F) %&gt;%
  add_header_above(c(&quot; &quot; = 1, &quot;Group 1&quot; = 2, &quot;Group 2&quot; = 2, &quot;Group 3&quot; = 2))%&gt;%
  group_rows(&quot;Grupo A&quot;,1,3)%&gt;%
  group_rows(&quot;Grupo B&quot;,4,5)</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-1">Table 1: </span>Título
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Group 1
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Group 2
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Group 3
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
mpg
</th>
<th style="text-align:right;">
cyl
</th>
<th style="text-align:left;">
disp
</th>
<th style="text-align:right;">
hp
</th>
<th style="text-align:left;">
drat
</th>
<th style="text-align:right;">
wt
</th>
</tr>
</thead>
<tbody>
<tr grouplength="3">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Grupo A</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Mazda RX4
</td>
<td style="text-align:left;">
21.0
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
160
</td>
<td style="text-align:right;">
110
</td>
<td style="text-align:left;">
3.90
</td>
<td style="text-align:right;">
2.620
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Mazda RX4 Wag
</td>
<td style="text-align:left;">
21.0
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
160
</td>
<td style="text-align:right;">
110
</td>
<td style="text-align:left;">
3.90
</td>
<td style="text-align:right;">
2.875
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Datsun 710
</td>
<td style="text-align:left;">
22.8
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
108
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:left;">
3.85
</td>
<td style="text-align:right;">
2.320
</td>
</tr>
<tr grouplength="2">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Grupo B</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Hornet 4 Drive
</td>
<td style="text-align:left;">
21.4
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
258
</td>
<td style="text-align:right;">
110
</td>
<td style="text-align:left;">
3.08
</td>
<td style="text-align:right;">
3.215
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Hornet Sportabout
</td>
<td style="text-align:left;">
18.7
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
360
</td>
<td style="text-align:right;">
175
</td>
<td style="text-align:left;">
3.15
</td>
<td style="text-align:right;">
3.440
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>library(tidyr)
library(ggplot2)
n=nrow(mtcars)

rbind(
cbind(gather(mtcars[,1:2]*10),Grupo=rep(&quot;Grupo1&quot;,n)),
cbind(gather(mtcars[,3:4]),Grupo=rep(&quot;Grupo2&quot;,n)),
cbind(gather(mtcars[,5:6]*100),Grupo=rep(&quot;Grupo3&quot;,n))
)%&gt;%
  ggplot(aes( fill=key, x=value))+  geom_bar(position=&quot;dodge&quot;)+
  coord_flip()+ facet_wrap(~Grupo,ncol = 1)+ 
  xlab(&quot;Banco mtcars adaptado para exemplo&quot;)+theme(axis.text.x = element_text(size=18)) +
  theme_set(theme_gray(base_size = 13))+theme(axis.title.y = element_text(size = rel(1.2)))+theme_bw()</code></pre>
<p><img src="/post/2018-03-07-word-e-r-2/word-e-r-2_files/figure-html/unnamed-chunk-1-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Pode ser muito útil utilizar da mesma praticidade de construir as tabelas em html nos documentos words. Utilizando o pacote <a href="https://github.com/gforge/Grmd"><code>Grmd</code></a>, ao abrir o documento no Word a tabela e figura acima serão exibidas da seguinte maneira:</p>
<center>
<img src="/post/2018-03-07-word-e-r-2/word-e-r-2_files/img2.png" />
</center>
<p>Para utilizar o pacote basta instala-lo através da função <code>devtools::install_github("gforge/Grmd")</code>, após o pacote instalado é só modificar onde estiver escrito <code>output:word_document</code> no preâmbulo por <code>Grmd::docx_document</code> e ficar tranquilo, porque todas as funcionalidades apresentadas acima continuam funcionando! Veja o exemplo acima alterado:</p>
<pre><code>---
title: &quot;Título do trabalho&quot;
author: &quot;Fellipe&quot;
date: &quot; 06 de março de 2018&quot;
output: word_document
    reference_docx: word-styles-reference-01.docx
    fig_width: 7
    fig_height: 4
    fig_caption: true
    toc: true
---</code></pre>
<p>Portanto ao deixar o preâmbulo dessa nova maneira, seu documento será renderizado em html e poderá ser aberto e editado como documento Word tranquilamente! Assim a pessoa que receber o relatório final estará em contato direto com suas análises em um formato que seja amigável para ela e ela se sinta confortável em editar, copiar, colar ou fazer o que bem entender!</p>
<p>Atenção! Pois no github do desenvolvedor possui um aviso de que o pacote “provavelmente será fundido com o pacote Gmisc”, portanto é bom ficar atento a possíveis alterações!</p>
</div>
</div>
<div id="dica-para-casos-extremos" class="section level1">
<h1>Dica para casos extremos</h1>
<p>A principal dica quando não sabemos resolver um problema é: MANTENHA A CALMA! Mesmo com todas essas opções, ainda existem casos que nenhum esses artifícios será o bastante! Para isso muitas vezes é preciso explorar o desconhecido e usar a criatividade!</p>
<p>Um problema prático que eu tive e precisava solucionar em um tempo razoavelmente curto era que de as margens das tabelas que eu criei não cabiam de maneira satisfatória na página. Diante disso pesquisei bastante e me lembrei que assim como o Excel, o Word também possui Macros! Portanto pesquisando mais um pouco na internet encontrei <a href="https://datascienceplus.com/r-markdown-how-to-format-tables-and-figures-in-docx-files/">este artigo</a> que ensina como formatar tabelas e figuras em documentos .docx!</p>
<center>
<img src="https://lh6.googleusercontent.com/-pgLFnuWFV7E/UDVVoRcvmrI/AAAAAAAAAxU/1qTUIIrvxpA/s347/Bot%25C3%25A3o%2520Macro.png" />
</center>
<p><a href="https://datascienceplus.com/r-markdown-how-to-format-tables-and-figures-in-docx-files/">No artigo</a> é apresentada uma Macro para formatar as tabelas então depois de pesquisar um pouco e fazer algumas alterações foi bem útil para resolver meu problema com o tamanho da letra e a posição das tabelas! A Macro adaptada foi a seguinte:</p>
<pre><code>Sub FormatTables()

 Dim tbl As Table
    For Each tbl In ActiveDocument.Tables
         tbl.AutoFormat wdTableFormatList6
         tbl.Range.Font.Name = &quot;Arial&quot;
         tbl.Range.Font.Size = 6
         tbl.Range.ParagraphFormat.SpaceBefore = 1
         tbl.Range.ParagraphFormat.SpaceAfter = 2
         tbl.Range.Cells.SetHeight RowHeight:=18, HeightRule:=wdRowHeightExactly

    Next

End Sub</code></pre>
<p>Esta macro formata todas as tabelas o documento, selecionando o estilo <code>TableFormatList6</code>, a fonte <code>Arial</code> com o tamanho <code>6</code> e altera os espaçamentos de parágrafos, resumindo todo esse processo em um único botão</p>
</div>
<div id="foco-nas-análises" class="section level1">
<h1>Foco nas análises</h1>
<center>
<img src="/post/2018-03-07-word-e-r-2/word-e-r-2_files/img3.jpg" />
</center>
<p>Após usar o o recurso <code>Grmd::docx_document</code> em conjunto com a Macro <code>FormatTables</code> foi possível focar nas análises dos resultados e deixar a tarefa de formatação muito mais ágil, porém este método não é definitivo e a busca por novas maneiras de fazer e otimizar esse e outros tipos de tarefas integradas com R continua!</p>
</div>

        <p><strong>Leia o post completo em:</strong> <a href="https://gomesfellipe.github.io/post/2018-03-07-word-e-r-2/word-e-r-2/">Produzindo e formatando um documento Word direto em R</a></p>
        <p><em>Este post foi originalmente publicado em <a href="https://gomesfellipe.github.io/">Fellipe Gomes - Data Science Blog</a></em></p>
      ]]></content:encoded>
      <category>Estatistica</category>
      <category>R</category>
      <category>Reports</category>
      <category>Prática</category>
      <category>RMarkdown</category>
      <category domain="tag">Estatistica</category>
      <category domain="tag">gamificacao</category>
      <category domain="tag">gomesfellipe</category>
      <category domain="tag">Prática</category>
      <category domain="tag">R</category>
      <category domain="tag">R Markdown</category>
      <category domain="tag">word</category>
      <category domain="tag">macro</category>
      <category domain="tag">rmarkdown</category>
    </item>
    <item>
      <title>Tabelas incriveis com R</title>
      <link>https://gomesfellipe.github.io/post/2018-01-12-tabelas-incriveis-com-r/tabelas-incriveis-com-r/</link>
      <pubDate>Fri, 12 Jan 2018 00:00:00 +0000</pubDate>
      <author>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</author>
      <guid>https://gomesfellipe.github.io/post/2018-01-12-tabelas-incriveis-com-r/tabelas-incriveis-com-r/</guid>
      <description>Alguns pacotes que serão bem úteis na hora de criar tabelas lindas e informativas!</description>
      <content:encoded>&lt;![CDATA[
        
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>
<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>
<link href="/rmarkdown-libs/lightable/lightable.css" rel="stylesheet" />


<div id="importâcia-da-apresentação-dos-dados" class="section level1">
<h1>Importâcia da apresentação dos dados</h1>
<p>O trabalho do estatístico vai muito além do planejamento, sumarização e interpretação de observações para fornecer a melhor informação possível a partir do dados disponíveis. O processo de analises deve ser tratado na etapa final de todo projeto ou pesquisa que envolva apresentação dos resultados, não é atoa que já até existem áreas dentro da ciência de dados focada nesta tarefa, recebendo o título de “Data Artist”.</p>
<p>Além da variedade de pacotes que auxiliam na apresentação das figuras geradas nas análises(como já foi visto em alguns posts como estes <a href="https://gomesfellipe.github.io/post/2017-12-24-diagnostico-de-modelo/diagnostico-de-modelos/">para visualizar a qualidade do ajuste de modelos</a> ou <a href="https://gomesfellipe.github.io/post/2017-12-18-bayesiana-jags-mcmcplot/bayesiana-jags-mcmcplot/">este para valiar ajuste de modelos pela abordagem bayesiana</a>), também contamos com alguns pacotes que possibilitam a apresentação de tabelas de maneira bastante satisfatória (de forma elegante e até interativa)</p>
<p>Seja escrevendo relatórios em <span class="math inline">\(\LaTeX\)</span>, Rmarkdown ou até mesmo um aplicativo shiny , este posta tem a finalidade de trazer algumas alternativas para a boa apresentação dos resultados.</p>
<p>Como de costume vou apresentar alguns pacotes que serão bem úteis na hora de criar aquelas tabelas lindas e informativas que qualquer cliente adora.</p>
</div>
<div id="pacote-dt" class="section level1">
<h1>Pacote <code>DT</code></h1>
<p>O pacote <code>DT</code> é uma excelente opção quando se trata de incluir tabelas de dados em relatórios Rmarkdown, o pacote esta hospedado neste <a href="https://rstudio.github.io/DT/">link no github</a>, veja a seguir um simples exemplo de uso:</p>
<pre class="r"><code># install.packages(&quot;DT&quot;)  #caso ainda nao tenha o pacote instalado
DT::datatable(iris[1:20, c(5, 1:4)], rownames = FALSE)</code></pre>
<p><img src="/post/2018-01-12-tabelas-incriveis-com-r/tabelas-incriveis-com-r_files/img11.png" /></p>
<p>Com este <a href="https://cran.r-project.org/web/packages/DT/vignettes/DT.html">link do manual no CRAN</a> é possível entender melhor o funcionamento do pacote e conferir mais exemplos de uso.</p>
</div>
<div id="pacote-formattable" class="section level1">
<h1>Pacote <code>formattable</code></h1>
<p>Este pacote é repleto de funcionalidades interessantes para a formatação dos resultados dispostos em tabelas, também está <a href="https://github.com/renkun-ken/formattable">hospedado no github</a>, podendo ser instalado pelo CRAN ou com os comandos:</p>
<pre class="r"><code># Instalando pelo github
# library(devtools)
# devtools::install_github(&quot;renkun-ken/formattable&quot;)
library(formattable)</code></pre>
<p>Com o pacote carregado vamos conferir algumas das funcionalidades básicas:</p>
<pre class="r"><code>#Exemplo de formatação para resultados de porcentagem:
percent(c(0.1, 0.02, 0.03, 0.12))</code></pre>
<pre><code>## [1] 10.00% 2.00%  3.00%  12.00%</code></pre>
<pre class="r"><code>#Exemplo de formatação para resultados de na casa do milhar:
accounting(c(1000, 500, 200, -150, 0, 1200))</code></pre>
<pre><code>## [1] 1,000.00 500.00   200.00   (150.00) 0.00     1,200.00</code></pre>
<p>Vamos criar um <code>data.frame</code> para ilustrar algumas das funcionalidades do pacote:</p>
<pre class="r"><code>#criando um data.frame
df &lt;- data.frame(
  id = 1:10, 
  Nomes = c(&quot;Sofia&quot;, &quot;Kiara&quot;, &quot;Dunki&quot;, &quot;Edgar&quot;, &quot;Emilia&quot;,&quot;Gertrudes&quot;, &quot;Genovena&quot;, &quot;Champanhe&quot;, &quot;Amora&quot;, &quot;Penelope&quot;),
  Kilos = accounting(c(20000, 30000, 50000, 70000, 47000,80000,45000,35000,20000,25000), format = &quot;d&quot;),
  Crescimento = percent(c(0.1, 0.2, 0.5, 0.95, 0.97,0.45,0.62,0.57,0.37, 0.3), format = &quot;d&quot;),
  Suficiente = formattable(c(T, F, T, F, T,F,F,T,T,F), &quot;Sim&quot;, &quot;Não&quot;))</code></pre>
<p>Com esses resultados, vejamos um exemplo de tabela que pode ser criada para apresentar esses resultados com o pacote:</p>
<pre class="r"><code>formattable(df, list(
  id = color_tile(&quot;white&quot;, &quot;orange&quot;),
  Suficiente = formatter(&quot;span&quot;, style = x ~ ifelse(x == T, 
                                               style(color = &quot;green&quot;, font.weight = &quot;bold&quot;), NA)),
  area(col = c(Kilos)) ~ normalize_bar(&quot;lightgrey&quot;, 0.2),
  Crescimento = formatter(&quot;span&quot;,
                          style = x ~ style(color = ifelse(rank(-x) &lt;= 3, &quot;green&quot;, &quot;gray&quot;)),
                          x ~ sprintf(&quot;%.2f (rank: %02g)&quot;, x, rank(-x)))
))</code></pre>
<table class="table table-condensed">
<thead>
<tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:right;">
Nomes
</th>
<th style="text-align:right;">
Kilos
</th>
<th style="text-align:right;">
Crescimento
</th>
<th style="text-align:right;">
Suficiente
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">1</span>
</td>
<td style="text-align:right;">
Sofia
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 20.00%">20,000</span>
</td>
<td style="text-align:right;">
<span style="color: gray">0.10 (rank: 10)</span>
</td>
<td style="text-align:right;">
<span style="color: green; font-weight: bold">Sim</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #fff5e2">2</span>
</td>
<td style="text-align:right;">
Kiara
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 33.33%">30,000</span>
</td>
<td style="text-align:right;">
<span style="color: gray">0.20 (rank: 09)</span>
</td>
<td style="text-align:right;">
<span>Não</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffebc6">3</span>
</td>
<td style="text-align:right;">
Dunki
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 60.00%">50,000</span>
</td>
<td style="text-align:right;">
<span style="color: gray">0.50 (rank: 05)</span>
</td>
<td style="text-align:right;">
<span style="color: green; font-weight: bold">Sim</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffe1aa">4</span>
</td>
<td style="text-align:right;">
Edgar
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 86.67%">70,000</span>
</td>
<td style="text-align:right;">
<span style="color: green">0.95 (rank: 02)</span>
</td>
<td style="text-align:right;">
<span>Não</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffd78d">5</span>
</td>
<td style="text-align:right;">
Emilia
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 56.00%">47,000</span>
</td>
<td style="text-align:right;">
<span style="color: green">0.97 (rank: 01)</span>
</td>
<td style="text-align:right;">
<span style="color: green; font-weight: bold">Sim</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffcd71">6</span>
</td>
<td style="text-align:right;">
Gertrudes
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 100.00%">80,000</span>
</td>
<td style="text-align:right;">
<span style="color: gray">0.45 (rank: 06)</span>
</td>
<td style="text-align:right;">
<span>Não</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffc355">7</span>
</td>
<td style="text-align:right;">
Genovena
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 53.33%">45,000</span>
</td>
<td style="text-align:right;">
<span style="color: green">0.62 (rank: 03)</span>
</td>
<td style="text-align:right;">
<span>Não</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffb938">8</span>
</td>
<td style="text-align:right;">
Champanhe
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 40.00%">35,000</span>
</td>
<td style="text-align:right;">
<span style="color: gray">0.57 (rank: 04)</span>
</td>
<td style="text-align:right;">
<span style="color: green; font-weight: bold">Sim</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffaf1c">9</span>
</td>
<td style="text-align:right;">
Amora
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 20.00%">20,000</span>
</td>
<td style="text-align:right;">
<span style="color: gray">0.37 (rank: 07)</span>
</td>
<td style="text-align:right;">
<span style="color: green; font-weight: bold">Sim</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffa500">10</span>
</td>
<td style="text-align:right;">
Penelope
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgrey; width: 26.67%">25,000</span>
</td>
<td style="text-align:right;">
<span style="color: gray">0.30 (rank: 08)</span>
</td>
<td style="text-align:right;">
<span>Não</span>
</td>
</tr>
</tbody>
</table>
<p>Para entender melhor o funcionamento do pacote e conferir mais exemplo de uso confira o <a href="https://cran.r-project.org/web/packages/formattable/vignettes/introduction.html">manual de introdução ao pacote</a> e <a href="https://cran.r-project.org/web/packages/formattable/vignettes/formattable-data-frame.html">manual do pacote</a>, ambos disponíveis no CRAN.</p>
</div>
<div id="o-pacote-knitr-e-kabbleextra" class="section level1">
<h1>O pacote <code>knitr</code> e <code>kabbleExtra</code></h1>
<p>O pacote <code>knitr</code> permite o uso da função <code>kable()</code> que produz tabelas parecidas com as apresentadas com o pacote <code>DT</code>, porém trás diversas outras funcionalidades que podem ser combinadas com as funcionalidades de outros pacotes, como o <code>kableExtra</code> e até mesmo o <code>formattable</code> apresentado acima.</p>
<p>Os exemplos aqui apresentados foram retirados (sem alterações) do <a href="https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html#overview">manual do pacote no CRAN</a></p>
<pre class="r"><code>#Carregando pacotes
library(knitr)
library(kableExtra)
#Carregando pacote para ajudar na manipulação dos dados:
library(dplyr)

mtcars[1:10, 1:2] %&gt;%
  mutate(
    car = row.names(.),
    # Você não precisa de formato = &quot;html&quot; se você já definiu opções (knitr.table.format)
    mpg = cell_spec(mpg, &quot;html&quot;, color = ifelse(mpg &gt; 20, &quot;red&quot;, &quot;blue&quot;)),
    cyl = cell_spec(cyl, &quot;html&quot;, color = &quot;white&quot;, align = &quot;c&quot;, angle = 45, 
                    background = factor(cyl, c(4, 6, 8), 
                                        c(&quot;#666666&quot;, &quot;#999999&quot;, &quot;#BBBBBB&quot;)))) %&gt;%
  select(car, mpg, cyl) %&gt;%
  kable(&quot;html&quot;, escape = F) %&gt;%
  kable_styling(&quot;striped&quot;, full_width = F)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
car
</th>
<th style="text-align:left;">
mpg
</th>
<th style="text-align:left;">
cyl
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Mazda RX4
</td>
<td style="text-align:left;">
<span style="     color: red !important;">21</span>
</td>
<td style="text-align:left;">
<span style="-webkit-transform: rotate(45deg); -moz-transform: rotate(45deg); -ms-transform: rotate(45deg); -o-transform: rotate(45deg); transform: rotate(45deg); display: inline-block; "><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #999999 !important;text-align: c;">6</span></span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Mazda RX4 Wag
</td>
<td style="text-align:left;">
<span style="     color: red !important;">21</span>
</td>
<td style="text-align:left;">
<span style="-webkit-transform: rotate(45deg); -moz-transform: rotate(45deg); -ms-transform: rotate(45deg); -o-transform: rotate(45deg); transform: rotate(45deg); display: inline-block; "><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #999999 !important;text-align: c;">6</span></span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Datsun 710
</td>
<td style="text-align:left;">
<span style="     color: red !important;">22.8</span>
</td>
<td style="text-align:left;">
<span style="-webkit-transform: rotate(45deg); -moz-transform: rotate(45deg); -ms-transform: rotate(45deg); -o-transform: rotate(45deg); transform: rotate(45deg); display: inline-block; "><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #666666 !important;text-align: c;">4</span></span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Hornet 4 Drive
</td>
<td style="text-align:left;">
<span style="     color: red !important;">21.4</span>
</td>
<td style="text-align:left;">
<span style="-webkit-transform: rotate(45deg); -moz-transform: rotate(45deg); -ms-transform: rotate(45deg); -o-transform: rotate(45deg); transform: rotate(45deg); display: inline-block; "><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #999999 !important;text-align: c;">6</span></span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Hornet Sportabout
</td>
<td style="text-align:left;">
<span style="     color: blue !important;">18.7</span>
</td>
<td style="text-align:left;">
<span style="-webkit-transform: rotate(45deg); -moz-transform: rotate(45deg); -ms-transform: rotate(45deg); -o-transform: rotate(45deg); transform: rotate(45deg); display: inline-block; "><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #BBBBBB !important;text-align: c;">8</span></span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Valiant
</td>
<td style="text-align:left;">
<span style="     color: blue !important;">18.1</span>
</td>
<td style="text-align:left;">
<span style="-webkit-transform: rotate(45deg); -moz-transform: rotate(45deg); -ms-transform: rotate(45deg); -o-transform: rotate(45deg); transform: rotate(45deg); display: inline-block; "><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #999999 !important;text-align: c;">6</span></span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Duster 360
</td>
<td style="text-align:left;">
<span style="     color: blue !important;">14.3</span>
</td>
<td style="text-align:left;">
<span style="-webkit-transform: rotate(45deg); -moz-transform: rotate(45deg); -ms-transform: rotate(45deg); -o-transform: rotate(45deg); transform: rotate(45deg); display: inline-block; "><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #BBBBBB !important;text-align: c;">8</span></span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Merc 240D
</td>
<td style="text-align:left;">
<span style="     color: red !important;">24.4</span>
</td>
<td style="text-align:left;">
<span style="-webkit-transform: rotate(45deg); -moz-transform: rotate(45deg); -ms-transform: rotate(45deg); -o-transform: rotate(45deg); transform: rotate(45deg); display: inline-block; "><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #666666 !important;text-align: c;">4</span></span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Merc 230
</td>
<td style="text-align:left;">
<span style="     color: red !important;">22.8</span>
</td>
<td style="text-align:left;">
<span style="-webkit-transform: rotate(45deg); -moz-transform: rotate(45deg); -ms-transform: rotate(45deg); -o-transform: rotate(45deg); transform: rotate(45deg); display: inline-block; "><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #666666 !important;text-align: c;">4</span></span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Merc 280
</td>
<td style="text-align:left;">
<span style="     color: blue !important;">19.2</span>
</td>
<td style="text-align:left;">
<span style="-webkit-transform: rotate(45deg); -moz-transform: rotate(45deg); -ms-transform: rotate(45deg); -o-transform: rotate(45deg); transform: rotate(45deg); display: inline-block; "><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: #999999 !important;text-align: c;">6</span></span>
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>#Outro exemplo colorido legal:
iris[1:10, ] %&gt;%
  mutate_if(is.numeric, function(x) {
    cell_spec(x, &quot;html&quot;, bold = T, color = spec_color(x, end = 0.9),
              font_size = spec_font_size(x))
  }) %&gt;%
  mutate(Species = cell_spec(
    Species, &quot;html&quot;, color = &quot;white&quot;, bold = T,
    background = spec_color(1:10, end = 0.9, option = &quot;A&quot;, direction = -1)
  )) %&gt;%
  kable(&quot;html&quot;, escape = F, align = &quot;c&quot;) %&gt;%
  kable_styling(&quot;striped&quot;, full_width = F)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
Sepal.Length
</th>
<th style="text-align:center;">
Sepal.Width
</th>
<th style="text-align:center;">
Petal.Length
</th>
<th style="text-align:center;">
Petal.Width
</th>
<th style="text-align:center;">
Species
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(40, 174, 128, 1) !important;font-size: 14px;">5.1</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(31, 154, 138, 1) !important;font-size: 13px;">3.5</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(62, 75, 138, 1) !important;font-size: 10px;">1.4</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(53, 96, 141, 1) !important;font-size: 11px;">0.2</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: rgba(254, 206, 145, 1) !important;">setosa</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(37, 131, 142, 1) !important;font-size: 12px;">4.9</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(72, 34, 116, 1) !important;font-size: 9px;">3</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(62, 75, 138, 1) !important;font-size: 10px;">1.4</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(53, 96, 141, 1) !important;font-size: 11px;">0.2</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: rgba(254, 160, 109, 1) !important;">setosa</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(57, 87, 140, 1) !important;font-size: 10px;">4.7</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(56, 88, 140, 1) !important;font-size: 10px;">3.2</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(68, 1, 84, 1) !important;font-size: 8px;">1.3</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(53, 96, 141, 1) !important;font-size: 11px;">0.2</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: rgba(246, 110, 92, 1) !important;">setosa</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(67, 62, 133, 1) !important;font-size: 10px;">4.6</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(67, 62, 133, 1) !important;font-size: 10px;">3.1</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(37, 131, 142, 1) !important;font-size: 12px;">1.5</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(53, 96, 141, 1) !important;font-size: 11px;">0.2</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: rgba(222, 73, 104, 1) !important;">setosa</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(31, 154, 138, 1) !important;font-size: 13px;">5</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(41, 175, 127, 1) !important;font-size: 14px;">3.6</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(62, 75, 138, 1) !important;font-size: 10px;">1.4</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(53, 96, 141, 1) !important;font-size: 11px;">0.2</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: rgba(183, 55, 121, 1) !important;">setosa</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(187, 223, 39, 1) !important;font-size: 16px;">5.4</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(187, 223, 39, 1) !important;font-size: 16px;">3.9</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(187, 223, 39, 1) !important;font-size: 16px;">1.7</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(187, 223, 39, 1) !important;font-size: 16px;">0.4</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: rgba(140, 41, 129, 1) !important;">setosa</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(67, 62, 133, 1) !important;font-size: 10px;">4.6</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(37, 131, 142, 1) !important;font-size: 12px;">3.4</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(62, 75, 138, 1) !important;font-size: 10px;">1.4</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(34, 168, 132, 1) !important;font-size: 13px;">0.3</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: rgba(100, 26, 128, 1) !important;">setosa</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(31, 154, 138, 1) !important;font-size: 13px;">5</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(37, 131, 142, 1) !important;font-size: 12px;">3.4</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(37, 131, 142, 1) !important;font-size: 12px;">1.5</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(53, 96, 141, 1) !important;font-size: 11px;">0.2</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: rgba(60, 15, 112, 1) !important;">setosa</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(68, 1, 84, 1) !important;font-size: 8px;">4.4</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(68, 1, 84, 1) !important;font-size: 8px;">2.9</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(62, 75, 138, 1) !important;font-size: 10px;">1.4</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(53, 96, 141, 1) !important;font-size: 11px;">0.2</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: rgba(20, 14, 54, 1) !important;">setosa</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(37, 131, 142, 1) !important;font-size: 12px;">4.9</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(67, 62, 133, 1) !important;font-size: 10px;">3.1</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(37, 131, 142, 1) !important;font-size: 12px;">1.5</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: rgba(68, 1, 84, 1) !important;font-size: 8px;">0.1</span>
</td>
<td style="text-align:center;">
<span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: rgba(0, 0, 4, 1) !important;">setosa</span>
</td>
</tr>
</tbody>
</table>
<p>Mais um exemplo, dessa vez integrando com o pacote <code>formattable</code>:</p>
<pre class="r"><code>#Integrando com formattable
suppressMessages(library(formattable))
mtcars[1:5, 1:4] %&gt;%
  mutate(
    car = row.names(.),
    mpg = color_tile(&quot;white&quot;, &quot;orange&quot;)(mpg),
    cyl = cell_spec(cyl, &quot;html&quot;, angle = (1:5)*60, 
                    background = &quot;red&quot;, color = &quot;white&quot;, align = &quot;center&quot;),
    disp = ifelse(disp &gt; 200,
                  cell_spec(disp, &quot;html&quot;, color = &quot;red&quot;, bold = T),
                  cell_spec(disp, &quot;html&quot;, color = &quot;green&quot;, italic = T)),
    hp = color_bar(&quot;lightgreen&quot;)(hp)
  ) %&gt;%
  select(car, everything()) %&gt;%
  kable(&quot;html&quot;, escape = F) %&gt;%
  kable_styling(&quot;hover&quot;, full_width = F) %&gt;%
  column_spec(5, width = &quot;3cm&quot;) %&gt;%
  add_header_above(c(&quot; &quot;, &quot;Hello&quot; = 2, &quot;World&quot; = 2))</code></pre>
<table class="table table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Hello
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
World
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
car
</th>
<th style="text-align:left;">
mpg
</th>
<th style="text-align:left;">
cyl
</th>
<th style="text-align:left;">
disp
</th>
<th style="text-align:left;">
hp
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Mazda RX4
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffcc6f">21.0</span>
</td>
<td style="text-align:left;">
<span style="-webkit-transform: rotate(60deg); -moz-transform: rotate(60deg); -ms-transform: rotate(60deg); -o-transform: rotate(60deg); transform: rotate(60deg); display: inline-block; "><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: red !important;text-align: center;">6</span></span>
</td>
<td style="text-align:left;">
<span style="  font-style: italic;   color: green !important;">160</span>
</td>
<td style="text-align:left;width: 3cm; ">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgreen; width: 62.86%">110</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Mazda RX4 Wag
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffcc6f">21.0</span>
</td>
<td style="text-align:left;">
<span style="-webkit-transform: rotate(120deg); -moz-transform: rotate(120deg); -ms-transform: rotate(120deg); -o-transform: rotate(120deg); transform: rotate(120deg); display: inline-block; "><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: red !important;text-align: center;">6</span></span>
</td>
<td style="text-align:left;">
<span style="  font-style: italic;   color: green !important;">160</span>
</td>
<td style="text-align:left;width: 3cm; ">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgreen; width: 62.86%">110</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Datsun 710
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffa500">22.8</span>
</td>
<td style="text-align:left;">
<span style="-webkit-transform: rotate(180deg); -moz-transform: rotate(180deg); -ms-transform: rotate(180deg); -o-transform: rotate(180deg); transform: rotate(180deg); display: inline-block; "><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: red !important;text-align: center;">4</span></span>
</td>
<td style="text-align:left;">
<span style="  font-style: italic;   color: green !important;">108</span>
</td>
<td style="text-align:left;width: 3cm; ">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgreen; width: 53.14%">93</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Hornet 4 Drive
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffc357">21.4</span>
</td>
<td style="text-align:left;">
<span style="-webkit-transform: rotate(240deg); -moz-transform: rotate(240deg); -ms-transform: rotate(240deg); -o-transform: rotate(240deg); transform: rotate(240deg); display: inline-block; "><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: red !important;text-align: center;">6</span></span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    color: red !important;">258</span>
</td>
<td style="text-align:left;width: 3cm; ">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgreen; width: 62.86%">110</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Hornet Sportabout
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">18.7</span>
</td>
<td style="text-align:left;">
<span style="-webkit-transform: rotate(300deg); -moz-transform: rotate(300deg); -ms-transform: rotate(300deg); -o-transform: rotate(300deg); transform: rotate(300deg); display: inline-block; "><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: red !important;text-align: center;">8</span></span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    color: red !important;">360</span>
</td>
<td style="text-align:left;width: 3cm; ">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: lightgreen; width: 100.00%">175</span>
</td>
</tr>
</tbody>
</table>
</div>
<div id="o-pacote-sparklike" class="section level1">
<h1>O pacote <code>sparklike</code></h1>
<p>O sparklike é um pacote ótimo para enriquecer as aprestações de forma que possibilita incluir “mini gráficos” como boxplots, gráfico de linhas ou barras diretamente nas tabelas, como se fosse uma coluna do <code>data.frame</code>!</p>
<p>Seu funcionamento é bem simples e poderoso, apresento aqui alguns exemplo de uso, caso queira conferir mais detalhes, pode conferir o <a href="https://cran.r-project.org/web/packages/sparkline/vignettes/intro_sparkline.html">manual do pacote no CRAN</a> ou <a href="https://omnipotent.net/jquery.sparkline/#s-about">esta página</a>.</p>
<pre class="r"><code># library(devtools)
# install_github(&#39;htmlwidgets/sparkline&#39;)

#Carregando o pacote:
library(htmlwidgets)
library(sparkline)

#Exemplos de uso:
x = rnorm(20)
sparkline(x)
sparkline(x, type = &#39;bar&#39;)
sparkline(x, type = &#39;box&#39;)</code></pre>
<p><img src="/post/2018-01-12-tabelas-incriveis-com-r/tabelas-incriveis-com-r_files/img22.png" /></p>
<p>Exemplo de tabela para rmarkdown, a partir dessa sequência de códigos markdown e R:</p>
<pre class="r"><code>#Seja:
set.seed(1234)
x = rnorm(10)
y = rnorm(10)

#Ao digitar isso:

| Var.  | Sparkline         | Boxplot                       | Bar                          
|-------|-------------------|-------------------------------|------------------------------
| x     | `r sparkline(x)`  | `r sparkline(x, type =&#39;box&#39;)` |`r sparkline(x, type = &#39;bar&#39;)`
| y     | `r sparkline(y)`  | `r sparkline(y, type =&#39;box&#39;)` |`r sparkline(y, type = &#39;bar&#39;)`</code></pre>
<p>Exibe isso:</p>
<p><img src="/post/2018-01-12-tabelas-incriveis-com-r/tabelas-incriveis-com-r_files/img33.png" /></p>
</div>
<div id="o-pacote-rhandsontable" class="section level1">
<h1>O pacote <code>rhandsontable</code></h1>
<p>Mais um pacote repleto de funcionalidades que permitem a implementação de tabelas elegantes para a apresentação de projetos e pesquisas. Por se tratar de um <a href="www.htmlwidgets.org">htmlwidgets</a>, este pacote em especial é uma boa opção quando deseja-se apresentar tabela sem documentos no formato html ou com aplicativos shiny por exemplo.</p>
<p>Primeiramente apresentarei aqui primeiramente um exemplo com tabela de correlações utilizando formatação condicional:</p>
<pre class="r"><code>#Carregando o pacote:
library(rhandsontable)

#Tabela para correlações
rhandsontable(cor(iris[,-5]), readOnly = TRUE, width = 750, height = 300) %&gt;%
  hot_cols(renderer = &quot;
           function (instance, td, row, col, prop, value, cellProperties) {
           Handsontable.renderers.TextRenderer.apply(this, arguments);
           if (row == col) {
           td.style.background = &#39;lightgrey&#39;;
           } else if (col &gt; row) {
           td.style.background = &#39;grey&#39;;
           td.style.color = &#39;grey&#39;;
           } else if (value &lt; -0.75) {
           td.style.background = &#39;pink&#39;;
           } else if (value &gt; 0.75) {
           td.style.background = &#39;lightgreen&#39;;
           }
           }&quot;)</code></pre>
<p><img src="/post/2018-01-12-tabelas-incriveis-com-r/tabelas-incriveis-com-r_files/img44.png" /></p>
<p>Como este pacote possui muitas funcionalidades, apresentarei mais três exemplos baseados nas instruções do pacote e caso queira entender melhor o funcionamento e obter mais exemplos, consultar o <a href="https://cran.r-project.org/web/packages/rhandsontable/vignettes/intro_rhandsontable.html">manual no CRAN</a></p>
<pre class="r"><code>#Tabela com mini gráficos
#criando um data.frame
df &lt;- data.frame(
  id = 1:10, 
  Nomes = c(&quot;Sofia&quot;, &quot;Kiara&quot;, &quot;Dunki&quot;, &quot;Edgar&quot;, &quot;Aline&quot;,&quot;Gertrudes&quot;, &quot;Genovena&quot;, &quot;Champanhe&quot;, &quot;Pérola&quot;, &quot;Penelope&quot;),
  Kilos = accounting(c(20000, 30000, 50000, 70000, 47000,80000,45000,35000,20000,25000), format = &quot;d&quot;),
  Crescimento = percent(c(0.1, 0.2, 0.5, 0.95, 0.97,0.45,0.62,0.57,0.37, 0.3), format = &quot;d&quot;),
  Suficiente = c(T, F, T, F, T,F,F,T,T,F))

#E os gráficos de barra:
df$chart = c(sapply(1:5,
                    function(x) jsonlite::toJSON(list(values=rnorm(10,10,10),
                                                      options = list(type = &quot;bar&quot;)))),
             sapply(1:5,
                    function(x) jsonlite::toJSON(list(values=rnorm(10,10,10),
                                                      options = list(type = &quot;line&quot;)))))
rhandsontable(df, rowHeaders = NULL, width = 550, height = 300) %&gt;%
  hot_col(&quot;chart&quot;, renderer = htmlwidgets::JS(&quot;renderSparkline&quot;))</code></pre>
<p><img src="/post/2018-01-12-tabelas-incriveis-com-r/tabelas-incriveis-com-r_files/img55.png" /></p>
<p>Também podemos incluir comentários em células específicas da tabela utilizando este pacote, veja:</p>
<p>(Para ver os comentários basta passar o mouse sobre a célula com a marcação vermelha na borda)</p>
<pre class="r"><code>#Incluindo comentarios:
comments = matrix(ncol = ncol(df), nrow = nrow(df))
comments[1, 1] = &quot;Exemplo de comentário&quot;
comments[2, 2] = &quot;Outro exemplo de comentario&quot;

rhandsontable(df, comments = comments, width = 550, height = 300)%&gt;%
  hot_col(&quot;chart&quot;, renderer = htmlwidgets::JS(&quot;renderSparkline&quot;))</code></pre>
<p><img src="/post/2018-01-12-tabelas-incriveis-com-r/tabelas-incriveis-com-r_files/img66.png" /></p>
<p>Caso a tabela dos dados seja muito grande, também podemos utilizar o pacote para gerar a tabela com a barra de rolar</p>
<pre class="r"><code>#Tabela com barra de rolar para grande base de dados
rhandsontable(mtcars, rowHeaderWidth = 200, width = 700, height = 550)</code></pre>
</div>
<div id="relatórios-muito-mais-bonitos" class="section level1">
<h1>Relatórios muito mais bonitos</h1>
<p>Com essas lindas tabelas seus relatórios serão irresistíveis, até quem não entende de estatística vai passar a gostar depois de ver tanta beleza com números! Espero que tenha gostado do conteúdo, caso queira acrescentar ou reportar algo basta entrar em contato.</p>
</div>

        <p><strong>Leia o post completo em:</strong> <a href="https://gomesfellipe.github.io/post/2018-01-12-tabelas-incriveis-com-r/tabelas-incriveis-com-r/">Tabelas incriveis com R</a></p>
        <p><em>Este post foi originalmente publicado em <a href="https://gomesfellipe.github.io/">Fellipe Gomes - Data Science Blog</a></em></p>
      ]]></content:encoded>
      <category>Estatistica</category>
      <category>Analise Mutivariada</category>
      <category>Reports</category>
      <category>Prática</category>
      <category>Analise Exploratória</category>
      <category domain="tag">Estatistica</category>
      <category domain="tag">Data Mining</category>
      <category domain="tag">gomesfellipe</category>
      <category domain="tag">Prática</category>
      <category domain="tag">analise multivariada</category>
      <category domain="tag">R Markdown</category>
      <category domain="tag">Tabelas</category>
    </item>
    <item>
      <title>Análise Multivariada com R</title>
      <link>https://gomesfellipe.github.io/post/2018-01-04-analise-multivariada-em-r/analise-multivariada-em-r/</link>
      <pubDate>Thu, 04 Jan 2018 00:00:00 +0000</pubDate>
      <author>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</author>
      <guid>https://gomesfellipe.github.io/post/2018-01-04-analise-multivariada-em-r/analise-multivariada-em-r/</guid>
      <description>Análise Multivariada Imagem do Wikpedia
Esse é o primeiro post do ano e como no ano de 2017 falou-se tanto das maravilhas computacionais desta onda do Big Data e em contra partida, identificamos que deste 2004 a popularidade pelo termo “estatística” vem diminuindo como mostrei em uma breve pesquisa neste post sobre a API do googletrends sinto que existe uma necessidade de se ampliar também a divulgação dos métodos estatísticos pois o aprofundamento na teoria é fundamental (é muito fácil achar resultados sem fundamento apenas “apertando botão”), como as ferramentas da estatística multivariada que muitas vezes servem como soluções para essas grandes quantidades de dados</description>
      <content:encoded>&lt;![CDATA[
        
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<div id="análise-multivariada" class="section level1">
<h1>Análise Multivariada</h1>
<p><a href="https://commons.wikimedia.org/wiki/File:Multivariate_Gaussian.png">Imagem do Wikpedia</a></p>
<p>Esse é o primeiro post do ano e como no ano de 2017 falou-se tanto das maravilhas computacionais desta onda do Big Data e em contra partida, <a href="https://gomesfellipe.github.io/post/2017-12-12-google-trends-e-r/google-trends-e-r/">identificamos que deste 2004 a popularidade pelo termo “estatística” vem diminuindo como mostrei em uma breve pesquisa neste post sobre a API do googletrends</a> sinto que existe uma necessidade de se ampliar também a divulgação dos métodos estatísticos pois o aprofundamento na teoria é fundamental (é muito fácil achar resultados sem fundamento apenas “apertando botão”), como as ferramentas da estatística multivariada que muitas vezes servem como soluções para essas grandes quantidades de dados</p>
<p>Diversas vezes nos deparamos com bases de dados que envolvem além de muitas observações, muitas variáveis, especialmente nas análises de fenômenos ou processos sociais, psicológicos, educacionais e econômicos bem como na área da química, biologia, geologia, marketing, medicina, medicina veterinária, dentre muitas outras.</p>
<p>Com as ferramentas estatísticas da análise multivariada somos capazes de identificar muitos elementos que podem ter relevância na análise dos dados, dois exemplos de ferramentas importantes são as que permitem encontrar fatores que não são diretamente observáveis com base em um conjunto de variáveis observáveis e as que permitem agrupar conjuntos de dados que possuem características semelhantes com algorítimos computacionais (chamados de aprendizados não-supervisionados ou semi-supervisionados em machine learning) e a partir dai estudar as novas classificações.</p>
<p>Neste post será apresentado algumas soluções para o caso em que existe a necessidade de avaliar um grande conjunto de dados com muitas variáveis e não temos muitas informações a respeito.</p>
</div>
<div id="análise-fatorial" class="section level1">
<h1>Análise Fatorial</h1>
<p>Na análise fatorial buscamos fatores que explicam parte da variância total dos dados, os fatores são as somas das variâncias originais.</p>
<div id="objetivo-da-análise-fatorial" class="section level2">
<h2>Objetivo da análise fatorial:</h2>
<ul>
<li><p>Procura identificar fatores que não são diretamente observáveis, com base em um conjunto de variáveis observáveis.</p></li>
<li><p>Explicar a correlação ou covariância, entre um conjunto de variáveis, em termos de um número limitado de variáveis não-observáveis, chamadas de fatores ou variáveis latentes.</p></li>
<li><p>Em casos nos quais se tem um número grande de variáveis medidas e correlacionadas entre si, seria possível identificar-se um número menor de variáveis alternativas, não correlacionadas e que de algum modo sumarizassem as informações principais das variáveis originais.</p></li>
<li><p>A partir do momento em que os fatores são identificados, seus valores numéricos, chamados de escores, podem ser obtidos para cada elemento amostral. Conseqüentemente, estes escores podem ser utilizados em outras análises que envolvam outras técnicas estatísticas, como análise de regressão ou análise de variância, por exemplo.</p></li>
</ul>
</div>
<div id="etapas-para-realização" class="section level2">
<h2>Etapas para realização</h2>
<ul>
<li><p>Computação da matriz de correlações para as variáveis originais;</p></li>
<li><p>Extração de fatores</p></li>
<li><p>Rotação dos fatores para tonar a interpretação mais fácil;</p></li>
<li><p>Cálculo dos escores dos fatores</p></li>
</ul>
<div id="matriz-de-correlação" class="section level3">
<h3>Matriz de Correlação:</h3>
<ul>
<li>Teste de Bartlett - a hipótese nula da matriz de correlação ser uma matriz identidade ( <span class="math inline">\(| R | = 1\)</span> ), isto é, avalia se os componentes fora da diagonal principal são zero. O resultado significativo indica que existem algumas relações entre as variáveis.</li>
</ul>
<p>No R:</p>
<pre class="r"><code>Bartlett.sphericity.test &lt;- function(x)
{
  method &lt;- &quot;Teste de esfericidade de Bartlett&quot;
  data.name &lt;- deparse(substitute(x))
  x &lt;- subset(x, complete.cases(x)) # Omitindo valores faltantes
  n &lt;- nrow(x)
  p &lt;- ncol(x)
  chisq &lt;- (1-n+(2*p+5)/6)*log(det(cor(x)))
  df &lt;- p*(p-1)/2
  p.value &lt;- pchisq(chisq, df, lower.tail=FALSE)
  names(chisq) &lt;- &quot;X-squared&quot;
  names(df) &lt;- &quot;df&quot;
  return(structure(list(statistic=chisq, parameter=df, p.value=p.value,
                        method=method, data.name=data.name), class=&quot;htest&quot;))
}
Bartlett.sphericity.test(dados)</code></pre>
<pre><code>## 
##  Teste de esfericidade de Bartlett
## 
## data:  dados
## X-squared = 2590.3, df = 55, p-value &lt; 2.2e-16</code></pre>
<ul>
<li>Teste KMO (Kaiser-Meyer-Olkin) - avalia a adequação do tamanho amostra. Varia entre 0 e 1, onde: zero indica inadequado para análise fatorial, aceitável se for maior que 0.5, recomendado acima de 0.8.</li>
</ul>
<p>No R:</p>
<pre class="r"><code>kmo = function(x)
{
  x = subset(x, complete.cases(x))
  r = cor(x)
  r2 = r^2 
  i = solve(r) 
  d = diag(i) 
  p2 = (-i/sqrt(outer(d, d)))^2 
  diag(r2) &lt;- diag(p2) &lt;- 0 
  KMO = sum(r2)/(sum(r2)+sum(p2))
  MSA = colSums(r2)/(colSums(r2)+colSums(p2))
  return(list(KMO=KMO, MSA=MSA))
}

kmo(dados)</code></pre>
<pre><code>## $KMO
## [1] 0.5942236
## 
## $MSA
##         A         B         C         D         E         F         G         H 
## 0.6789278 0.9151657 0.6897541 0.3385536 0.8699746 0.3632508 0.5172135 0.4878681 
##         I         J         K 
## 0.4901580 0.4895023 0.4686937</code></pre>
<div id="tipos-de-correlação" class="section level4">
<h4>Tipos de correlação:</h4>
<p>Nem sempre é possível utilizar a correlação de pearson, porém, existem diversas outras maneiras de se saber qual a correlação dos dados. Podemos utilizar correlações como de Spearman, Policórica, etc.. Já fiz um post onde explico os <a href="https://gomesfellipe.github.io/post/tipos-de-relacoes-entre-variaveis/">diferentes tipos de relações entre os tipos de variáveis</a> e os <a href="https://gomesfellipe.github.io/post/tipos-de-correlacoes/">tipos de correlações</a> possíveis para avaliar a relação dessas variáveis.</p>
<p>Aqui um outro exemplo de como utilizar a correlação parcial</p>
<pre class="r"><code>partial.cor &lt;- function (x)
{
R &lt;- cor(x)
RI &lt;- solve(R)
D &lt;- 1/sqrt(diag(RI))
Rp &lt;- -RI * (D %o% D)
diag(Rp) &lt;- 0
rownames(Rp) &lt;- colnames(Rp) &lt;- colnames(x)
Rp
}
mat_anti_imagem &lt;- -partial.cor(dados[,1:10])
mat_anti_imagem</code></pre>
<pre><code>##              A           B            C           D           E            F
## A  0.000000000 -0.25871349 -0.872167400  0.01668860 -0.04245837 -0.011036934
## B -0.258713494  0.00000000 -0.204228090  0.05621580  0.09801359  0.060189694
## C -0.872167400 -0.20422809  0.000000000 -0.02459342 -0.00482831 -0.008201211
## D  0.016688604  0.05621580 -0.024593418  0.00000000 -0.18602037  0.806258927
## E -0.042458373  0.09801359 -0.004828310 -0.18602037  0.00000000 -0.140784264
## F -0.011036934  0.06018969 -0.008201211  0.80625893 -0.14078426  0.000000000
## G  0.006994874 -0.12746560  0.045529480 -0.75073120 -0.32160010 -0.792991683
## H -0.071792191  0.03375700  0.059785980 -0.03196914  0.08903510  0.001496987
## I  0.055698412 -0.03720345 -0.040061304  0.08243832 -0.03925037  0.084673934
## J -0.042609593  0.06775755  0.004145341 -0.06024239  0.05806892 -0.001404078
##              G            H           I            J
## A  0.006994874 -0.071792191  0.05569841 -0.042609593
## B -0.127465596  0.033756995 -0.03720345  0.067757550
## C  0.045529480  0.059785980 -0.04006130  0.004145341
## D -0.750731196 -0.031969142  0.08243832 -0.060242391
## E -0.321600101  0.089035097 -0.03925037  0.058068923
## F -0.792991683  0.001496987  0.08467393 -0.001404078
## G  0.000000000 -0.025016441 -0.05943429  0.009961615
## H -0.025016441  0.000000000 -0.55229599  0.044929237
## I -0.059434295 -0.552295987  0.00000000  0.056248550
## J  0.009961615  0.044929237  0.05624855  0.000000000</code></pre>
</div>
</div>
<div id="extração-de-fatores-via-componentes-principais" class="section level3">
<h3>Extração de fatores via componentes principais</h3>
<ul>
<li><p>Determinado o número de fatores necessários para representar os dados</p></li>
<li><p>Também é determinado o método que será utilizado, o mais utilizado é a análise de componentes principais</p></li>
</ul>
<div id="estimação-do-número-de-fatores-m" class="section level4">
<h4>Estimação do número de fatores m</h4>
<ul>
<li><p>Estimação do número de fatores m</p></li>
<li><p>Para a estimação de m, bastará extrair-se os autovalores da matriz de correlação amostral.</p></li>
<li><p>Observa-se quais autovalores são os mais importantes em termos de grandeza numérica.</p></li>
<li><p>os autovalores refletem a importância do fator se o número de fatores for igual ao número de variáveis então a soma dos autovetores é igual a soma das variâncias (pois cada variância será igual a 1).</p></li>
<li><p>Portanto a razão $ / 2 var $ indica proporção da variabilidade total explicada pelo fator</p></li>
</ul>
<p><strong>Critérios:</strong></p>
<ol style="list-style-type: decimal">
<li><p>A análise da proporção da variância total relacionada com cada autovalor (<span class="math inline">\(\lambda_i\)</span>). Permanecem aqueles autovalores que maiores proporções da variância total e, portanto, o valor de m será igual ao número de autovalores retidos;</p></li>
<li><p>A comparação do valor numérico de (<span class="math inline">\(\lambda_i\)</span>) com o valor 1. O valor de m será igual ao número de autovalores maiores ou iguais a 1.</p></li>
<li><p>Observação do gráfico scree-plot, que dispõe os valores de (<span class="math inline">\(\lambda_i\)</span>) ordenados em ordem decrescente. Por este critério, procura-se no gráfico um “ponto de salto”, que estaria representando um decréscimo de importância em relação à variância total. O valor de m seria então igual ao número de autovalores anteriores ao “ponto de salto”.</p></li>
</ol>
</div>
</div>
<div id="análise-de-componentes-principais" class="section level3">
<h3>Análise de componentes Principais:</h3>
<ul>
<li><p>Fatores são obtidos através da decomposição espectral da matriz de correlações, resultado em cargas fatoriais que indicam o quanto cada variável está associada a cada fator e os autovalores associados a cada um dos fatores envolvidos</p></li>
<li><p>São formadas combinações lineares das variáveis observadas.</p></li>
<li><p>O primeiro componente principal consiste na combinação que responde pela maior quantidade de variância na amostra.</p></li>
<li><p>O segundo componente responde pela segunda maior variância na amostra e não é correlacionado com o primeiro componente.</p></li>
<li><p>Sucessivos componentes explicam progressivamente menores porções de variância total da amostra e todos são não correlacionados uns aos outros.</p></li>
</ul>
<p>No R a análise de componentes principais pode ser realizada com as funções nativas <code>prcomp()</code> e a visualização pode ser realizada com a função <code>biplot</code> nativa do R ou com a função <code>autoplot()</code> do pacote <code>ggfortify</code> apresentado em um posto que eu <a href="https://gomesfellipe.github.io/post/2017-12-26-diagnostico-de-modelos/diagnostico-de-modelos/">comento sobre ajustes de modelos lineares</a>.</p>
<p>Neste exemplo utilizaremos <a href="https://github.com/vqv/ggbiplot/blob/master/R/ggscreeplot.r">as funções de código aberto encontrei nesse github</a> que permite elaborar o gráfico baseado em funções do <code>ggplot</code>, além disso também carregaremos o pacote deste Github. Veja:</p>
<pre class="r"><code>library(ggplot2)
library(ggfortify)
library(ggbiplot)
#Componentes principais:
acpcor=prcomp(dados, scale = TRUE)
summary(acpcor)</code></pre>
<pre><code>## Importance of components:
##                           PC1    PC2    PC3    PC4     PC5     PC6    PC7
## Standard deviation     1.7205 1.5835 1.2745 1.2107 1.02156 0.72100 0.6634
## Proportion of Variance 0.2691 0.2280 0.1477 0.1333 0.09487 0.04726 0.0400
## Cumulative Proportion  0.2691 0.4971 0.6447 0.7780 0.87285 0.92011 0.9601
##                           PC8     PC9    PC10    PC11
## Standard deviation     0.4953 0.33061 0.25079 0.14588
## Proportion of Variance 0.0223 0.00994 0.00572 0.00193
## Cumulative Proportion  0.9824 0.99235 0.99807 1.00000</code></pre>
<pre class="r"><code>ggbiplot(acpcor, obs.scale = 1, var.scale = 1,
   ellipse = TRUE, circle = TRUE) +
  scale_color_discrete(name = &#39;&#39;) +
  theme(legend.direction = &#39;horizontal&#39;, legend.position = &#39;top&#39;)</code></pre>
<p><img src="/post/2018-01-04-analise-multivariada-em-r/analise-multivariada-em-r_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="r"><code># autoplot(acpcor, label = TRUE, label.size = 1,
#          loadings = TRUE, loadings.label = TRUE, loadings.label.size  = 3)</code></pre>
<p>Para a observação do gráfico scree-plot podemos utilizar os comandos a seguir (com funções nativas do R ou mesmo com funções personalizadas como a que eu acabei de comentar <a href="https://github.com/vqv/ggbiplot/blob/master/R/ggscreeplot.r">disponivel nesse github</a></p>
<pre class="r"><code>#Com Funcao nativa do R:
# plot(1:ncol(dados), acpcor$sdev^2, type = &quot;b&quot;, xlab = &quot;Componente&quot;,
#      ylab = &quot;Variância&quot;, pch = 20, cex.axis = 1.3, cex.lab = 1.3)

#Ou funcao personalizada com ggplot2:
ggscreeplot(acpcor)</code></pre>
<p><img src="/post/2018-01-04-analise-multivariada-em-r/analise-multivariada-em-r_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<div id="rotação" class="section level4">
<h4>Rotação</h4>
<ul>
<li><p>Algumas variáveis são mais correlacionadas com alguns fatores do que outras.</p></li>
<li><p>Em alguns casos, a interpretação dos fatores originais pode não ser tarefa muito fácil devido à aparição de coeficientes de grandeza numérica similar, e não desprezível, em vários fatores diferentes.</p></li>
<li><p>O propósito da rotação é obter uma estrutura simples.</p></li>
<li><p>Em uma estrutura simples, cada fator tem carga alta somente para algumas variáveis, tornando mais fácil a sua identificação.</p></li>
<li><p>Tipos: Varimax, Quartimax, Equamax</p></li>
</ul>
<p>Aplicando a Varimax:</p>
<pre class="r"><code>k &lt;- 6 #6 fatores selecionados
carfat = acpcor$rotation[, 1:k] %*% diag(acpcor$sdev[1:k])
carfatr = varimax(carfat)</code></pre>
</div>
<div id="comunalidade" class="section level4">
<h4>Comunalidade</h4>
<ul>
<li><p>Índices atribuídos a variável original que expressam em % o quanto da variabilidade de cada variável é explicada pelo modelo</p></li>
<li><p>Designa-se por comunalidade (<span class="math inline">\(h^{2}_i\)</span>)a proporção da variância de cada variável explicada pelos fatores comuns.</p></li>
<li><p>As comunalidades variam entre 0 e 1, sendo 0 quando os fatores comuns não explicam nenhuma variância da variável e 1 quando explicam toda a sua variância.</p></li>
<li><p>Quando o valor das comunalidades é menor que 0,6 deve-se
pensar em: aumentar a amostra, eliminar as variáveis.</p></li>
</ul>
</div>
</div>
<div id="interpretar-o-modelo" class="section level3">
<h3>Interpretar o modelo</h3>
<ul>
<li><p>Feito pelas cargas fatoriais que são os parâmetros do modelo</p></li>
<li><p>Fatores expressam as covariâncias entre cada fator e as variáveis originais</p></li>
<li><p>Varimax ajuda a interpretar o modelo</p></li>
<li><p>Rotações ortogonais (para dependente) ; Rotações oblíquas (para independentes)</p></li>
</ul>
</div>
</div>
</div>
<div id="clusters" class="section level1">
<h1>Clusters</h1>
<p>Técnica estatística multivariada que tem como objetivo organizar um conjunto de objetos em um determinado nº de subconjuntos mutuamente exclusivos (clusters), de tal forma que os objetos em um mesmo cluster sejam semelhantes entre si,porém diferentes dos objetos nos outros clusters</p>
<p>Etapas para análise de clusters, que são comuns em qualquer análise (KDD):</p>
<ul>
<li>Seleção dos objetos a serem agrupados</li>
<li>Definir conjunto de atributos que caracterizam os objetos</li>
<li>Medida de dissimilaridade</li>
<li>Seleção de um algoritmo de agregação</li>
<li>Definição do número de clusters</li>
<li>Interpretação e validação dos clusters</li>
</ul>
<p>Critérios para a seleção:</p>
<ul>
<li>Selecionar variáveis diferentes entre si</li>
<li>Variáveis padronizadas (padronização mais comum é a Z-score)</li>
</ul>
<p>Existem algumas abordagens para a utilização das técnicas de análises de clusters, as diferenças entre os métodos hierárquicos e os não hierárquicos são as seguintes:</p>
<p>Métodos Hierárquicos são preferidos quando:</p>
<ul>
<li>Serão analisadas varias alternativas de agrupamento.</li>
<li>O tamanho da amostra é moderado ( de 300 a 1000 objetos )</li>
</ul>
<p>Métodos não-hierárquicos são preferidos quando:</p>
<ul>
<li>O número de grupos é conhecido.</li>
<li>Presença dos outliers, desde que os métodos não-hierárquicos são
menos influenciados por outliers.</li>
<li>Há um grande nº de objetos a serem agrupados.</li>
</ul>
<div id="método-hierárquico-de-agrupamento" class="section level2">
<h2>Método hierárquico de agrupamento</h2>
<p>É realizado em dois passos, o primeiro deles calcula-se a matriz de similaridade com o uso da função <em>dist()</em> (existem diversos tipos de distâncias que podem ser utilizadas aqui), o método utilizado será o de <strong>Ward</strong> (também poderíamos escolher o método da menor distância, maior distância ou a distância média).</p>
<p>Vantagens:</p>
<ul>
<li>Rápidos e exigem menos tempo de processamento.</li>
<li>Apresentam resultados para diferentes níveis de agregação.</li>
</ul>
<p>Desvantagens:</p>
<ul>
<li>Alocação de um objeto em um cluster é irrevogável</li>
<li>Impacto substancial dos outliers ( apesar do Ward ser o menos susceptível)</li>
<li>Não apropriados para analisar uma amostra muito extensa, pois a medida que o tamanho da amostra aumenta, a necessidade de armazenamento das distâncias cresce drasticamente</li>
</ul>
<p>Para bases grandes é melhor não usar este método pois precisa da matriz de distâncias.</p>
<p>Dentre os métodos, a menor distância pode ser ruim em muitas situações, pois coloca muitos objetos no mesmo cluster.</p>
<p>Geralmente utiliza-se o dendograma para a visualização dos clusters.</p>
<pre class="r"><code>#Construindo a matriz de similaridade:
matriz_similaridade = dist(iris[,-5],             #Conjunto de dados utilizados
                           &quot;euclidean&quot;            #medida de distância utilizada
                           )

#Construindo o agrupamento hierárquico aglomerativo:
agrupamento = hclust(matriz_similaridade,     #Matriz de similaridade calculada
                     &quot;ward.D&quot;                 #Método de agrupamento
                     )
#Converte hclust em dendrograma e plot:
hcd &lt;- as.dendrogram(agrupamento)

library(ggdendro)
# Tipo pode ser &quot;rectangle&quot; ou &quot;triangle&quot;
dend_data &lt;- dendro_data(hcd, type = &quot;rectangle&quot;)
# o que esta contido em dend_data:
names(dend_data)</code></pre>
<pre><code>## [1] &quot;segments&quot;    &quot;labels&quot;      &quot;leaf_labels&quot; &quot;class&quot;</code></pre>
<pre class="r"><code>plot(agrupamento,xlab=&quot;Matriz de similaridade&quot;,main = &quot;Dendograma&quot;, cex = 0.3)
#Construindo representacao de grupos - geração de vetores:
grupos = cutree(agrupamento,             #Variável calculada em hclust
                3                        #Quantidade de grupos desejados
                )

#Construindo o dendograma:
rect.hclust(agrupamento, k=3, border=&quot;red&quot;)</code></pre>
<p><img src="/post/2018-01-04-analise-multivariada-em-r/analise-multivariada-em-r_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Existem diversas outras maneiras de se visualizar dendogramas, veja a seguir um outro exemplo utilizando o pacote <code>ape</code>:</p>
<pre class="r"><code>library(ape)
plot(as.phylo(agrupamento), type = &quot;unrooted&quot;, cex = 0.6,
     no.margin = TRUE)</code></pre>
<p><img src="/post/2018-01-04-analise-multivariada-em-r/analise-multivariada-em-r_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Para mais informações de métodos de plot de dendogramas,talvez <a href="http://www.sthda.com/english/wiki/beautiful-dendrogram-visualizations-in-r-5-must-known-methods-unsupervised-machine-learning">essa página</a> possa ser útil.</p>
</div>
<div id="método-não-hierárquico-de-agrupamento-k-means" class="section level2">
<h2>Método não hierárquico de agrupamento K-means</h2>
<p>Esta é uma das mais populares abordagens de agrupamento de dados por partição. A partir de uma escolha inicial para os centroides, o algoritmo procede verificando quais exemplares são mais similares a quais centroides.</p>
<p>Vantagens:</p>
<ul>
<li>Tendem a maximizar a dispersão entre os centros de gravidade dos clusters (mantem os clusters bem separados)</li>
<li>Simplicidade de cálculo, calcula somente as distâncias entre os objetos e os centros de gravidade dos clusters</li>
</ul>
<p>Desvantagens:</p>
<ul>
<li>Depende dos conjuntos de sementes iniciais, principalmente se a seleção das sementes é aleatória</li>
<li>Não há garantias de um agrupamento ótimo dos objetos</li>
</ul>
<pre class="r"><code>#Construindo o agrupamento por particionamento:
c = kmeans(iris[,-5],          #Conjunto de dados utilizados
                 2,            #Número de  grupos a ser descoberto
                 iter.max=5    #Número máximo de iterações permitido no algorítmo
                 )</code></pre>
<p>Para efeito de visualização, podemos utilizar a seguinte função que encontra dois fatores principais a partir da análise fatorial e às utiliza como eixos</p>
<pre class="r"><code>plot_kmeans = function(df, clusters, runs) {
  suppressMessages(library(psych))
  suppressMessages(library(ggplot2))
  
  #cluster
  tmp_k = kmeans(df, centers = clusters, nstart = 100)
  
  #factor
  tmp_f = fa(df, 2, rotate = &quot;none&quot;)
  
  #collect data
  tmp_d = data.frame(matrix(ncol=0, nrow=nrow(df)))
  tmp_d$cluster = as.factor(tmp_k$cluster)
  tmp_d$fact_1 = as.numeric(tmp_f$scores[, 1])
  tmp_d$fact_2 = as.numeric(tmp_f$scores[, 2])
  tmp_d$label = rownames(df)
  
  #plot
  g = ggplot(tmp_d, aes(fact_1, fact_2, color = cluster)) + geom_point() + geom_text(aes(label = label), size = 3, vjust = 1, color = &quot;black&quot;)
  return(g)
}
plot_kmeans(iris[,-5], 3)</code></pre>
<p><img src="/post/2018-01-04-analise-multivariada-em-r/analise-multivariada-em-r_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<div id="análise-exploratória-dos-clusters" class="section level3">
<h3>Análise exploratória dos clusters</h3>
<p>Não vou me estender nessa parte, mas é bom esclarecer que após encontrar os clusters e de extrema importância realizar a análise exploratória deles para entender os comportamentos dos grupos identificados.</p>
<pre class="r"><code>#Conferindo os grupos formados:
c$cluster%&gt;%
  table()</code></pre>
<pre><code>## .
##  1  2 
## 53 97</code></pre>
<pre class="r"><code>c$cluster%&gt;%
  table()%&gt;%
  barplot(main=&quot;Frequências dos clusters&quot;, names.arg=c(&quot;Cluster 1&quot;, &quot;Cluster 2&quot;))</code></pre>
<p><img src="/post/2018-01-04-analise-multivariada-em-r/analise-multivariada-em-r_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
</div>
<div id="medidas-de-validação-e-estabilidade" class="section level2">
<h2>Medidas de validação e estabilidade</h2>
<div id="pseudo-f" class="section level4">
<h4>pseudo-F</h4>
<p>O número adequado de clusters (k) deve ser maximizar o pseudo-F:</p>
<p><span class="math display">\[
pseudo-F = \dfrac{  \dfrac{BSS}{k-1} } { \dfrac{WSS}{N-k}} =\dfrac{\textrm{Quadrado médio entre clusters}}{\textrm{Quadrado médio dentro dos clusters}}
\]</span></p>
</div>
<div id="libraryclvalid" class="section level4">
<h4>library(clvalid)</h4>
<p>Este pacote faz os cálculos das medidas que avaliam se os clusters são compactos, bem separados e estáveis.</p>
<p>Vejamos os tipos de medidas:</p>
<p><strong>Medidas de validação</strong>:</p>
<ol style="list-style-type: decimal">
<li>conectividade: relativa ao grau de vizinhança entre objetos em um mesmo cluster, varia
entre 0 e infinito e quanto menor melhor.</li>
<li>silhueta: homogeneidade interna, assume valores entre -1 e 1 e quanto mais próximo de 1
melhor.</li>
<li>índice de Dunn: quantifica a separação entre os agrupamentos, assume valores entre 0 e 1 e
quanto maior melhor.</li>
</ol>
<p><strong>Medidas de estabilidade</strong>:</p>
<ol style="list-style-type: decimal">
<li>APN - average proportion of non-overlap: proporção média de observações não
classificadas no mesmo cluster nos casos com dados completos e incompletos. Assume valor
no intervalo [0,1], próximos de 0 indicam agrupamentos consistentes.</li>
<li>AD - average distance: distância média entre observações classificadas no mesmo cluster
nos casos com dados completos e incompletos. Assume valores não negativos, sendo
preferíveis valores próximos de zero.</li>
<li>ADM - average distance between means: distância média entre os centroides quando as
observações estão em um mesmo cluster. Assume valores não negativos, sendo preferíveis
valores próximos de zero.</li>
<li>FOM - figure of merit: medida do erro cometido ao usar os centroides como estimativas das
observações na coluna removida. Assume valores não negativos, sendo preferíveis valores
próximos de zero.</li>
</ol>
<pre class="r"><code>library(clValid)

#Medidas de validação:
valida=clValid(iris[1:4],3,clMethods=c(&quot;hierarchical&quot;,&quot;kmeans&quot;),validation=&quot;internal&quot;)
summary(valida)</code></pre>
<pre><code>## 
## Clustering Methods:
##  hierarchical kmeans 
## 
## Cluster sizes:
##  3 
## 
## Validation Measures:
##                                  3
##                                   
## hierarchical Connectivity   4.4770
##              Dunn           0.1378
##              Silhouette     0.5542
## kmeans       Connectivity  10.0917
##              Dunn           0.0988
##              Silhouette     0.5528
## 
## Optimal Scores:
## 
##              Score  Method       Clusters
## Connectivity 4.4770 hierarchical 3       
## Dunn         0.1378 hierarchical 3       
## Silhouette   0.5542 hierarchical 3</code></pre>
<pre class="r"><code>#Medidas de estabilidade;
valida=clValid(iris[1:4],3,clMethods=c(&quot;hierarchical&quot;,&quot;kmeans&quot;),validation=&quot;stability&quot;)
summary(valida)</code></pre>
<pre><code>## 
## Clustering Methods:
##  hierarchical kmeans 
## 
## Cluster sizes:
##  3 
## 
## Validation Measures:
##                        3
##                         
## hierarchical APN  0.0912
##              AD   1.0596
##              ADM  0.3680
##              FOM  0.4209
## kmeans       APN  0.0630
##              AD   0.9390
##              ADM  0.1131
##              FOM  0.3935
## 
## Optimal Scores:
## 
##     Score  Method Clusters
## APN 0.0630 kmeans 3       
## AD  0.9390 kmeans 3       
## ADM 0.1131 kmeans 3       
## FOM 0.3935 kmeans 3</code></pre>
</div>
<div id="gráfico-da-silhueta" class="section level4">
<h4>Gráfico da silhueta:</h4>
<pre class="r"><code>library(cluster)
#Construindo a matriz de similaridade:
matriz_similaridade = dist(iris[,-5],             #Conjunto de dados utilizados
                           &quot;euclidean&quot;            #medida de distância utilizada
                           )

#Construindo o agrupamento hierárquico aglomerativo:
agrupamento = hclust(matriz_similaridade,     #Matriz de similaridade calculada
                     &quot;ward.D&quot;                 #Método de agrupamento
                     )

silhueta =silhouette(cutree(agrupamento,k=3),dist(iris[,-5]))
plot(silhueta,main=&quot;&quot;)</code></pre>
<p><img src="/post/2018-01-04-analise-multivariada-em-r/analise-multivariada-em-r_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<pre class="r"><code>summary(silhueta)</code></pre>
<pre><code>## Silhouette of 150 units in 3 clusters from silhouette.default(x = cutree(agrupamento, k = 3), dist = dist(iris[,  from     -5])) :
##  Cluster sizes and average silhouette widths:
##        50        64        36 
## 0.7994998 0.4115006 0.4670305 
## Individual silhouette widths:
##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## -0.09013  0.39933  0.56701  0.55416  0.77690  0.85493</code></pre>
</div>
<div id="muitas-opções" class="section level3">
<h3>Muitas opções</h3>
<p>Como podemos observar, a análise de agrupamentos é um método exploratório. É útil para organizar conjuntos de dados que contam com características semelhantes.</p>
<p>É uma das principais técnicas da mineração de dados e já conta com grande variedade de algoritmos.</p>
</div>
</div>
</div>
<div id="referência" class="section level1">
<h1>Referência</h1>
<p><a href="https://www1.udel.edu/oiss/pdf/617.pdf">I Johnson e Wichern (2007). Applied Multivariate Statistical Analysis, 6th
Edition. Prentice-Hal</a></p>
</div>

        <p><strong>Leia o post completo em:</strong> <a href="https://gomesfellipe.github.io/post/2018-01-04-analise-multivariada-em-r/analise-multivariada-em-r/">Análise Multivariada com R</a></p>
        <p><em>Este post foi originalmente publicado em <a href="https://gomesfellipe.github.io/">Fellipe Gomes - Data Science Blog</a></em></p>
      ]]></content:encoded>
      <category>Estatistica</category>
      <category>R</category>
      <category>Teoria</category>
      <category>Analise Mutivariada</category>
      <category>Nao supervisionado</category>
      <category>Clustering</category>
      <category domain="tag">Estatistica</category>
      <category domain="tag">gomesfellipe</category>
      <category domain="tag">R Markdown</category>
      <category domain="tag">R</category>
      <category domain="tag">Teoria</category>
      <category domain="tag">pca</category>
      <category domain="tag">kmeans</category>
      <category domain="tag">clustering</category>
      <category domain="tag">analise multivariada</category>
    </item>
    <item>
      <title>Pacotes do R para avaliar o ajuste de modelos</title>
      <link>https://gomesfellipe.github.io/post/2017-12-24-diagnostico-de-modelo/diagnostico-de-modelos/</link>
      <pubDate>Sun, 24 Dec 2017 00:00:00 +0000</pubDate>
      <author>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</author>
      <guid>https://gomesfellipe.github.io/post/2017-12-24-diagnostico-de-modelo/diagnostico-de-modelos/</guid>
      <description>Alguns pacotes úteis para avaliar o ajuste do modelo de forma rápida, precisa e elegante</description>
      <content:encoded>&lt;![CDATA[
        
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<div id="funções-do-r-para-avaliar-o-ajuste-de-modelos" class="section level1">
<h1>Funções do R para avaliar o ajuste de modelos</h1>
<p>Traduzindo:</p>
<p>“<em>Essencialmente, todos os modelos estão errados, mas alguns são úteis</em>” - George E. P. Box</p>
<p>Se você estuda estatística provavelmente já deve saber quem é este simpático senhor. Box teve grande contribuição para a estatística. Foi aluno do Ronald Aylmer Fisher e ainda se casou com a filha dele!</p>
<p>Lendo um <a href="http://jaguar.fcav.unesp.br/RME/fasciculos/v27/v27_n4/A10_Millor.pdf">artigo sobre a vida de Fisher</a> um parágrafo me chamou atenção com uma fala de sua filha, que dizia o seguinte:</p>
<p>“Joan Fisher Box, filha de Fisher, em seu livro sobre a vida do pai, se referindo à péssima classificação dele em francês, escreveu: “… ele nunca teve muita paciência com irrelevâncias.” (Box, 1978)"</p>
<p>Fico imaginando o tamanho da contribuição desdes crânios para a comunidade se tivessem acesso a tantos mecanismos que temos hoje em dia e o que eles achariam relevantes..</p>
<p>Para o bom ajuste de um modelo, certamente; a inferência, as análises de desvios, os critérios de seleção de um modelo, conferir comportamento dos resíduos e avaliação das estatísticas de diagnósticos são muito relevantes.</p>
<p>No <a href="https://cran.r-project.org/">CRAN</a> já contamos com muitos pacotes disponíveis para nos auxiliar nessas avaliações, portanto vou mostrar aqui alguns pacotes com funções que já me ajudaram muito em avaliações de modelos indo além das funções nativas do R e do pacote <code>ggplot2</code> (Um excelente pacote para apresentações elegantes e práticas de resultados visuais).</p>
</div>
<div id="ggally" class="section level1">
<h1>GGally</h1>
<p>Este pacote é sensacional, existem funções muito relevantes nele para melhorar a nossa experiência com ajuste de modelos, as funções apresentadas aqui são baseadas na <a href="http://ggobi.github.io/ggally/#ggally">página de documentação GGally</a>, lá você pode conferir a documentação completa.</p>
<p>Primeiramente vamos carregar o pacote:</p>
<pre class="r"><code>library(GGally)</code></pre>
<p>Carregado o pacote, vejamos as principais funções que podem nos auxiliar.</p>
<div id="ggallyggcoef" class="section level2">
<h2><code>GGally::ggcoef</code></h2>
<p>O objetivo da função <code>GGally::ggcoef</code> é traçar rapidamente os coeficientes de um modelo.</p>
<p>Para um modelo linear:</p>
<pre class="r"><code>reg &lt;- lm(Sepal.Length ~ Sepal.Width + Petal.Length + Petal.Width, data = iris)
ggcoef(reg)</code></pre>
<p><img src="/post/2017-12-24-diagnostico-de-modelo/diagnostico-de-modelos_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Para um modelo logístico podemos utilizar o argumento <code>exponentiate = TRUE</code> e além disso, somos capazes de fazer diversas alterações no gráfico utilizando o <code>ggcoef()</code> veja alguns exemplo de argumentos que podem ser usados para personalizar como barras de erro e a linha vertical são plotadas:</p>
<pre class="r"><code>#Ajustando o modelo:
d &lt;- as.data.frame(Titanic)
log.reg &lt;- glm(Survived ~ Sex + Age + Class, family = binomial, data = d, weights = d$Freq)

#Elaborando o gráfico
ggcoef(
  log.reg,                      #O modelo a ser conferido
  exponentiate = TRUE,          #Para avaliar o modelo logístico
  vline_color = &quot;red&quot;,          #Reta em zero  
  #vline_linetype =  &quot;solid&quot;,   #Altera a linha de referência
  errorbar_color = &quot;blue&quot;,      #Cor da barra de erros
  errorbar_height = .25,
  shape = 18,                   #Altera o formato dos pontos centrais
  #size=3,                      #Altera o tamanho do ponto
  color=&quot;black&quot;,                #Altera a cor do ponto
  mapping = aes(x = estimate, y = term, size = p.value))+
  scale_size_continuous(trans = &quot;reverse&quot;) #Essa linha faz com que inverta o tamanho                 </code></pre>
<p><img src="/post/2017-12-24-diagnostico-de-modelo/diagnostico-de-modelos_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="ggallyggduo" class="section level2">
<h2><code>GGally::ggduo</code></h2>
<p>O objetivo desta função é exibir dois dados agrupados em uma matriz de plotagem. Isso é útil para análise de correlação canônica, análise de séries temporais múltiplas e análise de regressão.</p>
<p>Os dados do exemplo apresentados aqui podem ser encontrados neste <a href="http://www.stats.idre.ucla.edu/r/dae/canonical-correlation-analysis">link</a></p>
<pre class="r"><code>data(psychademic)
head(psychademic)</code></pre>
<pre><code>##   locus_of_control self_concept motivation read write math science    sex
## 1            -0.84        -0.24          4 54.8  64.5 44.5    52.6 female
## 2            -0.38        -0.47          3 62.7  43.7 44.7    52.6 female
## 3             0.89         0.59          3 60.6  56.7 70.5    58.0   male
## 4             0.71         0.28          3 62.7  56.7 54.7    58.0   male
## 5            -0.64         0.03          4 41.6  46.3 38.4    36.3 female
## 6             1.11         0.90          2 62.7  64.5 61.4    58.0 female</code></pre>
<pre class="r"><code>psych_variables &lt;- attr(psychademic, &quot;psychology&quot;)
academic_variables &lt;- attr(psychademic, &quot;academic&quot;)</code></pre>
<pre class="r"><code>ggduo(
  psychademic, psych_variables, academic_variables,
  types = list(continuous = &quot;smooth_lm&quot;),
  title = &quot;Correlação entre as variáveis psicológicas e academicas&quot;,
  xlab = &quot;Psicológicos&quot;,
  ylab = &quot;Academicas&quot;
)</code></pre>
<p><img src="/post/2017-12-24-diagnostico-de-modelo/diagnostico-de-modelos_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Uma vez que o <code>ggduo</code> não tem uma seção superior para exibir os valores de correlação, podemos usar uma função personalizada para adicionar a informação nas parcelas contínuas.</p>
<p>Criando uma função personalizada para informar a correlação entre as observações:</p>
<pre class="r"><code>lm_with_cor &lt;- function(data, mapping, ..., method = &quot;pearson&quot;) {
  x &lt;- eval(mapping$x, data)
  y &lt;- eval(mapping$y, data)
  cor &lt;- cor(x, y, method = method)
  ggally_smooth_lm(data, mapping, ...) +
    ggplot2::geom_label(
      data = data.frame(
        x = min(x, na.rm = TRUE),
        y = max(y, na.rm = TRUE),
        lab = round(cor, digits = 3)
      ),
      mapping = ggplot2::aes(x = x, y = y, label = lab),
      hjust = 0, vjust = 1,
      size = 5, fontface = &quot;bold&quot;,
      inherit.aes = FALSE # do not inherit anything from the ...
    )
}</code></pre>
<p>Portanto:</p>
<pre class="r"><code>ggduo(
  psychademic, psych_variables, academic_variables,
  types = list(continuous = &quot;smooth_lm&quot;),
  title = &quot;Correlação entre variáveis acadêmica e psicológica&quot;,
  xlab = &quot;Psicológica&quot;,
  ylab = &quot;Academica&quot;
)+
  theme(legend.position = &quot;bottom&quot;)</code></pre>
<p><img src="/post/2017-12-24-diagnostico-de-modelo/diagnostico-de-modelos_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Para avaliar resíduos da uma regressão ajustada para cada uma das variáveis explanatórias vs. as variáveis explanatórias:</p>
<pre class="r"><code>dados &lt;- datasets::swiss

# Criando uma coluna &quot;fake&quot;:
dados$Residual &lt;- seq_len(nrow(dados))

# Calculando todos os resíduos que serão exibidos:
colunas=2:6  #Informe as colunas que contem as variaveis explanatorias
residuals &lt;- lapply(dados[colunas], function(x) {
  summary(lm(Fertility ~ x, data = dados))$residuals
})
# Calculando um intervalo constante para todos os resíduos
y_range &lt;- range(unlist(residuals))

# Função modificada para mostrar os resíduos:

lm_or_resid &lt;- function(data, mapping, ..., line_color = &quot;red&quot;, line_size = 1) {
  if (as.character(mapping$y) != &quot;Residual&quot;) {
    return(ggally_smooth_lm(data, mapping, ...))
  }

  # Criando os resíduos para apresentar:
  resid_data &lt;- data.frame(
    x = data[[as.character(mapping$x)]],
    y = residuals[[as.character(mapping$x)]]
  )

  ggplot(data = data, mapping = mapping) +
    geom_hline(yintercept = 0, color = line_color, size = line_size) +
    ylim(y_range) +
    geom_point(data = resid_data, mapping = aes(x = x, y = y), ...)

}

# Plote os dados:
ggduo(
  dados,
  2:6, c(1,7),
  types = list(continuous = lm_or_resid)
)</code></pre>
<p><img src="/post/2017-12-24-diagnostico-de-modelo/diagnostico-de-modelos_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="ggallyggnostic" class="section level2">
<h2><code>GGally::ggnostic</code></h2>
<p>O <code>ggnostic</code> é um wrapper de exibição para <code>ggduo</code> que exibe diagnósticos de modelo completo para cada variável explicativa dada.</p>
<p>Por padrão, o ggduo exibe os valores residuais, o sigma do modelo de “leave-one-out”, os pontos de alavanca e a distância de Cook em relação a cada variável explicativa.</p>
<p>As linhas da matriz de plotagem podem ser expandidas para incluir valores ajustados, erro padrão dos valores ajustados, resíduos padronizados e qualquer uma das variáveis de resposta.</p>
<p>Se o modelo for um modelo linear, os asteriscos (*) são adicionados de acordo com a significância anova de cada variável explicativa.</p>
<p>A maioria das parcelas diagnósticas contêm linhas de referência para ajudar a determinar se o modelo está adequadamente instalado</p>
<p>Olhando para os conjuntos de dados do conjunto de dados <code>state.x77</code> ajustaremos um modelo de regressão múltipla para a expectativa de vida.</p>
<pre class="r"><code>#Dados que serão utilizados no exemplos:
state &lt;- as.data.frame(state.x77)
#Arrumando o nome das variaveis:
colnames(state)[c(4, 6)] &lt;- c(&quot;Life.Exp&quot;, &quot;HS.Grad&quot;)
# Ajustando o modelo completo:
model &lt;- lm(Life.Exp ~ ., data = state)
# Executando o stepwise para encontrar o melhor ajuste
model &lt;- step(model, trace = FALSE)</code></pre>
<p>Executando o diagnóstico deste modelo com a função <code>ggnostic()</code>:</p>
<pre class="r"><code># look at model diagnostics
ggnostic(model)</code></pre>
<p><img src="/post/2017-12-24-diagnostico-de-modelo/diagnostico-de-modelos_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Para acessar as variáveis influentes do modelo podemos utilizar a função <code>influence.measures()</code>, veja:</p>
<pre class="r"><code>summary(influence.measures(model))</code></pre>
<pre><code>## Potentially influential observations of
##   lm(formula = Life.Exp ~ Population + Murder + HS.Grad + Frost,      data = state) :
## 
##            dfb.1_ dfb.Pplt dfb.Mrdr dfb.HS.G dfb.Frst dffit   cov.r   cook.d
## Alaska      0.41   0.18    -0.40    -0.35    -0.16    -0.50    1.36_*  0.05 
## California  0.04  -0.09     0.00    -0.04     0.03    -0.12    1.81_*  0.00 
## Hawaii     -0.03  -0.57    -0.28     0.66    -1.24_*   1.43_*  0.74    0.36 
## Nevada      0.40   0.14    -0.42    -0.29    -0.28    -0.52    1.46_*  0.05 
## New York    0.01  -0.06     0.00     0.00    -0.01    -0.07    1.44_*  0.00 
##            hat    
## Alaska      0.25  
## California  0.38_*
## Hawaii      0.24  
## Nevada      0.29  
## New York    0.23</code></pre>
<p>Esta função retorna as seguintes estatísticas:</p>
<table>
<colgroup>
<col width="23%" />
<col width="25%" />
<col width="17%" />
<col width="17%" />
<col width="17%" />
</colgroup>
<thead>
<tr class="header">
<th>DFBeta</th>
<th>DFFit</th>
<th>CovRatio</th>
<th>D.Cook</th>
<th>h</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Alteração no vetor estimado <span class="math inline">\(\hat \beta\)</span> ao se retirar o i-ésimo ponto da análise</td>
<td>Alteração provocada no valor ajustado pela retirada da observação <span class="math inline">\(i\)</span></td>
<td>Expressa o relação de covariancia</td>
<td>Medida de afastamento das estimativas ao retirar <span class="math inline">\(i\)</span> e também considera o resíduo estudentizado internamente</td>
<td>Elementos da diagonal da matriz H</td>
</tr>
</tbody>
</table>
<p>Vejamos então um exemplo de matriz de matriz de diagnóstico completo.</p>
<p>As seguintes linhas de código exibirão uma matriz de diagnóstico para o mesmo modelo:</p>
<pre class="r"><code>#Ajustando um modelo de exemplo:
flea_model &lt;- step(lm(head ~ ., data = flea), trace = FALSE)</code></pre>
<p>Todas as colunas possíveis e usando <code>ggally_smooth()</code> para exibir os pontos ajustados e as variáveis de resposta temos:</p>
<pre class="r"><code># default output
ggnostic(flea_model,
 #        mapping = ggplot2::aes(color = species),  #Para colorir segundo um fator
         columnsY = c(&quot;head&quot;, &quot;.fitted&quot;, &quot;.se.fit&quot;, &quot;.resid&quot;, &quot;.std.resid&quot;, &quot;.hat&quot;, &quot;.sigma&quot;, &quot;.cooksd&quot;),
        continuous = list(default = ggally_smooth, .fitted = ggally_smooth)
)</code></pre>
<p><img src="/post/2017-12-24-diagnostico-de-modelo/diagnostico-de-modelos_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="ggallyggpairs" class="section level2">
<h2><code>GGally::ggpairs</code></h2>
<p>O <code>ggpairs</code> é uma forma especial de uma ggmatrix que produz uma comparação pairwise de dados multivariados. Por padrão, o ggpairs fornece duas comparações diferentes de cada par de colunas e exibe a densidade ou a contagem da variável respectiva ao longo da diagonal. Com diferentes configurações de parâmetros, a diagonal pode ser substituída pelos valores do eixo e rótulos variáveis.</p>
<pre class="r"><code>#Funcao de correlacoes
my_fn &lt;- function(data, mapping, method=&quot;lm&quot;, ...){
  p &lt;- ggplot(data = data, mapping = mapping) + 
    geom_point() + 
    geom_smooth(method=method, ...)
  p
}
data(tips, package = &quot;reshape&quot;)
#Correlaçoes cruzadas
ggpairs(tips, lower = list(continuous = my_fn))</code></pre>
<p><img src="/post/2017-12-24-diagnostico-de-modelo/diagnostico-de-modelos_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Existem muitos recursos ocultos dentro dos <code>ggpairs()</code> e muitos exemplos podem ser conferidos na internet para obter o máximo do <code>ggpairs()</code>.</p>
</div>
<div id="ggallyggscatmat" class="section level2">
<h2><code>GGally::ggscatmat</code></h2>
<p>A principal função é <code>ggscatmat</code>. É semelhante a <code>ggpairs()</code>, mas funciona apenas para dados multivariados puramente numéricos.</p>
<p>É mais rápido que ggpairs, porque é necessário fazer menos escolhas.</p>
<p>Ele cria uma matriz com diagramas de dispersão na diagonal inferior, densidades na diagonal e correlações escritas na diagonal superior.</p>
<p>A sintaxe é inserir o conjunto de dados, as colunas que deseja traçar, uma coluna de cores e um nível alfa.</p>
<pre class="r"><code>data(flea)
ggscatmat(flea, columns = 2:4, color=&quot;species&quot;, alpha=0.8)</code></pre>
<p><img src="/post/2017-12-24-diagnostico-de-modelo/diagnostico-de-modelos_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
</div>
</div>
<div id="ggfottify" class="section level1">
<h1>ggfottify</h1>
<p>Outra opção interessante para avaliar o ajuste dos modelos é o pacote <a href="https://cran.r-project.org/web/packages/ggfortify/index.html">ggfottify</a>. Ele disponibiliza uma interface de traçado (como a função <code>plot(modelo_ajustado)</code>) de análise e gráficos em um estilo unificado, porém usando <code>ggplot2</code>.</p>
<p>Vamos então dar início carregando o pacote:</p>
<pre class="r"><code>library(ggfortify)</code></pre>
<p>Veja a seguir alguns dos gráficos disponíveis no R para a análise de resíduos:</p>
<pre class="r"><code>autoplot(flea_model, which = 1:6, ncol = 3, label.size = 3)</code></pre>
<p><img src="/post/2017-12-24-diagnostico-de-modelo/diagnostico-de-modelos_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>Especificando as opções de plot</p>
<p>Algumas propriedades desses gráficos podem ser alteradas. Por exemplo, a opção <code>colour = 'dodgerblue3'</code> é para pontos de dados, o <code>smooth.colour = 'black'</code> é para linhas de suavização e <code>ad.colour = 'blue'</code> é para opções adicionais.</p>
<p>Veja ainda que ncol e nrow controlam o layout.</p>
<pre class="r"><code>autoplot(flea_model, which = 1:6, colour = &#39;dodgerblue3&#39;,
         smooth.colour = &#39;black&#39;, smooth.linetype = &#39;dashed&#39;,
         ad.colour = &#39;blue&#39;,
         label.size = 3, label.n = 5, label.colour = &#39;blue&#39;,
         ncol = 3)</code></pre>
<p><img src="/post/2017-12-24-diagnostico-de-modelo/diagnostico-de-modelos_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>Além disso, você pode usar nomes de colunas para essas propriedades, vamos separar os grupos de machos e fêmeas por cores:</p>
<pre class="r"><code>autoplot(flea_model, which = 1:6, data = flea,
         colour = &#39;species&#39;, label.size = 3,
         ncol = 3)</code></pre>
<p><img src="/post/2017-12-24-diagnostico-de-modelo/diagnostico-de-modelos_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>O que será que os crânios da estatística fariam diante de tantos recursos?</p>
</div>

        <p><strong>Leia o post completo em:</strong> <a href="https://gomesfellipe.github.io/post/2017-12-24-diagnostico-de-modelo/diagnostico-de-modelos/">Pacotes do R para avaliar o ajuste de modelos</a></p>
        <p><em>Este post foi originalmente publicado em <a href="https://gomesfellipe.github.io/">Fellipe Gomes - Data Science Blog</a></em></p>
      ]]></content:encoded>
      <category>Estatistica</category>
      <category>Modelagem Estatistica</category>
      <category>R</category>
      <category>Teoria</category>
      <category>Tidyverse</category>
      <category domain="tag">gomesfellipe</category>
      <category domain="tag">R</category>
      <category domain="tag">modelagem</category>
      <category domain="tag">modelagem estatistica</category>
      <category domain="tag">Estatistica</category>
      <category domain="tag">Correlacoes</category>
      <category domain="tag">R Markdown</category>
      <category domain="tag">regression</category>
      <category domain="tag">Teoria</category>
      <category domain="tag">modelos lineares</category>
      <category domain="tag">modelos generalizados</category>
      <category domain="tag">ggfortify</category>
      <category domain="tag">GGally</category>
    </item>
    <item>
      <title>Criando relatorios com template tufle</title>
      <link>https://gomesfellipe.github.io/post/2017-12-14-criando-relatorios-com-template-tufle/criando-relatorios-com-template-tufle/</link>
      <pubDate>Thu, 14 Dec 2017 00:00:00 +0000</pubDate>
      <author>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</author>
      <guid>https://gomesfellipe.github.io/post/2017-12-14-criando-relatorios-com-template-tufle/criando-relatorios-com-template-tufle/</guid>
      <description>Focando no conteúdo Além da limpeza da base de dados, análises e aplicação de metodologias estatísticas para a solução de problemas, escrever relatórios também é uma tarefa indispensável e que ocupa bastante tempo do trabalho de um estatístico.
Como disse Khalil Gibran; é preciso transformar em palavras aquilo que já conhecemos em pensamentos. Ninguém quer perder tempo precioso de análises em formatações de documentos.
Elaborar templates de relatórios é uma tarefa comum entre programadores estatísticos.</description>
      <content:encoded>&lt;![CDATA[
        
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<div id="focando-no-conteúdo" class="section level1">
<h1>Focando no conteúdo</h1>
<p>Além da limpeza da base de dados, análises e aplicação de metodologias estatísticas para a solução de problemas, escrever relatórios também é uma tarefa indispensável e que ocupa bastante tempo do trabalho de um estatístico.</p>
<p>Como disse Khalil Gibran; é preciso <em>transformar em palavras aquilo que já conhecemos em pensamentos</em>. Ninguém quer perder tempo precioso de análises em formatações de documentos.</p>
<p>Elaborar templates de relatórios é uma tarefa comum entre programadores estatísticos. Busquei alguma solução que de alguma forma fosse útil na página do <a href="https://www.rstudio.com/">RStudio</a> e me deparei com o pacote <code>tufle</code> disponível no <a href="https://cran.r-project.org">CRAN</a>.</p>
<p>Este pacote fornece um template interessante para a elaboração de arquivos rmarkdown para converter para PDF, a apresentação é apresentada no manual mais ou menos dessa maneira:</p>
<div class="figure">
<img src="http://rmarkdown.rstudio.com/images/tufte-handout.png" alt="" />
<p class="caption">Imagem do manual</p>
</div>
</div>
<div id="instalando-o-pacote" class="section level1">
<h1>Instalando o pacote</h1>
<p>Para instalar o pacote, basta rodar a linha de comando:</p>
<pre class="r"><code>install.packages(&quot;tufte&quot;)</code></pre>
</div>
<div id="criando-um-documento-documento" class="section level1">
<h1>Criando um documento documento</h1>
<p>Para criar um documento com o novo template, basta acessar <code>File&gt;New File&gt;R Markdown...</code> e selecionar o templante:</p>
<div class="figure">
<img src="http://rmarkdown.rstudio.com/images/new-tufte-handout.png" alt="" />
<p class="caption">Imagem do <a href="http://rmarkdown.rstudio.com/tufte_handout_format.html#overview">manual do pacote</a></p>
</div>
<p>Um novo documento será aberto, caso deseje fazer alguma alteração no preâmbulo, existem essas opções apresentadas no <a href="https://cran.r-project.org/web/packages/tufte/tufte.pdf">manual do pacote no CRAN</a>:</p>
</div>
<div id="preâmbulo-do-documento" class="section level1">
<h1>Preâmbulo do documento</h1>
<pre class="r"><code>---
title: &quot;Título&quot;
subtitle: &quot;Subtitulo&quot;
author: &quot;Autor&quot;
date: &quot;`r Sys.Date()`&quot;
output:
  tufte::tufte_html: default
  tufte::tufte_handout:
    keep_tex: false #true
    highlight: tango #“default”, “pygments”, “kate”, “monochrome”, “espresso”, “zenburn”, and “haddock”
    fig_width: 4
    fig_height: 4
    citation_package: natbib
    latex_engine: xelatex
  tufte::tufte_book:
    citation_package: natbib
    latex_engine: xelatex
bibliography: skeleton.bib
link-citations: yes
---</code></pre>
<p>Agora basta formatar e organizar os resultados de acordo com seu interesse nas análises sem grandes preocupações com a formatação, deixando da maneira que seja mais conveiente.</p>
<p>O que sempre foi possível em latex agora já pode ser adapato para quem gosta de trabalhar diretamente no RStudio!</p>
</div>

        <p><strong>Leia o post completo em:</strong> <a href="https://gomesfellipe.github.io/post/2017-12-14-criando-relatorios-com-template-tufle/criando-relatorios-com-template-tufle/">Criando relatorios com template tufle</a></p>
        <p><em>Este post foi originalmente publicado em <a href="https://gomesfellipe.github.io/">Fellipe Gomes - Data Science Blog</a></em></p>
      ]]></content:encoded>
      <category>R</category>
      <category>Prática</category>
      <category>Reports</category>
      <category domain="tag">R</category>
      <category domain="tag">gomesfellipe</category>
      <category domain="tag">Prática</category>
      <category domain="tag">R Markdown</category>
      <category domain="tag">RStudio</category>
      <category domain="tag">Tufle</category>
    </item>
  </channel>
</rss>