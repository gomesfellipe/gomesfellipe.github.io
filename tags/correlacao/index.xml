&lt;?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>correlacao on Fellipe Gomes - Data Science Blog</title>
    <link>https://gomesfellipe.github.io/tags/correlacao/</link>
    <description>√öltimos posts sobre Data Science, Machine Learning e R</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>pt-br</language>
    <managingEditor>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</managingEditor>
    <webMaster>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</webMaster>
    <lastBuildDate>Wed, 25 Mar 2020 00:00:00 +0000</lastBuildDate>
    <atom:link href="https://gomesfellipe.github.io/tags/correlacao/" rel="self" type="application/rss+xml" />
    <item>
      <title>Desenvolva um bot e receba resultados de Machine Learning no seu Smartphone para ajudar nos investimentos</title>
      <link>https://gomesfellipe.github.io/post/2020-03-25-investment-alert/investment-alert/</link>
      <pubDate>Wed, 25 Mar 2020 00:00:00 +0000</pubDate>
      <author>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</author>
      <guid>https://gomesfellipe.github.io/post/2020-03-25-investment-alert/investment-alert/</guid>
      <description>Entenda a l√≥gica de como montar uma carteira, coletar dados de finan√ßa em tempo real, treinar um modelo de Machine Learning com Prophet (Facebook Open Source) e receber an√°lises automatizadas no Smartphone</description>
      <content:encoded>&lt;![CDATA[
        


<style>
.column {
  float: left;
  width: 50%;
  padding: 10px;
}

.column4 {
  float: left;
  width: 33%;
  padding: 10px;
}

.column8 {
  float: left;
  width: 66%;
  padding: 10px;
}

.row:after {
  content: "";
  display: table; 
  clear: both;
}
</style>
<div id="por-que-investir" class="section level1">
<h1>Por que investir?</h1>
<p>Como esta sua situa√ß√£o financeira? Caso tenha alguma reserva pode ser interessante pensar em investimentos pois a poupan√ßa j√° n√£o √© mais garantia de lucro no longo prazo, n√£o acredita?</p>
<p>Estamos no final do primeiro trimestre de 2020 e desde 2019 j√° liam-se not√≠cias como esta abaixo que levam √† reflex√£o sobre reeduca√ß√£o financeira pois alertam sobre a necessidade da busca por novas oportunidades de investimento.</p>
<center>
<img src="/post/2020-03-25-investment-alert/noticia_poupanca.png" style="width:50.0%" /> <br><small>Fonte: <a href="https://noticias.r7.com/economia/economize/poupanca-em-baixa-exige-busca-por-novos-investimentos-em-2020-25122019" class="uri">https://noticias.r7.com/economia/economize/poupanca-em-baixa-exige-busca-por-novos-investimentos-em-2020-25122019</a></small>
</center>
<p></br></p>
<p>Com a finalidade de fomentar um pouco a discuss√£o sobre investimentos, trouxe nesse post algumas sugest√µes e id√©ias de como elaborar uma carteira e otimizar as escolhas para equilibrar risco em novos investimentos combinando elementos de estat√≠stica, machine learning e programa√ß√£o em R.</p>
<p>Ao final do post criaremos um <a href="https://core.telegram.org/bots">rob√¥ no telegram</a> que coletar√° os dados das cota√ß√µes adquiridas, aplicar√° o modelo <a href="https://facebook.github.io/prophet/docs/quick_start.html">Prophet do Facebook</a> para forecast e analisar√° a desmontagem da carteira segundo os crit√©rios estabelecidos e enviar√° mensagens para n√≥s com uma tabela financeira automatizada via Telegram como mostra na anima√ß√£o:</p>
<p></br></p>
<div class="row">
<div class="column4">
<center>
<img src="/post/2020-03-25-investment-alert/watch.png" />
</center>
</div>
<div class="column8">
<p><img src="/post/2020-03-25-investment-alert/report_stocks.gif" style="width:90.0%" /></p>
</div>
</div>
<p></br></p>
<div class="w3-panel w3-pale-red w3-border">
<p><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> <strong>AVISO</strong>: Este post <strong>n√£o</strong> tem como finalidade ser um guia de investimentos (J√° existem muitas consultorias especializadas nisso por ai). Todos as decis√µes tomadas como diversifica√ß√£o da carteira, sele√ß√£o de a√ß√µes e crit√©rios para desmontagem da carteira s√£o <strong>exemplos</strong> e servem para ilustrar algumas <strong>possibilidades</strong> que um cientista de dados t√™m na hora de desenvolver ferramentas para auxiliar √† tomada de decis√£o.</p>
</div>
<p></br></p>
<div id="diferen√ßa-de-poupar-e-investir" class="section level2">
<h2>Diferen√ßa de poupar e investir</h2>
<p>De acordo com um <a href="https://www.infomoney.com.br/minhas-financas/brasileiros-nao-sabem-a-diferenca-entre-poupar-e-investir-afirma-especialista-2/">especialista entrevistado pela InfoMoney</a>:</p>
<blockquote>
‚ÄúPoupar √© guardar dinheiro para usar no futuro, comprar alguma coisa com ele. Investimento √© juntar dinheiro, n√£o mexer nele, para que este gere rendimentos e a√≠ sim, usar os lucros mais para frente. √â o recomendado para quem quer viver de renda no futuro, por exemplo‚Äù (‚Ä¶)
<div align="right">
<font size="1">InfoMoney - Ago 2015</font>
</div>
</blockquote>
<p>Ou seja, poupar √© acumular agora para utilizar depois, e normalmente envolve mudan√ßa de h√°bitos, pois requer uma redu√ß√£o nos gastos pessoais e familiares, j√° investir √© usar esse dinheiro poupado em aplica√ß√µes que rendam.</p>
<p>Como todo mundo sabe, n√£o existe investimento sem risco e este risco deve ser controlado e utilizado a nosso favor de forma que gere alguma seguran√ßa financeira.</p>
</div>
</div>
<div id="montagem-da-carteira" class="section level1">
<h1>Montagem da carteira</h1>
<div class="row">
<div class="column8">
<p>N√£o colocar todos os ovos na mesma cesta significa que voc√™ deve diversificar o seu investimento. Provavelmente voc√™ j√° ouviu essa frase alguma vez na vida e ela certamente faz sentido!</p>
<p>Diversificar a carteira ir√° proteger seus investimentos diminuindo o risco pois, imagine s√≥, voc√™ investe todo o seu dinheiro em uma empresa e ela passa por alguma crise assim seu dinheiro estar√° todo comprometido!</p>
<p>Existem diversos motivos para se diversificar a carteira mas acho que essa met√°fora dos ovos j√° resume bem pois acredito que ningu√©m queira perder tudo em uma queda.</p>
</div>
<div class="column4">
<p><img src="/post/2020-03-25-investment-alert/ovos_mesm_cesta.png" style="width:90.0%" /></p>
</div>
</div>
<div id="como-dividir-a-carteira" class="section level2">
<h2>Como dividir a carteira?</h2>
<p>Dependendo do risco que voc√™ deseja se expor existem muitas formas de preparar a carteira mas a id√©ias principal consiste em atingir um equil√≠brio entre dois tipos de investimento:</p>
<ul>
<li>Renda fixa: Menor exposi√ß√£o, menor risco (ex.: CDI, Selic e TR)</li>
<li>Renda vari√°vel: Maior exposi√ß√£o, maior risco (ex: A√ß√µes, Commodities, Im√≥veis)</li>
</ul>
<p>Para ajudar a dividir a carteira de investimentos neste post utilizaremos a chamada <a href="https://www.btgpactualdigital.com/blog/coluna-gustavo-cerbasi/defina-sua-estrategia-entre-renda-fixa-ou-variavel">Regra (ou Lei) dos 80</a>. A estrat√©gia √© a seguinte: subtraia da sua idade o n√∫mero 80. O resultado dessa conta vai indicar o percentual a ser investido em <a href="https://pt.wikipedia.org/wiki/Renda_vari%C3%A1vel">renda vari√°vel</a>. Por exemplo, no meu caso: tenho 26 anos, portanto <span class="math inline">\(80-26 = 54\%\)</span> dever√° ser investido em renda vari√°vel. Aos 53 anos esse percentual vai cair√° para a metade, <span class="math inline">\(27\%\)</span>.</p>
<p>A id√©ias principal por tr√°s desta regra que √© que a cada ano que passa, 1% do montante da renda vari√°vel deva ser direcionado para a <a href="https://pt.wikipedia.org/wiki/Renda_fixa">renda fixa</a>.</p>
<p>Para testar diferentes valores seguindo esta regra desenvolvi uma fun√ß√£o que se chama <a href="https://gist.github.com/gomesfellipe/a74710a63b3c8637166b538ad2f460f5"><code>montagem80()</code> (que j√° est√° dispon√≠vel no github)</a>. Vejamos alguns resultados para diferentes cen√°rios e vamos selecionar um para seguir com a montagem da carteira:</p>
<pre class="r"><code># https://gist.github.com/gomesfellipe/a74710a63b3c8637166b538ad2f460f5
devtools::source_gist(&quot;a74710a63b3c8637166b538ad2f460f5&quot;, quiet = T)</code></pre>
<div class="row">
<div class="column">
<ol style="list-style-type: decimal">
<li>Entrada de R$20.000,00 <big>üëà</big></li>
</ol>
<pre class="r"><code>montagem80(entrada = 20000, idade = 26)</code></pre>
<pre><code>## ‚Ä¢ Entrada: R$R$20.000,00
##   ‚îî‚îÄ Renda fixa:     R$9.200,00
##   ‚îî‚îÄ Renda variavel: R$10.800,00
##        (Acao + Cryptomoeda): 
##        R$9.720,00 + R$1.080,00</code></pre>
</div>
<div class="column">
<ol start="2" style="list-style-type: decimal">
<li>R$ 5.000,00 em acoes</li>
</ol>
<pre class="r"><code>montagem80(variavel = 10800, idade = 53)</code></pre>
<pre><code>## ‚Ä¢ Entrada: R$R$40.000,00
##   ‚îî‚îÄ Renda fixa:     R$29.200,00
##   ‚îî‚îÄ Renda variavel: R$10.800,00
##        (Acao + Cryptomoeda): 
##        R$9.720,00 + R$1.080,00</code></pre>
</div>
</div>
<p>Utilizaremos a primeira (1.) configura√ß√£o que esta assinalada em vermelho como exemplo, onde:</p>
<ul>
<li>Entrada: R$20.000,00</li>
<li>Renda fixa: R$9.200,00</li>
<li>Renda Vari√°vel (Acoes): R$9.720,00</li>
<li>Renda Vari√°vel (Crypt): R$1.080,00</li>
</ul>
<p>Note que a entrada deve ser o dobro na segunda (2.) configura√ß√£o caso deseje investir R$10.800,00 (que √© o valor sugerido aos 26 anos para uma entrada de R$20.000,00)</p>
<p>Ap√≥s definir a quantidade a ser investida √© hora de planejar a pr√≥xima etapa: a diversifica√ß√£o.</p>
</div>
<div id="diversifica√ß√£o-da-carteira" class="section level2">
<h2>Diversifica√ß√£o da carteira</h2>
<div class="row">
<div class="column8">
<p>A diversifica√ß√£o √© uma t√©cnica para gest√£o do risco que visa distribuir o capital investido em uma variedade de investimentos dentro de da nossa carteira.</p>
<p>Assim, o risco do portf√≥lio √© consideravelmente reduzido pois reduzimos a volatividade e criamos um equil√≠brio onde um desempenho positivo de um ativo neutraliza as baixas ocorridas em outras aplica√ß√µes. Al√©m disso a diversifica√ß√£o pode ser tanto coma renda vari√°vel quanto com a renda fixa.</p>
<p>Mas lembre-se, n√£o existe uma receita mais eficiente!</p>
</div>
<div class="column4">
</br>
<iframe src="https://giphy.com/embed/qJkRbWM1MfVjq" width="100%" height="150" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>
<p>
<a href="https://giphy.com/gifs/eggs-qJkRbWM1MfVjq">via GIPHY</a>
</p>
</div>
</div>
<div id="renda-fixa" class="section level3">
<h3>Renda fixa</h3>
<p>Normalmente, tamb√©m diversificamos nossa renda fixa por√©m como gostaria de focar nas an√°lises de renda vari√°vel utilizaremos o simulador dispon√≠vel no site <a href="https://verios.com.br/" class="uri">https://verios.com.br/</a> neste <a href="https://simulador-tesouro-direto.verios.com.br/">link</a> para selecionar apenas um t√≠tulo:</p>
<center>
<img src="/post/2020-03-25-investment-alert/tesouro_direto.png" style="width:80.0%" />
<small></br>Fonte: <a href="https://simulador-tesouro-direto.verios.com.br/" class="uri">https://simulador-tesouro-direto.verios.com.br/</a></small>
</center>
<p></br></p>
<p>Como exemplo, escolhi o Tesouro Prefixado 2015 (LTN), note que com essa escolha o lucro planejado seria de quase 3 mil reais nos pr√≥ximos 5 anos.</p>
<div class="w3-panel w3-pale-red w3-border">
<p><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> <strong>AVISO</strong>: Lembrando que esta sele√ß√£o √© apenas um exemplo e existem diversas informa√ß√µes a serem levadas em conta ao se fazer esta escolha al√©m de se poder diversificar tamb√©m. Convido o leitor a procurar saber mais sobre os tipos, pr√≥s e contras do Tesouro Direto.</p>
</div>
</div>
<div id="renda-vari√°vel" class="section level3">
<h3>Renda vari√°vel</h3>
<p>Para elabora√ß√£o da parte da renda vari√°vel da carteira selecionei duas a√ß√µes que s√£o inversamente correlacionadas (de forma totalmente arbitr√°ria) baseado no excelente post "<a href="https://www.tradingcomdados.com/post/2017/07/09/estudo-de-correla%C3%A7%C3%A3o-entre-a%C3%A7%C3%B5es-da-bolsa-de-valores-de-s%C3%A3o-paulo">Estudo de correla√ß√£o entre a√ß√µes da Bolsa de Valores de S√£o Paulo</a>" escrito por Victor Gomes onde o autor faz um estudo de correla√ß√µes das s√©ries hist√≥ricas de a√ß√µes de diferentes setores.</p>
<p>Al√©m disso, o Bitcoin ser√° selecionado para completar a carteira de renda vari√°vel como um ativo de alto risco com bastante volatividade. Mas voc√™ deve estar se perguntando, por que assumir este risco?</p>
<p>Existem muitas hist√≥rias de pessoas que ficaram milion√°rias com o Bitcoin pela sua valoriza√ß√£o inesperada ao longo do tempo, como por exemplo o <a href="https://www.infomoney.com.br/mercados/adolescente-fica-milionario-aos-18-anos-usando-bitcoins-apos-fazer-aposta-com-os-pais/">adolescente que ficou milion√°rio aos 18 anos usando bitcoins ap√≥s fazer aposta com os pais</a>.</p>
<p>Ent√£o <strong>eu</strong> acho que 10% dessa nossa carteira (n√£o esque√ßa que podemos ter mais de uma carteira) √© um risco que pode valer a pena correr e por isso vou inclu√≠-lo.</p>
<p>Portanto, para este exemplo consideramos:</p>
<ul>
<li>TUPY3.SA: <a href="https://www.google.com/search?q=tupy3&amp;oq=tupy3&amp;aqs=chrome..69i57.7273j0j4&amp;sourceid=chrome&amp;ie=UTF-8">Tupy</a></li>
<li>ELET3.SA: <a href="https://www.google.com/search?ei=-dxuXtuyNIbR5OUPxY2m8AE&amp;q=ELET3.SA&amp;oq=ELET3.SA&amp;gs_l=psy-ab.3..0.40045.41040..41701...0.2..0.123.237.0j2......0....2j1..gws-wiz.......0i71.a2fjObIM6cM&amp;ved=0ahUKEwibk86a8p3oAhWGKLkGHcWGCR4Q4dUDCAs&amp;uact=5">Centrais Eletricas Brasileiras SA</a></li>
<li>BTC-USD: <a href="https://www.google.com/search?ei=JN1uXsDJLJm55OUPj8-c8As&amp;q=bitcoin&amp;oq=bitcoin&amp;gs_l=psy-ab.3.0.0i131i70i258j0i131i67j0i131j0i67j0j0i67j0i131j0i67j0j0i131.25383.26281..27215...0.0..0.175.1147.1j8......0....1..gws-wiz.xu0EQx1CnXI">Bitcoin</a></li>
</ul>
<pre class="r"><code>portifolio = c(&quot;TUPY3.SA&quot;,&quot;ELET3.SA&quot;, &quot;BTC-USD&quot;)</code></pre>
<div class="w3-panel w3-pale-red w3-border">
<p><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> <strong>AVISO</strong>: Volto a frisar que as escolhas das a√ß√µes foram feitas de forma arbitr√°ria. Estamos em tempos de incerteza atualmente por conta do corona v√≠rus (espero que todos fiquem bem) o que leva algumas escolhas √† serem ainda mais complexas e imprevis√≠veis.</p>
</div>
<div id="obter-dados" class="section level4">
<h4>Obter dados</h4>
<p>A aquisi√ß√£o das s√©rie hist√≥ricas das cota√ß√µes destes ativos desde 01/01/2016 foram obtidas utilizando o pacote <a href="https://github.com/business-science/tidyquant"><code>tidyquant</code></a> que nos retorna os dados das cota√ß√µes das a√ß√µes informadas em formato ‚Äúarrumado‚Äù (ou seja, familiar com fun√ß√µes do <a href="https://www.tidyverse.org/">tidyverse</a>), veja:</p>
<pre class="r"><code>library(tidyquant) # aquisicao de dados financeiros
stocks &lt;-map_df(portifolio, ~tq_get(.x, get = &quot;stock.prices&quot;, from = &quot; 2016-01-01&quot;))
saveRDS(stocks, &quot;stocks.rds&quot;)</code></pre>
<p>Veja as linhas iniciais do dataset obtido:</p>
<pre class="r"><code>stocks %&gt;% head() %&gt;% kable2()</code></pre>
<center>
<img src="/post/2020-03-25-investment-alert/img1.png" style="width:80.0%" />
</center>
<p>Existem uma s√©rie de vantagens de se trabalhar com os dados neste formato em R, veremos o porque nas pr√≥ximas se√ß√µes.</p>
</div>
<div id="arrumar-dataset" class="section level4">
<h4>Arrumar dataset</h4>
<p>O formato <a href="https://github.com/tidyverts/tsibble"><code>tsibble</code></a> √© um formato moderno para se trabalhar com s√©ries temporais trazendo a filosofia do <code>tidyverse</code> para os dados de s√©ries temporais facilitando o <a href="https://blog.earo.me/2018/12/20/reintro-tsibble/">fluxo de trabalho</a>.</p>
<p>Diversos outros pacotes podem ser combinados utilizando os dados no formato do pacote <code>tsibble</code> como os pacotes <a href="https://robjhyndman.com/hyndsight/fable/"><code>fable</code></a> e o <a href="https://github.com/mitchelloharawild/fable.prophet"><code>prophet</code></a> (sugiro a leitura para quem nao conhece) para aplica√ß√£o de modelagem de s√©ries temporais.</p>
<p>Veja como √© o fluxo ao trabalhar com objetos do tipo <code>tsibble</code></p>
<center>
<img src="/post/2020-03-25-investment-alert/ds-pipeline.png" style="width:60.0%" />
</br>
<small>Fonte: <a href="https://blog.earo.me/2018/12/20/reintro-tsibble/" class="uri">https://blog.earo.me/2018/12/20/reintro-tsibble/</a></small>
</center>
<p></br></p>
<pre class="r"><code>library(tsibble) # series temporais arrumadas
tbl_stocks &lt;- stocks %&gt;% as_tsibble(key = symbol, index = date) </code></pre>
<p>Ap√≥s importar e arrumar o dataset, seguimos para os pr√≥ximos passos.</p>
</div>
<div id="transformar" class="section level4">
<h4>Transformar</h4>
<p>Ap√≥s converter para <code>tsibble</code>, vamos preencher alguns gaps da bolsa como por exemplo os finais de semana (quando a bolsa de valores fica fechada) com o mesmo valor do dia anterior (Para este exemplo vamos fazer esse preenchimento dos gaps do final de semana mas n√£o √© sempre √© necess√°rio):</p>
<pre class="r"><code>tbl_stocks &lt;- 
  tbl_stocks %&gt;% 
  fill_gaps() %&gt;% 
  tidyr::fill(c(open, high, low, close, volume, adjusted),.direction = &quot;down&quot;)</code></pre>
<p>Com os dados arrumados vamos a algumas visualiza√ß√µes.</p>
</div>
<div id="visualizar" class="section level4">
<h4>Visualizar</h4>
<p>Vejamos qual foi o comportamento das s√©ries hist√≥ricas que coletamos desde o in√≠cio de 2016:</p>
<pre class="r"><code>library(forecast) # series temporais
library(fpp3)     # series temporais
d2 &lt;- 
  tbl_stocks %&gt;% 
  group_by(symbol) %&gt;% 
  summarise(y = mean(close))

autoplot(tbl_stocks)+
  geom_line(aes(group = symbol), color = &quot;black&quot;, show.legend = F) + 
  facet_wrap(~symbol, scales = &quot;free_y&quot;, ncol = 1)+
  geom_ma(n=6*30, color = &quot;red&quot;) + 
  theme(legend.position = &quot;none&quot;)+
  labs(subtitle = &quot;m√©dia m√≥vel n = 6 meses&quot;,
       caption = &quot;gomesfellipe.github.io&quot;)</code></pre>
<center>
<img src="/post/2020-03-25-investment-alert/unnamed-chunk-10-1.png" style="width:80.0%" />
</center>
<p>Note que a s√©rie do Bitcoin √© a mais imprevis√≠vel, houve um pico em 2018 mas ap√≥s isso n√£o houve nenhum grande pico como aquele. Em breve ocorrer√° o <a href="https://www.infomoney.com.br/onde-investir/halving-conheca-o-processo-que-pode-levar-o-bitcoin-a-uma-nova-explosao-de-preco/">Halving</a> (a contagem regressiva pode acompanhada <a href="https://www.bitcoinblockhalf.com/">neste link</a>) que √© um processo de choque de oferta e ocorre aproximadamente a cada 4 anos e pode ser uma boa oportunidade de retorno.</p>
<p>As duas s√©ries da bolsa de valores n√£o parecem ter uma correla√ß√£o muito forte, os picos ocorrem de forma alternada e isto pode ser uma caracter√≠stica boa para a carteira pois caso uma delas entre em crise a outra poder√° estar em uma fase boa.</p>
<div class="w3-panel w3-pale-blue w3-border">
<p><i class="fa fa-ambulance" aria-hidden="true"></i> Nota: Esta queda abrupta que ocorreu na bolsa no in√≠cio de 2020 √© o reflexo da <a href="https://pt.wikipedia.org/wiki/Pandemia_de_COVID-19_no_Brasil">Pandemia CODVID-19</a> que j√° come√ßou a apresentar alguns casos no Brasil e isso certamente tem gerando muita incerteza na bolsa de valores. Nem eu nem ningu√©m sabe o que pode acontecer, estou na torcida para que todos fiquem bem e pelo sucesso na conten√ß√£o desse v√≠rus! <i class="fas fa-praying-hands"></i></p>
</div>
</div>
<div id="correla√ß√µes" class="section level4">
<h4>Correla√ß√µes</h4>
<p>Para estudar melhor as conjecturas formadas ao observar o comportamento das s√©ries hist√≥rias (de que os picos e vales se alternam) vamos conferir olhada nos gr√°ficos de dispers√£o e coeficientes de <a href="https://pt.wikipedia.org/wiki/Coeficiente_de_correla%C3%A7%C3%A3o_de_postos_de_Spearman">correla√ß√£o de Spearman</a>:</p>
<pre class="r"><code>points_loess &lt;- function(data, mapping){
  ggplot(data = data, mapping = mapping) + 
    geom_point(alpha = 0.3,size=0.5) + 
    geom_smooth(method = &quot;loess&quot;)
}

tbl_stocks %&gt;%
  as_tibble() %&gt;% 
  select(symbol, date, close) %&gt;% 
  spread(key = symbol, value = close) %&gt;%
  GGally::ggpairs(columns = 2:4,
                  upper = list(continuous = GGally::wrap(&quot;cor&quot;, method = &quot;spearman&quot;)),
                  lower = list(continuous =  points_loess))</code></pre>
<center>
<img src="/post/2020-03-25-investment-alert/unnamed-chunk-11-1.png" style="width:80.0%" />
</center>
<p>Note que a rela√ß√£o entre TUPY3 e ELET3 n√£o √© linear e al√©m disso essa correla√ß√£o √© fraca, o que pode ser ben√©fico para o portf√≥lio pois uma poss√≠vel queda em uma n√£o parece n√£o ter tanto impacto na outra.</p>
<p>Al√©m disso note que a correla√ß√£o do BTC-USD com TUPY3 e ELET3 √© moderada e mesmo apresentando este valores num√©ricos, o Bitcoin √© um ativo negociado em escala global e √© de um setor totalmente diferente das outras a√ß√µes.</p>
<div class="w3-panel w3-pale-red w3-border">
<p><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> <strong>AVISO</strong>: Essa an√°lise meramente num√©rica n√£o √© o suficiente para detectar uma rela√ß√£o de causa, pois correla√ß√£o n√£o implica causalidade. Isto que dizer que poda haver uma causa em comum para ambas ou que seja uma <a href="https://pt.wikipedia.org/wiki/Regress%C3%A3o_esp%C3%BAria">correla√ß√£o esp√∫ria</a>. Quando se trata da bolsa de valores √© necess√°rio tamb√©m conhecer um pouco sobre a situa√ß√£o e hist√≥ria da empresa na qual se investe.</p>
</div>
</div>
<div id="forecast-com-prophet-do-facebook" class="section level4">
<h4>Forecast com Prophet do Facebook</h4>
<p>Poder√≠amos utilizar uma s√©rie de modelos estat√≠sticos, econom√©tricos e de machine learning utilizando tanto as fun√ß√µes nativas do R base ou pacote forecast quanto as fun√ß√µes desenvolvidas para trabalhar de maneira ‚Äúarrumada‚Äù com tsibble mas resolvi fazer uma abordagem diferente neste post escolhendo o modelo disponibilizado pelo Facebook.</p>
<div class="row">
<div class="column">
<p></br>
O <a href="https://facebook.github.io/prophet/">Prophet</a> √© um software de c√≥digo aberto disponibilizado pela equipe de <a href="https://research.fb.com/category/data-science/">Data Science do Facebook</a> que fornece um procedimento para realiza√ß√£o de previs√µes de dados de s√©ries temporais.</p>
</div>
<div class="column">
<p><img src="/post/2020-03-25-investment-alert/prophet_logo.png" style="width:80.0%" />
</br><small>Fonte: <a href="https://facebook.github.io/prophet/" class="uri">https://facebook.github.io/prophet/</a></small></p>
</div>
</div>
<p>Segundo a <a href="https://facebook.github.io/prophet/">documenta√ß√£o oficial</a>, (em tradu√ß√£o livre):</p>
<blockquote>
<p>O Prophet tem como ‚Äúbase em um modelo aditivo no qual tend√™ncias n√£o lineares se ajustam √† sazonalidade anual, semanal e di√°ria, al√©m de efeitos de f√©rias. Funciona melhor com s√©ries temporais que t√™m fortes efeitos sazonais e v√°rias temporadas de dados hist√≥ricos. O Profeta √© robusto para a falta de dados e mudan√ßas na tend√™ncia, e geralmente lida bem com outliers‚Äù.</p>
</blockquote>
<p>Este modelo me pareceu uma boa op√ß√£o para exemplificar a etapa da modelagem de s√©ries temporais deste post. Vamos ver o que o modelo do Facebook tem a nos dizer sobre o futuro das nossas a√ß√µes.</p>
<div id="divis√£o-entre-treino-e-teste-em-s√©ries-temporais" class="section level5">
<h5>Divis√£o entre treino e teste em s√©ries temporais</h5>
<p>Assim como em uma tarefa de machine learning que n√£o envolvem dados temporais, no caso de s√©ries temporais, quando desejamos avaliar o ajuste do nosso modelo tamb√©m dividimos o dataset em treino e teste por√©m utilizamos a data como √≠ndice.</p>
<p>Veja como ser√£o divididas nossas s√©ries hist√≥ricas:</p>
<ul>
<li>treino: inicio da s√©rie at√© 18/11/20;</li>
<li>teste: de 18/11/2020 at√© o final da s√©rie hist√≥rica (2 meses atr√°s)</li>
</ul>
<pre class="r"><code>h = 30 * 2
data_split &lt;- Sys.Date() - h

tbl_stocks_train &lt;-  
  tbl_stocks %&gt;% 
  filter(date &lt;= data_split) %&gt;% 
  select(symbol, date, close)

tbl_stocks_test &lt;- 
  tbl_stocks %&gt;%
  filter(date &gt; data_split) %&gt;% 
  select(symbol, date, close)</code></pre>
<p>Ap√≥s dividir os dados em treino e teste j√° estamos habilitados √† utilizar o modelo. Note que, por default, o modelo espera duas colunas nomeadas como <code>ds</code>: data da s√©rie e <code>y</code>: vari√°vel target da s√©rie.</p>
<p>Al√©m disso faremos uma previs√£o 6 meses a frente dos dados de teste para entender qual a tend√™ncia o modelo estaria adotando.</p>
<pre class="r"><code>library(prophet)

prophet_results &lt;- 
  tbl_stocks_train %&gt;% 
  rename(ds = date, y = close) %&gt;% 
  nest(data = c(ds, y)) %&gt;% 
  mutate(pmodel = map(data, ~ prophet(.x, daily.seasonality=TRUE))
  )%&gt;% 
  mutate(pprediction = map(pmodel, ~.x %&gt;%  
                             make_future_dataframe(periods = h + 30*6) %&gt;%
                             predict(.x,.))) </code></pre>
<p>Veja os resultados do ajuste do modelo:</p>
<pre class="r"><code>library(patchwork)

pmap(list(
  x = prophet_results$pprediction,
  y = split(tbl_stocks_train, tbl_stocks_train$symbol),
  z = split(tbl_stocks_test, tbl_stocks_test$symbol),
  w = prophet_results$symbol
),function(x, y, z, w){
  x %&gt;% 
    as_tibble() %&gt;%
    mutate(ds=as_date(ds)) %&gt;%
    select(ds, trend, yhat, yhat_lower, yhat_upper) %&gt;% 
    ggplot() + 
    geom_line(aes(x=ds, y=yhat, color=&quot;blue&quot;), show.legend = F) +
    geom_line(data=y, aes(x=date, y=close, color=&quot;black&quot;), show.legend = F) +
    geom_line(data=z, aes(x=date, y=close, color=&quot;red&quot;), show.legend = T) +
    geom_ribbon(aes(x=ds, ymin=yhat_lower, ymax=yhat_upper), alpha=0.2)  +
    scale_x_date(#limits = c(as.Date(&quot;2018-06-01&quot;), Sys.Date() + 30*12), 
      date_breaks = &quot;6 month&quot;, date_labels = &quot;%m/%Y&quot;) +
    theme_bw()+
    labs(y = w, x = &quot;&quot;, caption = &quot;gomesfellipe.github.io&quot;)+
    scale_colour_manual(values=c(&quot;black&quot;,&quot;blue&quot;,&quot;red&quot;), name=&quot;&quot;, labels=c(&quot;treino&quot;,&quot;modelo&quot;,&quot;teste&quot;))+
    theme(legend.position = c(1-0.8,1-0.2), 
          legend.background = element_rect(fill=alpha(&#39;lightgrey&#39;, 0.2)),
          legend.direction = &quot;horizontal&quot;)
}
) %&gt;% {.[[1]] / .[[2]] / .[[3]]}

ggsave(&quot;prophet.png&quot;) # salvar para o bot retornar este resultado!</code></pre>
<center>
<img src="/post/2020-03-25-investment-alert/unnamed-chunk-15-1.png" style="width:80.0%" />
</center>
<p>Parece interessante..</p>
<p>Veja que a linha azul (modelo ajustado) se ajusta bem √† linha preta (dados de treino) acompanhando a s√©rie hist√≥rica e captando algumas tend√™ncias n√£o lineares.</p>
<p>Por√©m note que a linha azul se perde completamente da linha vermelha (dados de teste) no in√≠cio de 2020 e acho isso muito razo√°vel pois dificilmente algum modelo iria prever os efeitos de uma Pandemia utilizando apenas a s√©rie hist√≥rica do ativo.</p>
<p>Note ainda que a linha azul se estende at√© o final de 2020 (previs√µes para os pr√≥ximos 6 meses) o que sugere que a s√©rie possu√≠a esta tendencia positiva ao longo dos anos, segundo o modelo Prophet .</p>
<div class="w3-panel w3-pale-yellow w3-border">
<p><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> <strong>Aviso</strong>: Existem v√°rias maneiras de estudar e melhorar a qualidade do ajuste deste modelo mas como o objetivo deste post n√£o √© este deixo como aviso para o leitor.</p>
</div>
<p>Com a interpreta√ß√£o dos resultados conclu√≠da.. vamos √†s compras!</p>
</div>
</div>
</div>
</div>
</div>
<div id="comprando-a√ß√µes" class="section level1">
<h1>Comprando a√ß√µes</h1>
<p>Ap√≥s toda essa exemplifica√ß√£o de como podem ser feitas as an√°lises para a elabora√ß√£o da carteira chegou a hora das compras.</p>
<p>Suponha que tiv√©ssemos realizado nossas compra no fechamento do dia <strong>2018-12-01</strong>, quando os valores de <font color="blue"><strong>fechamento</strong></font> das cota√ß√µes eram as seguintes:</p>
<pre class="r"><code>tbl_stocks %&gt;% 
  filter(date == &quot;2018-12-01&quot;) %&gt;% 
  mutate(close = cell_spec(moeda_real(close), &quot;html&quot;, color = &quot;blue&quot;, bold = T)) %&gt;% 
  mutate_at(c(3:5, 8), ~moeda_real(.x)) %&gt;% 
  kable2()</code></pre>
<center>
<img src="/post/2020-03-25-investment-alert/img2.png" style="width:80.0%" />
</center>
<p>Neste dia a cota√ß√£o para ELET3 era R$24,42 e TUPY3 era R$19,73 e suponha que tenhamos comprado 200 lotes de ELET3 e 150 fracion√°rios de TUPY, totalizando R$7.843,64 (pr√≥ximo ao que tinhaamos planejado no inicio do estudo)</p>
<p>Vamos guardar estes valores:</p>
<pre class="r"><code>cot_inicio = filter(tbl_stocks, date == &quot;2018-12-01&quot;, symbol != &quot;BTC-USD&quot;) %&gt;% pull(close)
qtd_inicio = c(elet = 200, tupy = 150)</code></pre>
<p>Note que o valor do Bitcoin est√° em d√≥lares, para obter o valor em reais (R$) daquele dia vamos utilizar a <a href="https://www.mercadobitcoin.net/api/BTC/day-summary/2020/01/09/">API do Mercado Bitcoin</a>. Como n√£o existe nenhum pacote que forne√ßa estes dados diretamente no R, a requisi√ß√£o ser√° feita normalmente via API com o pacote <code>jsonlite</code>:</p>
<pre class="r"><code>library(jsonlite) # requisicao de api
url &lt;- glue::glue(&quot;https://www.mercadobitcoin.net/api/BTC/day-summary/2019/12/01/&quot;)
safe_fromJSON &lt;- purrr:::safely(fromJSON, as.numeric(NA)) 
consulta &lt;- safe_fromJSON(url)$result %&gt;% map_dfc(~.x)

consulta %&gt;%
  select(-date) %&gt;% 
  mutate_all(~moeda_real(.x)) %&gt;%
  mutate(closing = cell_spec(closing, &quot;html&quot;, color = &quot;blue&quot;)) %&gt;% 
  kable2()</code></pre>
<center>
<img src="/post/2020-03-25-investment-alert/img3.png" style="width:80.0%" />
</center>
<p>O pre√ßo de fechamento foi de R$31.747,38 e suponhamos que tenha sido este o valor pago no dia. (Parece que neste dia o d√≥lar estava em torno de R$4,03)</p>
<p>Para completar esta carteira fict√≠cia vamos adquirir 0,0032 do valor de um Bitcoin</p>
<pre class="r"><code>cot_inicio[3] &lt;- consulta$closing
qtd_inicio[3] &lt;- 0.032</code></pre>
<p>Portanto, ao valor de R$31.747,38 compramos 0.032 Bitcoin totalizando R$1.015,92 completando nossa carteira.</p>
<div id="tabela-financeira" class="section level2">
<h2>Tabela financeira</h2>
<p>Semelhante a uma planilha financeira, criaremos uma tabela financeira automatizada que receber√° como input os valores da montagem e calcular√° automaticamente os valores do desmontagem no tempo atual utilizando dados de APIs abertas.</p>
<blockquote>
‚ÄúAquilo que n√£o se pode medir, n√£o se pode melhorar‚Äù.
<div align="right">
<font size="1">F√≠sico irland√™s William Thomson</font>
</div>
</blockquote>
<p>Primeiro √© necess√°rio obter os valores mais recentes das cota√ß√µes das acoes que compramos na bolsa e para isto ser√° necess√°rio utilizar outro pacote pois o <code>tidyquant</code> s√≥ fornece os dados em frequ√™ncia di√°ria.</p>
<p>Utilizaremos portanto, o pacote <a href="https://www.business-science.io/code-tools/2017/09/03/alphavantager-0-1-0.html">alphavantager</a> que fornece dados de finan√ßas da API gratuita <a href="https://www.alphavantage.co/">Alpha Vantage</a> no formato arrumados e tamb√©m foi desenvolvida pela <a href="https://github.com/business-science">Business Science</a> (mesmo criados do pacote <code>tidyquant</code>).</p>
<div class="w3-panel w3-pale-yellow w3-border">
<p><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> <strong>Aviso</strong>: Na <a href="https://www.alphavantage.co/support/#api-key">documenta√ß√£o da api do Alphavantage</a> recomenda-se a solicita√ß√µes de API com modera√ß√£o, suportando at√© 5 solicita√ß√µes de API por minuto e 500 solicita√ß√µes por dia para obter o melhor desempenho no servidor. Caso deseje segmentar um volume maior de chamadas da API, confira a <a href="https://www.alphavantage.co/premium/">associa√ß√£o premium.</a>.</p>
</div>
<p>J√° para a coleta da cota√ß√£o em tempo real do Bitcoin em reais (R$), utilizaremos novamente a <a href="https://www.mercadobitcoin.com.br/api-doc/?">api do mercado bitcoin</a>.</p>
<pre class="r"><code># Importar dados da bolsa de valores ==================================

library(alphavantager) # api streaming bovespa

AV_API_KEY = Sys.getenv(&quot;AV_API_KEY&quot;)
av_api_key(AV_API_KEY)

consulta_acoes &lt;- map_df(portifolio[1:2], ~{
  alphavantager::av_get(symbol = .x,
         av_fun = &quot;TIME_SERIES_INTRADAY&quot;,
         interval = &quot;1min&quot;,  # &quot;1min&quot;, &quot;5min&quot;, &quot;15min&quot;, &quot;30min&quot; ou &quot;60min&quot;
         outputsize = &quot;compact&quot;) %&gt;%  # &quot;full&quot;
    bind_cols(stock = rep(.x, nrow(.)))
})

# Impotar dados do bitcoin ============================================

coin &lt;- &quot;BTC&quot;
method &lt;- &quot;ticker&quot;
url &lt;- glue::glue(&quot;https://www.mercadobitcoin.net/api/{coin}/{method}/&quot;)

safe_fromJSON &lt;- safely(fromJSON, as.numeric(NA)) 
consulta_bitcoin &lt;- 
  safe_fromJSON(url)$result$ticker %&gt;% 
  as_tibble() %&gt;% 
  transmute(timestamp = lubridate::ymd_hms(as.POSIXct(date, origin=&quot;1970-01-01&quot;)),
            open, high, low, close = sell, volume = NA, stock = &quot;BTC.BR&quot;) %&gt;% 
  mutate_at(c(&#39;open&#39;, &#39;high&#39;, &#39;low&#39;, &#39;close&#39;), ~as.numeric(.x))

# Combinar resultados das consultas ==================================

consulta_atual &lt;- 
  bind_rows(
    consulta_acoes %&gt;% 
      group_by(stock) %&gt;% 
      filter(timestamp == last(timestamp)),
    consulta_bitcoin
  ) 

# Salvar consulta ====================================================
saveRDS(consulta_atual, &quot;consulta_atual.rds&quot;)</code></pre>
<p>Resultados da consulta atual (ap√≥s combinar a requisi√ß√£o da bolsa de valores e do Mercado Bitcoin):</p>
<pre class="r"><code>consulta_atual  %&gt;%
  mutate_at(2:4, ~moeda_real(.x)) %&gt;% 
  mutate_if(is.numeric, ~ifelse(is.na(.x), &quot;-&quot;, format(.x, digits = 2))) %&gt;% 
  mutate(close = cell_spec(moeda_real(close), &quot;html&quot;, color = &quot;blue&quot;)) %&gt;% 
  kable2()</code></pre>
<center>
<img src="/post/2020-03-25-investment-alert/img4.png" style="width:80.0%" />
</center>
<p>Com os valores da Montagem organizados e os valores da Desmontagem coletados em tempo real j√° podemos construir nossa tabela financeira automatizada.</p>
<p>A tabela cont√©m:</p>
<ul>
<li>Valores de cota√ß√£o e quantidade adquiridas de cada uma no momento da montagem da carteira;</li>
<li>Valores de cada cota√ß√£o no momento atual com suas respectivas quantidades dispon√≠veis;</li>
<li>Resultados de o ganho (ou perda) seguido do resultado bruto caso realize a venda agora;</li>
<li>√öltima coluna indica se vale a pena vender ou n√£o aquela cota√ß√£o considerando que o valor de venda √© superior ao valor de compra.</li>
</ul>
<div class="w3-panel w3-pale-yellow w3-border">
<p><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> <strong>Aviso</strong>: Essa opera√ß√£o de vender o ativo caso o pre√ßo da venda seja maior que o da compra √© apenas um exemplo. Poder√≠amos utilizar diversas estat√≠sticas para determinar o momento da opera√ß√£o por√©m adotei esta apenas para ilustrar o funcionamento da tabela financeira, o limite de op√ß√µes √© a sua criatividade!</p>
</div>
<p>Veja a tabela final com os resultados atualizados em tempo real:</p>
<pre class="r"><code>porcentagem &lt;- function(x){paste0(round(x,2), &quot;%&quot;)} # Funcao auxiliar

# Tabela resultado
financas &lt;- 
  tibble(
    ativo = portifolio,
    cot_inicio = cot_inicio,
    qtd_inicio = qtd_inicio,
    vol_inicio = cot_inicio * qtd_inicio,
    cot_atual = consulta_atual$close,
    qtd_atual = qtd_inicio,
    vol_atual = cot_atual * qtd_atual,
    ganho_perda = vol_atual - vol_inicio,
    resultado_bruto = ganho_perda / vol_inicio * 100
  ) 


tabela &lt;- 
  financas %&gt;% 
  mutate(
    cot_inicio = moeda_real(cot_inicio),
    cot_atual = moeda_real(cot_atual),
    vol_inicio = moeda_real(vol_inicio),
    vol_atual = moeda_real(vol_atual),
    qtd_inicio = round(qtd_inicio,4),
    qtd_atual = round(qtd_atual,4),
    ` ` = ifelse(ganho_perda &gt; 0,&quot;\u2713&quot;, &quot;\u2718&quot;) ,
    cot_atual = cell_spec(cot_atual, &quot;html&quot;, color = &quot;blue&quot;),
    ganho_perda = cell_spec(moeda_real(ganho_perda), &quot;html&quot;,
                            color = ifelse(ganho_perda &gt; 0, 
                                           &quot;green&quot;, &quot;red&quot;)),
    resultado_bruto = cell_spec(porcentagem(resultado_bruto), &quot;html&quot;,
                                color = ifelse(resultado_bruto &gt; 0, 
                                               &quot;green&quot;, &quot;red&quot;))) %&gt;% 
  `colnames&lt;-`(stringr::str_replace_all(colnames(.), &quot;(_|[[:space:]])&quot;, &quot;\n&quot;)) %&gt;% 
  # Exibicao
  kable(format = &quot;html&quot;, escape = F) %&gt;%
  kable_styling(c(&quot;striped&quot;, &quot;bordered&quot;, &quot;hover&quot;, &quot;responsive&quot;), full_width = T, font_size = 12) %&gt;%
  add_header_above(c(&quot; &quot;, &quot;Montagem&quot; = 3,
                     &quot;Desmontagem / Atual&quot; = 3, &quot;Resultado&quot; = 3))

tabela</code></pre>
<center>
<img src="/post/2020-03-25-investment-alert/img5.png" style="width:80.0%" />
</center>
<p>Agora que j√° possu√≠mos nossa requisi√ß√£o completa e arrumada em tempo real precisamos ter acesso a esta informa√ß√£o de forma din√¢mica tamb√©m e para isso utilizaremos o bot do Telegram.</p>
</div>
</div>
<div id="bot-telegram" class="section level1">
<h1>Bot Telegram</h1>
<p>Depois de muitas decis√µes tomadas enfim chegamos ao bot! Espero que tenha notado que montar uma carteira n√£o √© uma tarefa f√°cil pois envolve exposi√ß√£o ao risco e tamb√©m exige certo acompanhamento do mercado.</p>
<div class="row">
<div class="column8">
<p></br>
Para criar um bot no Telegram basta seguir os passos do <a href="https://github.com/lbraglia/telegram">readme</a> do pacote <a href="https://github.com/lbraglia/telegram"><code>telegram</code></a> disponibilizado no Github ou seguir os passos desse excelente <a href="https://www.curso-r.com/blog/2017-08-19-r-telegram-bitcoin/">post do curso-r</a> que me inspirou a uns anos atras e hoje me auxiliou novamente para criar este bot. Ao concluir a etapa de configura√ß√£o teremos um novo contado no Telegram, o nosso bot!</p>
<p>Com a configura√ß√£o no aplicativo do Telegram conclu√≠da, o primeiro passo para configurar as a√ß√µes do bot no R √© iniciar um objeto TGBot declarando o id do seu bot. No meu caso o bot se chama <em>Stocks</em> e o id √© <em>fgstockbot</em>.</p>
</div>
<div class="column4">
</br>
<center>
<img src="/post/2020-03-25-investment-alert/bot_telegram.png" style="width:99.0%" />
</center>
</div>
</div>
<p>Com o R conectado ao bot do Telegram j√° somos capazes de criar um conjunto de regras de forma que o bot nos retorne as informa√ß√µes que desejamos.</p>
<p>Desenvolveremos a fun√ß√£o <code>report_stocks()</code> que programa o bot para realizar o seguinte algoritmo:</p>
<ol start="0" style="list-style-type: decimal">
<li>Carregar depend√™ncias e conectar chaves de acesso</li>
<li>Conferir se a bolsa de valores esta aberta</li>
<li>Requisi√ß√£o das cota√ß√µes da bolsa de valores em <em>real-time</em></li>
<li>Requisi√ß√£o da cota√ß√£o do Bitcoin em <em>real-time</em></li>
<li>Combinar resultados</li>
<li>Inserir resultados da coleta na tabela financeira</li>
<li>Se o valor de algum volume atual seja maior que o volume inicial:
<ul>
<li>Calcular valores de desmontagem</li>
<li>Preparar layout da tabela financeira</li>
<li>Salvar resultados</li>
<li>Enviar via Telegram</li>
</ul></li>
<li>Aguardar 20 minutos para a pr√≥xima requisi√ß√£o</li>
<li>Repetir todo o processo</li>
</ol>
<p>Parece complicado mas √© tranquilo pois todos os c√≥digos de cada uma destas tarefas j√° foram desenvolvidos nas se√ß√µes anteriores e ser√£o apenas combinados. A fun√ß√£o <a href="https://gist.github.com/gomesfellipe/357af0735d2aedca60146a7655e33929"><code>report_stocks()</code> j√° esta dispon√≠vel no github</a>, veja a baixo:</p>
<p>(A frequ√™ncia adotata como default pela fun√ß√£o tenta fazer a requisi√ß√£o com a maior frequ√™ncia poss√≠vel na api do Alphavantage)</p>
<script src="https://gist.github.com/gomesfellipe/357af0735d2aedca60146a7655e33929.js"></script>
<p>Ap√≥s todas as devidas configura√ß√µes, basta carregar a fun√ß√£o e executar para obter o seguinte resultado:</p>
<pre class="r"><code># https://gist.github.com/gomesfellipe/357af0735d2aedca60146a7655e33929
devtools::source_gist(&quot;357af0735d2aedca60146a7655e33929&quot;,quiet = T)

# Executar
bot_report_stocks(portifolio = portifolio, 
                  cot_inicio = cot_inicio,
                  qtd_inicio = qtd_inicio)</code></pre>
<center>
<img src="/post/2020-03-25-investment-alert/report_stocks.gif" style="width:70.0%" />
</center>
<p></br>
E assim obtemos um feedback atrav√©s do nosso Smartphone ou Smartwatch em tempo real sobre o desempenho da nossa carteira!</p>
</div>
<div id="conclus√£o-e-pr√≥ximos-passos" class="section level1">
<h1>Conclus√£o e pr√≥ximos passos</h1>
<p>Neste post criamos um bot que coleta os dados e faz an√°lises disponibilizando-as em tempo real no Telegram. Por√©m vimos tamb√©m o qu√£o dif√≠cil pode ser a montagem de uma carteira e as an√°lises envolvendo s√©ries hist√≥ricas de ativos.</p>
<p>Diante dos resultados obtidos aqui existe uma grande gama de op√ß√µes de inova√ß√µes para trabalhos futuros como:</p>
<ul>
<li>Programar o bot para responder a uma <a href="https://support.apple.com/pt-br/guide/watch/apd92a90f882/watchos">menssagem r√°pida no smartwatch</a> com o valor de uma previs√£o;</li>
<li>Desenvolver um Shiny parametrizando o bot para consultar an√°lises em tempo real;</li>
<li>Hospedar a rotina em um servidor para operacionalizar o bot (caso tenha d√∫vidas de como se iniciar um RStudio Server u um Shiny Server <a href="https://gomesfellipe.github.io/post/2018-10-27-server-cloud/server-cloud/">consulte este post do blog</a>);</li>
<li>Criar uma API com <a href="https://www.rplumber.io">plumber</a> para fornecer os resultados;</li>
<li>Treinar modelo utilizando mais dados, mais vari√°veis explicativas e tuning dos par√¢metros;</li>
<li>Criar pacote com um rob√¥ mais geral para responder diferentes consultas.</li>
</ul>
<p>Espero que tenha gostado qualquer d√∫vida deixe nos coment√°rios!</p>
</div>
<div id="refer√™ncias" class="section level1">
<h1>Refer√™ncias</h1>
<ul>
<li><a href="https://www.infomoney.com.br/minhas-financas/brasileiros-nao-sabem-a-diferenca-entre-poupar-e-investir-afirma-especialista-2/" class="uri">https://www.infomoney.com.br/minhas-financas/brasileiros-nao-sabem-a-diferenca-entre-poupar-e-investir-afirma-especialista-2/</a></li>
<li><a href="https://www.btgpactualdigital.com/blog/investimentos/diversificacao-de-investimentos" class="uri">https://www.btgpactualdigital.com/blog/investimentos/diversificacao-de-investimentos</a></li>
<li><a href="https://www.btgpactualdigital.com/blog/coluna-gustavo-cerbasi/defina-sua-estrategia-entre-renda-fixa-ou-variavel" class="uri">https://www.btgpactualdigital.com/blog/coluna-gustavo-cerbasi/defina-sua-estrategia-entre-renda-fixa-ou-variavel</a></li>
<li><a href="https://blog.earo.me/2018/12/20/reintro-tsibble/" class="uri">https://blog.earo.me/2018/12/20/reintro-tsibble/</a></li>
<li><a href="https://www.tradingcomdados.com/post/2017/07/09/estudo-de-correla%C3%A7%C3%A3o-entre-a%C3%A7%C3%B5es-da-bolsa-de-valores-de-s%C3%A3o-paulo" class="uri">https://www.tradingcomdados.com/post/2017/07/09/estudo-de-correla%C3%A7%C3%A3o-entre-a%C3%A7%C3%B5es-da-bolsa-de-valores-de-s%C3%A3o-paulo</a></li>
<li><a href="https://www.business-science.io/code-tools/2017/10/28/demo_week_h2o.html" class="uri">https://www.business-science.io/code-tools/2017/10/28/demo_week_h2o.html</a></li>
<li><a href="https://www.infomoney.com.br/mercados/adolescente-fica-milionario-aos-18-anos-usando-bitcoins-apos-fazer-aposta-com-os-pais/" class="uri">https://www.infomoney.com.br/mercados/adolescente-fica-milionario-aos-18-anos-usando-bitcoins-apos-fazer-aposta-com-os-pais/</a></li>
<li><a href="https://www.infomoney.com.br/onde-investir/halving-conheca-o-processo-que-pode-levar-o-bitcoin-a-uma-nova-explosao-de-preco/" class="uri">https://www.infomoney.com.br/onde-investir/halving-conheca-o-processo-que-pode-levar-o-bitcoin-a-uma-nova-explosao-de-preco/</a></li>
<li><a href="https://cran.r-project.org/web/packages/telegram/README.html" class="uri">https://cran.r-project.org/web/packages/telegram/README.html</a></li>
<li><a href="https://otexts.com/fpp2/" class="uri">https://otexts.com/fpp2/</a>
<a href="https://www.curso-r.com/blog/2017-08-19-r-telegram-bitcoin/" class="uri">https://www.curso-r.com/blog/2017-08-19-r-telegram-bitcoin/</a></li>
<li><a href="https://www.curso-r.com/blog/2017-08-19-r-telegram-bitcoin/" class="uri">https://www.curso-r.com/blog/2017-08-19-r-telegram-bitcoin/</a></li>
</ul>
</div>

        <p><strong>Leia o post completo em:</strong> <a href="https://gomesfellipe.github.io/post/2020-03-25-investment-alert/investment-alert/">Desenvolva um bot e receba resultados de Machine Learning no seu Smartphone para ajudar nos investimentos</a></p>
        <p><em>Este post foi originalmente publicado em <a href="https://gomesfellipe.github.io/">Fellipe Gomes - Data Science Blog</a></em></p>
      ]]></content:encoded>
      <category>Fundamentos de Data Science</category>
      <category>Intelig√™ncia Artificial</category>
      <category>Machine Learning</category>
      <category>Programa√ß√£o e Ferramentas</category>
      <category domain="tag">bitcoin</category>
      <category domain="tag">bolsa-de-valores</category>
      <category domain="tag">correlacao</category>
      <category domain="tag">dplyr</category>
      <category domain="tag">estatistica</category>
      <category domain="tag">machine-learning</category>
      <category domain="tag">modelagem</category>
      <category domain="tag">prophet</category>
      <category domain="tag">r</category>
      <category domain="tag">reports</category>
    </item>
    <item>
      <title>Tipos de rela√ß√µes entre vari√°veis</title>
      <link>https://gomesfellipe.github.io/post/2017-12-02-tipos-de-relacoes-entre-variaveis/</link>
      <pubDate>Sat, 02 Dec 2017 00:00:00 +0000</pubDate>
      <author>gomes.fellipe1@gmail.com (Fellipe Carvalho Gomes)</author>
      <guid>https://gomesfellipe.github.io/post/2017-12-02-tipos-de-relacoes-entre-variaveis/</guid>
      <description>Tipos de rela√ß√µes Vimos no √∫ltimo post sobre quais tipos de medidas de correla√ß√£o e associa√ß√£o podem ser calculadas para identificar o grau de associa√ß√£o (ou depend√™ncia) entre as vari√°veis.
J√° sabemos que esses coeficientes variam entre 0 e 1 ou entre -1 e +1, de maneira que a proximidade de zero indique a falta de associa√ß√£o entre elas.
Por√©m o que fazer com tantas m√©tricas? Qual o c√°lculo mais aconselhado para as rela√ß√µes dois a dois de cada tipo de vari√°veis (medidas, quantidades, nomes, classes com algum tipo de ordem ou hierarquia)?</description>
      <content:encoded>&lt;![CDATA[
        
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<div id="tipos-de-rela√ß√µes" class="section level1">
<h1>Tipos de rela√ß√µes</h1>
<p>Vimos no <a href="https://gomesfellipe.github.io/post/tipos-de-correlacoes/">√∫ltimo post</a> sobre quais tipos de medidas de correla√ß√£o e associa√ß√£o podem ser calculadas para identificar o grau de associa√ß√£o (ou depend√™ncia) entre as vari√°veis.</p>
<p>J√° sabemos que esses coeficientes variam entre 0 e 1 ou entre -1 e +1, de maneira que a proximidade de zero indique a falta de associa√ß√£o entre elas.</p>
<p>Por√©m o que fazer com tantas m√©tricas? Qual o c√°lculo mais aconselhado para as rela√ß√µes dois a dois de cada tipo de vari√°veis (medidas, quantidades, nomes, classes com algum tipo de ordem ou hierarquia)?</p>
<p>N√£o basta chegar no R e fazer um <code>pairs(dados)</code> junto com <code>cor(dados)</code> e olhar aquele monte de n√∫meros sem saber se eles apresentam algum resultado realmente relevante embasado na teoria estat√≠stica.</p>
<p>Vejamos ent√£o os tipos de rela√ß√µes poss√≠veis e quais tipos de medidas podem ser utilizadas a seguir.</p>
</div>
<div id="num√©rica-x-num√©rica" class="section level1">
<h1>Num√©rica x Num√©rica</h1>
<p>Tipos de medidas que podem ser utilizadas:</p>
<ul>
<li>Pearson (Intensidade de relacionamento linear)</li>
<li>Spearman (Rela√ß√£o monot√¥nica entre dados emparelhados)</li>
<li>Kendall (Correla√ß√£o entre duas vari√°veis ordinais de amostras pequenas)</li>
</ul>
<div id="graficamente" class="section level2">
<h2>Graficamente</h2>
<p>Um jeito informal e intuitivo de avaliar a rela√ß√£o √© verificar se existe rela√ß√£o linear entre as vari√°veis, al√©m de identificar se esta rela√ß√£o √© positiva, negativa ou inexistente.</p>
<div id="duas-variaveis" class="section level3">
<h3>Duas variaveis</h3>
<p>Algumas op√ß√µes de como avaliar graficamente duas vari√°veis:</p>
<p><img src="/post/2017-12-02-tipos-de-relacoes-entre-variaveis_files/figure-html/unnamed-chunk-1-1.png" width="672" /><img src="/post/2017-12-02-tipos-de-relacoes-entre-variaveis_files/figure-html/unnamed-chunk-1-2.png" width="672" /></p>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="/post/2017-12-02-tipos-de-relacoes-entre-variaveis_files/figure-html/unnamed-chunk-1-3.png" width="672" /></p>
</div>
<div id="mais-de-duas-vari√°veis" class="section level3">
<h3>Mais de duas vari√°veis</h3>
<p>Quando existe a presen√ßa de mais de duas vari√°veis em estudo podemos utilizar outras caracter√≠sticas gr√°ficas al√©m do eixo x e y para identificar padr√µes, veja:</p>
<p><img src="/post/2017-12-02-tipos-de-relacoes-entre-variaveis_files/figure-html/unnamed-chunk-2-1.png" width="672" /><img src="/post/2017-12-02-tipos-de-relacoes-entre-variaveis_files/figure-html/unnamed-chunk-2-2.png" width="672" /><img src="/post/2017-12-02-tipos-de-relacoes-entre-variaveis_files/figure-html/unnamed-chunk-2-3.png" width="672" /></p>
</div>
</div>
<div id="normalidade" class="section level2">
<h2>Normalidade</h2>
<p>A suposi√ß√£o de normalidade √© amplamente utilizada na estat√≠stica.</p>
<div id="graficamente-1" class="section level3">
<h3>Graficamente</h3>
<p>Avaliando a normalidade de forma visual com alguns comandos do ggplot:</p>
<pre class="r"><code>### Verificando a Normalidade Atrav√©s do Histograma

# Criando um painel com o espa√ßo de 4 gr√°ficos
par(mfrow=c(2,2))

#preenchendo os quatro espa√ßos com 4 histogramas (um para cada vari√°vel)
histogram=function(x){
  hist(x,prob=T)
  lines(density(x),col=&quot;red&quot;)
  curve(dnorm(x,mean(x), sd(x)),add=T,col=&quot;blue&quot;)
}
histogram(dados$GASTEDU)
histogram(dados$GASAUDE)
histogram(dados$GASLAZER)
histogram(dados$IDADE)</code></pre>
<p><img src="/post/2017-12-02-tipos-de-relacoes-entre-variaveis_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
<div id="qq-plot" class="section level3">
<h3>QQ-plot</h3>
<p>Compara os quantis dos dados com os quantis de uma normal padr√£o</p>
<pre class="r"><code>par(mfrow=c(2,2))
### Verificando a Normalidade Atrav√©s do QQplot
qq = function(x){
  qqnorm(x,main = &quot;&quot;, xlab = &quot;Quantis te√≥ricos N(0,1)&quot;, pch = 20)
qqline(x, lty = 1, col = &quot;red&quot;)
}

qq(dados$IDADE)
qq(dados$GASAUDE)
qq(dados$GASLAZER)
qq(dados$GASTEDU)</code></pre>
<p><img src="/post/2017-12-02-tipos-de-relacoes-entre-variaveis_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="qq-plot-com-envelope" class="section level3">
<h3>QQ plot com envelope</h3>
<p>Incluindo uma regi√£o de aceita√ß√£o, para cada ponto constroi o intervalo de confian√ßa</p>
<pre class="r"><code>#Envelope
envelope&lt;-function(x){
  n &lt;- length(x)
  nsim &lt;- 100 # N√∫mero de simula√ß√µes
  conf &lt;- 0.95 # Coef. de confian√ßa
  # Dados simulados ~ normal
  dadossim &lt;- matrix(rnorm(n*nsim, mean = mean(x), sd = sd(x)), nrow = n)
  dadossim &lt;- apply(dadossim,2,sort)
  # Limites da banda e m√©dia
  infsup&lt;-apply(dadossim,1,quantile, probs = c((1 - conf) / 2,(1 + conf) / 2))
  xbsim &lt;- rowMeans(dadossim)
  faixay &lt;- range(x, dadossim)
  qq0 &lt;- qqnorm(x, main = &quot;&quot;, xlab = &quot;Quantis te√≥ricos N(0,1)&quot;, pch = 20, ylim = faixay)
  eixox &lt;- sort(qq0$x)
  lines(eixox, xbsim)
  lines(eixox, infsup[1,], col = &quot;red&quot;)
  lines(eixox, infsup[2,], col = &quot;red&quot;)
}

par(mfrow=c(2,2))
envelope(dados$GASTEDU)
envelope(dados$GASAUDE)
envelope(dados$GASLAZER)
envelope(dados$IDADE)</code></pre>
<p><img src="/post/2017-12-02-tipos-de-relacoes-entre-variaveis_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="testes" class="section level3">
<h3>Testes</h3>
<p>A seguir, diversos testes de hip√≥teses para avaliar:</p>
<p><span class="math display">\[
H_0: \text{Dados Normais} \\
H_1: \text{Dados N√£o Normais} 
\]</span></p>
<p>A seguir uma fun√ß√£o que criei colocando logo uma variedade de testes para fornecer diferentes evid√™ncias para nossa hip√≥tese:</p>
<pre class="r"><code>normalidade&lt;-function(x){
t1 &lt;- ks.test(x, &quot;pnorm&quot;,mean(x), sd(x)) # KS  
t2 &lt;- lillie.test(x) # Lilliefors
t3 &lt;- cvm.test(x) # Cram√©r-von Mises
t4 &lt;- shapiro.test(x) # Shapiro-Wilk 
t5 &lt;- sf.test(x) # Shapiro-Francia
t6 &lt;- ad.test(x) # Anderson-Darling
t7&lt;-pearson.test(x) # Pearson Test of Normality

testes &lt;- c(t1$method, t2$method, t3$method, t4$method, t5$method,t6$method,t7$method)
valorp &lt;- c(t1$p.value, t2$p.value, t3$p.value, t4$p.value, t5$p.value,t6$p.value,t7$p.value)

resultados &lt;- cbind(valorp)
rownames(resultados) &lt;- testes
print(resultados, digits = 4)

}

normalidade(dados$GASAUDE)</code></pre>
<pre><code>##                                                valorp
## One-sample Kolmogorov-Smirnov test             0.9238
## Lilliefors (Kolmogorov-Smirnov) normality test 0.6494
## Cramer-von Mises normality test                0.6605
## Shapiro-Wilk normality test                    0.6297
## Shapiro-Francia normality test                 0.6286
## Anderson-Darling normality test                0.6346
## Pearson chi-square normality test              0.3249</code></pre>
</div>
</div>
<div id="dados-normais-rela√ß√£o-linear" class="section level2">
<h2>Dados normais + Rela√ß√£o linear</h2>
<p>Quando os dados s√£o normais e a rela√ß√£o entre vari√°veis √© linear, podemos utilizar os mesmos testes j√° comentados:</p>
<ul>
<li>Pearson</li>
<li>Spearman (amostras maiores)</li>
<li>Kendall (amostras pequenas)</li>
</ul>
<div id="coeficiente-de-correla√ß√£o-de-pearson-rho" class="section level3">
<h3>Coeficiente de Correla√ß√£o de Pearson <span class="math inline">\(\rho\)</span></h3>
<p>No R:</p>
<pre class="r"><code>#Matriz de correla√ß√µes:
cor(dados$GASTEDU,dados$GASAUDE)</code></pre>
<pre><code>## [1] 0.77825</code></pre>
<p>Como saber se a correla√ß√£o √© significativa?</p>
<p><span class="math display">\[
H_0: \text{N√£o existe correla√ß√£o} \\
H_1: \text{Existe correla√ß√£o} 
\]</span></p>
<p>Aplicando o teste:</p>
<pre class="r"><code>#Teste de correla√ß√£o:
cor.test(dados$GASTEDU,dados$GASAUDE,method = &quot;pearson&quot;)</code></pre>
</div>
</div>
<div id="dados-n√£o-normais-eou-sem-rela√ß√£o-linear" class="section level2">
<h2>Dados n√£o normais e/ou sem rela√ß√£o linear</h2>
<p>Quando os dados n√£o se apresentam conforme a distribui√ß√£o normal ou n√£o apresentam rela√ß√£o linear, temos dispon√≠veis o c√°lculo das seguintes correla√ß√µes:</p>
<ul>
<li>Spearman (amostras maiores)</li>
<li>kendall (amostras pequenas)</li>
</ul>
<div id="coeficiente-de-correla√ß√£o-de-spearman-rho" class="section level3">
<h3>Coeficiente de Correla√ß√£o de Spearman <span class="math inline">\(\rho\)</span></h3>
<p>Ideal quando temos vari√°veis medidas apenas em uma escala ordinal.</p>
<p>Executando no R:</p>
<pre class="r"><code>#Teste de correla√ß√£o:
cor.test(dados$GASTEDU,dados$GASAUDE,method = &quot;spearman&quot;)</code></pre>
</div>
<div id="coeficiente-de-correla√ß√£o-de-kendall-tau-de-kendall" class="section level3">
<h3>Coeficiente de Correla√ß√£o de Kendall (<span class="math inline">\(\tau\)</span> de kendall)</h3>
<p>Coeficiente de Kendall √©, muitas vezes, interpretado como uma medida de concord√¢ncia entre dois conjuntos de classifica√ß√µes relativas a um conjunto de objetos de estudo.</p>
<p>Vamos considerar apenas os 20 primeiros elementos da amostra:</p>
<p>Aplica√ß√£o no R:</p>
<pre class="r"><code>#Teste de correla√ß√£o:
cor.test(dados2$IDADE,dados2$GASAUDE,method = &quot;kendall&quot;)</code></pre>
</div>
</div>
</div>
<div id="ordinal-x-ordinal" class="section level1">
<h1>Ordinal x Ordinal</h1>
<p>Tipos de correla√ß√µes poss√≠veis para calcular:</p>
<ul>
<li>Spearman (amostras maiores)</li>
<li>kendall (amostras pequenas)</li>
</ul>
<p>Exemplo de uso de Spearman no R:</p>
<pre class="r"><code>cor(dados$ESCOLAR, dados$RENDA, method = &quot;spearman&quot;)
cor.test(dados$ESCOLAR, dados$RENDA, method = &quot;spearman&quot;)</code></pre>
<p>Exemplo de uso de Kendall com uma amostra menor:</p>
<pre class="r"><code>cor(dados2$ESCOLAR, dados2$RENDA, method = &quot;kendall&quot;)
cor.test(dados2$ESCOLAR, dados2$RENDA, method = &quot;kendall&quot;)</code></pre>
</div>
<div id="num√©rica-x-ordinal" class="section level1">
<h1>Num√©rica x Ordinal</h1>
<p>Independente de ser normal ou n√£o</p>
<ul>
<li>Spearman (amostras maiores)</li>
<li>Kendall (amostras pequenas)</li>
<li>Compara√ß√µes de grupos (Testes de Hip√≥teses)</li>
</ul>
<p>Exemplo de uso de Spearman no R:</p>
<pre class="r"><code>cor(dados$IDADE, dados$RENDA, method = &quot;spearman&quot;)
cor.test(dados$IDADE, dados$RENDA, method = &quot;spearman&quot;)</code></pre>
<p>Exemplo de uso de Kendall com uma amostra menor:</p>
<pre class="r"><code>cor(dados2$IDADE, dados2$RENDA, method = &quot;kendall&quot;)
cor.test(dados2$IDADE, dados2$RENDA, method = &quot;kendall&quot;)</code></pre>
</div>
<div id="nominal-x-nominal" class="section level1">
<h1>Nominal x Nominal</h1>
<p>Os termos n√≠vel nominal de
medida ou escala nominal s√£o utilizadas para se referir
a √†queles dados que s√≥ podem ser categorizados. No
sentido estrito, n√£o existe uma medida ou escala envolvida,
o que existe √© apenas uma contagem.</p>
<p>Vamos avaliar a profiss√£o e o estado civil primeiramente, precisamos da tabela de conting√™ncia.</p>
<p>Tabelas de Conting√™ncia (ou tabelas de freq√º√™ncia de dupla entrada) s√£o tabelas em que as frequ√™ncias correspondem a duas classifica√ß√µes, uma classifica√ß√£o est√° nas linhas da tabela e a outra est√° nas colunas. Veja:</p>
<pre class="r"><code>tab=ftable(as.factor(dados$PROFI),
      as.factor(dados$ESTCIVIL),
      dnn=c(&quot;Profiss√£o&quot;, &quot;EStado Civil&quot;))
tab</code></pre>
<pre><code>##           EStado Civil  1  2  3  4
## Profiss√£o                         
## 1                      26 13 29  1
## 2                      24  6 21  0</code></pre>
<div id="qui-quadrado-de-independencia" class="section level2">
<h2>Qui-quadrado de independencia</h2>
<p><span class="math display">\[
H_0: \text{S√£o independentes (N√£o associadas)} \\
H_1: \text{N√£o s√£o independentes (S√£o associadas) }
\]</span></p>
<p>Executando o teste:</p>
<pre class="r"><code>chisq.test(dados$PROFI, dados$ESTCIVIL)</code></pre>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  dados$PROFI and dados$ESTCIVIL
## X-squared = 2.2905, df = 3, p-value = 0.5143</code></pre>
<p><strong>OBS</strong>: Corre√ß√£o de YAKES quando existe alguma frequ√™ncia esperada menor do que 5, veja:</p>
</div>
<div id="teste-exato-de-fisher" class="section level2">
<h2>Teste exato de fisher</h2>
<p>O teste qui-quadrado quando aplicado a amostras pequenas, como por exemplo com tamanho inferior a 20, veja:</p>
<pre class="r"><code>fisher.test(dados2$PROFI, dados2$ESTCIVIL)</code></pre>
<pre><code>## 
##  Fisher&#39;s Exact Test for Count Data
## 
## data:  dados2$PROFI and dados2$ESTCIVIL
## p-value = 0.5226
## alternative hypothesis: two.sided</code></pre>
</div>
<div id="medidas-de-associa√ß√£o" class="section level2">
<h2>Medidas de associa√ß√£o</h2>
<p>os testes fornecem apenas a resposta se as vari√°veis est√£o ou n√£o correlacionadas. Para saber a intensidade desta rela√ß√£o, utilizam-se medidas de associa√ß√£o.</p>
<p>Considere as seguintes medidas:</p>
<ul>
<li><span class="math inline">\(\mathbf{\phi}\)</span> <strong>(phi)</strong> (√© o R de pearson quando aplicado a tabelas 2x2)</li>
<li><strong>V de Cr√°mer</strong></li>
<li><strong>Coeficiente de conting√™ncia</strong></li>
</ul>
<p>Ambos variam de 0 (aus√™ncia de associa√ß√£o) a 1 (associa√ß√£o muito forte).</p>
<pre class="r"><code>#Comando para tabela cruzada:
tab &lt;- xtabs(~ PROFI + ESTCIVIL, data = dados)

#Calcular as medidas de associa√ß√£o da tabela:
summary(assocstats(tab))</code></pre>
<pre><code>## 
## Call: xtabs(formula = ~PROFI + ESTCIVIL, data = dados)
## Number of cases in table: 120 
## Number of factors: 2 
## Test for independence of all factors:
##  Chisq = 2.2905, df = 3, p-value = 0.5143
##  Chi-squared approximation may be incorrect
##                     X^2 df P(&gt; X^2)
## Likelihood Ratio 2.6823  3  0.44324
## Pearson          2.2905  3  0.51435
## 
## Phi-Coefficient   : NA 
## Contingency Coeff.: 0.137 
## Cramer&#39;s V        : 0.138</code></pre>
<pre class="r"><code>#phi  (r aplicado na Tabela de 2x2 --&gt; Phi)
cor(dados$PROFI,dados$ESTCIVIL)  </code></pre>
<pre><code>## [1] -0.06972599</code></pre>
</div>
<div id="kappa" class="section level2">
<h2>Kappa</h2>
<p>√â uma medida de concord√¢ncia.</p>
<p><strong>Obs</strong>: Tamb√©m pode ser utilizado o coeficiente de Kappa ponderado (pesquisar)</p>
<pre class="r"><code>#Kappa
medico1&lt;-sample(0:1,10, replace=T)
medico2&lt;-sample(0:1,10, replace=T)

#Kappa.test(x, y=NULL, conf.level=0.95)

fmsb::Kappa.test(medico1,medico2)</code></pre>
<pre><code>## $Result
## 
##  Estimate Cohen&#39;s kappa statistics and test the null hypothesis that
##  the extent of agreement is same as random (kappa=0)
## 
## data:  medico1 and medico2
## Z = -1.2649, p-value = 0.897
## 95 percent confidence interval:
##  -0.9680515  0.1680515
## sample estimates:
## [1] -0.4
## 
## 
## $Judgement
## [1] &quot;No agreement&quot;</code></pre>
</div>
</div>
<div id="nominal-x-ordinal" class="section level1">
<h1>Nominal x Ordinal</h1>
<p>Vamos avaliar a profiss√£o e o estado civil primeiramente, precisamos da tabela de conting√™ncia:</p>
<pre class="r"><code>tab=ftable(as.factor(dados$PROFI),
      as.factor(dados$RENDA),
      dnn=c(&quot;Profiss√£o&quot;, &quot;Renda&quot;))
tab</code></pre>
<pre><code>##           Renda  1  2  3  4
## Profiss√£o                  
## 1                4 52  9  4
## 2                0 30 17  4</code></pre>
<div id="qui-quadrado-de-independencia-1" class="section level2">
<h2>Qui-quadrado de independencia</h2>
<p><span class="math display">\[
H_0: \text{S√£o independentes (N√£o associadas)} \\
H_1: \text{N√£o s√£o independentes (S√£o associadas) }
\]</span></p>
<p>Executando o teste:</p>
<pre class="r"><code>chisq.test(dados$PROFI, dados$RENDA)</code></pre>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  dados$PROFI and dados$RENDA
## X-squared = 9.8864, df = 3, p-value = 0.01956</code></pre>
<p><strong>OBS</strong>: Corre√ß√£o de YAKES quando existe alguma frequ√™ncia esperada menor do que 5, veja:</p>
</div>
<div id="teste-exato-de-fisher-1" class="section level2">
<h2>Teste exato de fisher</h2>
<p>O teste qui-quadrado quando aplicado a amostras pequenas, como por exemplo com tamanho inferior a 20, veja:</p>
<pre class="r"><code>fisher.test(dados2$PROFI, dados2$RENDA)</code></pre>
<pre><code>## 
##  Fisher&#39;s Exact Test for Count Data
## 
## data:  dados2$PROFI and dados2$RENDA
## p-value = 1
## alternative hypothesis: two.sided</code></pre>
</div>
<div id="medidas-de-associa√ß√£o-1" class="section level2">
<h2>Medidas de associa√ß√£o</h2>
<p>os testes fornecem apenas a resposta se as vari√°veis est√£o ou n√£o correlacionadas. Para saber a intensidade desta rela√ß√£o, utilizam-se medidas de associa√ß√£o.</p>
<p>Considere as seguintes medidas:</p>
<ul>
<li><span class="math inline">\(\mathbf{\phi}\)</span> <strong>(phi) </strong> (√© o R de pearson quando aplicado a tabelas 2x2)</li>
<li><strong>V de Cr√°mer</strong></li>
<li><strong>Coeficiente de conting√™ncia</strong></li>
</ul>
<p>Ambos variam de 0 (aus√™ncia de associa√ß√£o) a 1 (associa√ß√£o muito forte).</p>
<pre class="r"><code>#Comando para tabela cruzada:
tab &lt;- xtabs(~ PROFI + RENDA, data = dados)

#Calcular as medidas de associa√ß√£o da tabela:
summary(assocstats(tab))</code></pre>
<pre><code>## 
## Call: xtabs(formula = ~PROFI + RENDA, data = dados)
## Number of cases in table: 120 
## Number of factors: 2 
## Test for independence of all factors:
##  Chisq = 9.886, df = 3, p-value = 0.01956
##  Chi-squared approximation may be incorrect
##                      X^2 df P(&gt; X^2)
## Likelihood Ratio 11.3123  3 0.010152
## Pearson           9.8864  3 0.019557
## 
## Phi-Coefficient   : NA 
## Contingency Coeff.: 0.276 
## Cramer&#39;s V        : 0.287</code></pre>
<pre class="r"><code>#phi  (r aplicado na Tabela de 2x2 --&gt; Phi)
cor(dados$PROFI,dados$RENDA)  </code></pre>
<pre><code>## [1] 0.231198</code></pre>
</div>
<div id="kappa-1" class="section level2">
<h2>Kappa</h2>
<p>Testa a concord√¢ncia entre duas pessoas (a hip√≥tese nula √© de que a concord√¢ncia √© zero)</p>
<pre class="r"><code>#Kappa
medico1&lt;-sample(0:1,10, replace=T)
medico2&lt;-sample(0:1,10, replace=T)

#Kappa.test(x, y=NULL, conf.level=0.95)

fmsb::Kappa.test(medico1,medico2)</code></pre>
<pre><code>## $Result
## 
##  Estimate Cohen&#39;s kappa statistics and test the null hypothesis that
##  the extent of agreement is same as random (kappa=0)
## 
## data:  medico1 and medico2
## Z = 0.2538, p-value = 0.3998
## 95 percent confidence interval:
##  -0.4998102  0.6479584
## sample estimates:
## [1] 0.07407407
## 
## 
## $Judgement
## [1] &quot;Slight agreement&quot;</code></pre>
</div>
</div>
<div id="dicot√¥nica-x-ordinal" class="section level1">
<h1>Dicot√¥nica x Ordinal</h1>
<p>Uma vari√°vel dicot√¥mica √© uma vari√°vel qualitativa que s√≥ possui duas categorias.</p>
<p>Portanto a mesma abordagem utilizada em:</p>
<p>Dicot√¥mica x Ordinal = Nominal x Ordinal = Nominal x Nominal</p>
</div>
<div id="nominal-x-num√©rca" class="section level1">
<h1>Nominal x Num√©rca</h1>
<div id="r2-do-ajuste-de-modelos-lineares" class="section level2">
<h2><span class="math inline">\(R^2\)</span> do ajuste de modelos lineares</h2>
<p>Pode-se ajustar um modelo de regress√£o linear simples e avaliar seu coeficiente de determina√ß√£o, veja:</p>
<pre class="r"><code>#R2:
summary(lm(dados$GASAUDE~dados$ESTCIVIL))$r.squared</code></pre>
<pre><code>## [1] 0.0001015817</code></pre>
</div>
<div id="bisserial-pearson" class="section level2">
<h2>Bisserial = Pearson</h2>
<p>O pearson aplicada em uma rela√ß√£o de vari√°vel dicot√¥mica com uma vari√°vel ordinal</p>
</div>
<div id="compara√ß√µes-de-grupos" class="section level2">
<h2>Compara√ß√µes de Grupos</h2>
<p>Quando por exemplo, trabalha-se com ‚Äúrenda por grupo‚Äù, existem muitas abordagens como o teste t ou anova como op√ß√µes de testes param√©tricos e muito mais</p>
</div>
</div>
<div id="correla√ß√£o-parcial" class="section level1">
<h1>Correla√ß√£o parcial</h1>
<div id="controlando-vari√°vel-num√©rica" class="section level2">
<h2>Controlando vari√°vel num√©rica</h2>
<p>Pode ser que queremos estudar a correla√ß√£o entre x e y, por√©m existem uma vari√°vel z que tamb√©m est√° correlacionada com alguma das duas vari√°veis, veja:</p>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="/post/2017-12-02-tipos-de-relacoes-entre-variaveis_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<pre><code>## [1] 0.7821115</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="/post/2017-12-02-tipos-de-relacoes-entre-variaveis_files/figure-html/unnamed-chunk-27-2.png" width="672" /></p>
<pre><code>## [1] 0.7476177</code></pre>
<p><img src="/post/2017-12-02-tipos-de-relacoes-entre-variaveis_files/figure-html/unnamed-chunk-27-3.png" width="672" /></p>
<pre><code>## [1] 0.7821115</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="/post/2017-12-02-tipos-de-relacoes-entre-variaveis_files/figure-html/unnamed-chunk-27-4.png" width="672" /></p>
<pre><code>## [1] 0.77825</code></pre>
<p>Isto implica que a vari√°vel educa√ß√£o √© uma vari√°vel de confus√£o, veja as correla√ß√µes:</p>
<pre><code>## Registered S3 method overwritten by &#39;GGally&#39;:
##   method from   
##   +.gg   ggplot2</code></pre>
<p><img src="/post/2017-12-02-tipos-de-relacoes-entre-variaveis_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>O que acontece com a associa√ß√£o entre lazer e sa√∫de quando controlamos a vari√°vel de confus√£o educa√ß√£o?</p>
<pre class="r"><code># correla√ß√£o LAZER vc SA√öDE controlando o EDUCA√á√ÉO (correla√ß√£o parcial de primeira ordem = um vari√°vel para controlar)
rp&lt;-ggm::pcor(c(&quot;GASLAZER&quot;, &quot;GASAUDE&quot;, &quot;GASTEDU&quot;),var(dados))  #controlando A EDUCA√á√ÉO

#Signific√¢ncia da Correla√ß√£o Parcial

#Coeficiente de Determina√ß√£o com base no Coef. de Pearson
r&lt;-cor(dados$GASLAZER,dados$GASAUDE) #sem controlar o lazer

#Coeficiente de Determina√ß√£o com base na correla√ß√£o parcial
pcor.test(rp,1,length(dados$GASAUDE))  #&quot;1&quot; porque s√≥ usamos uma vari√°vel de controle</code></pre>
<pre><code>## $tval
## [1] 5.922106
## 
## $df
## [1] 117
## 
## $pvalue
## [1] 3.259388e-08</code></pre>
<pre class="r"><code>data.frame(&quot;Sem corre√ß√£o&quot;=r^2, &quot;Com corre√ß√£o&quot;=rp^2)</code></pre>
<pre><code>##   Sem.corre√ß√£o Com.corre√ß√£o
## 1    0.6116985    0.2306242</code></pre>
</div>
<div id="controlando-vari√°vel-qualitativa" class="section level2">
<h2>Controlando vari√°vel Qualitativa</h2>
<p>A vari√°vel de controle (ou qualquer uma delas) pode ser dicot√¥mica (categ√≥rica)</p>
<pre class="r"><code>#Visualmente:
ggplot(data = dados, aes(x = GASLAZER, y = GASAUDE,colour = as.factor(PROFI))) + geom_point()</code></pre>
<p><img src="/post/2017-12-02-tipos-de-relacoes-entre-variaveis_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<pre class="r"><code>#Sem controlar:
r=cor(dados$GASLAZER, dados$GASAUDE)
rp&lt;-pcor(c(&quot;GASLAZER&quot;, &quot;GASAUDE&quot;, &quot;PROFI&quot;),var(dados))
data.frame(&quot;Sem corre√ß√£o&quot;=r^2, &quot;Com corre√ß√£o&quot;=rp^2)</code></pre>
<pre><code>##   Sem.corre√ß√£o Com.corre√ß√£o
## 1    0.6116985    0.6162497</code></pre>
</div>
</div>
<div id="refer√™ncias" class="section level1">
<h1>Refer√™ncias</h1>
<p><a href="https://www.amazon.com.br/Practical-Nonparametric-Statistics-W-Conover/dp/0471160687">CONOVER, W. J. Pratical Nonparametric Statistics</a></p>
<p><a href="https://www.amazon.com.br/Estat%C3%ADstica-n%C3%A3o-Param%C3%A9trica-Para-Ci%C3%AAncias-Comportamento-ebook/dp/B06Y2F9NQY/ref=sr_1_2?s=books&amp;ie=UTF8&amp;qid=1515522153&amp;sr=1-2">SIEGEL, S. Estat√≠stica N√£o Param√©trica para as Ci√™ncias do Comportamento</a></p>
<p><a href="https://www.amazon.com.br/Estat%C3%ADstica-B%C3%A1sica-Pedro-Morettin/dp/8502207997">BUSSAB, W. de O.;MORETTIN, P. A. Estat√≠stica b√°sica. 5 ed.</a></p>
</div>

        <p><strong>Leia o post completo em:</strong> <a href="https://gomesfellipe.github.io/post/2017-12-02-tipos-de-relacoes-entre-variaveis/">Tipos de rela√ß√µes entre vari√°veis</a></p>
        <p><em>Este post foi originalmente publicado em <a href="https://gomesfellipe.github.io/">Fellipe Gomes - Data Science Blog</a></em></p>
      ]]></content:encoded>
      <category>Estatistica</category>
      <category>R</category>
      <category>Teoria</category>
      <category domain="tag">correlacoes</category>
      <category domain="tag">correlacao</category>
      <category domain="tag">ggplot2</category>
      <category domain="tag">r</category>
      <category domain="tag">gomesfellipe</category>
    </item>
  </channel>
</rss>